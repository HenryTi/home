(window.webpackJsonp=window.webpackJsonp||[]).push([[0],[,,,,,,,,,,function(e,t,n){"use strict";n(40);var r=n(24),i=n(36),a=n(38),o=n(23),s=n(0),c=n.n(s),u=n(3),l=n(5),h=n(13),d=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},f=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},p=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];Object(u.a)(this,e),this.isFirst=!0,this.loading=!1,this.beforeLoad=!0,this.loaded=!1,this.allLoaded=!1,this.firstSize=100,this.pageStart=void 0,this.pageSize=30,this.appendPosition="tail",this._items=h.l.array([],{deep:t})}return Object(l.a)(e,[{key:"scrollToTop",value:function(){this.topDiv="$$"+Object(a.a)()}},{key:"scrollToBottom",value:function(){this.bottomDiv="$$"+Object(a.a)()}},{key:"reset",value:function(){this.isFirst=!0,this.beforeLoad=!0,this.loaded=!1,this.param=void 0,this.allLoaded=!1,this._items.clear(),this.setPageStart(void 0)}},{key:"append",value:function(e){"tail"===this.appendPosition?this._items.unshift(e):this._items.push(e)}},{key:"first",value:function(e){return f(this,void 0,void 0,c.a.mark(function t(){return c.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.reset(),this.beforeLoad=!1,this.param=e,t.next=5,this.more();case 5:case"end":return t.stop()}},t,this)}))}},{key:"more",value:function(){return f(this,void 0,void 0,c.a.mark(function e(){var t,n,r,i,a;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!0!==this.allLoaded){e.next=2;break}return e.abrupt("return");case 2:if(!0!==this.loading){e.next=4;break}return e.abrupt("return");case 4:return this.loading=!0,r=this.pageSize+1,!0===this.isFirst&&this.firstSize>this.pageSize&&(r=this.firstSize+1),e.next=9,this.load(this.param,this.pageStart,r);case 9:if(i=e.sent,this.loading=!1,this.loaded=!0,a=i.length,!0===this.isFirst&&a>this.firstSize||!1===this.isFirst&&a>this.pageSize?(this.allLoaded=!1,--a,i.splice(a,1)):this.allLoaded=!0,0!==a){e.next=17;break}return this._items.clear(),e.abrupt("return");case 17:this.setPageStart(i[a-1]),"tail"===this.appendPosition?(t=this._items).push.apply(t,Object(o.a)(i)):(n=this._items).unshift.apply(n,Object(o.a)(i.reverse())),this.isFirst=!1;case 20:case"end":return e.stop()}},e,this)}))}},{key:"items",get:function(){return!0===this.beforeLoad?null:!1!==this.loaded?this._items:void 0}}]),e}();d([h.l],p.prototype,"loading",void 0),d([h.l],p.prototype,"beforeLoad",void 0),d([h.l],p.prototype,"loaded",void 0),d([h.l],p.prototype,"allLoaded",void 0),d([h.e],p.prototype,"items",null),d([h.l],p.prototype,"topDiv",void 0),d([h.l],p.prototype,"bottomDiv",void 0);var v=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},m=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},y=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100;Object(u.a)(this,e),this.arr=[],this.dict=new Map,this.maxCount=t}return Object(l.a)(e,[{key:"loadIds",value:function(e){var t=[],n=!0,r=!1,i=void 0;try{for(var a,o=e[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value;if(null!==s){var c=this.dict.get(s);void 0===c&&(t.push(s),c={id:s},this.dict.set(s,c))}}}catch(u){r=!0,i=u}finally{try{n||null==o.return||o.return()}finally{if(r)throw i}}this.loadId(t)}},{key:"get",value:function(e){if(void 0===e||null===e)return null;var t=this.dict.get(e);return void 0===t&&(this.dict.set(e,{id:e}),this.loadId([e]),t=this.dict.get(e)),t}},{key:"setItem",value:function(e,t){void 0===t?(this.dict.set(e,null),this.arr.push({id:e})):(this.dict.set(e,t),this.arr.push(t)),this.arr.length>this.maxCount&&(t=this.arr.shift(),this.dict.delete(t.id))}},{key:"loadId",value:function(e){return m(this,void 0,void 0,c.a.mark(function t(){var n,r,i,a,o,s,u,l,h,d,f,p,v,m,y=this;return c.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._loadIds(e);case 2:if(void 0!==(n=t.sent)){t.next=36;break}r=!0,i=!1,a=void 0,t.prev=7,o=e[Symbol.iterator]();case 9:if(r=(s=o.next()).done){t.next=20;break}if(null!==(u=s.value)){t.next=13;break}return t.abrupt("continue",17);case 13:return t.next=15,this._loadId(u);case 15:l=t.sent,this.setItem(u,l);case 17:r=!0,t.next=9;break;case 20:t.next=26;break;case 22:t.prev=22,t.t0=t.catch(7),i=!0,a=t.t0;case 26:t.prev=26,t.prev=27,r||null==o.return||o.return();case 29:if(t.prev=29,!i){t.next=32;break}throw a;case 32:return t.finish(29);case 33:return t.finish(26);case 34:t.next=56;break;case 36:for(h=!0,d=!1,f=void 0,t.prev=39,p=function(){var e=m.value,t=n.find(function(t){return t.id===e});y.setItem(e,t)},v=e[Symbol.iterator]();!(h=(m=v.next()).done);h=!0)p();t.next=48;break;case 44:t.prev=44,t.t1=t.catch(39),d=!0,f=t.t1;case 48:t.prev=48,t.prev=49,h||null==v.return||v.return();case 51:if(t.prev=51,!d){t.next=54;break}throw f;case 54:return t.finish(51);case 55:return t.finish(48);case 56:case"end":return t.stop()}},t,this,[[7,22,26,34],[27,,29,33],[39,44,48,56],[49,,51,55]])}))}}]),e}();v([h.l],y.prototype,"dict",void 0),n.d(t,"p",function(){return r.l}),n.d(t,"n",function(){return r.k}),n.d(t,"m",function(){return r.i}),n.d(t,"l",function(){return r.g}),n.d(t,"h",function(){return r.c}),n.d(t,"g",function(){return r.b}),n.d(t,"b",function(){return r.a}),n.d(t,"k",function(){return r.f}),n.d(t,"d",function(){return i.c}),n.d(t,"o",function(){return i.g}),n.d(t,"e",function(){return i.d}),n.d(t,"c",function(){return i.a}),n.d(t,"j",function(){return i.f}),n.d(t,"i",function(){return i.e}),n.d(t,"q",function(){return i.h}),n.d(t,"f",function(){return p}),n.d(t,"a",function(){return y})},,function(e,t,n){"use strict";n.d(t,"store",function(){return b});var r=n(16),i=n(39),a=n.n(i),o=n(10),s=n(19),c=n(65),u=n(55),l=n(60);n.o(l,"sysTemplets")&&n.d(t,"sysTemplets",function(){return l.sysTemplets}),n.o(l,"templetDict")&&n.d(t,"templetDict",function(){return l.templetDict});var h=n(61);n.d(t,"sysTemplets",function(){return h.a}),n.d(t,"templetDict",function(){return h.b});var d=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},f=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})};const p={id:0,name:"\u540c\u82b1\u7cfb\u7edf",nick:void 0,discription:"\u540c\u82b1\u5e73\u53f0",icon:void 0,date:void 0};class v extends o.f{constructor(e,t){super(!0),this.unit=e,this.query=t,this.appendPosition="head"}load(){return f(this,void 0,void 0,function*(){return yield this.query.loadSchema(),(yield this.query.page(this.param,this.pageStart,this.pageSize)).$page})}setPageStart(e){this.pageStart=void 0===e?void 0:e.id}end(e){this.items.find(t=>t.id===e)}remove(e){let t=this.items.find(t=>t.id===e);void 0!==t&&this.items.remove(t)}addMessage(e){this.remove(e.id),this.append(e),void 0===this.unread&&(this.unread=0),++this.unread}}d([r.k],v.prototype,"unread",void 0);class m{constructor(e){this.id=e,this.messages=new v(this,void 0)}get isOwner(){return this._isOwner}set isOwner(e){this._isOwner=e}get isAdmin(){return this._isAdmin}set isAdmin(e){this._isAdmin=e}loadProps(){return f(this,void 0,void 0,function*(){let e=yield s.a.unitBase(this.id);if(void 0===e)return;let{name:t,discription:n,icon:r,nick:i,isOwner:a,isAdmin:o,owner:c,ownerName:u,ownerNick:l,ownerIcon:h}=e;this.name=t,this.discription=n,this.nick=i,this.icon=r,this.isOwner=a,this.isAdmin=o,this.owner=c,this.ownerName=u,this.ownerNick=l,this.ownerIcon=h})}loadApps(){return f(this,void 0,void 0,function*(){let e,t=yield s.a.apps(this.id);e=void 0===t?[]:t.apps,void 0===t?(t={},a.a.assign(t,p)):0===t.id&&a.a.assign(t,p),a.a.assign(this,t),this.apps=e})}loadMessages(){return f(this,void 0,void 0,function*(){yield s.a.messagesRead(this.id),void 0===this.messages.items&&(yield this.messages.first(void 0))})}messageReadClear(){return f(this,void 0,void 0,function*(){this.unread=0,this.messages.unread=0;let e=b.stickies.find(e=>e.objId===this.id);if(void 0!==e){e.date=void 0;let t=e.obj;void 0!==t&&(t.subject=void 0,t.unread=0)}yield s.a.messagesRead(this.id)})}messageAct(e,t){return f(this,void 0,void 0,function*(){yield s.a.actMessage({unit:this.id,id:e,action:t})})}}d([r.k],m.prototype,"apps",void 0),d([r.k],m.prototype,"unread",void 0),d([r.k],m.prototype,"date",void 0);class y{constructor(){this.unitArray=[],this.units=new Map,this.unit=void 0,this.cacheUsers=new u.b,this.cacheUnits=new u.a,this.follow=new c.a(this)}onWs(e){return f(this,void 0,void 0,function*(){let{from:t,to:n,body:r,push:i}=e;if(void 0===r)return;let{$type:a,$user:o,$unit:s,$io:c,action:u,data:l,msg:h}=r;if("msg"!==a)return;if(!l)return;let d=new Date,f=b.dataToMsg(l);for(let e of this.units){let t=e[1];if(s===t.id){this.onStickyMessage(t,c,d,f.message&&f.message.subject);break}}void 0!==e.id?this.processMessage(e):this.processCommand(e)})}dataToMsg(e){let t=e.split("\t");function n(e){if(e)return Number(e)}let r,i=n(t[0]),a=function(e){if(e)return new Date(1e3*Number(e))}(t[4]),o=n(t[8]),s=n(t[9]),c=t[10],u=t[11];return void 0!==a&&(r={id:i,fromUser:n(t[1]),fromUnit:n(t[2]),type:t[3],date:a,subject:t[5],discription:t[6],content:t[7]}),{id:i,message:r,branch:o,done:s,prevState:c,state:u}}onStickyMessage(e,t,n,r){if(e.unread+=t,e.date=n,void 0!==this.stickies)for(let i of this.stickies)if(i.objId===e.id){void 0!==i.obj&&(i.obj.subject=r);break}}processCommand(e){let{type:t,content:n}=e;switch(t){case"message-end":this.messageEnd(n);break;case"message-removed":this.messageRemoved(n)}}messageEnd(e){let{id:t,unit:n,state:r}=e,i=this.units.get(n);void 0!==i&&i.messages.end(t)}messageRemoved(e){let{id:t,unit:n}=e;this.removeMessage(n,t)}removeMessage(e,t){let n=this.units.get(e);void 0!==n&&n.messages.remove(t)}processMessage(e){}logout(){this.stickies.splice(0,this.stickies.length),this.units.clear(),this.unit=void 0,this.cacheUsers.dict.clear(),this.cacheUnits.dict.clear(),this.follow.logout()}getAdminApp(){return f(this,void 0,void 0,function*(){return void 0!==this.adminApp?this.adminApp:this.adminApp=yield s.a.adminUrl()})}getAppFromId(e){return f(this,void 0,void 0,function*(){return yield s.a.appFromId(e)})}loadStickies(){return f(this,void 0,void 0,function*(){let e=[],t=yield s.a.stickies(),n=t[0],r=t[4];for(let a of n)switch(a.type){case 3:let e=a.obj=r.find(e=>e.id===a.objId),{id:t,type:n,name:i,discription:o,icon:s,unread:c,date:u,owner:l}=e,h=new m(t);h.type=n,h.name=i,h.discription=o,h.icon=s,h.unread=c,h.date=u,h.owner=l,this.units.set(t,h)}e.push(...n);let i=t[5][0];if(void 0!==i){let{unread:t,date:n}=i;this.addSysUnitStick(e,t,n)}this.stickies=e})}newUnit(e){return f(this,void 0,void 0,function*(){let t=new m(e);if(yield t.loadProps(),this.units.set(e,t),this.unitArray.unshift(t),this.unitArray.length>y.maxUnitCount){let e=this.unitArray.pop();this.units.delete(e.id)}return t})}setUnit(e){return f(this,void 0,void 0,function*(){let t=this.units.get(e);if(void 0===t)t=yield this.newUnit(e);else{let e=this.unitArray.findIndex(e=>e===t);e>0&&(this.unitArray.splice(e,1),this.unitArray.unshift(t))}o.n.unit=e,this.unit=t})}setUnitRead(){return f(this,void 0,void 0,function*(){let{unread:e,id:t}=this.unit;e>0&&(yield s.b.messageRead(t),this.unit.unread=0)})}acceptFellowInvite(e){return f(this,void 0,void 0,function*(){let t=yield s.a.unitAddFellow(e.id);this.follow.removeInvite(e),void 0!==t&&this.stickies.unshift(t)})}addSysUnitStick(e,t,n){if(void 0===t||t<=0)return;let r=e.findIndex(e=>(0===e.type||3===e.type)&&0===e.objId);if(r<0){let n=a.a.clone(p);return n.unread=t,void e.unshift({id:0,date:new Date,type:0,objId:0,obj:n})}if(r>0){let t=e.splice(r,1)[0];e.unshift(t)}}followUnit(e){return f(this,void 0,void 0,function*(){let t=yield s.a.searchUnitsFollow(e),n=this.units.get(e);void 0===n?n=yield this.newUnit(e):n.apps=void 0,this.stickies.unshift({id:t,date:new Date,type:3,objId:e,obj:n})})}unfollowUnit(){return f(this,void 0,void 0,function*(){if(void 0===this.unit)return;this.unit.apps=void 0;let e=this.unit.id;yield s.a.unitNotFollow(e);let t=this.stickies.findIndex(t=>t.objId===e);t<0||this.stickies.splice(t,1)})}}y.maxUnitCount=2,d([r.k],y.prototype,"stickies",void 0),d([r.k],y.prototype,"units",void 0),d([r.k],y.prototype,"unit",void 0);const b=new y},,,,,,,function(e,t,n){"use strict";n.d(t,"b",function(){return o});var r=n(10),i=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})};const a=new class extends r.b{stickies(){return i(this,void 0,void 0,function*(){return yield this.get("sticky/list",{start:0,pageSize:30})})}ties(){return i(this,void 0,void 0,function*(){return yield this.get("tie/list",{start:0,pageSize:30})})}searchUnits(e,t,n){return i(this,void 0,void 0,function*(){return yield this.get("tie/search-unit",{key:e,pageStart:t,pageSize:n})})}searchUnitsFollow(e){return i(this,void 0,void 0,function*(){return yield this.get("tie/search-unit-follow",{unit:e})})}unitNotFollow(e){return i(this,void 0,void 0,function*(){yield this.get("tie/unit-not-follow",{unit:e})})}apps(e){return i(this,void 0,void 0,function*(){return yield this.get("tie/apps",{unit:e})})}unitxApi(e){return i(this,void 0,void 0,function*(){return yield this.get("tie/apps",{unit:e})})}adminUrl(){return i(this,void 0,void 0,function*(){return yield this.get("tie/admin-url",{})})}appFromId(e){return i(this,void 0,void 0,function*(){return yield this.get("tie/app-id",{appId:e})})}appApi(e,t,n){return i(this,void 0,void 0,function*(){return yield this.get("tie/app-api",{unit:e,app:t,apiName:n})})}unitMessages(e,t,n){return i(this,void 0,void 0,function*(){return yield this.get("tie/message-inbox",{unit:e,pageStart:t,pageSize:n})})}messagesRead(e){return i(this,void 0,void 0,function*(){return yield this.get("tie/message-read",{unit:e})})}unitAddFellow(e){return i(this,void 0,void 0,function*(){return yield this.get("unit/add-fellow",{invite:e})})}removeMessage(e){return i(this,void 0,void 0,function*(){yield this.get("tie/remove-message",{id:e})})}unitAdmins(e){return i(this,void 0,void 0,function*(){return yield this.get("unit/admins",{unit:e})})}unitCreate(e,t){return i(this,void 0,void 0,function*(){return yield this.post("unit/create",{name:e,message:t})})}saveMessage(e){return i(this,void 0,void 0,function*(){return yield this.post("tie/message-save",e)})}actMessage(e){return i(this,void 0,void 0,function*(){yield this.post("tie/message-act",e)})}userBase(e){return i(this,void 0,void 0,function*(){return yield this.get("tie/user",{id:e})})}unitBase(e){return i(this,void 0,void 0,function*(){return yield this.get("tie/unit",{id:e})})}postMessage(e,t){return i(this,void 0,void 0,function*(){return yield this.post("test/post",{to:e,message:t})})}membersFromName(e){return i(this,void 0,void 0,function*(){return yield this.get("unit/members-from-name",e)})}resetPassword(e){return i(this,void 0,void 0,function*(){return yield this.post("tie/reset-password",e)})}}("tv/",void 0);t.a=a;const o=new class extends r.b{messageUnread(){return i(this,void 0,void 0,function*(){return yield this.get("tie/message-unread",{})})}messageRead(e){return i(this,void 0,void 0,function*(){return yield this.get("tie/message-read",{unit:e})})}typeMessageCount(){return i(this,void 0,void 0,function*(){return yield this.get("tie/message-type-count",{})})}readMessages(e){return i(this,void 0,void 0,function*(){0!==e.length&&(yield this.post("tie/read-messages",{ids:e.join(";")}))})}}("tv/",!1)},function(e,t,n){"use strict";(function(e){n.d(t,"b",function(){return C}),n.d(t,"a",function(){return P}),n.d(t,"c",function(){return _});var r,i=n(0),a=n.n(i),o=n(3),s=n(5),c=n(6),u=n(4),l=n(7),h=n(11),d=n(8),f=n(13),p=n(40),v=n(44),m=n(54),y=n(63),b=n(29),w=n(64),k=n(24),g=(n(58),n(67),n(84),n(86),n(33)),x=n(41),O=n(52),j=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},E=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},C=new RegExp("Android|webOS|iPhone|iPad|BlackBerry|Windows Phone|Opera Mini|IEMobile|Mobile","i").test(navigator.userAgent)?{minHeight:"3em"}:void 0,S=(n(68),[]),N=1,P=function(t){function n(e){var t;return Object(o.a)(this,n),(t=Object(c.a)(this,Object(u.a)(n).call(this,e))).waitCount=0,t.isHistoryBack=!1,t.clearError=function(){t.setState({fetchError:void 0})},t.back=t.back.bind(Object(h.a)(Object(h.a)(t))),t.navBack=t.navBack.bind(Object(h.a)(Object(h.a)(t))),t.stack=[],t.state={stack:t.stack,wait:0,fetchError:void 0},t}return Object(l.a)(n,t),Object(s.a)(n,[{key:"componentWillMount",value:function(){return E(this,void 0,void 0,a.a.mark(function e(){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:window.addEventListener("popstate",this.navBack);case 1:case"end":return e.stop()}},e,this)}))}},{key:"componentDidMount",value:function(){return E(this,void 0,void 0,a.a.mark(function e(){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return _.set(this),e.next=3,_.start();case 3:case"end":return e.stop()}},e,this)}))}},{key:"startWait",value:function(){var t=this;0===this.waitCount&&(this.setState({wait:1}),this.waitTimeHandler=e.setTimeout(function(){t.waitTimeHandler=void 0,t.setState({wait:2})},1e3)),++this.waitCount,this.setState({fetchError:void 0})}},{key:"endWait",value:function(){var e=this;setTimeout(function(){--e.waitCount,0===e.waitCount&&(void 0!==e.waitTimeHandler&&(clearTimeout(e.waitTimeHandler),e.waitTimeHandler=void 0),e.setState({wait:0}))},100)}},{key:"onError",value:function(e){return E(this,void 0,void 0,a.a.mark(function t(){var n;return a.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(void 0===(n=e.error)||!0!==n.unauthorized){t.next=5;break}return t.next=4,_.showLogin();case 4:return t.abrupt("return");case 5:this.setState({fetchError:e});case 6:case"end":return t.stop()}},t,this)}))}},{key:"show",value:function(e,t){return this.clear(),this.push(e,t)}},{key:"push",value:function(e,t){this.removeCeased(),this.stack.length>0&&window.history.pushState("forward",null,null);var n=N++;return this.stack.push({key:n,view:e,ceased:!1,disposer:t}),this.refresh(),n}},{key:"replace",value:function(e,t){var n=void 0,r=this.stack;r.length>0&&(n=r.pop());var i=N++;return this.stack.push({key:i,view:e,ceased:!1,disposer:t}),void 0!==n&&this.dispose(n.disposer),this.refresh(),i}},{key:"ceaseTop",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=this.stack.length-1,n=0;n<e&&!(t<0);n++,t--){this.stack[t].ceased=!0}}},{key:"pop",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=this.stack,n=t.length;if(!(e<=0||n<=1)){n<e&&(e=n);for(var r=0,i=0;i<e&&0!==t.length;i++)this.popAndDispose(),++r;r>=n&&r--,this.refresh(),this.isHistoryBack}}},{key:"popTo",value:function(e){throw new Error("to be designed")}},{key:"removeCeased",value:function(){for(;;){var e=this.stack.length-1;if(e<0)break;if(!1===this.stack[e].ceased)break;var t=this.stack.pop().disposer;this.dispose(t)}this.refresh()}},{key:"popAndDispose",value:function(){this.removeCeased();var e=this.stack.pop();if(void 0!==e){var t=e.disposer;return this.dispose(t),this.removeCeased(),e}}},{key:"dispose",value:function(e){void 0!==e&&(void 0===this.stack.find(function(t){return t.disposer===e})&&e())}},{key:"clear",value:function(){for(this.stack.length;this.stack.length>0;)this.popAndDispose();this.refresh()}},{key:"regConfirmClose",value:function(e){var t=this.stack,n=t.length;0!==n&&(t[n-1].confirmClose=e)}},{key:"navBack",value:function(){_.log("backbutton pressed - nav level: "+this.stack.length),this.isHistoryBack=!0,this.back(!0),this.isHistoryBack=!1}},{key:"back",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return E(this,void 0,void 0,a.a.mark(function t(){var n,r,i;return a.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n=this.stack,0!==(r=n.length)){t.next=4;break}return t.abrupt("return");case 4:if(1!==r){t.next=7;break}return self!=window.top&&window.top.postMessage({type:"pop-app"},"*"),t.abrupt("return");case 7:if(i=n[r-1],!0!==e||!i.confirmClose){t.next=16;break}return t.next=11,i.confirmClose();case 11:if(t.t0=t.sent,!0!==t.t0){t.next=14;break}this.pop();case 14:t.next=17;break;case 16:this.pop();case 17:case"end":return t.stop()}},t,this)}))}},{key:"confirmBox",value:function(e){return window.confirm(e)}},{key:"render",value:function(){var e=this.state,t=e.wait,n=e.fetchError,r=this.state.stack,i=r.length-1,a=null,o=null;switch(t){case 1:a=d.createElement("li",{className:"va-wait va-wait1"});break;case 2:a=d.createElement("li",{className:"va-wait va-wait2"},d.createElement("i",{className:"fa fa-spinner fa-spin fa-3x fa-fw"}),d.createElement("span",{className:"sr-only"},"Loading..."))}return n&&(o=d.createElement(y.a,Object.assign({clearError:this.clearError},n))),d.createElement("ul",{className:"va"},r.map(function(e,t){var n=e.key,r=e.view;return d.createElement("li",{key:n,style:t<i?{visibility:"hidden"}:void 0},r)}),a,o)}},{key:"refresh",value:function(){this.setState({stack:this.stack})}},{key:"level",get:function(){return this.stack.length}}]),n}(d.Component),F=function(){function e(){Object(o.a)(this,e),this.local=new w.a,this.user=void 0;var t=x.b.lang,n=x.b.district;this.language=t,this.culture=n}return Object(s.a)(e,[{key:"set",value:function(e){this.nav=e}},{key:"registerReceiveHandler",value:function(e){if(void 0!==this.ws)return this.ws.onWsReceiveAny(e)}},{key:"unregisterReceiveHandler",value:function(e){void 0!==this.ws&&void 0!==e&&this.ws.endWsReceive(e)}},{key:"onReceive",value:function(e){return E(this,void 0,void 0,a.a.mark(function t(){return a.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(void 0!==this.ws){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,this.ws.receive(e);case 4:case"end":return t.stop()}},t,this)}))}},{key:"getUnitName",value:function(){return E(this,void 0,void 0,a.a.mark(function e(){var t,n;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch("unit.json",{});case 3:return t=e.sent,e.next=6,t.json();case 6:return n=e.sent,e.abrupt("return",n.unit);case 10:return e.prev=10,e.t0=e.catch(0),this.local.unit.clear(),e.abrupt("return");case 14:case"end":return e.stop()}},e,this,[[0,10]])}))}},{key:"loadUnit",value:function(){return E(this,void 0,void 0,a.a.mark(function e(){var t,n,r;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===(n=this.local.unit.get())){e.next=13;break}if(!0===k.h){e.next=4;break}return e.abrupt("return",n.id);case 4:return e.next=6,this.getUnitName();case 6:if(void 0!==(t=e.sent)){e.next=9;break}return e.abrupt("return");case 9:if(n.name!==t){e.next=11;break}return e.abrupt("return",n.id);case 11:e.next=18;break;case 13:return e.next=15,this.getUnitName();case 15:if(void 0!==(t=e.sent)){e.next=18;break}return e.abrupt("return");case 18:return e.next=20,k.e.unitFromName(t);case 20:return void 0!==(r=e.sent)&&this.local.unit.set({id:r,name:t}),e.abrupt("return",r);case 23:case"end":return e.stop()}},e,this)}))}},{key:"start",value:function(){return E(this,void 0,void 0,a.a.mark(function e(){var t,n,r,i,o,s,c,u;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return _.clear(),_.push(d.createElement(v.a,{header:!1},d.createElement(O.a,null))),e.next=4,k.f.start();case 4:return t=k.f.url,n=k.f.ws,this.centerHost=t,this.wsHost=n,Object(k.o)(t),e.next=10,this.loadUnit();case 10:if(r=e.sent,k.k.unit=r,void 0!==(i=this.local.guest.get())){e.next=17;break}return e.next=16,k.e.guest();case 16:i=e.sent;case 17:if(_.setGuest(i),o=document.location.hash,console.log("url=%s hash=%s",document.location.origin,o),this.isInFrame=void 0!==o&&""!==o&&o.startsWith("#tv"),!0!==this.isInFrame){e.next=28;break}if(void 0===(s=Object(b.h)(o))){e.next=28;break}return this.ws=g.d,console.log("this.ws = wsBridge in sub frame"),self!==window.parent&&window.parent.postMessage({type:"sub-frame-started",hash:s.hash},"*"),e.abrupt("return");case 28:if(void 0!==(c=this.local.user.get())){e.next=39;break}if(void 0===(u=this.nav.props.notLogined)){e.next=36;break}return e.next=34,u();case 34:e.next=38;break;case 36:return e.next=38,_.showLogin();case 38:return e.abrupt("return");case 39:return e.next=41,_.logined(c);case 41:case"end":return e.stop()}},e,this)}))}},{key:"showAppView",value:function(){return E(this,void 0,void 0,a.a.mark(function e(){var t;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==(t=this.nav.props.onLogined)){e.next=4;break}return _.push(d.createElement("div",null,"NavView has no prop onLogined")),e.abrupt("return");case 4:return _.clear(),e.next=7,t();case 7:console.log("logined: AppView shown");case 8:case"end":return e.stop()}},e,this)}))}},{key:"setGuest",value:function(e){this.local.guest.set(e),m.a.set(0,e.token)}},{key:"logined",value:function(e){return E(this,void 0,void 0,a.a.mark(function t(){return a.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return(this.ws=new k.d(this.wsHost,e.token)).connect(),console.log("logined: %s",JSON.stringify(e)),this.local.user.set(e),m.a.set(e.id,e.token),this.user=new p.a(e),t.next=8,this.showAppView();case 8:case"end":return t.stop()}},t,this)}))}},{key:"showLogin",value:function(e){return E(this,void 0,void 0,a.a.mark(function t(){var r,i;return a.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.e(1).then(n.bind(null,113));case 2:r=t.sent,i=d.createElement(r.default,{withBack:e}),!0!==e&&(this.nav.clear(),this.pop()),this.nav.push(i);case 6:case"end":return t.stop()}},t,this)}))}},{key:"logout",value:function(e){return E(this,void 0,void 0,a.a.mark(function t(){var n;return a.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.local.logoutClear(),this.user=void 0,Object(k.j)(),Object(b.f)(),n=this.local.guest.get(),Object(k.n)(0,n&&n.token),this.ws=void 0,!0!==e){t.next=9;break}return t.abrupt("return");case 9:return t.next=11,_.start();case 11:case"end":return t.stop()}},t,this)}))}},{key:"startWait",value:function(){this.nav.startWait()}},{key:"endWait",value:function(){this.nav.endWait()}},{key:"onError",value:function(e){return E(this,void 0,void 0,a.a.mark(function t(){return a.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.nav.onError(e);case 2:case"end":return t.stop()}},t,this)}))}},{key:"show",value:function(e,t){this.nav.show(e,t)}},{key:"push",value:function(e,t){this.nav.push(e,t)}},{key:"replace",value:function(e,t){this.nav.replace(e,t)}},{key:"pop",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.nav.pop(e)}},{key:"clear",value:function(){this.nav.clear()}},{key:"navBack",value:function(){this.nav.navBack()}},{key:"ceaseTop",value:function(e){this.nav.ceaseTop(e)}},{key:"removeCeased",value:function(){this.nav.removeCeased()}},{key:"back",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return E(this,void 0,void 0,a.a.mark(function t(){return a.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.nav.back(e);case 2:case"end":return t.stop()}},t,this)}))}},{key:"regConfirmClose",value:function(e){this.nav.regConfirmClose(e)}},{key:"confirmBox",value:function(e){return this.nav.confirmBox(e)}},{key:"navToApp",value:function(e,t,n,r,i){var a=this,o=!0===this.centerHost.includes("http://localhost:")?"sheet_debug":"sheet",s=void 0===i?Object(b.b)(e,t):Object(b.b)(e,t,o,[n,r,i]);console.log("navToApp: %s",JSON.stringify(s)),_.push(d.createElement("article",{className:"app-container"},d.createElement("span",{id:s.hash,onClick:function(){return a.back()},style:C},d.createElement("i",{className:"fa fa-arrow-left"})),d.createElement("iframe",{src:s.url})))}},{key:"navToSite",value:function(e){window.open(e)}},{key:"log",value:function(e){S.push(e)}},{key:"logMark",value:function(){var e=new Date;r=e.getTime(),S.push("log-mark: "+e.toTimeString())}},{key:"logStep",value:function(e){S.push(e+": "+((new Date).getTime()-r))}},{key:"guest",get:function(){var e=this.local.guest;if(void 0===e)return 0;var t=e.get();return void 0===t?0:t.guest}},{key:"level",get:function(){return this.nav.level}},{key:"logs",get:function(){return S}}]),e}();j([f.l],F.prototype,"user",void 0);var _=new F}).call(this,n(35))},,,,function(e,t,n){"use strict";var r=n(33),i=n(46),a=n(0),o=n.n(a),s=n(3),c=n(5),u=n(6),l=n(4),h=n(7),d=n(40),f=n(30),p=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},v=new(function(e){function t(){return Object(s.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"guest",value:function(){return p(this,void 0,void 0,o.a.mark(function e(){var t,n;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get("",{});case 2:t=e.sent,e.t0=typeof t,e.next="string"===e.t0?7:"object"===e.t0?8:6;break;case 6:return e.abrupt("return");case 7:return e.abrupt("return",Object(d.b)(t));case 8:return n=Object(d.b)(t.token),e.abrupt("return",n);case 10:case"end":return e.stop()}},e,this)}))}},{key:"unitFromName",value:function(e){return p(this,void 0,void 0,o.a.mark(function t(){var n;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.get(e);case 2:return n=t.sent,t.abrupt("return",n&&n.unit);case 4:case"end":return t.stop()}},t,this)}))}}]),t}(f.a))("tv/guest/",void 0),m=n(29),y=n(37);n(42);n.d(t,"d",function(){return r.a}),n.d(t,"l",function(){return r.b}),n.d(t,"m",function(){return i.b}),n.d(t,"e",function(){return v}),n.d(t,"j",function(){return f.g}),n.d(t,"c",function(){return f.d}),n.d(t,"b",function(){return f.c}),n.d(t,"o",function(){return f.i}),n.d(t,"n",function(){return f.h}),n.d(t,"a",function(){return f.a}),n.d(t,"k",function(){return m.g}),n.d(t,"i",function(){return m.e}),n.d(t,"g",function(){return m.d}),n.d(t,"h",function(){return y.b}),n.d(t,"f",function(){return y.a})},,,,,function(e,t,n){"use strict";n.d(t,"f",function(){return m}),n.d(t,"g",function(){return b}),n.d(t,"d",function(){return w}),n.d(t,"h",function(){return j}),n.d(t,"b",function(){return E}),n.d(t,"e",function(){return C}),n.d(t,"a",function(){return S}),n.d(t,"c",function(){return P});var r=n(0),i=n.n(r),a=n(3),o=n(5),s=n(25),c=n.n(s),u=n(36),l=n(38),h=n(30),d=n(33),f=n(37),p=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},v={};function m(){for(var e in v)v[e]=void 0}var y={},b=new(function(){function e(){Object(a.a)(this,e)}return Object(o.a)(e,[{key:"unit",get:function(){return this._unit},set:function(e){this._unit=e}}]),e}());function w(){return self!==window.parent}function k(e){var t,n,r=e.data,i=e.source;Object(d.c)(i),t=r.hash,void 0!==(n=document.getElementById(t))&&(n.hidden=!0);var a=c.a.clone(u.g.user);a.type="init-sub-win",i.postMessage(a,"*")}function g(e){return p(this,void 0,void 0,i.a.mark(function t(){var n,r;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("initSubWin: set nav.user",e),n=e.id,r=e.token,Object(h.h)(n,r),u.g.user=e,t.next=6,u.g.showAppView();case 6:case"end":return t.stop()}},t,this)}))}function x(e,t){return p(this,void 0,void 0,i.a.mark(function n(){var r,a,o,s;return i.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(void 0!==(r=y[e])){n.next=3;break}return n.abrupt("return",{name:t,url:void 0,urlDebug:void 0,token:void 0});case 3:return a=r.unit,o=t.split("/"),n.next=7,h.j.uq({unit:a,uqOwner:o[0],uqName:o[1]});case 7:if(void 0!==(s=n.sent)){n.next=11;break}throw console.log("apiTokenApi.api return undefined. api=%s, unit=%s",t,a),"api not found";case 11:return n.abrupt("return",{name:t,url:s.url,urlDebug:s.urlDebug,token:s.token});case 12:case"end":return n.stop()}},n,this)}))}function O(e){return p(this,void 0,void 0,i.a.mark(function t(){var n,r,a,o,s,c;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.apiName,r=e.url,a=e.urlDebug,o=e.token,void 0!==(s=v[n])){t.next=4;break}throw"error app api return";case 4:c=f.a.getUrlOrDebug(r,a),console.log("onAppApiReturn(message:any): url="+r+", debug="+a+", real="+c),s.url=c,s.token=o,s.resolve(s);case 9:case"end":return t.stop()}},t,this)}))}function j(e){var t=e.split("-"),n=t.length;return b.hash=t[0].substr(3),n>0&&(b.unit=Number(t[1])),n>1&&(b.page=t[2]),n>2&&(b.param=t.slice(3)),b}function E(e,t,n,r){for(var i;;){if(i=Object(l.a)(),void 0===y[i]){y[i]={hash:i,unit:t};break}}if(e+="#tv"+i+"-"+t,void 0!==n&&(e+="-"+n,void 0!==r))for(var a=0;a<r.length;a++)e+="-"+r[a];return{url:e,hash:i}}function C(e,t){return p(this,void 0,void 0,i.a.mark(function n(){var r,a,o;return i.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return r=new h.b("tv/",void 0),a=b.unit,n.next=4,r.uqs(a,e,t);case 4:return o=n.sent,r.checkUqs(a,e,t).then(function(e){!1===e&&u.g.start()}),n.abrupt("return",o);case 7:case"end":return n.stop()}},n,this)}))}function S(e,t,n){return p(this,void 0,void 0,i.a.mark(function r(){var a,o,s,c,u,l=this;return i.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(void 0===(a=v[e])){r.next=3;break}return r.abrupt("return",a);case 3:if(w()){r.next=17;break}return r.next=6,h.j.uq({unit:b.unit,uqOwner:t,uqName:n});case 6:if(void 0!==(a=r.sent)){r.next=10;break}throw"unauthorized call: uqTokenApi center return undefined!","unauthorized call: uqTokenApi center return undefined!";case 10:return void 0===a.token&&(a.token=h.f),s=(o=a).url,c=o.urlDebug,u=f.a.getUrlOrDebug(s,c),console.log("realUrl: %s",u),a.url=u,v[e]=a,r.abrupt("return",a);case 17:return console.log("appApi parent send: %s",b.hash),a={name:e,url:void 0,urlDebug:void 0,token:void 0,resolve:void 0,reject:void 0},v[e]=a,r.abrupt("return",new Promise(function(t,n){a.resolve=function(e){return p(l,void 0,void 0,i.a.mark(function n(){var r;return i.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e;case 2:r=n.sent,console.log("return from parent window: %s",JSON.stringify(r)),a.url=r.url,a.urlDebug=r.urlDebug,a.token=r.token,t(a);case 8:case"end":return n.stop()}},n,this)}))},a.reject=n,(window.opener||window.parent).postMessage({type:"app-api",apiName:e,hash:b.hash},"*")}));case 21:case"end":return r.stop()}},r,this)}))}window.addEventListener("message",function(e){return p(this,void 0,void 0,i.a.mark(function t(){var n,r;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:n=e.data,t.t0=n.type,t.next="sub-frame-started"===t.t0?4:"ws"===t.t0?6:"init-sub-win"===t.t0?9:"pop-app"===t.t0?12:"center-api"===t.t0?14:"center-api-return"===t.t0?17:"app-api"===t.t0?19:"app-api-return"===t.t0?26:31;break;case 4:return k(e),t.abrupt("break",33);case 6:return t.next=8,u.g.onReceive(n.msg);case 8:return t.abrupt("break",33);case 9:return t.next=11,g(n);case 11:return t.abrupt("break",33);case 12:return u.g.navBack(),t.abrupt("break",33);case 14:return t.next=16,F(e.source,n);case 16:return t.abrupt("break",33);case 17:return _(n),t.abrupt("break",33);case 19:return console.log("receive PostMessage: %s",JSON.stringify(n)),t.next=22,x(n.hash,n.apiName);case 22:return r=t.sent,console.log("onReceiveAppApiMessage: %s",JSON.stringify(r)),e.source.postMessage({type:"app-api-return",apiName:n.apiName,url:r.url,urlDebug:r.urlDebug,token:r.token},"*"),t.abrupt("break",33);case 26:return console.log("app-api-return: %s",JSON.stringify(n)),console.log("await onAppApiReturn(message);"),t.next=30,O(n);case 30:return t.abrupt("break",33);case 31:return this.console.log("message: %s",JSON.stringify(n)),t.abrupt("break",33);case 33:case"end":return t.stop()}},t,this)}))});var N={};function P(e,t,n){return p(this,void 0,void 0,i.a.mark(function r(){var a=this;return i.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return console.log("bridgeCenterApi: url=%s, method=%s",e,t),r.next=3,new Promise(function(r,o){return p(a,void 0,void 0,i.a.mark(function a(){var s;return i.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(s=Object(l.a)(),void 0!==N[s]){i.next=5;break}return N[s]={id:s,resolve:r,reject:o},i.abrupt("break",7);case 5:i.next=0;break;case 7:(window.opener||window.parent).postMessage({type:"center-api",callId:s,url:e,method:t,body:n},"*");case 8:case"end":return i.stop()}},a,this)}))});case 3:return r.abrupt("return",r.sent);case 4:case"end":return r.stop()}},r,this)}))}function F(e,t){return p(this,void 0,void 0,i.a.mark(function n(){var r,a,o,s,c;return i.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return r=t.callId,a=t.url,o=t.method,s=t.body,n.next=3,h.e.directCall(a,o,s);case 3:c=n.sent,e.postMessage({type:"center-api-return",callId:r,result:c},"*");case 5:case"end":return n.stop()}},n,this)}))}function _(e){var t=e.callId,n=e.result,r=N[t];void 0!==r&&(N[t]=void 0,r.resolve(n))}},function(e,t,n){"use strict";var r=n(6),i=n(4),a=n(7),o=n(0),s=n.n(o),c=n(3),u=n(5),l=n(25),h=n.n(l),d=n(42),f=n(20),p=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},v=function(){function e(){Object(c.a)(this,e)}return Object(u.a)(e,[{key:"startWait",value:function(){f.c.startWait()}},{key:"endWait",value:function(){f.c.endWait()}},{key:"showError",value:function(e){return p(this,void 0,void 0,s.a.mark(function t(){return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return f.c.endWait(),t.next=3,f.c.onError(e);case 3:case"end":return t.stop()}},t,this)}))}}]),e}(),m=n(29),y=n(46),b=n(37);n.d(t,"g",function(){return x}),n.d(t,"d",function(){return j}),n.d(t,"c",function(){return S}),n.d(t,"i",function(){return N}),n.d(t,"f",function(){return _}),n.d(t,"h",function(){return A}),n.d(t,"a",function(){return R}),n.d(t,"j",function(){return V}),n.d(t,"e",function(){return T}),n.d(t,"b",function(){return D});var w=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},k={},g={};function x(){k={},g={},E={}}var O=new(function(){function e(){Object(c.a)(this,e)}return Object(u.a)(e,[{key:"loadAccess",value:function(e){return w(this,void 0,void 0,s.a.mark(function t(){var n,r,i,a,o,c,u,l,d,f,p;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,n=e.uqOwner,r=e.uqName,void 0===this.local&&null!==(i=localStorage.getItem("uqLocalEntities"))&&(this.local=JSON.parse(i)),void 0!==this.local)if(a=this.local,o=a.user,c=a.uqs,o!==I||void 0===c)this.local=void 0;else for(u in c)c[u].isNet=void 0;if(void 0===this.local&&(this.local={user:I,unit:void 0,uqs:{}}),d=n+"/"+r,void 0!==(f=this.local.uqs[d])&&(p=f.value,l=p),void 0!==l){t.next=13;break}return t.next=11,e.__loadAccess();case 11:l=t.sent,this.saveLocal(d,l);case 13:return t.abrupt("return",h.a.cloneDeep(l));case 16:throw t.prev=16,t.t0=t.catch(0),this.local=void 0,localStorage.removeItem("uqLocalEntities"),t.t0;case 21:case"end":return t.stop()}},t,this,[[0,16]])}))}},{key:"saveLocal",value:function(e,t){this.local.uqs[e]={value:t,isNet:!0};var n=JSON.stringify(this.local);localStorage.setItem("uqLocalEntities",n)}},{key:"checkAccess",value:function(e){return w(this,void 0,void 0,s.a.mark(function t(){var n,r,i,a,o,c,u,l;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.uqOwner,r=e.uqName,i=n+"/"+r,void 0!==(a=this.local.uqs[i])){t.next=5;break}return t.abrupt("return",!1);case 5:if(o=a.isNet,c=a.value,!0!==o){t.next=8;break}return t.abrupt("return",!0);case 8:return t.next=10,e.__loadAccess();case 10:return u=t.sent,!1===(l=h.a.isMatch(c,u))&&this.saveLocal(i,u),t.abrupt("return",l);case 14:case"end":return t.stop()}},t,this)}))}}]),e}()),j=function(e){function t(e,n,a,o,s){var u;return Object(c.a)(this,t),u=Object(r.a)(this,Object(i.a)(t).call(this,e,s)),a&&(u.uqOwner=n,u.uqName=a,u.uq=n+"/"+a),u.access=o,u.showWaiting=s,u}return Object(a.a)(t,e),Object(u.a)(t,[{key:"getHttpChannel",value:function(){return w(this,void 0,void 0,s.a.mark(function e(){var t,n,r,i;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!0===this.showWaiting||void 0===this.showWaiting?(t=k,n=new v):t=g,void 0===(r=t[this.uq])){e.next=4;break}return e.abrupt("return",r);case 4:return e.next=6,Object(m.a)(this.uq,this.uqOwner,this.uqName);case 6:return i=e.sent,this.token=i.token,r=new d.a(!1,i.url,i.token,n),e.abrupt("return",t[this.uq]=r);case 10:case"end":return e.stop()}},e,this)}))}},{key:"update",value:function(){return w(this,void 0,void 0,s.a.mark(function e(){return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get("update");case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}))}},{key:"__loadAccess",value:function(){return w(this,void 0,void 0,s.a.mark(function e(){var t,n;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=void 0===this.access?"":this.access.join("|"),e.next=3,this.get("access",{acc:t});case 3:return n=e.sent,e.abrupt("return",n);case 5:case"end":return e.stop()}},e,this)}))}},{key:"loadAccess",value:function(){return w(this,void 0,void 0,s.a.mark(function e(){return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O.loadAccess(this);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}))}},{key:"loadEntities",value:function(){return w(this,void 0,void 0,s.a.mark(function e(){return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get("entities");case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}))}},{key:"checkAccess",value:function(){return w(this,void 0,void 0,s.a.mark(function e(){return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O.checkAccess(this);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}))}},{key:"schema",value:function(e){return w(this,void 0,void 0,s.a.mark(function t(){return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.get("schema/"+e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}},t,this)}))}},{key:"schemas",value:function(e){return w(this,void 0,void 0,s.a.mark(function t(){return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.post("schema",e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}},t,this)}))}},{key:"tuidGet",value:function(e,t){return w(this,void 0,void 0,s.a.mark(function n(){return s.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.get("tuid/"+e+"/"+t);case 2:return n.abrupt("return",n.sent);case 3:case"end":return n.stop()}},n,this)}))}},{key:"tuidGetAll",value:function(e){return w(this,void 0,void 0,s.a.mark(function t(){return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.get("tuid-all/"+e+"/");case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}},t,this)}))}},{key:"tuidSave",value:function(e,t){return w(this,void 0,void 0,s.a.mark(function n(){return s.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.post("tuid/"+e,t);case 2:return n.abrupt("return",n.sent);case 3:case"end":return n.stop()}},n,this)}))}},{key:"tuidSearch",value:function(e,t,n,r,i,a){return w(this,void 0,void 0,s.a.mark(function o(){var c;return s.a.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,this.post("tuids/"+e,{arr:t,owner:n,key:r,pageStart:i,pageSize:a});case 2:return c=o.sent,o.abrupt("return",c);case 4:case"end":return o.stop()}},o,this)}))}},{key:"tuidArrGet",value:function(e,t,n,r){return w(this,void 0,void 0,s.a.mark(function i(){return s.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,this.get("tuid-arr/"+e+"/"+n+"/"+t+"/"+r);case 2:return i.abrupt("return",i.sent);case 3:case"end":return i.stop()}},i,this)}))}},{key:"tuidArrGetAll",value:function(e,t,n){return w(this,void 0,void 0,s.a.mark(function r(){return s.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,this.get("tuid-arr-all/"+e+"/"+n+"/"+t+"/");case 2:return r.abrupt("return",r.sent);case 3:case"end":return r.stop()}},r,this)}))}},{key:"tuidArrSave",value:function(e,t,n,r){return w(this,void 0,void 0,s.a.mark(function i(){return s.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,this.post("tuid-arr/"+e+"/"+n+"/"+t+"/",r);case 2:return i.abrupt("return",i.sent);case 3:case"end":return i.stop()}},i,this)}))}},{key:"tuidArrPos",value:function(e,t,n,r,i){return w(this,void 0,void 0,s.a.mark(function a(){return s.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.post("tuid-arr-pos/"+e+"/"+n+"/"+t+"/",{id:r,$order:i});case 2:return a.abrupt("return",a.sent);case 3:case"end":return a.stop()}},a,this)}))}},{key:"tuidIds",value:function(e,t,n){return w(this,void 0,void 0,s.a.mark(function r(){var i,a;return s.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,i="tuidids/"+e+"/",i+=void 0!==t?t:"$",r.next=5,this.post(i,n);case 5:return a=r.sent,r.abrupt("return",a);case 9:r.prev=9,r.t0=r.catch(0),console.error(r.t0);case 12:case"end":return r.stop()}},r,this,[[0,9]])}))}},{key:"proxied",value:function(e,t,n){return w(this,void 0,void 0,s.a.mark(function r(){var i,a;return s.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,i="tuid-proxy/"+e+"/"+t+"/"+n,r.next=4,this.get(i);case 4:return a=r.sent,r.abrupt("return",a);case 8:r.prev=8,r.t0=r.catch(0),console.error(r.t0);case 11:case"end":return r.stop()}},r,this,[[0,8]])}))}},{key:"sheetSave",value:function(e,t){return w(this,void 0,void 0,s.a.mark(function n(){return s.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.post("sheet/"+e,t);case 2:return n.abrupt("return",n.sent);case 3:case"end":return n.stop()}},n,this)}))}},{key:"sheetAction",value:function(e,t){return w(this,void 0,void 0,s.a.mark(function n(){return s.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.put("sheet/"+e,t);case 2:return n.abrupt("return",n.sent);case 3:case"end":return n.stop()}},n,this)}))}},{key:"stateSheets",value:function(e,t){return w(this,void 0,void 0,s.a.mark(function n(){return s.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.post("sheet/"+e+"/states",t);case 2:return n.abrupt("return",n.sent);case 3:case"end":return n.stop()}},n,this)}))}},{key:"stateSheetCount",value:function(e){return w(this,void 0,void 0,s.a.mark(function t(){return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.get("sheet/"+e+"/statecount");case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}},t,this)}))}},{key:"getSheet",value:function(e,t){return w(this,void 0,void 0,s.a.mark(function n(){return s.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.get("sheet/"+e+"/get/"+t);case 2:return n.abrupt("return",n.sent);case 3:case"end":return n.stop()}},n,this)}))}},{key:"sheetArchives",value:function(e,t){return w(this,void 0,void 0,s.a.mark(function n(){return s.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.post("sheet/"+e+"/archives",t);case 2:return n.abrupt("return",n.sent);case 3:case"end":return n.stop()}},n,this)}))}},{key:"sheetArchive",value:function(e,t){return w(this,void 0,void 0,s.a.mark(function n(){return s.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.get("sheet/"+e+"/archive/"+t);case 2:return n.abrupt("return",n.sent);case 3:case"end":return n.stop()}},n,this)}))}},{key:"action",value:function(e,t){return w(this,void 0,void 0,s.a.mark(function n(){return s.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.post("action/"+e,t);case 2:return n.abrupt("return",n.sent);case 3:case"end":return n.stop()}},n,this)}))}},{key:"page",value:function(e,t,n,r){return w(this,void 0,void 0,s.a.mark(function i(){var a;return s.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:i.t0=typeof r,i.next="undefined"===i.t0?3:5;break;case 3:return a={key:""},i.abrupt("break",7);case 5:return a=h.a.clone(r),i.abrupt("break",7);case 7:return a.$pageStart=t,a.$pageSize=n,i.next=11,this.post("query-page/"+e,a);case 11:return i.abrupt("return",i.sent);case 12:case"end":return i.stop()}},i,this)}))}},{key:"query",value:function(e,t){return w(this,void 0,void 0,s.a.mark(function n(){var r;return s.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.post("query/"+e,t);case 2:return r=n.sent,n.abrupt("return",r);case 4:case"end":return n.stop()}},n,this)}))}},{key:"user",value:function(){return w(this,void 0,void 0,s.a.mark(function e(){return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get("user");case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}))}}]),t}(y.a),E={};var C,S=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(r.a)(this,Object(i.a)(t).call(this,"tv/",void 0,void 0,void 0,!0))).unitId=e,n}return Object(a.a)(t,e),Object(u.a)(t,[{key:"getHttpChannel",value:function(){return w(this,void 0,void 0,s.a.mark(function e(){var t;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===(t=E[this.unitId])){e.next=3;break}return e.abrupt("return",t);case 3:return e.next=5,this.buildChannel();case 5:return e.abrupt("return",E[this.unitId]=e.sent);case 6:case"end":return e.stop()}},e,this)}))}},{key:"buildChannel",value:function(){return w(this,void 0,void 0,s.a.mark(function e(){var t,n,r,i,a,o,c;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new v,n=new D("tv/",void 0),e.next=4,n.unitxUq(this.unitId);case 4:return r=e.sent,i=r.token,a=r.url,o=r.urlDebug,c=b.a.getUrlOrDebug(a,o),this.token=i,e.abrupt("return",new d.a(!1,c,i,t));case 9:case"end":return e.stop()}},e,this)}))}}]),t}(j);function N(e){console.log("setCenterUrl %s",e),C=e,_=void 0,F=void 0,P=void 0}var P,F,_=void 0,I=0;function A(e,t){_=t,I=e,console.log("setCenterToken %s",t),F=void 0,P=void 0}var R=function(e){function t(e,n){return Object(c.a)(this,t),Object(r.a)(this,Object(i.a)(t).call(this,e,n))}return Object(a.a)(t,e),Object(u.a)(t,[{key:"getHttpChannel",value:function(){return w(this,void 0,void 0,s.a.mark(function e(){return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",!0===this.showWaiting||void 0===this.showWaiting?void 0!==P?P:P=new d.a(!0,C,_,new v):void 0!==F?F:F=new d.a(!0,C,_));case 1:case"end":return e.stop()}},e,this)}))}}]),t}(y.a),V=new(function(e){function t(){return Object(c.a)(this,t),Object(r.a)(this,Object(i.a)(t).apply(this,arguments))}return Object(a.a)(t,e),Object(u.a)(t,[{key:"uq",value:function(e){return w(this,void 0,void 0,s.a.mark(function t(){var n,r,i,a,o,c,u,l,h,d,f,p,v;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,n=e.unit,r=e.uqOwner,i=e.uqName,void 0===this.local&&null!==(a=localStorage.getItem("uqTokens"))&&(this.local=JSON.parse(a)),void 0!==this.local&&(o=this.local,c=o.unit,u=o.user,c===n&&u===I||(this.local=void 0)),void 0===this.local&&(this.local={user:I,unit:e.unit,uqs:{}}),l=r+"/"+i,h=(new Date).getTime(),void 0===(d=this.local.uqs[l])){t.next=12;break}if(f=d.tick,p=d.value,!(h-f<864e5)){t.next=12;break}return t.abrupt("return",p);case 12:return t.next=14,this.get("app-uq",e);case 14:return v=t.sent,this.local.uqs[l]={tick:h,value:v},localStorage.setItem("uqTokens",JSON.stringify(this.local)),t.abrupt("return",v);case 20:throw t.prev=20,t.t0=t.catch(0),this.local=void 0,localStorage.removeItem("uqTokens"),t.t0;case 25:case"end":return t.stop()}},t,this,[[0,20]])}))}}]),t}(R))("tv/tie/",void 0),T=new(function(e){function t(){return Object(c.a)(this,t),Object(r.a)(this,Object(i.a)(t).apply(this,arguments))}return Object(a.a)(t,e),Object(u.a)(t,[{key:"directCall",value:function(e,t,n){return this.call(e,t,n)}}]),t}(R))("",void 0),D=function(e){function t(){return Object(c.a)(this,t),Object(r.a)(this,Object(i.a)(t).apply(this,arguments))}return Object(a.a)(t,e),Object(u.a)(t,[{key:"uqs",value:function(e,t,n){return w(this,void 0,void 0,s.a.mark(function r(){var i,a,o,c,u,l,d,f;return s.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(null!==(a=localStorage.getItem("appUqs"))&&(o=JSON.parse(a),c=o.unit,u=o.appOwner,l=o.appName,d=o.value,e===c&&t===u&&n===l&&(i=d)),void 0!==i){r.next=8;break}return r.next=5,this.uqsPure(e,t,n);case 5:i=r.sent,f={unit:e,appOwner:t,appName:n,value:i},localStorage.setItem("appUqs",JSON.stringify(f));case 8:return r.abrupt("return",this.cachedUqs=h.a.cloneDeep(i));case 9:case"end":return r.stop()}},r,this)}))}},{key:"uqsPure",value:function(e,t,n){return w(this,void 0,void 0,s.a.mark(function r(){return s.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,this.get("tie/app-uqs",{unit:e,appOwner:t,appName:n});case 2:return r.abrupt("return",r.sent);case 3:case"end":return r.stop()}},r,this)}))}},{key:"checkUqs",value:function(e,t,n){return w(this,void 0,void 0,s.a.mark(function r(){var i;return s.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,this.uqsPure(e,t,n);case 2:return i=r.sent,r.abrupt("return",h.a.isMatch(this.cachedUqs,i));case 4:case"end":return r.stop()}},r,this)}))}},{key:"unitxUq",value:function(e){return w(this,void 0,void 0,s.a.mark(function t(){return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.get("tie/unitx-uq",{unit:e});case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}},t,this)}))}}]),t}(R)},,,function(e,t,n){"use strict";n.d(t,"c",function(){return f}),n.d(t,"b",function(){return p}),n.d(t,"d",function(){return y}),n.d(t,"a",function(){return b});var r,i=n(6),a=n(4),o=n(7),s=n(0),c=n.n(s),u=n(3),l=n(5),h=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})};function d(e){void 0!==r&&r.postMessage({type:"ws",msg:e},"*")}function f(e){r=e}function p(e){window.top.postMessage({type:"ws",msg:e},"*")}var v=function(){function e(){Object(u.a)(this,e),this.handlerSeed=1,this.anyHandlers={},this.msgHandlers={}}return Object(l.a)(e,[{key:"onWsReceiveAny",value:function(e){var t=this.handlerSeed++;return this.anyHandlers[t]=e,t}},{key:"onWsReceive",value:function(e,t){var n=this.handlerSeed++;return this.msgHandlers[n]={type:e,handler:t},n}},{key:"endWsReceive",value:function(e){delete this.anyHandlers[e],delete this.msgHandlers[e]}},{key:"receive",value:function(e){return h(this,void 0,void 0,c.a.mark(function t(){var n,r,i,a,o,s;return c.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:n=e.$type,t.t0=c.a.keys(this.anyHandlers);case 2:if((t.t1=t.t0()).done){t.next=8;break}return r=t.t1.value,t.next=6,this.anyHandlers[r](e);case 6:t.next=2;break;case 8:t.t2=c.a.keys(this.msgHandlers);case 9:if((t.t3=t.t2()).done){t.next=18;break}if(i=t.t3.value,a=this.msgHandlers[i],o=a.type,s=a.handler,o===n){t.next=14;break}return t.abrupt("continue",9);case 14:return t.next=16,s(e);case 16:t.next=9;break;case 18:case"end":return t.stop()}},t,this)}))}}]),e}(),m=1,y=new(function(e){function t(){var e;return Object(u.a)(this,t),(e=Object(i.a)(this,Object(a.a)(t).apply(this,arguments))).wsBaseId="WsBridge seed "+m++,e}return Object(o.a)(t,e),t}(v)),b=function(e){function t(e,n){var r;return Object(u.a)(this,t),(r=Object(i.a)(this,Object(a.a)(t).call(this))).wsBaseId="WSChannel seed "+m++,r.wsHost=e,r.token=n,r}return Object(o.a)(t,e),Object(l.a)(t,[{key:"connect",value:function(){var e=this;if(void 0===this.ws){var n=this;return new Promise(function(r,i){var a=new WebSocket(e.wsHost,e.token||t.centerToken);console.log("connect webSocket %s",e.wsHost),a.onopen=function(t){console.log("webSocket connected %s",e.wsHost),n.ws=a,r()},a.onerror=function(e){i("webSocket can't open!")},a.onmessage=function(t){return h(e,void 0,void 0,c.a.mark(function e(){return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.wsMessage(t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}))},a.onclose=function(e){n.ws=void 0,console.log("webSocket closed!")}})}}},{key:"close",value:function(){void 0!==this.ws&&(this.ws.close(),this.ws=void 0)}},{key:"wsMessage",value:function(e){return h(this,void 0,void 0,c.a.mark(function t(){var n;return c.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,console.log("websocket message: %s",e.data),d(n=JSON.parse(e.data)),t.next=6,this.receive(n);case 6:t.next=11;break;case 8:t.prev=8,t.t0=t.catch(0),console.log("ws msg error: ",t.t0);case 11:case"end":return t.stop()}},t,this,[[0,8]])}))}},{key:"sendWs",value:function(e){var t=this;this.connect().then(function(){t.ws.send(e)})}}],[{key:"setCenterToken",value:function(e){t.centerToken=e}}]),t}(v)},,,function(e,t,n){"use strict";var r=n(20),i=(n(47),n(44)),a=n(8),o=n(3),s=n(5),c=n(6),u=n(4),l=n(7),h=n(15),d=n.n(h),f=(a.Component,a.Component,n(0)),p=n.n(f),v=n(24),m=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},y=function(){function e(t){var n=this;Object(o.a)(this,e),this.isDev=v.h,this.onMessageReceive=function(e){return m(n,void 0,void 0,p.a.mark(function t(){return p.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.onMessage(e);case 2:case"end":return t.stop()}},t,this)}))},this.res=t||{},this.x=this.res.x||{}}return Object(s.a)(e,[{key:"dispose",value:function(){r.c.unregisterReceiveHandler(this.receiveHandlerId),this.onDispose()}},{key:"onDispose",value:function(){}},{key:"showVPage",value:function(e,t){return m(this,void 0,void 0,p.a.mark(function n(){return p.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,new e(this).showEntry(t);case 2:case"end":return n.stop()}},n,this)}))}},{key:"renderView",value:function(e,t){return new e(this).render(t)}},{key:"event",value:function(e,t){return m(this,void 0,void 0,p.a.mark(function n(){return p.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.onEvent(e,t);case 2:case"end":return n.stop()}},n,this)}))}},{key:"onEvent",value:function(e,t){return m(this,void 0,void 0,p.a.mark(function e(){return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e,this)}))}},{key:"msg",value:function(e){alert(e)}},{key:"errorPage",value:function(e,t){this.openPage(a.createElement(i.a,{header:"App error!"},a.createElement("pre",null,"string"===typeof t?t:t.message)))}},{key:"onMessage",value:function(e){}},{key:"beforeStart",value:function(){return m(this,void 0,void 0,p.a.mark(function e(){return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",!0);case 1:case"end":return e.stop()}},e,this)}))}},{key:"registerReceiveHandler",value:function(){this.receiveHandlerId=r.c.registerReceiveHandler(this.onMessageReceive)}},{key:"start",value:function(e){return m(this,void 0,void 0,p.a.mark(function t(){return p.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.disposer=this.dispose.bind(this),this.registerReceiveHandler(),t.next=4,this.beforeStart();case 4:if(!1!==t.sent){t.next=7;break}return t.abrupt("return");case 7:return t.next=9,this.internalStart(e);case 9:case"end":return t.stop()}},t,this)}))}},{key:"call",value:function(e){return m(this,void 0,void 0,p.a.mark(function t(){var n=this;return p.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return void 0===this._resolve_$&&(this._resolve_$=[]),t.abrupt("return",new Promise(function(t,r){return m(n,void 0,void 0,p.a.mark(function n(){return p.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return this._resolve_$.push(t),n.next=3,this.start(e);case 3:case"end":return n.stop()}},n,this)}))}));case 2:case"end":return t.stop()}},t,this)}))}},{key:"vCall",value:function(e,t){return m(this,void 0,void 0,p.a.mark(function n(){var r=this;return p.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return void 0===this._resolve_$&&(this._resolve_$=[]),n.abrupt("return",new Promise(function(n,i){return m(r,void 0,void 0,p.a.mark(function r(){return p.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return this._resolve_$.push(n),r.next=3,new e(this).showEntry(t);case 3:case"end":return r.stop()}},r,this)}))}));case 2:case"end":return n.stop()}},n,this)}))}},{key:"returnCall",value:function(e){if(void 0!==this._resolve_$){var t=this._resolve_$.pop();void 0!==t?t(e):alert("the Coordinator call already returned, or not called")}}},{key:"openPage",value:function(e){r.c.push(e,this.disposer),this.disposer=void 0}},{key:"replacePage",value:function(e){r.c.replace(e,this.disposer),this.disposer=void 0}},{key:"backPage",value:function(){r.c.back()}},{key:"closePage",value:function(e){r.c.pop(e)}},{key:"ceasePage",value:function(e){r.c.ceaseTop(e)}},{key:"removeCeased",value:function(){r.c.removeCeased()}},{key:"regConfirmClose",value:function(e){r.c.regConfirmClose(e)}},{key:"user",get:function(){return r.c.user}},{key:"isLogined",get:function(){var e=r.c.user;return void 0!==e&&e.id>0}},{key:"isCalling",get:function(){return void 0!==this._resolve_$}}]),e}(),b=function(){function e(t){Object(o.a)(this,e),this.controller=t,this.res=t.res,this.x=t.x}return Object(s.a)(e,[{key:"renderVm",value:function(e,t){return new e(this.controller).render(t)}},{key:"showVPage",value:function(e,t){return m(this,void 0,void 0,p.a.mark(function n(){return p.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,new e(this.controller).showEntry(t);case 2:case"end":return n.stop()}},n,this)}))}},{key:"event",value:function(e,t){return m(this,void 0,void 0,p.a.mark(function n(){return p.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.controller.event(e,t);case 2:case"end":return n.stop()}},n,this)}))}},{key:"returnCall",value:function(e){this.controller.returnCall(e)}},{key:"openPage",value:function(e,t){this.controller.openPage(a.createElement(e,t))}},{key:"replacePage",value:function(e,t){this.controller.replacePage(a.createElement(e,t))}},{key:"openPageElement",value:function(e){this.controller.openPage(e)}},{key:"replacePageElement",value:function(e){this.controller.replacePage(e)}},{key:"backPage",value:function(){this.controller.backPage()}},{key:"closePage",value:function(e){this.controller.closePage(e)}},{key:"ceasePage",value:function(e){this.controller.ceasePage(e)}},{key:"removeCeased",value:function(){this.controller.removeCeased()}},{key:"regConfirmClose",value:function(e){this.controller.regConfirmClose(e)}},{key:"isDev",get:function(){return v.h}}]),e}(),w=function(e){function t(e){return Object(o.a)(this,t),Object(c.a)(this,Object(u.a)(t).call(this,e))}return Object(l.a)(t,e),Object(s.a)(t,[{key:"render",value:function(e){return null}}]),t}(b),k=n(11),g=n(13),x=n(31),O=n(23),j=n(21),E=n(25),C=n.n(E),S=function e(){Object(o.a)(this,e)},N=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(c.a)(this,Object(u.a)(t).call(this))).func=e,n}return Object(l.a)(t,e),Object(s.a)(t,[{key:"check",value:function(e,t){var n=this.func(t);if(void 0!==n)switch(typeof n){case"undefined":return;case"string":return void e.push(n);default:return void e.push.apply(e,Object(O.a)(n))}}}]),t}(S),P=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(c.a)(this,Object(u.a)(t).call(this))).res=e,n}return Object(l.a)(t,e),t}(S),F=function(e){function t(){return Object(o.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(l.a)(t,e),Object(s.a)(t,[{key:"check",value:function(e,t){switch(typeof t){default:case"boolean":return;case"object":if(null!==t)return;break;case"string":if(t.trim().length>0)return;break;case"number":if(NaN!==t)return;break;case"undefined":}e.push(this.res.required)}}]),t}(P),_=function(e){function t(e,n,r){var i;return Object(o.a)(this,t),(i=Object(c.a)(this,Object(u.a)(t).call(this,e))).minMsg=C.a.template(e.min),i.maxMsg=C.a.template(e.max),i.min=n,i.max=r,i}return Object(l.a)(t,e),Object(s.a)(t,[{key:"check",value:function(e,t){if(void 0!==t&&null!==t){var n=Number(t);NaN===n?e.push(this.res.number):this.checkMore(e,n)}}},{key:"checkMore",value:function(e,t){void 0!==this.min&&Number(t)<this.min&&e.push(this.minMsg({min:this.min})),void 0!==this.max&&Number(t)>this.max&&e.push(this.maxMsg({max:this.max}))}}]),t}(P),I=function(e){function t(){return Object(o.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(l.a)(t,e),Object(s.a)(t,[{key:"checkMore",value:function(e,n){Object(j.a)(Object(u.a)(t.prototype),"checkMore",this).call(this,e,n),!1===Number.isInteger(n)&&e.push(this.res.integer)}}]),t}(_),A=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},R=function(){function e(t,n,r,i){var a=this;Object(o.a)(this,e),this.errors=[],this.contextErrors=[],this.onInputChange=function(e){a.changeValue(e.target.value,!0)},this.context=t;var s=n.name;if(this.name=s,this.itemSchema=n,this.fieldProps=r,this.children=i,this.ui=t.getUiItem(s),void 0===this.ui)this.readOnly=!1,this.disabled=!1,this.visible=!0;else{var c=this.ui,u=c.readOnly,l=c.disabled,h=c.visible;this.readOnly=!0===u,this.disabled=!0===l,this.visible=!(!1===h)}this.value=this.defaultValue=t.getValue(s),this.init()}return Object(s.a)(e,[{key:"init",value:function(){if(this.rules=[],!0===this.itemSchema.required&&this.rules.push(new F(this.context.form.res)),this.buildRules(),void 0!==this.ui){var e=this.ui.rules;if(void 0!==e)if(!1!==Array.isArray(e)){var t=!0,n=!1,r=void 0;try{for(var i,a=e[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var o=i.value;this.rules.push(new N(o))}}catch(s){n=!0,r=s}finally{try{t||null==a.return||a.return()}finally{if(n)throw r}}}else this.rules.push(new N(e))}}},{key:"buildRules",value:function(){}},{key:"checkRules",value:function(){var e,t=[],n=!0,r=!1,i=void 0;try{for(var a,o=this.rules[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){a.value.check(t,this.value)}}catch(s){r=!0,i=s}finally{try{n||null==o.return||o.return()}finally{if(r)throw i}}0===t.length?this.context.removeErrorWidget(this):(this.context.addErrorWidget(this),(e=this.errors).push.apply(e,t))}},{key:"setError",value:function(e){var t;void 0!==e&&("string"===typeof e?this.errors.push(e):(t=this.errors).push.apply(t,Object(O.a)(e)))}},{key:"setContextError",value:function(e){var t;void 0!==e&&("string"===typeof e?this.contextErrors.push(e):(t=this.contextErrors).push.apply(t,Object(O.a)(e)))}},{key:"clearError",value:function(){this.errors.splice(0)}},{key:"clearContextError",value:function(){this.contextErrors.splice(0)}},{key:"parse",value:function(e){return e}},{key:"setElementValue",value:function(e){}},{key:"setDataValue",value:function(e){!0!==this.isChanging&&(this.context.initData[this.name]=this.value=this.parse(e))}},{key:"setValue",value:function(e){!0!==this.isChanging&&this.changeValue(e,!1)}},{key:"getValue",value:function(){return this.context.getValue(this.name)}},{key:"getReadOnly",value:function(){return this.readOnly}},{key:"getDisabled",value:function(){return this.disabled}},{key:"getVisible",value:function(){return this.visible}},{key:"setReadOnly",value:function(e){this.readOnly=e}},{key:"setDisabled",value:function(e){this.disabled=e}},{key:"setVisible",value:function(e){this.visible=e}},{key:"changeValue",value:function(e,t){var n,r,i=this.value;void 0!==this.ui&&(n=this.ui.onChanging,r=this.ui.onChanged);var a=!0;void 0!==n&&(this.isChanging=!0,a=n(this.context,this.value,i),this.isChanging=!1),!0===a&&(this.setDataValue(e),!0!==t&&this.setElementValue(e),void 0!==r&&(this.isChanging=!0,r(this.context,this.value,i),this.isChanging=!1))}},{key:"renderContainer",value:function(){if(!1===this.visible)return null;var e,t=this.context,n=t.form;if(!0===t.inNode)return this.render();if(void 0===this.ui)e=this.name;else{var r=this.ui.label;null===r&&(e=null),e=r||this.name}return!0===this.itemSchema.required&&!1!==n.props.requiredFlag&&null!==e&&(e=a.createElement(a.Fragment,null,e,"\xa0",a.createElement("span",{className:"text-danger"},"*"))),n.FieldContainer(e,this.render())}},{key:"renderTemplet",value:function(){if(void 0!==this.children)return a.createElement(a.Fragment,null,this.children);if(void 0!==this.ui){var e=this.ui.Templet;return"function"===typeof e?e(this.value):e}}},{key:"renderErrors",value:function(){var e=[].concat(Object(O.a)(this.errors),Object(O.a)(this.contextErrors));if(0===e.length)return null;var t=!0===this.context.inNode?"span":"div";return e.map(function(e){return a.createElement(t,{key:e,className:"text-danger d-inline-block my-2 ml-3"},a.createElement(a.Fragment,null,a.createElement("i",{className:"fa fa-exclamation-circle"})," \xa0",e))})}},{key:"hasError",get:function(){return this.errors.length+this.contextErrors.length>0}},{key:"isOk",get:function(){return 0===this.errors.length}},{key:"className",get:function(){var e;return!1===this.context.inNode&&(e="form-control"),d()(e,this.context.form.FieldClass,this.ui&&this.ui.className)}}]),e}();A([g.l],R.prototype,"errors",void 0),A([g.l],R.prototype,"contextErrors",void 0),A([g.e],R.prototype,"hasError",null),A([g.l],R.prototype,"visible",void 0),A([g.e],R.prototype,"isOk",null);var V=function(e){function t(){var e;return Object(o.a)(this,t),(e=Object(c.a)(this,Object(u.a)(t).apply(this,arguments))).inputType="text",e}return Object(l.a)(t,e),Object(s.a)(t,[{key:"setElementValue",value:function(e){null!==this.input&&(this.input.value=e)}},{key:"onBlur",value:function(e){this.onInputChange(e),this.checkRules(),this.context.checkContextRules()}},{key:"onFocus",value:function(e){this.clearError(),this.context.removeErrorWidget(this),this.context.removeErrors()}},{key:"onChange",value:function(e){}},{key:"setReadOnly",value:function(e){null!==this.input&&(this.input.readOnly=this.readOnly=e)}},{key:"setDisabled",value:function(e){null!==this.input&&(this.input.disabled=this.disabled=e)}},{key:"render",value:function(){var e=this,t=this.renderTemplet();if(void 0!==t)return t;var n={};return!0===this.hasError?n["is-invalid"]=!0:n["required-item"]=!0===this.itemSchema.required,a.createElement(a.Fragment,null,a.createElement("input",{ref:function(t){return e.input=t},className:d()(this.className,n),type:this.inputType,defaultValue:this.value,onChange:function(t){return e.onChange(t)},placeholder:this.placeholder,readOnly:this.readOnly,disabled:this.disabled,onKeyDown:this.onKeyDown,onFocus:function(t){return e.onFocus(t)},onBlur:function(t){return e.onBlur(t)},maxLength:this.itemSchema.maxLength}),this.renderErrors())}},{key:"placeholder",get:function(){return this.ui&&this.ui.placeholder||this.name}}]),t}(R),T=function(e){function t(){var e;return Object(o.a)(this,t),(e=Object(c.a)(this,Object(u.a)(t).apply(this,arguments))).onInputChange=function(t){e.setValue(t.currentTarget.value)},e}return Object(l.a)(t,e),Object(s.a)(t,[{key:"setElementValue",value:function(e){this.input.value=e}},{key:"setReadOnly",value:function(e){this.input.readOnly=this.readOnly=e}},{key:"setDisabled",value:function(e){this.input.disabled=this.disabled=e}},{key:"render",value:function(){var e=this;return a.createElement("textarea",{ref:function(t){return e.input=t},rows:this.ui&&this.ui.rows,maxLength:this.itemSchema.maxLength,defaultValue:this.defaultValue,onChange:this.onInputChange})}}]),t}(R),D=function(e){function t(){var e;return Object(o.a)(this,t),(e=Object(c.a)(this,Object(u.a)(t).apply(this,arguments))).inputType="password",e}return Object(l.a)(t,e),t}(V),q=function(e){function t(){var e;return Object(o.a)(this,t),(e=Object(c.a)(this,Object(u.a)(t).apply(this,arguments))).inputType="url",e}return Object(l.a)(t,e),t}(V),M=function(e){function t(){var e;return Object(o.a)(this,t),(e=Object(c.a)(this,Object(u.a)(t).apply(this,arguments))).inputType="email",e}return Object(l.a)(t,e),t}(V),U=function(e){function t(){var e;return Object(o.a)(this,t),(e=Object(c.a)(this,Object(u.a)(t).apply(this,arguments))).inputType="number",e}return Object(l.a)(t,e),Object(s.a)(t,[{key:"buildRules",value:function(){Object(j.a)(Object(u.a)(t.prototype),"buildRules",this).call(this);var e=this.context.form.res,n=this.itemSchema,r=n.min,i=n.max;this.rules.push("integer"===this.itemSchema.type?new _(e,r,i):new I(e,r,i))}},{key:"parse",value:function(e){if(void 0!==e&&null!==e)return Number(e)}}]),t}(V),L=function(e){function t(){var e;return Object(o.a)(this,t),(e=Object(c.a)(this,Object(u.a)(t).apply(this,arguments))).inputType="number",e.onKeyDown=function(t){var n=t.keyCode;event.returnValue=e.isValidKey(n)},e}return Object(l.a)(t,e),Object(s.a)(t,[{key:"isValidKey",value:function(e){return 46===e||8===e||37===e||39===e||e>=48&&e<=57||e>=96&&e<=105||109===e||189===e}}]),t}(U),B=function(e){function t(){var e;return Object(o.a)(this,t),(e=Object(c.a)(this,Object(u.a)(t).apply(this,arguments))).inputType="date",e}return Object(l.a)(t,e),t}(V),$=function(e){function t(){var e;return Object(o.a)(this,t),(e=Object(c.a)(this,Object(u.a)(t).apply(this,arguments))).inputType="datetime",e}return Object(l.a)(t,e),t}(V),H=function(e){function t(){var e;return Object(o.a)(this,t),(e=Object(c.a)(this,Object(u.a)(t).apply(this,arguments))).inputType="time",e}return Object(l.a)(t,e),t}(V),W=function(e){function t(){var e;return Object(o.a)(this,t),(e=Object(c.a)(this,Object(u.a)(t).apply(this,arguments))).inputType="month",e}return Object(l.a)(t,e),t}(V),z=function(e){function t(){var e;return Object(o.a)(this,t),(e=Object(c.a)(this,Object(u.a)(t).apply(this,arguments))).onInputChange=function(t){e.setDataValue(!0===t.target.checked?e.trueValue:e.falseValue)},e.onClick=function(){e.context.removeErrors()},e}return Object(l.a)(t,e),Object(s.a)(t,[{key:"init",value:function(){if(Object(j.a)(Object(u.a)(t.prototype),"init",this).call(this),void 0!==this.ui){var e=this.ui,n=e.trueValue,r=e.falseValue;this.trueValue=void 0===n||n,this.falseValue=void 0!==r&&r}else this.trueValue=!0,this.falseValue=!1}},{key:"setElementValue",value:function(e){this.input.checked=e===this.trueValue}},{key:"setReadOnly",value:function(e){this.input.readOnly=this.readOnly=e}},{key:"setDisabled",value:function(e){this.input.disabled=this.disabled=e}},{key:"render",value:function(){var e=this,t=d()(this.className,"form-check-inline"),n=a.createElement("input",{ref:function(t){return e.input=t},className:"align-self-center",type:"checkbox",defaultChecked:this.defaultValue,onChange:this.onInputChange,onClick:this.onClick});return this.context.inNode?a.createElement("label",{className:t},n," ",this.ui&&this.ui.label||this.name):a.createElement("div",{className:t},n)}}]),t}(R),K=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},Q=function(e){function t(){var e;return Object(o.a)(this,t),(e=Object(c.a)(this,Object(u.a)(t).apply(this,arguments))).onInputChange=function(t){e.setDataValue(t.target.value)},e}return Object(l.a)(t,e),Object(s.a)(t,[{key:"setElementValue",value:function(e){this.select.value=e}},{key:"setReadOnly",value:function(e){this.select.disabled=this.readOnly=!e}},{key:"setDisabled",value:function(e){this.select.disabled=this.disabled=e}},{key:"render",value:function(){var e=this;if(!0===this.readOnly){var t=this.ui.list.find(function(t){return t.value===e.value}),n=void 0===t?"(???)":t.title;return a.createElement("span",{className:"form-control w-min-6c"},n)}return a.createElement("select",{ref:function(t){return e.select=t},className:d()(this.className,"form-control"),defaultValue:this.defaultValue,onChange:this.onInputChange},this.ui.list.map(function(e,t){var n=e.title,r=e.value;return a.createElement("option",{className:void 0,key:t,value:r},n||r)}))}}]),t}(R);K([g.l],Q.prototype,"readOnly",void 0);var J=function(e){function t(){var e;return Object(o.a)(this,t),(e=Object(c.a)(this,Object(u.a)(t).apply(this,arguments))).inputs={},e}return Object(l.a)(t,e),Object(s.a)(t,[{key:"setElementValue",value:function(e){for(var t in this.inputs){var n=this.inputs[t];n.checked=e===n.value}}},{key:"setReadOnly",value:function(e){for(var t in this.readOnly=e,this.inputs)this.inputs[t].readOnly=e}},{key:"setDisabled",value:function(e){for(var t in this.disabled=e,this.inputs)this.inputs[t].disabled=e}},{key:"render",value:function(){var e,t=this,n=this.ui,r=n.defaultValue,i=n.list,o=this.context,s=o.isRow;o.inNode;!0===s&&(e=this.context.rowKey);var c=d()(this.className,"form-radio-inline");return a.createElement("span",{className:c},i.map(function(n,i){var o=n.value,s=n.title,c=t.name;return void 0!==e&&(c+="-"+e),a.createElement("label",{key:i,className:"form-radio-inline"},a.createElement("input",{ref:function(e){return t.inputs[i]=e},type:"radio",name:c,value:o,defaultChecked:(t.defaultValue||r)===o}),s||o)}))}}]),t}(R),G=function(e){function t(){var e;return Object(o.a)(this,t),(e=Object(c.a)(this,Object(u.a)(t).apply(this,arguments))).inputType="range",e}return Object(l.a)(t,e),Object(s.a)(t,[{key:"setReadOnly",value:function(e){this.input.readOnly=this.readOnly=e}},{key:"setDisabled",value:function(e){this.input.disabled=this.disabled=e}},{key:"render",value:function(){var e=this,t=this.ui,n=t.min,r=t.max,i=t.step;return a.createElement(a.Fragment,null,a.createElement("input",{ref:function(t){return e.input=t},className:d()(this.className,"form-control","w-min-6c"),type:this.inputType,defaultValue:this.defaultValue,onChange:this.onInputChange,max:r,min:n,step:i}))}}]),t}(R),Y=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},X=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},Z=function(e){function t(){var e;return Object(o.a)(this,t),(e=Object(c.a)(this,Object(u.a)(t).apply(this,arguments))).onClick=function(){return X(Object(k.a)(Object(k.a)(e)),void 0,void 0,p.a.mark(function e(){var t,n;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==(t=this.ui&&this.ui.pickId)){e.next=4;break}return alert("no pickId defined!"),e.abrupt("return");case 4:return e.next=6,t(this.context,this.name,this.value);case 6:n=e.sent,this.setDataValue(n),this.clearError(),this.clearContextError(),this.checkRules();case 11:case"end":return e.stop()}},e,this)}))},e}return Object(l.a)(t,e),Object(s.a)(t,[{key:"setReadOnly",value:function(e){this.readOnly=e}},{key:"setDisabled",value:function(e){this.disabled=e}},{key:"render",value:function(){var e,t;void 0!==this.ui&&(e=this.ui.placeholder,t=this.ui.Templet);var n,r={"form-control":!0,"required-item":!0===this.itemSchema.required,"cursor-pointer":!0,"is-invalid":this.hasError};return void 0===this.value||null===this.value?(n=e||"placeholder",r["text-muted"]=!0):n=void 0===t?a.createElement(a.Fragment,null,this.value):"function"===typeof t?t(this.value):t,a.createElement(a.Fragment,null,a.createElement("div",{className:d()(r),onClick:this.onClick},n),this.renderErrors())}}]),t}(R);Y([g.l],Z.prototype,"value",void 0);var ee=function(e,t,n){return a.createElement("span",{className:"text-danger"},"!!data type ",e," only support ",(n||[]).join(", "),", can't use ui ",t,"!!")},te=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},ne=function(e){function t(){var e;return Object(o.a)(this,t),(e=Object(c.a)(this,Object(u.a)(t).apply(this,arguments))).onClick=function(){return te(Object(k.a)(Object(k.a)(e)),void 0,void 0,p.a.mark(function e(){var t,n,r,i;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.clearError(),this.clearContextError(),t=this.itemSchema,n=t.name,"submit"!==t.type){e.next=7;break}if(this.context.checkRules(),!0!==this.context.hasError){e.next=7;break}return e.abrupt("return");case 7:if(void 0!==(r=this.context.form.props.onButtonClick)){e.next=11;break}return alert("button ".concat(n," clicked. you should define form onButtonClick")),e.abrupt("return");case 11:return e.next=13,r(n,this.context);case 13:if(void 0!==(i=e.sent)){e.next=16;break}return e.abrupt("return");case 16:this.context.setError(n,i);case 17:case"end":return e.stop()}},e,this)}))},e.observerRender=Object(x.a)(function(){var t,n,r,i=e.itemSchema,o=i.name,s=i.type;if(void 0!==e.ui){var c=e.ui.widget;if("button"!==c)return ee(s,c,["button"]);t=e.ui.Templet,n=e.ui.className,r=e.ui.label}var u,l=e.context,h=l.form,d=l.hasError,f=e.context,p="submit"===s&&d;u=void 0!==e.children?e.children:"function"===typeof t?t():void 0!==t?t:r;var v=a.createElement("button",{className:n,type:"button",disabled:p,onClick:e.onClick},u||o);return!0===f.inNode?a.createElement(a.Fragment,null,v,e.renderErrors()):a.createElement("div",{className:h.ButtonClass},a.createElement("div",null,e.renderErrors()),v)}),e}return Object(l.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){return a.createElement(this.observerRender,null)}},{key:"renderContainer",value:function(){if(!1===this.visible)return null;var e=this.context,t=e.form;return!0===e.inNode?this.render():t.FieldContainer(null,this.render())}}]),t}(R),re=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},ie=function(){function e(t,n,r,i,s){var c=this;if(Object(o.a)(this,e),this.widgets={},this.errors=[],this.errorWidgets=[],this.renderErrors=Object(x.a)(function(){var e=c.errors;return 0===e.length?null:a.createElement(a.Fragment,null,e.map(function(e){return a.createElement("span",{key:e,className:"text-danger inline-block my-1 ml-3"},a.createElement("i",{className:"fa fa-exclamation-circle"})," \xa0",e)}))}),this.form=t,this.uiSchema=n,this.initData=r,this.inNode=i,this.isRow=s,void 0!==n){var u,l=n.rules;if(void 0!==l)this.rules=[],!1===Array.isArray(l)?this.rules.push(l):(u=this.rules).push.apply(u,Object(O.a)(l))}}return Object(s.a)(e,[{key:"getArrRowContexts",value:function(e){void 0===this.subContexts&&(this.subContexts={});var t=this.subContexts[name];return void 0===t&&(this.subContexts[name]=t={}),t}},{key:"getValue",value:function(e){return this.initData[e]}},{key:"setValue",value:function(e,t){this.initData[e]=t;var n=this.widgets[e];void 0!==n&&n.setValue(t)}},{key:"getDisabled",value:function(e){var t=this.widgets[e];if(void 0!==t)return t.getDisabled()}},{key:"setDisabled",value:function(e,t){var n=this.widgets[e];void 0!==n&&n.setDisabled(t)}},{key:"getReadOnly",value:function(e){var t=this.widgets[e];void 0!==t&&t.getReadOnly()}},{key:"setReadOnly",value:function(e,t){var n=this.widgets[e];void 0!==n&&n.setReadOnly(t)}},{key:"getVisible",value:function(e){var t=this.widgets[e];void 0!==t&&t.getVisible()}},{key:"setVisible",value:function(e,t){var n=this.widgets[e];void 0!==n&&n.setVisible(t)}},{key:"checkFieldRules",value:function(){for(var e in this.widgets)this.widgets[e].checkRules();if(void 0!==this.subContexts)for(var t in this.subContexts){var n=this.subContexts[t];for(var r in n)n[r].checkFieldRules()}}},{key:"checkContextRules",value:function(){if(void 0!==this.rules){this.clearContextErrors();var e=!0,t=!1,n=void 0;try{for(var r,i=this.rules[Symbol.iterator]();!(e=(r=i.next()).done);e=!0){var a,o=(0,r.value)(this);if(void 0!==o)if(!0===Array.isArray(o))(a=this.errors).push.apply(a,Object(O.a)(o));else if("string"===typeof o)this.errors.push(o);else for(var s in o)this.setError(s,o[s])}}catch(d){t=!0,n=d}finally{try{e||null==i.return||i.return()}finally{if(t)throw n}}if(void 0!==this.subContexts)for(var c in this.subContexts){var u=this.subContexts[c];for(var l in u){var h=u[l];h.removeErrors(),h.checkContextRules()}}}}},{key:"setError",value:function(e,t){var n=this.widgets[e];void 0!==n&&(n.setContextError(t),this.addErrorWidget(n))}},{key:"clearContextErrors",value:function(){for(var e in this.widgets)this.widgets[e].clearContextError()}},{key:"checkRules",value:function(){this.checkFieldRules(),this.checkContextRules()}},{key:"addErrorWidget",value:function(e){this.errorWidgets.findIndex(function(t){return t===e})<0&&this.errorWidgets.push(e)}},{key:"removeErrorWidget",value:function(e){var t=this.errorWidgets.findIndex(function(t){return t===e});t>=0&&this.errorWidgets.splice(t,1)}},{key:"checkHasError",value:function(){if(!0===this.errorWidgets.length+this.errors.length>0)return!0;if(void 0===this.subContexts)return!1;for(var e in this.subContexts){var t=this.subContexts[e];for(var n in t)if(!0===t[n].hasError)return!0}return!1}},{key:"removeErrors",value:function(){for(var e in this.errors.splice(0),this.errorWidgets.splice(0),this.widgets){var t=this.widgets[e];void 0!==t&&t.clearContextError()}}},{key:"arrName",get:function(){}},{key:"hasError",get:function(){return this.checkHasError()}}]),e}();re([g.l],ie.prototype,"errors",void 0),re([g.l],ie.prototype,"errorWidgets",void 0),re([g.e],ie.prototype,"hasError",null);var ae=1,oe=function(e){function t(e,n,r,i){var a,s;Object(o.a)(this,t);var l=e.uiSchema;if(void 0!==l){var h=l.items;void 0!==h&&(s=h[n.name])}return(a=Object(c.a)(this,Object(u.a)(t).call(this,e.form,s,r,i,!0))).parentContext=e,a.arrSchema=n,a.rowKey=ae++,a.data=r,a}return Object(l.a)(t,e),Object(s.a)(t,[{key:"getItemSchema",value:function(e){return this.arrSchema.itemSchemas[e]}},{key:"getUiItem",value:function(e){if(void 0!==this.uiSchema){var t=this.uiSchema.items;if(void 0!==t)return t[e]}}},{key:"removeErrors",value:function(){Object(j.a)(Object(u.a)(t.prototype),"removeErrors",this).call(this),this.parentContext.removeErrors()}},{key:"arrName",get:function(){return this.arrSchema.name}},{key:"parentData",get:function(){return this.parentContext.data}}]),t}(ie),se=function(e){function t(e,n){return Object(o.a)(this,t),Object(c.a)(this,Object(u.a)(t).call(this,e,e.uiSchema,e.data,n,!1))}return Object(l.a)(t,e),Object(s.a)(t,[{key:"getItemSchema",value:function(e){return this.form.itemSchemas[e]}},{key:"getUiItem",value:function(e){var t=this.form.uiSchema;if(void 0!==t){var n=t.items;if(void 0!==n)return n[e]}}},{key:"data",get:function(){return this.form.data}}]),t}(ie),ce=a.createContext({}),ue=Object(x.a)(function(e){var t,n,r,i,o=e.parentContext,s=e.arrSchema,c=e.children,u=s.name,l=s.arr,h=o.initData[u],f=o.form,p=o.getArrRowContexts(u),v=o.getUiItem(u),m=u,y=f.ArrContainer,b=f.RowContainer,w=f.RowSeperator,k=f.uiSchema;if(void 0!==k){var g=k.selectable,O=k.deletable,j=k.restorable;!0!==n&&(n=g),!0!==r&&(r=O),!0!==i&&(i=j)}if(void 0!==v){var E=v.widget,C=v.label,S=v.selectable,N=v.deletable,P=v.restorable,F=v.ArrContainer,_=v.RowContainer,I=v.RowSeperator;if(void 0!==S&&(n=S),void 0!==N&&(r=N),void 0!==P&&(i=P),void 0!==F&&(y=F),void 0!==_&&(b=_),void 0!==I&&(w=I),t=v.Templet,"arr"!==E)return ee(s.type,E,["arr"]);m=C||m}var A=!0;return y(m,a.createElement(a.Fragment,null,h.map(function(e,u){var f,v,m=void 0;if(!1===A?m=w:A=!1,void 0!==c)f=new oe(o,s,e,!0),v=a.createElement(a.Fragment,null,c);else{var y=typeof t;"function"===y?(f=new oe(o,s,e,!0),v=a.createElement(Object(x.a)(t),e)):"object"===y?(f=new oe(o,s,e,!0),v=t):(f=new oe(o,s,e,!1),v=a.createElement(a.Fragment,null,l.map(function(e,t){return a.createElement(a.Fragment,{key:e.name},he(f,e,void 0))})))}var k,g,O=f.rowKey;if(p[O]=f,!0===n){k=a.createElement("div",{className:"form-row-checkbox"},a.createElement("input",{type:"checkbox",onClick:function(t){var n=t.target.checked;e.$isSelected=n;var r=e.$source;void 0!==r&&(r.$isSelected=n),f.removeErrors()},defaultChecked:e.$isSelected}))}var j=!(void 0===e.$isDeleted||!1===e.$isDeleted);if(!0===r){var E=j?"fa-undo":"fa-trash";g=a.createElement("div",{className:"form-row-edit text-info",onClick:function(){if(!0===i){e.$isDeleted=!j;var t=e.$source;void 0!==t&&(t.$isDeleted=!j)}else{var n=h.indexOf(e);n>=0&&h.splice(n,1)}f.removeErrors()}},a.createElement("i",{className:d()("fa",E,"fa-fw")}))}var C=!0===n||!0===r?function(t){return a.createElement("fieldset",{disabled:j},a.createElement("div",{className:d()("d-flex",{deleted:j,"row-selected":e.$isSelected})},k,a.createElement("div",{className:"flex-grow-1"},t),g))}:function(e){return e};return a.createElement(ce.Provider,{key:O,value:f},m,b(C(a.createElement(a.Fragment,null,a.createElement(f.renderErrors,null),v))))})))}),le={id:{dataTypes:["id"],widget:Z},text:{dataTypes:["integer","number","string"],widget:V},textarea:{dataTypes:["string"],widget:T},password:{dataTypes:["string"],widget:D},date:{dataTypes:["date"],widget:B},datetime:{dataTypes:["date"],widget:$},time:{dataTypes:["date"],widget:H},month:{dataTypes:["date"],widget:W},select:{dataTypes:["integer","number","string","date","boolean"],widget:Q},url:{dataTypes:["string"],widget:q},email:{dataTypes:["string"],widget:M},number:{dataTypes:["integer","number"],widget:U},updown:{dataTypes:["integer","number"],widget:L},color:{},checkbox:{dataTypes:["boolean","integer","number"],widget:z},checkboxes:{},radio:{dataTypes:["integer","number","string","date","boolean"],widget:J},range:{dataTypes:["integer"],widget:G},button:{dataTypes:["button","submit"],widget:ne}};function he(e,t,n,r){if(void 0===e)return null;if(void 0!==t){var i,o=t.name,s=t.type;switch(s){case"arr":var c=e.getItemSchema(o);return a.createElement(ue,{parentContext:e,arrSchema:c,children:n})}var u=e.getUiItem(o);if(void 0===u)i=v(s);else{var l=u.widget;switch(l){default:if(void 0!==l)i=le[l].widget;void 0===i&&(i=v(s));break;case"custom":i=u.WidgetClass;break;case"group":return a.createElement("span",null,"impletment group")}}var h=e.isRow,d=e.widgets,f=new i(e,t,r,n);if(d[o]=f,!1===h){var p=Object(x.a)(function(){return f.renderContainer()});return a.createElement(p,null)}return f.renderContainer()}function v(e){switch(e){default:return V;case"id":return Z;case"integer":return L;case"number":return U;case"string":return V;case"date":return B;case"boolean":return z;case"button":case"submit":return ne}}}n(58);var de={_:{required:"required",number:"not valid number",integer:"not valid integer",min:"min value is ${min}",max:"max value is ${max}"},zh:{_:{required:"\u5fc5\u987b\u586b",number:"\u9700\u8981\u6570\u5b57",integer:"\u9700\u8981\u6574\u6570",min:"\u4e0d\u80fd\u5c0f\u4e8e${min}",max:"\u4e0d\u80fd\u5927\u4e8e${max}"}}},fe=n(41),pe=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},ve=function(e){function t(e){var n;Object(o.a)(this,t),(n=Object(c.a)(this,Object(u.a)(t).call(this,e))).calcSelectOrDelete=function(){if(void 0!==n.formData){var e=!0,t=!1,r=void 0;try{for(var i,a=n.schema[Symbol.iterator]();!(e=(i=a.next()).done);e=!0){var o=i.value;n.arrItemOperated(o)}}catch(s){t=!0,r=s}finally{try{e||null==a.return||a.return()}finally{if(t)throw r}}}},n.DefaultContainer=function(e){return a.createElement("form",{className:d()(n.props.className)},e)},n.DefaultFieldContainer=function(e,t){var r=n.props.fieldLabelSize;if(r>0){var i;null===e?r=0:i=a.createElement("label",{className:d()("col-sm-"+r,"col-form-label")},e);var o="col-sm-"+(12-r);return a.createElement("div",{className:"form-group row"},i,a.createElement("div",{className:o},t))}return a.createElement("div",{className:"form-group"},null===e?null:a.createElement("label",{className:"col-form-label"},e),t)},n.DefaultFieldClass=void 0,n.DefaultButtonClass="text-center py-2",n.DefaultRes=Object(fe.a)(de),n.ArrContainer=function(e,t){return a.createElement("div",null,a.createElement("div",{className:d()("small text-muted text-center bg-light py-1 px-3 mt-4 mb-1")},e),t)},n.RowContainer=function(e){var t=d()({"py-3":!0});return a.createElement("div",{className:t},e)},n.RowSeperator=a.createElement("div",{className:"border border-gray border-top"});var r=e.schema,i=e.uiSchema,s=e.formData,l=e.Container,h=e.FieldContainer,f=e.FieldClass,p=e.ButtonClass,v=e.res;n.Container=l||n.DefaultContainer,n.FieldContainer=h||n.DefaultFieldContainer,n.FieldClass=void 0!==f&&""!==f&&null!==f?f:n.DefaultFieldClass,n.res=v||n.DefaultRes,n.ButtonClass=p||n.DefaultButtonClass,n.schema=r,n.itemSchemas={};var m=!0,y=!1,b=void 0;try{for(var w,x=n.schema[Symbol.iterator]();!(m=(w=x.next()).done);m=!0){var O=w.value;n.itemSchemas[O.name]=O}}catch(C){y=!0,b=C}finally{try{m||null==x.return||x.return()}finally{if(y)throw b}}n.uiSchema=i,n.formData=s,n.disposer=Object(g.d)(n.calcSelectOrDelete),n.data={},n.initData(s);void 0!==n.props.children||n.uiSchema&&n.uiSchema.Templet;var j,E=n.props.children;void 0!==E?(n.content=a.createElement(a.Fragment,null,E),n.formContext=new se(Object(k.a)(Object(k.a)(n)),!0)):(void 0!==n.uiSchema&&(j=n.uiSchema.Templet),void 0!==j?(n.content="function"===typeof j?j(n.data):j,n.formContext=new se(Object(k.a)(Object(k.a)(n)),!0)):(n.formContext=new se(Object(k.a)(Object(k.a)(n)),!1),n.content=a.createElement(a.Fragment,null,n.schema.map(function(e,t){return a.createElement(a.Fragment,{key:t},he(n.formContext,e,E))}))));return n}return Object(l.a)(t,e),Object(s.a)(t,[{key:"initData",value:function(e){void 0===e&&(e={});var t=!0,n=!1,r=void 0;try{for(var i,a=this.schema[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var o=i.value;this.initDataItem(o,this.data,e)}}catch(s){n=!0,r=s}finally{try{t||null==a.return||a.return()}finally{if(n)throw r}}}},{key:"initDataItem",value:function(e,t,n){var r=e.name,i=e.type;if("button"!==i)if("arr"!==i)t[r]=n[r];else{var a=e,o=a.arr;if(void 0===o)return;var s=a.itemSchemas={},c=!0,u=!1,l=void 0;try{for(var h,d=o[Symbol.iterator]();!(c=(h=d.next()).done);c=!0){var f=h.value;s[f.name]=f}}catch(F){u=!0,l=F}finally{try{c||null==d.return||d.return()}finally{if(u)throw l}}var p=n[r];void 0===p?p=[]:!1===Array.isArray(p)&&(p=[p]);var v=[],m=!0,y=!1,b=void 0;try{for(var w,k=p[Symbol.iterator]();!(m=(w=k.next()).done);m=!0){var x=w.value,O={$source:x,$isSelected:x.$isSelected,$isDeleted:x.$isDeleted},j=!0,E=!1,C=void 0;try{for(var S,N=o[Symbol.iterator]();!(j=(S=N.next()).done);j=!0){var P=S.value;this.initDataItem(P,O,x)}}catch(F){E=!0,C=F}finally{try{j||null==N.return||N.return()}finally{if(E)throw C}}v.push(O)}}catch(F){y=!0,b=F}finally{try{m||null==k.return||k.return()}finally{if(y)throw b}}t[r]=Object(g.l)(v)}}},{key:"arrItemOperated",value:function(e){var t=e.name;if("arr"===e.type){var n=this.data[t],r=e.arr,i=!0,a=!1,o=void 0;try{for(var s,c=n[Symbol.iterator]();!(i=(s=c.next()).done);i=!0){var u=s.value,l=u.$source;if(void 0!==l){var h=l.$isSelected,d=l.$isDeleted;u.$isSelected=h,u.$isDeleted=d;var f=!0,p=!1,v=void 0;try{for(var m,y=r[Symbol.iterator]();!(f=(m=y.next()).done);f=!0){var b=m.value;this.arrItemOperated(b)}}catch(w){p=!0,v=w}finally{try{f||null==y.return||y.return()}finally{if(p)throw v}}}}}catch(w){a=!0,o=w}finally{try{i||null==c.return||c.return()}finally{if(a)throw o}}}}},{key:"componentDidMount",value:function(){var e=this.props.beforeShow;void 0!==e&&e(this.formContext)}},{key:"componentWillUnmount",value:function(){this.disposer()}},{key:"render",value:function(){return a.createElement(ce.Provider,{value:this.formContext},a.createElement(this.formContext.renderErrors,null),this.Container(this.content))}}]),t}(a.Component);pe([g.l],ve.prototype,"data",void 0),(function(e){function t(){return Object(o.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(l.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){var e=this.props,t=e.name,n=e.children,r=this.context;if(void 0===r)return a.createElement("span",{className:"text-danger"},"!only in Form!");var i=r.getItemSchema(t),o=he(r,i,n,this.props);return void 0===o?a.createElement("span",{className:"text-danger"},"!!",t," is not defined!!"):o}}]),t}(a.Component)).contextType=ce;var me=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},ye=function(){function e(){Object(o.a)(this,e)}return Object(s.a)(e,[{key:"content",get:function(){return!0!==this.selected?this._content:void 0!==this._content?this._content:this._content=this.contentBuilder()}}]),e}();me([g.l],ye.prototype,"selected",void 0);var be=function(e){function t(e){var n,r;Object(o.a)(this,t),(r=Object(c.a)(this,Object(u.a)(t).call(this,e))).tabs=[],r.tabClick=function(e){r.selectedTab.selected=!1,e.selected=!0,r.selectedTab=e};var i=r.props,a=i.size,s=i.tabs,l=i.tabBack,h=i.contentBack,d=i.sep,f=i.selected;switch(a){default:case"md":r.size="3.2rem";break;case"sm":r.size="4rem";break;case"lg":r.size="2.5rem"}return(n=r.tabs).push.apply(n,Object(O.a)(s.map(function(e){var t=new ye;return t.name=e.name,t.selected=!1,t.caption=e.caption,t.contentBuilder=e.content,t.notify=e.notify,t}))),r.tabBack=l||"bg-light",r.contentBack=h,r.sep=d||"border-top border-gray",void 0!==f&&(r.selectedTab=r.tabs.find(function(e){return e.name===f})),void 0===r.selectedTab&&(r.selectedTab=r.tabs[0]),r.selectedTab.selected=!0,r}return Object(l.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){var e=this;return a.createElement("div",{className:"tab"},a.createElement("div",{className:this.contentBack,style:{height:"calc(100% - "+this.size+")"}},this.tabs.map(function(e,t){var n={display:!0===e.selected?void 0:"none"};return a.createElement("div",{key:t,style:n},e.content)})),a.createElement("div",{className:d()(this.tabBack,this.sep),style:{height:this.size}},this.tabs.map(function(t,n){var r,i=t.selected,o=t.caption,s=t.notify;if(void 0!==s){var c=s.get();void 0!==c&&(c>0?r=a.createElement("u",null,c>99?"99+":c):c<0&&(r=a.createElement("u",{className:"dot"})))}return a.createElement("div",{key:n,className:"",onClick:function(){return e.tabClick(t)}},a.createElement("div",{className:"align-self-center"},r,o(i)))})))}}]),t}(a.Component);me([g.l],be.prototype,"selectedTab",void 0),me([g.l],be.prototype,"tabs",void 0),be=me([x.a],be);n(52);n.d(t,"c",function(){return r.a}),n.d(t,"g",function(){return r.c}),n.d(t,"d",function(){return i.a}),n.d(t,"a",function(){return y}),n.d(t,"f",function(){return b}),n.d(t,"e",function(){return w}),n.d(t,"b",function(){return ve}),n.d(t,"h",function(){return fe.a})},function(e,t,n){"use strict";n.d(t,"b",function(){return c}),n.d(t,"a",function(){return d});var r=n(0),i=n.n(r),a=n(3),o=n(5),s=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},c=!1,u={centerhost:{value:Object({NODE_ENV:"production",PUBLIC_URL:"/app",REACT_APP_CENTER_HOST:"101.200.46.56"}).REACT_APP_CENTER_DEBUG_HOST||"localhost:3000",local:!1},uqhost:{value:Object({NODE_ENV:"production",PUBLIC_URL:"/app",REACT_APP_CENTER_HOST:"101.200.46.56"}).REACT_APP_UQ_DEBUG_HOST||"localhost:3015",local:!1},unitxhost:{value:Object({NODE_ENV:"production",PUBLIC_URL:"/app",REACT_APP_CENTER_HOST:"101.200.46.56"}).REACT_APP_UQ_DEBUG_HOST||"localhost:3015",local:!1},"uq-build":{value:Object({NODE_ENV:"production",PUBLIC_URL:"/app",REACT_APP_CENTER_HOST:"101.200.46.56"}).REACT_APP_UQ_DEBUG_BUILDER_HOST||"localhost:3009",local:!1}};function l(e){return"http://".concat(e,"/")}function h(e){return"ws://".concat(e,"/tv/")}var d=new(function(){function e(){Object(a.a)(this,e)}return Object(o.a)(e,[{key:"start",value:function(){return s(this,void 0,void 0,i.a.mark(function e(){var t;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!0!==c){e.next=3;break}return e.next=3,this.tryLocal();case 3:t=this.getCenterHost(),this.url=l(t),this.ws=h(t);case 6:case"end":return e.stop()}},e,this)}))}},{key:"debugHostUrl",value:function(e){return"http://".concat(e,"/hello")}},{key:"tryLocal",value:function(){return s(this,void 0,void 0,i.a.mark(function e(){var t,n,r,a,o,s,c,l;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(n in t=[],u)r=u[n].value,a=this.debugHostUrl(r),o={method:"GET",mode:"no-cors",headers:{"Content-Type":"text/plain"}},t.push(v(a,o));return e.next=4,Promise.all(t);case 4:for(l in s=e.sent,c=0,u)u[l].local=s[c],++c;case 7:case"end":return e.stop()}},e,this)}))}},{key:"getCenterHost",value:function(){var e=u.centerhost,t=e.value,n=e.local;return!0===document.location.hash.includes("sheet_debug")?t:!0===c&&!0===n?t:"101.200.46.56"}},{key:"getUrlOrDebug",value:function(e,t){if(!0!==c)return e;if(!t)return e;for(var n in u){var r=u[n],i=r.value,a=r.local,o="://".concat(n,"/");if(t.indexOf(o)>0){if(!1===a)break;return t=t.replace(o,"://".concat(i,"/"))}}return t}}]),e}()),f=100;function p(e,t){return new Promise(function(n,r){fetch(e,t).then(function(e){e.text().then(n).catch(r)}).catch(r);var i=new Error("Connection timed out");setTimeout(r,f,i)})}function v(e,t){return s(this,void 0,void 0,i.a.mark(function n(){return i.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,p(e,t);case 3:return n.abrupt("return",!0);case 6:return n.prev=6,n.t0=n.catch(0),n.abrupt("return",!1);case 9:case"end":return n.stop()}},n,this,[[0,6]])}))}},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var r="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",i=8;function a(){for(var e=r.length,t="",n=0;n<i;n++)t+=r.charAt(Math.floor(Math.random()*e));return t}},,function(e,t,n){"use strict";n.d(t,"a",function(){return s}),n.d(t,"c",function(){return c}),n.d(t,"b",function(){return u});var r=n(3),i=n(5),a=n(53),o=n.n(a),s=function(){function e(t){Object(r.a)(this,e),this.user=t}return Object(i.a)(e,[{key:"id",get:function(){return this.user.id}},{key:"name",get:function(){return this.user.name}},{key:"nick",get:function(){return this.user.nick}},{key:"icon",get:function(){return this.user.icon||"http://101.200.46.56/imgs/Bear-icon.png"}},{key:"guest",get:function(){return this.user.guest}},{key:"token",get:function(){return this.user.token}}]),e}();function c(e){var t=o()(e);return{id:t.id,name:t.name,guest:t.guest,token:e}}function u(e){return{id:0,guest:o()(e).guest,token:e}}},function(e,t,n){"use strict";n.d(t,"b",function(){return a}),n.d(t,"a",function(){return o});var r=n(25),i=n.n(r),a={lang:void 0,district:void 0};function o(e){var t=a.lang,n=a.district,r={};if(void 0===e)return r;i.a.merge(r,e._);var o=e[t];if(void 0===o)return r;i.a.merge(r,o._);var s=o[n];if(void 0===s)return r;i.a.merge(r,s);var c=r.entity;if(void 0!==c)for(var u in c)c[u.toLowerCase()]=c[u];return r}!function(){var e,t,n=navigator.languages&&navigator.languages[0]||navigator.language;if(n){var r=n.split("-");e=r[0],r.length>1&&(t=r[1])}else e="zh",t="CN";!function(e,t){a.lang=e,a.district=t}(e,t)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return h});var r=n(3),i=n(5),a=n(0),o=n.n(a),s=n(29),c=n(20),u=n(37),l=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})};var h=function(){function e(t,n,i,a){var s=this;Object(r.a)(this,e),this.startWait=function(){void 0!==s.ui&&s.ui.startWait()},this.endWait=function(e,t){void 0!==s.ui&&s.ui.endWait(),void 0!==t&&t("\u8bbf\u95eewebapi\u8d85\u65f6 "+e)},this.showError=function(e){return l(s,void 0,void 0,o.a.mark(function t(){return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(void 0===this.ui){t.next=3;break}return t.next=3,this.ui.showError(e);case 3:case"end":return t.stop()}},t,this)}))},this.isCenter=t,this.hostUrl=n,this.apiToken=i,this.ui=a,this.timeout=!0===u.b?5e5:5e3}return Object(i.a)(e,[{key:"used",value:function(){this.post("",{})}},{key:"get",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;return l(this,void 0,void 0,o.a.mark(function n(){var r,i,a,s,c;return o.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(!t){n.next=15;break}if(!((r=Object.keys(t)).length>0)){n.next=15;break}i="?",a=0;case 5:if(!(a<r.length)){n.next=15;break}if(s=r[a],void 0!==t[s]){n.next=10;break}return n.abrupt("continue",12);case 10:e+=i+s+"="+t[s],i="&";case 12:a++,n.next=5;break;case 15:return(c=this.buildOptions()).method="GET",n.next=19,this.innerFetch(e,c);case 19:return n.abrupt("return",n.sent);case 20:case"end":return n.stop()}},n,this)}))}},{key:"post",value:function(e,t){return l(this,void 0,void 0,o.a.mark(function n(){var r;return o.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return(r=this.buildOptions()).method="POST",r.body=JSON.stringify(t),n.next=5,this.innerFetch(e,r);case 5:return n.abrupt("return",n.sent);case 6:case"end":return n.stop()}},n,this)}))}},{key:"put",value:function(e,t){return l(this,void 0,void 0,o.a.mark(function n(){var r;return o.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return(r=this.buildOptions()).method="PUT",r.body=JSON.stringify(t),n.next=5,this.innerFetch(e,r);case 5:return n.abrupt("return",n.sent);case 6:case"end":return n.stop()}},n,this)}))}},{key:"delete",value:function(e,t){return l(this,void 0,void 0,o.a.mark(function n(){var r;return o.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return(r=this.buildOptions()).method="DELETE",r.body=JSON.stringify(t),n.next=5,this.innerFetch(e,r);case 5:return n.abrupt("return",n.sent);case 6:case"end":return n.stop()}},n,this)}))}},{key:"fetch",value:function(e){function t(t,n,r,i){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e,t,n,r){return l(this,void 0,void 0,o.a.mark(function i(){var a,s,u,h,d,f,p,v=this;return o.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return u=function(e){return{channel:a,url:s,options:t,resolve:n,reject:r,error:e}},a=this,this.startWait(),s=e,i.prev=4,console.log("%s %s",t.method,s),h=setTimeout(function(){return a.endWait(e,r)},this.timeout),i.next=9,fetch(encodeURI(s),t);case 9:if(!1!==(d=i.sent).ok){i.next=15;break}throw clearTimeout(h),a.endWait(),console.log("call error %s",d.statusText),d.statusText;case 15:if(!((f=d.headers.get("content-type"))&&f.indexOf("json")>=0)){i.next=20;break}return i.abrupt("return",d.json().then(function(e){return l(v,void 0,void 0,o.a.mark(function t(){return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(clearTimeout(h),a.endWait(),!0!==e.ok){t.next=4;break}return t.abrupt("return",n(e.res));case 4:if(void 0!==e.error){t.next=9;break}return t.next=7,a.showError(u("not valid tonva json"));case 7:t.next=12;break;case 9:return t.next=11,a.showError(u(e.error));case 11:r(e.error);case 12:case"end":return t.stop()}},t,this)}))}).catch(function(e){return l(v,void 0,void 0,o.a.mark(function t(){return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,a.showError(u(e.message));case 2:case"end":return t.stop()}},t,this)}))}));case 20:return i.next=22,d.text();case 22:p=i.sent,clearTimeout(h),a.endWait(),n(p);case 26:i.next=36;break;case 28:if(i.prev=28,i.t0=i.catch(4),"string"!==typeof i.t0){i.next=34;break}if(!0!==i.t0.toLowerCase().startsWith("unauthorized")){i.next=34;break}return c.c.logout(),i.abrupt("return");case 34:return i.next=36,this.showError(u(i.t0.message));case 36:case 37:case"end":return i.stop()}},i,this,[[4,28]])}))})},{key:"innerFetch",value:function(e,t){return l(this,void 0,void 0,o.a.mark(function n(){var r,i=this;return o.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(r=this.hostUrl+e,!0!==this.isCenter||void 0!==this.apiToken||!Object(s.d)()){n.next=5;break}return n.next=4,Object(s.c)(r,t.method,t.body);case 4:return n.abrupt("return",n.sent);case 5:return n.next=7,new Promise(function(e,n){return l(i,void 0,void 0,o.a.mark(function i(){return o.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,this.fetch(r,t,e,n);case 2:case"end":return i.stop()}},i,this)}))});case 7:return n.abrupt("return",n.sent);case 8:case"end":return n.stop()}},n,this)}))}},{key:"callFetch",value:function(e,t,n){return l(this,void 0,void 0,o.a.mark(function r(){var i,a=this;return o.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return(i=this.buildOptions()).method=t,i.body=n,r.next=5,new Promise(function(t,n){return l(a,void 0,void 0,o.a.mark(function r(){return o.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,this.fetch(e,i,t,n);case 2:case"end":return r.stop()}},r,this)}))});case 5:return r.abrupt("return",r.sent);case 6:case"end":return r.stop()}},r,this)}))}},{key:"buildOptions",value:function(){var e=c.c.language,t=c.c.culture,n=new Headers;n.append("Content-Type","application/json;charset=UTF-8");var r=e;return t&&(r+="-"+t),n.append("Accept-Language",r),this.apiToken&&n.append("Authorization",this.apiToken),{headers:n}}}]),e}()},,function(e,t,n){"use strict";n.d(t,"a",function(){return x});var r=n(0),i=n.n(r),a=n(3),o=n(5),s=n(6),c=n(4),u=n(7),l=n(11),h=n(8),d=n(31),f=n(15),p=n.n(f),v=n(25),m=n.n(v),y=n(47),b=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},w=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},k=100,g=function(e){function t(){var e;return Object(a.a)(this,t),(e=Object(s.a)(this,Object(c.a)(t).apply(this,arguments))).bottomTime=0,e.topTime=0,e.onScroll=function(t){return w(Object(l.a)(Object(l.a)(e)),void 0,void 0,i.a.mark(function e(){var n,r,a,o,s,c,u;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=this.props,r=n.onScroll,a=n.onScrollTop,o=n.onScrollBottom,r&&this.props.onScroll(t),(s=t.target).scrollTop<30&&void 0!==a&&(c=(new Date).getTime())-this.topTime>k&&(this.topTime=c,a()),s.scrollTop+s.offsetHeight>s.scrollHeight-30&&void 0!==o&&(u=(new Date).getTime())-this.bottomTime>k&&(this.bottomTime=u,o());case 5:case"end":return e.stop()}},e,this)}))},e}return Object(u.a)(t,e),Object(o.a)(t,[{key:"eachChild",value:function(e,t){var n=this,r=e.props;if(void 0!==r){var i=r.children;void 0!==i&&h.Children.forEach(i,function(e,r){var i=e._$scroll;i&&i(t),console.log(e.toString()),n.eachChild(e,t)})}}},{key:"render",value:function(){return h.createElement("main",{className:this.props.className,onScroll:this.onScroll},this.props.children)}}]),t}(h.Component),x=function(e){function t(e){var n;Object(a.a)(this,t),n=Object(s.a)(this,Object(c.a)(t).call(this,e));var r,i=e.tabs;if(void 0===i||0===i.length)return Object(s.a)(n);n.tabs=i;var o=[],u=!0,l=!1,h=void 0;try{for(var d,f=i[Symbol.iterator]();!(u=(d=f.next()).done);u=!0){var p=d.value,v=m.a.clone(p);void 0===r&&!0===v.isSelected?r=v:v.isSelected=!1,v.isMounted=!1,o.push(v)}}catch(y){l=!0,h=y}finally{try{u||null==f.return||f.return()}finally{if(l)throw h}}return n.state={cur:r,tabs:o},n}return Object(u.a)(t,e),Object(o.a)(t,[{key:"componentDidMount",value:function(){return w(this,void 0,void 0,i.a.mark(function e(){var t;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==this.tabs){e.next=2;break}return e.abrupt("return");case 2:if(void 0!==(t=this.state.tabs[0])){e.next=5;break}return e.abrupt("return");case 5:return e.next=7,this.onTabClick(t);case 7:case"end":return e.stop()}},e,this)}))}},{key:"onTabClick",value:function(e){return w(this,void 0,void 0,i.a.mark(function t(){var n,r,a,o,s,c,u,l,h;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!0!==e.isSelected){t.next=2;break}return t.abrupt("return");case 2:for(r=this.state.tabs,a=!0,o=!1,s=void 0,t.prev=6,c=r[Symbol.iterator]();!(a=(u=c.next()).done);a=!0)(l=u.value)===e?(l.isSelected=!0,n=l):l.isSelected=!1;t.next=14;break;case 10:t.prev=10,t.t0=t.catch(6),o=!0,s=t.t0;case 14:t.prev=14,t.prev=15,a||null==c.return||c.return();case 17:if(t.prev=17,!o){t.next=20;break}throw s;case 20:return t.finish(17);case 21:return t.finish(14);case 22:if(!0===n.isMounted){t.next=27;break}if(void 0===(h=n.load)){t.next=27;break}return t.next=27,h();case 27:this.setState({cur:n,tabs:r});case 28:case"end":return t.stop()}},t,this,[[6,10,14,22],[15,,17,21]])}))}},{key:"onTouchStart",value:function(e){}},{key:"renderTabs",value:function(e){var t,n=this,r=this.props,i=r.header,a=r.back,o=r.right,s=r.keepHeader,c=this.state.cur,u=h.createElement("div",null,this.state.tabs.map(function(e,t){var r,i,a,o=e.icon,s=e.isSelected,c=e.title,u=e.redDot;if(void 0!==o&&(r=h.createElement("img",{src:o})),void 0!==u){var l=u.get();l<0?(a=p()("red-dot"),i=h.createElement("u",null)):l>0&&(a=p()("red-dot","num"),i=h.createElement("u",null,l))}return h.createElement("div",{key:t,className:p()("va-tab",{cur:s}),onClick:function(){return n.onTabClick(e)}},r,h.createElement("div",{className:a},c,i))}));return!1!==i&&(t=h.createElement(y.a,{back:a,center:!0===s?i:c&&(c.header||c.title),right:o})),h.createElement("article",{className:"page-container"},t,h.createElement("section",null,this.state.tabs.map(function(e,t){var n=e.isSelected,r=e.isMounted,i=e.content;if(!0===n||!0===r)return e.isMounted=!0,h.createElement(g,{key:t,className:p()({invisible:!1===n}),onScroll:e.onScroll,onScrollTop:e.onScrollTop,onScrollBottom:e.onScrollBottom},"function"===typeof i?i():i)})),u,e)}},{key:"renderSingle",value:function(e){var t,n=this.props,r=n.back,i=n.header,a=n.right,o=n.onScroll,s=n.onScrollTop,c=n.onScrollBottom,u=n.children;return!1!==i&&(t=h.createElement(y.a,{back:r,center:i,right:a,logout:this.props.logout})),h.createElement("article",{className:"page-container",onTouchStart:this.onTouchStart},t,h.createElement("section",null,h.createElement(g,{onScroll:o,onScrollTop:s,onScrollBottom:c},u)),e)}},{key:"render",value:function(){var e,t=this.props.footer;return void 0!==t&&(e=h.createElement("footer",null,t)),void 0!==this.tabs?this.renderTabs(e):this.renderSingle(e)}}]),t}(h.Component);x=b([d.a],x)},,function(e,t,n){"use strict";n.d(t,"b",function(){return c}),n.d(t,"a",function(){return u});var r=n(3),i=n(5),a=n(0),o=n.n(a),s=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})};function c(e,t,n,r,i){return s(this,void 0,void 0,o.a.mark(function a(){return o.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,e.fetch(t,n,r,i);case 2:case"end":return a.stop()}},a,this)}))}var u=function(){function e(t,n){Object(r.a)(this,e),this.path=t||"",this.showWaiting=n}return Object(i.a)(e,[{key:"call",value:function(e,t,n){return s(this,void 0,void 0,o.a.mark(function r(){var i;return o.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,this.getHttpChannel();case 2:return i=r.sent,r.next=5,i.callFetch(e,t,n);case 5:return r.abrupt("return",r.sent);case 6:case"end":return r.stop()}},r,this)}))}},{key:"get",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;return s(this,void 0,void 0,o.a.mark(function n(){var r;return o.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.getHttpChannel();case 2:return r=n.sent,n.next=5,r.get(this.path+e,t);case 5:return n.abrupt("return",n.sent);case 6:case"end":return n.stop()}},n,this)}))}},{key:"post",value:function(e,t){return s(this,void 0,void 0,o.a.mark(function n(){var r;return o.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.getHttpChannel();case 2:return r=n.sent,n.next=5,r.post(this.path+e,t);case 5:return n.abrupt("return",n.sent);case 6:case"end":return n.stop()}},n,this)}))}},{key:"put",value:function(e,t){return s(this,void 0,void 0,o.a.mark(function n(){var r;return o.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.getHttpChannel();case 2:return r=n.sent,n.next=5,r.put(this.path+e,t);case 5:return n.abrupt("return",n.sent);case 6:case"end":return n.stop()}},n,this)}))}},{key:"delete",value:function(e,t){return s(this,void 0,void 0,o.a.mark(function n(){var r;return o.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.getHttpChannel();case 2:return r=n.sent,n.next=5,r.delete(this.path+e,t);case 5:return n.abrupt("return",n.sent);case 6:case"end":return n.stop()}},n,this)}))}}]),e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return p});var r=n(0),i=n.n(r),a=n(3),o=n(5),s=n(6),c=n(4),u=n(7),l=n(11),h=n(8),d=n(20),f=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},p=function(e){function t(e){var n;return Object(a.a)(this,t),(n=Object(s.a)(this,Object(c.a)(t).call(this,e))).logoutClick=function(){if(!1!==confirm("Really want to logout?")){var e=n.props.logout;"function"===typeof e&&e(),d.c.logout()}},n.navChange=n.navChange.bind(Object(l.a)(Object(l.a)(n))),n.state={hasBack:!1},n}return Object(u.a)(t,e),Object(o.a)(t,[{key:"navChange",value:function(){this.setState({hasBack:d.c.level>1})}},{key:"componentWillMount",value:function(){this.navChange()}},{key:"componentWillUnmount",value:function(){}},{key:"back",value:function(){return f(this,void 0,void 0,i.a.mark(function e(){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.c.back();case 2:case"end":return e.stop()}},e,this)}))}},{key:"openWindow",value:function(){window.open(document.location.href)}},{key:"render",value:function(){var e,t,n,r,i=this.state.hasBack||self!=top,a=this.props,o=a.right,s=a.center,c=a.logout;if(void 0!==c&&self===top&&("boolean"===typeof c&&!0===c||"function"===typeof c)){var u=d.c.user,l=u.nick,f=u.name;n=h.createElement("div",{className:"d-flex align-items-center"},h.createElement("small",{className:"text-light"},l||f),h.createElement("a",{className:"dropdown-toggle btn btn-secondary btn-sm ml-2",role:"button",onClick:this.logoutClick},h.createElement("i",{className:"fa fa-sign-out"})))}if(i)switch(this.props.back){case"none":e=void 0;break;default:case"back":e=h.createElement("nav",{onClick:this.back},h.createElement("i",{className:"fa fa-arrow-left"}));break;case"close":e=h.createElement("nav",{onClick:this.back},h.createElement("i",{className:"fa fa-close"}))}return self!=top&&(console.log(document.location.href),t=h.createElement("header",{onClick:this.openWindow})),(o||n)&&(r=h.createElement("aside",null,o," ",n)),h.createElement("header",{style:d.b},t,e,h.createElement("div",null,s),r)}}]),t}(h.Component)},,,,,function(e,t,n){"use strict";n.d(t,"a",function(){return i});var r=n(8);function i(){return r.createElement("div",{style:{height:"100%"},className:"d-flex flex-fill align-items-center justify-content-center"},r.createElement("div",{className:"d-flex align-items-center justify-content-center slide text-info",style:{width:"5em",height:"2em"}},"\u52a0\u8f7d\u4e2d..."))}},,function(e,t,n){"use strict";n.d(t,"a",function(){return a});var r=n(30),i=n(33),a={set:function(e,t){Object(r.h)(e,t),i.a.setCenterToken(t)},clear:function(){Object(r.h)(0,void 0),i.a.setCenterToken(void 0)}}},function(e,t,n){"use strict";n.d(t,"b",function(){return o}),n.d(t,"a",function(){return s});var r=n(10),i=n(19),a=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})};class o extends r.a{_loadIds(e){return a(this,void 0,void 0,function*(){})}_loadId(e){return a(this,void 0,void 0,function*(){return yield i.a.userBase(e)})}}class s extends r.a{_loadIds(e){return a(this,void 0,void 0,function*(){})}_loadId(e){return a(this,void 0,void 0,function*(){return yield i.a.unitBase(e)})}}},,,,,function(e,t){},function(e,t,n){"use strict";n.d(t,"a",function(){return r}),n.d(t,"b",function(){return i});const r=[{id:-99,name:"$self",icon:"tasks",caption:"\u81ea\u5df1\u5f85\u529e",discription:void 0,content:{needTo:!1}},{id:-98,name:"$dispatch",icon:"share-square",caption:"\u7ed9\u540c\u4e8b\u53d1\u4efb\u52a1",discription:void 0,content:{needTo:!0}}],i={};for(let a of r)i[a.name]=a},,function(e,t,n){"use strict";n.d(t,"a",function(){return p});var r=n(0),i=n.n(r),a=n(3),o=n(5),s=n(6),c=n(4),u=n(7),l=n(11),h=n(8),d=n(24),f=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},p=function(e){function t(){var e;return Object(a.a)(this,t),(e=Object(s.a)(this,Object(c.a)(t).apply(this,arguments))).reApi=function(){return f(Object(l.a)(Object(l.a)(e)),void 0,void 0,i.a.mark(function e(){var t,n,r,a,o,s;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.props.clearError(),t=this.props,n=t.channel,r=t.url,a=t.options,o=t.resolve,s=t.reject,e.next=4,Object(d.m)(n,r,a,o,s);case 4:case"end":return e.stop()}},e,this)}))},e.close=function(){return f(Object(l.a)(Object(l.a)(e)),void 0,void 0,i.a.mark(function e(){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.props.clearError();case 1:case"end":return e.stop()}},e,this)}))},e}return Object(u.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){var e,t=this.props,n=t.error,r=t.url;if("object"===typeof n){var i=[];for(var a in n)i.push(h.createElement("li",{key:a},h.createElement("label",null,a),h.createElement("div",null,n[a])));e=h.createElement("ul",null,i)}else e=h.createElement("div",null,n);return h.createElement("li",null,h.createElement("article",{className:"page-container"},h.createElement("section",null,h.createElement("div",{className:"va-error"},h.createElement("div",null,"\u7f51\u7edc\u51fa\u73b0\u95ee\u9898"),h.createElement("div",null,"\u70b9\u51fb\u91cd\u65b0\u8bbf\u95ee"),h.createElement("div",null,"url: ",r),e,h.createElement("div",{className:"p-3"},h.createElement("button",{type:"button",onClick:this.reApi},"\u91cd\u65b0API"),h.createElement("button",{type:"button",onClick:this.close},"\u5173\u95ed"))))))}}]),t}(h.Component)},function(e,t,n){"use strict";n.d(t,"a",function(){return o});var r=n(3),i=n(5),a=function(){function e(t){Object(r.a)(this,e),this.name=t}return Object(i.a)(e,[{key:"get",value:function(){if(void 0!==this.value)return this.value;var e=localStorage.getItem(this.name);return this.value=null===e?void 0:JSON.parse(e)}},{key:"set",value:function(e){e?(this.value=e,localStorage.setItem(this.name,JSON.stringify(e))):this.clear()}},{key:"clear",value:function(){this.value=void 0,localStorage.removeItem(this.name)}}]),e}(),o=function(){function e(){Object(r.a)(this,e),this.user=new a("user"),this.guest=new a("guest"),this.unit=new a("unit"),this.homeTabCur=new a("homeTabCur")}return Object(i.a)(e,[{key:"logoutClear",value:function(){[this.user,this.homeTabCur].map(function(e){return e.clear()})}}]),e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return s});var r=n(16),i=n(19),a=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},o=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})};class s{constructor(e){this.invites=void 0,this.newInvitesCount=0,this.store=e}logout(){this.invites=void 0,this.newInvitesCount=0}msgUnitInvited(e){void 0===this.invites?this.newInvitesCount++:void 0===this.invites.find(t=>t.id===e.id)&&this.invites.push(e)}loadInvites(){return o(this,void 0,void 0,function*(){if(void 0===this.invites){let e;if(this.invites=[],void 0===e)return}})}refuseInvite(e){return o(this,void 0,void 0,function*(){yield i.a.removeMessage(e.id),this.removeInvite(e)})}removeInvite(e){let t=this.invites.findIndex(t=>t.id===e.id);this.invites.splice(t,1)}}a([r.k],s.prototype,"invites",void 0),a([r.k],s.prototype,"newInvitesCount",void 0)},,function(e,t,n){},function(e,t,n){e.exports=n.p+"static/media/logo.ee7cd8ed.svg"},function(e,t,n){e.exports=n(112)},,,,,,,,,,,,,,,function(e,t,n){},,function(e,t,n){},,,,,,function(e,t,n){},,function(e,t,n){},,function(e,t,n){},,function(e,t,n){},,,,,,,,function(e,t,n){},,,,function(e,t,n){},,function(e,t,n){"use strict";n.r(t);var r,i=n(1),a=n.n(i),o=n(43),s=n(10),c=n(16),u=n(9),l=n(17),h=(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),d=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},f=function(){function e(e){this.formView=e}return e.prototype.render=function(){return u.createElement("div",{className:"col-sm-10"},this.renderControl())},Object.defineProperty(e.prototype,"hasError",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"filled",{get:function(){return!1},enumerable:!0,configurable:!0}),e.prototype.clear=function(){},e.prototype.clearErrors=function(){},e.prototype.readValues=function(e){},e.prototype.setError=function(e,t){},e.prototype.setInitValues=function(e){},e.prototype.isOk=function(){return this.validate(),!this.hasError},e.prototype.validate=function(){},d([l.d],e.prototype,"hasError",null),d([l.d],e.prototype,"filled",null),e}(),p=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.field=n,i.face=r,i.init(),i.setProps(),i}return h(t,e),t.prototype.ref=function(e){this.element=e},t.prototype.init=function(){var e;this.rules=[];var t=this.field.rules;void 0!==t&&(!0===Array.isArray(t)?(e=this.rules).push.apply(e,t):this.rules.push(t))},t.prototype.setProps=function(){return this.props={ref:this.ref.bind(this),name:this.field.name}},Object.defineProperty(t.prototype,"hasError",{get:function(){return void 0!==this.error},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"filled",{get:function(){return void 0!==this.value&&this.value!==this.field.defaultValue},enumerable:!0,configurable:!0}),t.prototype.clearValue=function(){this.value=void 0},t.prototype.clear=function(){this.clearErrors(),this.clearValue()},t.prototype.clearErrors=function(){this.isOK=void 0,this.error=void 0},t.prototype.readValues=function(e){e[this.field.name]=this.value},t.prototype.setError=function(e,t){},t.prototype.setInitValues=function(e){},t.prototype.getValueFromElement=function(){return this.value},t.prototype.validate=function(){try{var e=this.getValueFromElement();if(this.rules.length>0){for(var t=void 0,n=0,r=this.rules;n<r.length;n++){var i=r[n];console.log("validate: %s",e);var a=i(e);if(console.log("validate: %s err: %s",e,a),!0===a)this.error=void 0,t=!0;else if(void 0!==a)return this.error=a,void(this.isOK=!1)}this.isOK=t}this.value=e}catch(o){this.error=o.message}},t.prototype.render=function(){var e;if(void 0!==this.face){var t=this.face.notes;void 0!==t&&(e=u.createElement("small",{className:"text-muted"},t))}return u.createElement("div",{className:"col-sm-10"},this.renderControl(),e)},d([l.k],t.prototype,"isOK",void 0),d([l.k],t.prototype,"error",void 0),d([l.k],t.prototype,"value",void 0),d([l.d],t.prototype,"hasError",null),d([l.d],t.prototype,"filled",null),t}(f),v=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),m=function(e){function t(t){var n=e.call(this,t)||this;return n.otherClick=n.otherClick.bind(n),n}return v(t,e),t.prototype.otherClick=function(){var e=this.formView.props.onOther;void 0!==e&&e(this.formView.readValues())},t.prototype.renderControl=function(){console.log("buttons.renderControl");var e=this.formView.nothing,t=this.formView.hasError,n=this.formView.props;console.log("buttons.renderControl nothing:%s hasError:%s",e,t);var r,i=n.submitButton,a=n.otherButton;n.onOther;return void 0!==a&&(r=u.createElement("button",{className:"btn btn-outline-info ml-auto",onClick:this.otherClick},a)),u.createElement("div",{className:"d-flex justify-content-start"},u.createElement("button",{className:"btn btn-primary",type:"submit",disabled:e||t},i||"\u63d0\u4ea4"),r)},t}(f),y=n(28),b=n(14),w=n.n(b),k=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),g=function(){return(g=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},x=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return k(t,e),t.prototype.init=function(){e.prototype.init.call(this),!0===this.field.required&&this.rules.push(function(e){return null!==e&&void 0!==e&&0!==e.trim().length||"\u5fc5\u987b\u586b\u5165\u8981\u6c42\u5185\u5bb9"})},t.prototype.getValueFromElement=function(){return this.parseValue(this.element.value)},t.prototype.setProps=function(){e.prototype.setProps.call(this),y.assign(this.props,{onBlur:this.onBlur.bind(this),onFocus:this.onFocus.bind(this),onChange:this.onChange.bind(this)});var t=this.face;return void 0!==t&&y.assign(this.props,{placeholder:t.placeholder}),this.props},t.prototype.parseValue=function(e){return e},t.prototype.onBlur=function(){this.validate()},t.prototype.onChange=function(){console.log("onChange"),this.validate()},t.prototype.onFocus=function(){this.clearErrors()},t.prototype.className=function(){return b({"form-control":!0,"has-success":!0===this.isOK,"is-invalid":void 0!==this.error,"is-valid":void 0===this.error&&!0===this.isOK})},t.prototype.renderInput=function(){return u.createElement("input",g({className:this.className()},this.props))},t.prototype.ref=function(t){e.prototype.ref.call(this,t),t&&(t.value=void 0===this.value?"":this.value)},t.prototype.renderError=function(){return void 0===this.error?null:u.createElement("div",{className:"invalid-feedback"},this.error)},t.prototype.clearValue=function(){e.prototype.clearValue.call(this),this.element.value=""},t.prototype.setError=function(e,t){this.field.name===e&&(this.error=t)},t.prototype.setInitValues=function(e){var t=e[this.field.name];void 0!==t&&(this.value=t)},t.prototype.renderControl=function(){return u.createElement(u.Fragment,null,this.renderInput(),this.renderError())},t}(p),O=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),j=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return O(t,e),t.prototype.setProps=function(){var t=e.prototype.setProps.call(this);return y.assign(t,{type:"text",maxLength:this.field.maxLength}),t},t.prototype.parseValue=function(e){if(void 0!==e&&0!==e.trim().length)return e},t}(x),E=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return O(t,e),t.prototype.setProps=function(){var t=e.prototype.setProps.call(this);return y.assign(t,{type:"password",maxLength:this.field.maxLength}),t},t}(j),C=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),S=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return C(t,e),t.prototype.init=function(){e.prototype.init.call(this),this.extraChars=[];var t=this.field,n=t.min,r=t.max;switch(void 0!==n?(this.rules.push(function(e){if(void 0!==e)return!(e<n)||"\u6700\u5c0f\u503c\u4e3a"+n}),n<0&&this.extraChars.push(45)):this.extraChars.push(45),void 0!==r&&this.rules.push(function(e){if(void 0!==e)return!(e>r)||"\u6700\u5927\u503c\u4e3a"+r}),this.field.type){case"dec":case"number":this.extraChars.push(46)}},t.prototype.parseValue=function(e){if(void 0!==e&&0!==e.trim().length){var t=Number.parseFloat(e);if(isNaN(t))throw new Error("\u65e0\u6548\u7684\u6570\u5b57");return t}},t.prototype.setProps=function(){e.prototype.setProps.call(this),y.assign(this.props,{type:"number",step:this.field.step,onKeyPress:this.onKeyPress.bind(this)})},t.prototype.onKeyPress=function(e){var t=e.charCode;if(!(8===t||0===t||13===t||t>=48&&t<=57))if(void 0!==this.extraChars&&this.extraChars.indexOf(t)>=0)switch(t){case 46:this.onKeyDot();break;case 45:this.onKeyNeg(),e.preventDefault()}else e.preventDefault()},t.prototype.onKeyDot=function(){var e=this.element.value;e.indexOf(".")>=0&&(this.element.value=e.replace(".",""))},t.prototype.onKeyNeg=function(){var e=this.element.value,t=e.indexOf("-");e=t>=0?e.replace("-",""):"-"+e,this.element.value=e},t}(x),N=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),P=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return N(t,e),t.prototype.init=function(){e.prototype.init.call(this);var t=this.field,n=t.trueValue,r=t.falseValue;void 0===n&&(this.trueValue=1),void 0===r&&(this.falseValue=0)},t.prototype.setProps=function(){e.prototype.setProps.call(this),y.assign(this.props,{onChange:this.onChange.bind(this)})},t.prototype.clearValue=function(){this.element.checked=this.field.defaultValue===this.trueValue,this.value=this.getValueFromElement()},t.prototype.setInitValues=function(e){var t=e[this.field.name];void 0===t&&(t=this.field.defaultValue)},t.prototype.getValueFromElement=function(){return this.element.checked?this.trueValue:this.falseValue},t.prototype.onChange=function(){this.value=this.getValueFromElement()},t.prototype.renderControl=function(){return u.createElement("div",{className:"form-control-static"},u.createElement("label",{className:"form-control"},u.createElement("label",{className:"custom-control custom-checkbox mb-0"},u.createElement("input",{type:"checkbox",name:this.field.name,ref:this.props.ref,onChange:this.props.onChange,className:"custom-control-input"}),u.createElement("span",{className:"custom-control-indicator"}),u.createElement("span",{className:"custom-control-description"},this.face.label))))},t}(p),F=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),_=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return F(t,e),t.prototype.renderControl=function(){var e=this;return u.createElement("div",{className:"form-control-static"},u.createElement("div",{className:"form-control"},this.face.list.map(function(t,n){var r;return"object"!==typeof t?r=t:(r=t.text,t.value),u.createElement("label",{key:n,className:"custom-control custom-radio w-25"},u.createElement("input",{type:"radio",name:e.field.name,className:"custom-control-input"}),u.createElement("span",{className:"custom-control-indicator"}),u.createElement("span",{className:"custom-control-description"},r))})))},t}(p),I=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),A=function(){return(A=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},R=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return I(t,e),t.prototype.setProps=function(){var t=e.prototype.setProps.call(this),n=this.field.maxLength,r=this.face.rows;return y.assign(t,{maxLength:n,rows:r}),t},t.prototype.renderInput=function(){var e=this;return u.createElement("textarea",A({ref:function(t){e.el=t,void 0!==t&&(t.value="")},className:this.className()},this.props))},t}(x),V=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),T=function(e){function t(t,n,r){var i=e.call(this,t,n,r)||this;return i.ref=i.ref.bind(i),i}return V(t,e),t.prototype.getValueFromElement=function(){var e=this.element,t=(e.selectedIndex,e.selectedOptions[0].value);switch(this.field.type){case"number":t=Number(t);break;case"date":t=new Date(t);break;case"bool":"string"===typeof t&&(t="true"===t.toLowerCase())}return t},t.prototype.renderControl=function(){var e=this.face.list,t=[];return void 0===this.face.default&&t.push(u.createElement("option",{key:-1,value:void 0},"\u8bf7\u9009\u62e9")),t.push.apply(t,e.map(function(e,t){var n,r;return"object"!==typeof e?n=r=e:(n=e.text,r=e.value),u.createElement("option",{key:t,value:r},n)})),u.createElement("div",{className:"form-control-static"},u.createElement("select",{name:this.field.name,className:"form-control",ref:this.ref},t))},t}(p),D=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),q=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return D(t,e),t.prototype.renderControl=function(){return u.createElement("div",{className:"form-control-plaintext"},u.createElement("div",{className:"alert alert-primary",role:"alert"},"don't know how to create control",u.createElement("br",null),"field: ",JSON.stringify(this.field)," must be object ",u.createElement("br",null),"face: ",JSON.stringify(this.face)," must be object ",u.createElement("br",null)))},t}(p),M=function(e){function t(t,n){var r=e.call(this,t)||this;return r.element=n,r}return D(t,e),t.prototype.renderControl=function(){return u.createElement("div",{className:"form-control-plaintext"},this.element)},t}(f),U=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),L=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},B=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},$=function(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(s){a=[6,s],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}},H=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onClick=function(){return B(t,void 0,void 0,function(){var e,t,n,r,i,a,o;return $(this,function(s){switch(s.label){case 0:return e=this.face,t=e.pick,n=e.fromPicked,[4,t(this.face,this.formView.props,this.formView.readValues())];case 1:return void 0===(r=s.sent())?(this.value=void 0,[2]):void 0===n?(this.value=r.id,[2]):(i=n(r),a=i.id,o=i.caption,this.value=a,this.caption=o,[2])}})})},t.onPicked=function(e){t.value=e.id},t}return U(t,e),t.prototype.setInitValues=function(e){var t=e[this.field.name];this.value=t},t.prototype.controlContent=function(){var e=this.face,t=e.itemFromId,n=e.fromPicked,r=e.initCaption;if(void 0===this.value)return r||"\u8bf7\u9009\u62e9Id";if(void 0!==this.caption)return this.caption;if(void 0!==t&&void 0!==n){var i=t(this.value);if(i){var a=n(i);if(void 0!==a)return a.caption}}return String(this.value)},t.prototype.renderControl=function(){var e=this.face,t=e.tuid,n=e.input;return void 0===n?u.createElement("div",{className:"form-control-plaintext px-2 border text-primary rounded cursor-pointer",onClick:this.onClick},this.controlContent()):u.createElement("div",{className:"form-control-static "},u.createElement(n.component,{id:this.value,ui:t}))},L([l.k],t.prototype,"caption",void 0),t}(p),W=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),z=function(){return(z=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},K=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},Q=function(e){function t(t,n,r){var i=e.call(this,t,n,r)||this;return i.onIdChanged=i.onIdChanged.bind(i),i}return W(t,e),t.prototype.onIdChanged=function(e){this.value=e.id},t.prototype.setInitValues=function(e){var t=e[this.field.name];this.value=t},t.prototype.buildContent=function(){var e=this;return u.createElement(this.face.input.component,z({},this.face,{id:this.value,onFormValues:function(){return e.formView.readValues()},onIdChanged:this.onIdChanged}))},t.prototype.renderControl=function(){return u.createElement("div",{className:"form-control-static "},this.buildContent())},K([l.k],t.prototype,"caption",void 0),t}(p),J=n(26),G=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Y=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},X=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},Z=function(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(s){a=[6,s],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}},ee=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onClick=function(){return X(t,void 0,void 0,function(){var e,t,n,r,i,a,o;return Z(this,function(s){switch(s.label){case 0:return e=this.face,t=e.pick,n=e.fromPicked,[4,t(this.face,this.formView.props,this.formView.readValues())];case 1:return void 0===(r=s.sent())?(this.value=void 0,[2]):(i=n(r),a=i.id,o=i.caption,this.value=a,this.caption=o,[2])}})})},t.view=Object(J.a)(function(){var e,n=t.face.content;return e=void 0===t.value||null===t.value?"\u8bf7\u9009\u62e9":u.createElement(n,{id:t.value}),u.createElement("div",{className:"form-control-plaintext px-2 border text-primary rounded cursor-pointer bg-light",onClick:t.onClick},e)}),t}return G(t,e),t.prototype.setInitValues=function(e){var t=e[this.field.name];this.value=t},t.prototype.renderControl=function(){return u.createElement(this.view,null)},Y([l.k],t.prototype,"caption",void 0),t}(p),te=function(e,t){t.label;return void 0!==t.group?function(e,t,n){return new q(e,n,void 0)}(e,0,t):void 0!==t.field?function(e,t,n){var r=n.field,i=n.face;switch(typeof r){case"string":r={name:r,type:"string"};break;case"object":break;default:return new q(e,r,i)}var a=r.type||"string";if(void 0===i){if(void 0===(i=re[a]))return new q(e,r,i)}else if(void 0===i.type){var o=re[a];i.type=void 0===o?"string":o.type}return new(ne[i.type||a]||q)(e,r,i)}(e,0,t):new M(e,t.help)},ne={string:j,password:E,number:S,checkbox:P,radiobox:_,select:T,"pick-id":H,"pick-tuid":Q,textarea:R,pick:ee},re={string:{type:"string"},number:{type:"number"},int:{type:"number"},dec:{type:"number"},bool:{type:"checkbox"}};var ie=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),ae=function(){function e(e,t){if(this.form=e,this.row=t,void 0===t.type){var n=t.createControl;void 0===n&&(n=e.createControl),void 0===n&&(n=te),this.control=n(e,t)}}return e.prototype.isOk=function(){return void 0===this.control||this.control.isOk()},e.prototype.contains=function(e){var t=this.row.field;if(void 0!==t)return e===t.name;var n=this.row.group;return void 0!==n&&void 0!==n.find(function(t){return t.field.name===e})},Object.defineProperty(e.prototype,"hasError",{get:function(){return this.control.hasError},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"filled",{get:function(){return this.control.filled},enumerable:!0,configurable:!0}),e.prototype.clear=function(){void 0!==this.control&&this.control.clear()},e.prototype.clearErrors=function(){void 0!==this.control&&this.control.clearErrors()},e.prototype.readValues=function(e){void 0!==this.control&&this.control.readValues(e)},e.prototype.setError=function(e,t){void 0!==this.control&&this.control.setError(e,t)},e.prototype.setInitValues=function(e){void 0!==this.control&&this.control.setInitValues(e)},e}(),oe=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ie(t,e),t.prototype.render=function(e){return u.createElement("div",{key:e,className:"form-group"},this.row)},Object.defineProperty(t.prototype,"hasError",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"filled",{get:function(){return!1},enumerable:!0,configurable:!0}),t}(ae),se=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ie(t,e),t.prototype.render=function(e){return u.createElement("div",{key:e,className:"form-group row"},u.createElement("label",{className:"col-sm-2 col-form-label"},this.row.label),this.control.render())},t}(ae);function ce(e,t){return new se(e,t)}function ue(e,t){return new oe(e,t)}var le="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",he=8;function de(){for(var e=le.length,t="",n=0;n<he;n++)t+=le.charAt(Math.floor(Math.random()*e));return t}var fe=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},pe=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},ve=function(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(s){a=[6,s],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}},me=function(){function e(e){this.rows=[],this.uid=de(),this.props=e,this.buildRows(e),this.createControl=e.createControl,this.onSubmit=this.onSubmit.bind(this)}return Object.defineProperty(e.prototype,"hasError",{get:function(){var e=this.rows.map(function(e,t){return t+": "+e.hasError+"\n"});return console.log(e),this.rows.some(function(e){return e.hasError})},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nothing",{get:function(){return this.rows.every(function(e){return!e.filled})},enumerable:!0,configurable:!0}),e.prototype.readValues=function(){for(var e={},t=0,n=this.rows;t<n.length;t++){n[t].readValues(e)}return e},e.prototype.clear=function(){for(var e=0,t=this.rows;e<t.length;e++){t[e].clear()}},e.prototype.clearErrors=function(){for(var e=0,t=this.rows;e<t.length;e++){t[e].clearErrors()}},e.prototype.setError=function(e,t){for(var n=0,r=this.rows;n<r.length;n++){r[n].setError(e,t)}},e.prototype.setInitValues=function(e){if(void 0!==e)for(var t=0,n=this.rows;t<n.length;t++){n[t].setInitValues(e)}},e.prototype.buildRows=function(e){var t=e.formRows,n=e.createRow;if(void 0!==t){for(var r=0,i=t;r<i.length;r++){var a=i[r];this.rows.push(this.buildRow(a,n))}!0!==this.props.readOnly&&(this.buttonsRow=this.buildRow({createControl:this.createButtons.bind(this)},void 0))}else this.rows.push(ue(this,u.createElement("div",{className:"text-warning"},"TonvaForm need formRows defined")))},e.prototype.buildRow=function(e,t){var n;return void 0!==e.type?n=ue:void 0===(n=e.createRow)&&void 0===(n=t)&&(n=ce),n(this,e)},e.prototype.createButtons=function(e,t){return new m(e)},e.prototype.isOk=function(){for(var e=!0,t=0,n=this.rows;t<n.length;t++){n[t].isOk()||(e=!1)}return e},e.prototype.render=function(){var e=this;return u.createElement("form",{onSubmit:this.onSubmit},this.rows.map(function(t,n){return t.render(e.uid+n)}),this.buttons())},e.prototype.buttons=function(){if(void 0!==this.buttonsRow)return this.buttonsRow.render(this.uid+this.rows.length)},e.prototype.onSubmit=function(e){return pe(this,void 0,void 0,function(){var t;return ve(this,function(n){switch(n.label){case 0:return e.preventDefault(),this.isOk()?(t=this.readValues(),[4,this.props.onSubmit(t)]):[2];case 1:return n.sent(),[2]}})})},fe([l.d],e.prototype,"hasError",null),fe([l.d],e.prototype,"nothing",null),e}(),ye=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),be=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o};var we=function(e){function t(t){var n=e.call(this,t)||this;return n.formView=new me(n.props),n}return ye(t,e),t.prototype.componentWillMount=function(){this.formView.setInitValues(this.props.initValues)},t.prototype.debug=function(){},t.prototype.render=function(){var e=this.props,t=e.className,n=e.children;e.initValues;return u.createElement("div",{className:t},void 0===n?this.formView.render():u.createElement("form",{onSubmit:this.formView.onSubmit},n))},t=be([J.a],t)}(u.Component),ke=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},ge=function(){function e(e){this.list=e}return Object.defineProperty(e.prototype,"isPaged",{get:function(){var e=this.list.props.items;return null!==e&&void 0!==e&&!1===Array.isArray(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"items",{get:function(){var e=this.list.props.items;return null===e?null:void 0!==e?!0===Array.isArray(e)?e:e.items:void 0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"loading",{get:function(){var e=this.list.props.items;if(null===e)return!1;if(void 0===e)return!0;var t=e;return void 0!==t.items&&t.loading},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"selectedItems",{get:function(){},enumerable:!0,configurable:!0}),e.prototype.updateProps=function(e){},e.prototype.renderContent=function(e,t){var n=this.list.props.item.render;return void 0===n?u.createElement("div",{className:"px-3 py-2"},JSON.stringify(e)):n(e,t)},ke([l.d],e.prototype,"loading",null),e}(),xe=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Oe=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return xe(t,e),t.prototype.render=function(e,t){var n=this.list.props.item,r=n.className,i=n.key,a=n.onClick;return u.createElement("li",{key:void 0===i?t:i(e),className:b("va-row-clickable",r),onClick:function(){return a(e)}},this.renderContent(e,t))},t}(ge),je=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Ee=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return je(t,e),t.prototype.render=function(e,t){var n=this.list.props.item,r=n.className,i=n.key;n.render;if("string"===typeof e){var a=b("va-list-gap","px-3","pt-1");return u.createElement("li",{key:de(),className:a},e)}return u.createElement("li",{key:void 0===i?t:i(e),className:b(r)},this.renderContent(e,t))},t}(ge),Ce=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Se=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},Ne=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Ce(t,e),t.prototype.buildItems=function(){console.log("buildItems in selectable.tsx");var e,t=this.list.props,n=t.items,r=t.selectedItems,i=t.compare;return void 0===n?this._items=void 0:null===n?this._items=null:(e=!0===Array.isArray(n)?n:n.items,this._selectedItems=r,this._items=void 0===r?e.map(function(e){return{selected:!1,item:e,labelId:de()}}):void 0===i?e.map(function(e){return{selected:void 0!==r.find(function(t){return t===e}),item:e,labelId:de()}}):e.map(function(e){return{selected:void 0!==r.find(function(t){return i(e,t)}),item:e,labelId:de()}}))},Object.defineProperty(t.prototype,"items",{get:function(){return this.buildItems(),this._items},enumerable:!0,configurable:!0}),t.prototype.updateProps=function(e){e.selectedItems!==this._selectedItems&&this.buildItems()},t.prototype.onSelect=function(e,t){e.selected=t;var n=this._items.some(function(e){return e.selected});this.list.props.item.onSelect(e.item,t,n)},Object.defineProperty(t.prototype,"selectedItems",{get:function(){return this._items.filter(function(e){return!0===e.selected}).map(function(e){return e.item})},enumerable:!0,configurable:!0}),t.prototype.render=function(e,t){var n=this,r=this.list.props.item,i=r.className,a=r.key,o=(r.render,r.onSelect,e.labelId),s=e.selected;return u.createElement("li",{key:void 0===a?t:a(e),className:b(i)},u.createElement("div",{className:"d-flex align-items-center px-3"},u.createElement("input",{ref:function(e){e&&(n.input=e,e.checked=s)},className:"",type:"checkbox",value:"",id:o,defaultChecked:s,onChange:function(t){n.onSelect(e,t.target.checked)}}),u.createElement("label",{className:"",style:{flex:1,marginBottom:0},htmlFor:o},this.renderContent(e.item,t))))},Se([l.d],t.prototype,"items",null),t}(ge),Pe=(n(92),function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}()),Fe=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},_e=function(e){function t(t){var n=e.call(this,t)||this;n._$scroll=function(e){console.log("############### items scroll to "+e)};var r=n.props.item,i=r.onClick,a=r.onSelect;return n.listBase=void 0!==a?new Ne(n):void 0!==i?new Oe(n):new Ee(n),n}return Pe(t,e),t.prototype.componentWillUpdate=function(e,t,n){this.listBase.updateProps(e)},Object.defineProperty(t.prototype,"selectedItems",{get:function(){return this.listBase.selectedItems},enumerable:!0,configurable:!0}),t.prototype.render=function(){var e=this,t=this.props,n=t.className,r=t.header,i=t.footer,a=t.before,o=t.loading,s=t.none;t.item,t.selectedItems;void 0===a&&(a="before"),void 0===o&&(o="loading"),void 0===s&&(s="none");var c,l=this.listBase,h=(l.isPaged,l.items);l.loading;function d(e,t){if(e)switch(typeof e){default:case"string":return u.createElement("li",{className:"va-list-"+t},e);case"function":return u.createElement("li",{className:"va-list-"+t},e());case"object":return u.createElement("li",null,e)}}return c=null===h?d(a,"before"):void 0===h?d(o,"loading"):0===h.length?d(s,"none"):h.map(function(t,n){return e.listBase.render(t,n)}),u.createElement("ul",{className:w()("va-list",n)},d(r,"header"),c,d(i,"footer"))},t=Fe([J.a],t)}(u.Component),Ie=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Ae=function(e){function t(t){var n=e.call(this,t)||this;return n.handleDocumentClick=function(e){!1!==n.state.dropdownOpen&&(n.button&&n.button.contains(e.target)||n.menu&&n.toggle())},n.toggle=function(){n.setState({dropdownOpen:!n.state.dropdownOpen})},n.state={dropdownOpen:!1},n}return Ie(t,e),t.prototype.componentWillMount=function(){document.addEventListener("click",this.handleDocumentClick),document.addEventListener("touchstart",this.handleDocumentClick)},t.prototype.componentWillUnmount=function(){document.removeEventListener("click",this.handleDocumentClick),document.removeEventListener("touchstart",this.handleDocumentClick)},t.prototype.render=function(){var e=this,t=this.props,n=t.icon,r=t.actions,i=t.isRight;void 0===i&&(i=!0);var a=r.some(function(e){return void 0!==e.icon}),o=this.state.dropdownOpen;return u.createElement("div",{className:"dropdown"},u.createElement("button",{ref:function(t){return e.button=t},className:"cursor-pointer dropdown-toggle btn btn-sm","data-toggle":"dropdown","aria-expanded":o,onClick:this.toggle},u.createElement("i",{className:w()("fa","fa-"+(n||"ellipsis-v"))})),u.createElement("div",{ref:function(t){return e.menu=t},className:w()({"dropdown-menu":!0,"dropdown-menu-right":i,show:o})},r.map(function(e,t){var n,r=e.icon,i=e.caption,o=e.action;return void 0===r&&void 0===i?u.createElement("div",{className:"dropdown-divider"}):(!0===a&&(void 0!==r&&(r="fa-"+r),n=u.createElement(u.Fragment,null,u.createElement("i",{className:w()("fa",r,"fa-fw"),"aria-hidden":!0}),"\xa0 ")),void 0===o?u.createElement("h6",{className:"dropdown-header"},n," ",i):u.createElement("a",{className:"dropdown-item",key:t,href:"#",onClick:function(e){e.preventDefault(),o()}},n," ",i))})))},t}(u.Component),Re=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Ve=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Re(t,e),t.prototype.render=function(){var e=this.props.date;if(!e)return null;var t="string"===typeof e?new Date(Date.parse(e)):e,n=new Date,r=n.getTime()-t.getTime(),i=n.getDate(),a=t.getDate(),o=t.getHours(),s=t.getMinutes(),c=t.getMonth()+1,u=o+(s<10?":0":":")+s;return r<-864e5?t.getFullYear()+"\u5e74"+c+"\u6708"+a+"\u65e5 "+u:r<864e5?a!==i?(r<0?"\u660e\u5929 ":"\u6628\u5929 ")+u:u:r<31536e6?c+"\u6708"+a+"\u65e5 ":t.getFullYear()+"\u5e74"+c+"\u6708"+a+"\u65e5"},t}(u.Component),Te=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),De=function(){function e(){}return e.prototype.setValues=function(e){},e}(),qe=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Te(t,e),t.prototype.render=function(e){return u.createElement("div",{key:"_b_"+e,className:""},u.createElement("div",{className:"col-sm-12"},u.createElement("div",{style:{borderTop:"1px solid #f0f0f0"}})))},t}(De),Me=function(e){function t(t){var n=e.call(this)||this;return n.param=t,n}return Te(t,e),t.prototype.render=function(e){var t;switch(this.param){default:t="py-2";break;case"=":t="py-1";break;case"-":t="pb-1"}var n=b(t);return u.createElement("div",{key:"_g_"+e,className:n,style:{backgroundColor:"#f0f0f0"}})},t}(De),Ue=function(e){function t(t,n){var r=e.call(this)||this;return r.gridProps=t,r.prop=n,r}return Te(t,e),t.prototype.render=function(e){var t=this.prop,n=t.onClick,r=t.bk,i=b({"cursor-pointer":void 0!==n,"bg-white":void 0===r,row:!0});return u.createElement("div",{key:e,className:i,onClick:n},this.renderLabel(),this.renderProp())},t.prototype.renderLabel=function(){var e=this.prop.label;return void 0===e?null:u.createElement("label",{className:"col-sm-2 col-form-label"},e)},t.prototype.renderProp=function(){var e,t,n=this.prop,r=n.label,i=n.full;switch(this.gridProps.alignValue){case"left":e="justify-content-start";break;case"center":e="justify-content-center";break;case"right":e="justify-content-end"}switch(this.prop.vAlign){case"top":t="align-items-start";break;default:case"center":t="align-items-center";break;case"bottom":t="align-items-end";break;case"stretch":t="align-items-stretch"}var a=b(e,t,!0!==i?void 0===r?"col-sm-12":"col-sm-10":"w-100","d-flex");return u.createElement("div",{className:a},this.renderPropBody())},t.prototype.renderPropBody=function(){return u.createElement("div",{className:"form-control-plaintext"},this.renderPropContent())},t.prototype.renderPropContent=function(){return this.content},t}(De),Le=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Te(t,e),t.prototype.setValues=function(e){this.content=void 0===e?void 0:e[this.prop.name]},t}(Ue),Be=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Te(t,e),t.prototype.setValues=function(e){this.content=void 0===e?void 0:e[this.prop.name]},t}(Ue),$e=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Te(t,e),t.prototype.setValues=function(e){if(void 0===e)this.content=void 0;else{var t=this.prop.list;this.content="string"===typeof t?e[t]:void 0}},t.prototype.renderPropBody=function(){var e=this.prop,t=e.list,n=e.row,r="string"===typeof t?this.content:t;return void 0===r?u.createElement("div",null):u.createElement("div",{className:"w-100"},r.map(function(e,t){return u.createElement(u.Fragment,{key:t},0===t?null:u.createElement("div",{style:{width:"100%",borderBottom:"1px solid #f0f0f0"}}),u.createElement(n,e))}))},t}(Ue),He=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Te(t,e),t.prototype.renderPropBody=function(){return this.prop.component},t}(Ue),We=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}Te(t,e),t.prototype.render=function(e){return u.createElement("div",{className:"bg-white"},u.createElement("label",{className:"col-sm-2 col-form-label"},"AAABBBCCC"),u.createElement("div",{className:"col-sm-10"},u.createElement("div",{className:"form-control-plaintext"},"dsfasfa sdf asdf a")))}}(De),function(){function e(e,t){this.gridProps=e,this.props=t,this.buildRows()}return e.prototype.buildRows=function(){this.rows=[];for(var e=!0,t=0,n=this.props;t<n.length;t++){var r=n[t];if("string"===typeof r)this.rows.push(new Me(r)),e=!0;else{e||this.rows.push(new qe);var i=void 0;switch(r.type){default:continue;case"string":i=new Le(this.gridProps,r);break;case"number":i=new Be(this.gridProps,r);break;case"list":i=new $e(this.gridProps,r);break;case"component":i=new He(this.gridProps,r)}this.rows.push(i),e=!1}}},e.prototype.setValues=function(e){for(var t=0,n=this.rows;t<n.length;t++){n[t].setValues(e)}},e.prototype.render=function(){return this.rows.map(function(e,t){return e.render(String(t))})},e}()),ze=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Ke=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},Qe=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ze(t,e),t.prototype.render=function(){var e=this.props,t=e.className,n=e.rows,r=e.values,i=new We(this.props,n);i.setValues(r);var a=b("container-fluid",t);return u.createElement("div",{className:a},i.render())},t=Ke([J.a],t)}(u.Component),Je=(n(94),function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}()),Ge=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},Ye=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Je(t,e),t.prototype.render=function(){var e,t=this.props,n=t.className,r=t.badge,i=t.size,a=t.color,o=t.badgeAlign,s=t.badgeVertical,c=t.children,l=b(n,"va-badge",i&&"va-badge-"+i,"va-badge-"+(a||"secondary"),o&&"va-badg-"+o,s&&"va-badg-"+s);return r&&(e=u.createElement("b",null,r)),u.createElement("div",{className:l},c,e)},t=Ge([J.a],t)}(u.Component),Xe=(n(96),function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}()),Ze=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},et=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Xe(t,e),t.prototype.render=function(){var e,t,n,r=this.props,i=r.className,a=r.left,o=r.children,s=r.right,c=r.onClick;return void 0!==a&&(e=u.createElement("header",null,a)),void 0!==s&&(t=u.createElement("footer",null,s)),void 0!==c&&(n="cursor-pointer"),u.createElement("div",{className:b("va-lmr",i,n),onClick:c},e,u.createElement("div",null,o),t)},t=Ze([J.a],t)}(u.Component),tt=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),nt=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return tt(t,e),t.prototype.render=function(){var e=this.props,t=e.name,n=e.className,r=e.size,i=e.spin,a=e.fixWidth,o=e.border,s=e.pull,c=e.pulse,l=e.rotate,h=e.flip,d=e.inverse,f=b(n,"fa",t&&"fa-"+t,r&&"fa-"+r,a&&"fa-fw",o&&"fa-border",s&&"fa-pull-"+s,i&&"fa-spin",c&&"fa-pulse",l&&"fa-rotate-"+l,h&&"fa-flip-"+h,d&&"fa-inverse");return u.createElement("i",{className:f})},t}(u.Component),rt=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}tt(t,e),t.prototype.render=function(){var e=this.props,t=e.className,n=e.size,r=e.children,i=b("fa-stack",t,n&&"fa-"+n);return u.createElement("span",{className:i},r)}}(u.Component),function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}()),it=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return rt(t,e),t.prototype.render=function(){var e=this.props,t=e.icon,n=e.iconClass,r=e.text,i=e.textClass;return u.createElement("div",{className:"py-2"},u.createElement(nt,{className:n,name:t,fixWidth:!0}),u.createElement("span",{className:i},r))},t}(u.Component),at=function(e){return u.createElement("small",{className:b("text-muted",e.className),style:e.style},e.children)},ot=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),st={width:"4rem",height:"4rem"},ct=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ot(t,e),t.prototype.render=function(){var e,t=this.props,n=t.icon,r=t.main,i=t.discription,a=t.px,o=t.py;e="string"===typeof i?u.createElement("div",null,i):i;var s=n;"string"===typeof n&&(s=u.createElement("img",{className:"d-flex mr-3",src:n,alt:"img",style:st}));var c=b("media",void 0===a?"px-0":"px-"+a,void 0===o?"py-2":"py-"+o);return u.createElement("div",{className:c},s,u.createElement("div",{className:"media-body"},u.createElement("h5",{className:"mt-0"},r),e))},t}(u.Component),ut=(n(98),function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}()),lt=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},ht=function(e){function t(t){var n=e.call(this,t)||this;return n.state={pressed:!1},n}return ut(t,e),t.prototype.render=function(){var e,t,n,r,i,a,o=this.props,s=(o.date,o.main),c=o.vice,l=o.middle,h=o.midSize,d=o.icon,f=o.unread,p=o.right,v=o.onClick;if(void 0!==f){var m=void 0;(m="number"===typeof f?f:f.get())>0?n=u.createElement("b",null,m):m<0&&(n=u.createElement("b",{className:"dot"}))}switch(typeof d){case"object":e=u.createElement("header",null,d,n),t=!1;break;case"string":e=u.createElement("header",{className:"icon"},u.createElement("img",{src:d}),n),t=!0}if(void 0!==l)switch(typeof l){case"string":r=u.createElement("div",{style:{flex:h}},l);break;default:r=l}void 0!==p&&(i="string"===typeof p?u.createElement("footer",null,u.createElement("small",{className:"text-muted"},p)):u.createElement("footer",null,p)),void 0!==c&&(a=u.createElement("span",null,c));var y=b("va-row",{icon:t,pressed:this.state.pressed},{"va-action":void 0!==v});return u.createElement("li",{className:y,onClick:v},e,u.createElement("div",null,u.createElement("div",null,s),a),r,i)},t=lt([J.a],t)}(u.Component),dt=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),ft=function(){return(ft=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},pt=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},vt=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return dt(t,e),t.prototype.render=function(){var e,t,n=this,r=this.props,i=r.header,a=r.items,o=r.beforeLoad,s=r.none,c=r.renderRow,l=r.className,h=r.footer,d=r.itemClick,f=r.converter,p=b(l,"va-list");return e=void 0===a?null===o?null:u.createElement("li",{className:"empty"},o||"..."):0===a.length?u.createElement("li",{className:"empty"},s||"[none]"):void 0!==c?a.map(function(e,t){return c(e,t,n.props.ex)}):a.map(function(e,t){var n,r=e.onClick;if(void 0===r&&void 0!==d&&(r=function(){return d(e)}),void 0!==f){if(void 0===(n=f(e)))return null}else n=ft({},e);return void 0===n.key&&(n.key=n.main),u.createElement(ht,ft({onClick:r},n))}),void 0!==i&&(t="string"===typeof i?u.createElement("div",{className:"va-list-header"},i):i),u.createElement("div",{className:p},t,u.createElement("ul",null,e),h)},t=pt([J.a],t)}(u.Component),mt=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),yt=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},bt=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},wt=function(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(s){a=[6,s],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}},kt=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.key=null,t.onChange=function(e){t.key=e.target.value,void 0!==t.key&&(t.key=t.key.trim()),t.disabled=!t.key},t.onSubmit=function(e){return bt(t,void 0,void 0,function(){return wt(this,function(t){switch(t.label){case 0:return e.preventDefault(),null===this.key&&(this.key=this.props.initKey||""),this.key?(this.input&&(this.input.disabled=!0),[4,this.props.onSearch(this.key)]):[2];case 1:return t.sent(),this.input&&(this.input.disabled=!1),[2]}})})},t}return mt(t,e),t.prototype.render=function(){var e,t,n=this.props,r=n.className,i=n.inputClassName,a=n.label,o=n.placeholder,s=n.buttonText,c=n.maxLength;switch(n.size){default:case"sm":e="input-group-sm";break;case"md":e="input-group-md";break;case"lg":e="input-group-lg"}return void 0!==a&&(t=u.createElement("label",{className:"input-group-addon"},a)),u.createElement("form",{className:r,onSubmit:this.onSubmit},u.createElement("div",{className:w()("input-group",e)},t,u.createElement("input",{onChange:this.onChange,type:"text",name:"key",className:w()("form-control",i||"border-primary"),placeholder:o,defaultValue:this.props.initKey,maxLength:c}),u.createElement("div",{className:"input-group-append"},u.createElement("button",{className:"btn btn-primary",type:"submit",disabled:this.disabled},u.createElement("i",{className:"fa fa-search"}),u.createElement("i",{className:"fa"}),s))))},yt([l.k],t.prototype,"disabled",void 0),t}(u.Component),gt=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),xt=function(){return(xt=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},Ot=(function(e){function t(t){var n=e.call(this,t)||this;return n.values={},n.stepViews=[],n.state={topView:void 0,stepViews:[]},n.onPrev=n.onPrev.bind(n),n.onNext=n.onNext.bind(n),n}gt(t,e),t.prototype.setStep=function(e){var t=this.props.steps[e];if(void 0!==t){var n,r;void 0!==this.topView&&this.stepViews.push(this.topView),this.stepViews.length>0&&(n=u.createElement(Ot,{prefix:"undo",text:"\u4e0a\u4e00\u6b65"}),r=this.onPrev);var i=this.props,a=(i.header,i.footer,void 0===t.next?{prefix:"cloud-upload",text:this.props.submitButton||"\u63d0\u4ea4"}:{suffix:"arrow-right",text:"\u4e0b\u4e00\u6b65"}),o={formRows:t.formRows,submitButton:u.createElement(Ot,xt({},a)),onSubmit:this.onNext,otherButton:n,onOther:r};this.stepViews.length;this.topView={stepName:e,step:t,props:o},this.setState({topView:this.topView,stepViews:this.stepViews})}},t.prototype.componentWillMount=function(){this.setStep(this.props.first)},t.prototype.onPrev=function(e){y.assign(this.values,e),this.topView=this.stepViews.pop(),this.setState({topView:this.topView,stepViews:this.stepViews})},t.prototype.onNext=function(e){y.assign(this.values,e);var t,n=this.topView.step.next;if(void 0===n)return this.props.onSubmit(this.values);t="string"===typeof n?n:n(this.values),this.setStep(t)},t.prototype.render=function(){var e=this.props,t=e.className,n=e.header,r=e.footer,i=this.state,a=i.topView,o=i.stepViews,s=a.stepName,c=a.step,l=o.length+1;return u.createElement("div",{className:t},u.createElement("div",null,n&&n(c,l),u.createElement(we,xt({key:s,initValues:this.values},a.props)),r&&r(c,l)))}}(u.Component),function(e){var t,n,r=e.prefix,i=(e.text,e.suffix);return void 0!==r&&(t=u.createElement("i",{className:b("fa","fa-"+r)})),void 0!==i&&(n=u.createElement("i",{className:b("fa","fa-"+i)})),u.createElement(u.Fragment,null,t," ",e.text," ",n)}),jt=n(12),Et=n(27);const Ct="192.168.0.199";var St={serverUrl:Ct+":3000/",systemAdmin:{name:"\u540c\u82b1",role:"\u7cfb\u7edf\u603b\u7ba1",urlDebug:Ct+":3001"},phonePatter:"/^(0[0-9]{2,3}\\-)?([2-9]([0-9]|\\-){6,8})+(\\-[0-9]{1,4})?$|^(13[0-9]|15[0|3|6|7|8|9]|18[8|9])\\-*(\\d|\\-){8}$/",form:{label:{sm:3,md:2},input:{sm:9,md:9},submit:{xs:void 0,sm:{offset:3,size:3},md:{offset:2,size:3},lg:void 0}},appIcon:"http://101.200.46.56/imgs/Bear-icon.png",appItemIcon:"http://101.200.46.56/imgs/Bear-icon.png"},Nt=n(0),Pt=n.n(Nt),Ft=n(2),_t=n.n(Ft),It=n(3),At=n(5),Rt=n(6),Vt=n(4),Tt=n(7),Dt=n(11),qt=n(21),Mt=n(18),Ut=n(34),Lt=n.n(Ut),Bt=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},$t=function(){function e(t,n,r){Object(It.a)(this,e),this.fieldMaps={},this.entities=t,this.name=n,this.typeId=r,this.sys=this.name.indexOf("$")>=0}return Object(At.a)(e,[{key:"getApiFrom",value:function(){return Bt(this,void 0,void 0,Pt.a.mark(function e(){return Pt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.entities.uqApi);case 1:case"end":return e.stop()}},e,this)}))}},{key:"fieldMap",value:function(e){void 0===e&&(e="$");var t=this.fieldMaps[e];if(void 0===t){var n;if("$"===e)n=this.fields;else if(void 0!==this.arrFields){var r=this.arrFields.find(function(t){return t.name===e});void 0!==r&&(n=r.fields)}else if(void 0!==this.returns){var i=this.returns.find(function(t){return t.name===e});void 0!==i&&(n=i.fields)}if(void 0===n)return{};t={};var a=!0,o=!1,s=void 0;try{for(var c,u=n[Symbol.iterator]();!(a=(c=u.next()).done);a=!0){var l=c.value;t[l.name]=l}}catch(h){o=!0,s=h}finally{try{a||null==u.return||u.return()}finally{if(o)throw s}}this.fieldMaps[e]=t}return t}},{key:"loadSchema",value:function(){return Bt(this,void 0,void 0,Pt.a.mark(function e(){var t;return Pt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===this.schema){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.entities.uqApi.schema(this.name);case 4:t=e.sent,this.setSchema(t);case 6:case"end":return e.stop()}},e,this)}))}},{key:"setSchema",value:function(e){if(void 0!==e&&void 0===this.schema){this.schema=e;var t=e.name,n=e.fields,r=e.arrs,i=e.returns;t!==this.name&&(this.jName=t),this.entities.buildFieldTuid(this.fields=n),this.entities.buildArrFieldsTuid(this.arrFields=r,n),this.entities.buildArrFieldsTuid(this.returns=i,n)}}},{key:"schemaStringify",value:function(){return JSON.stringify(this.schema,function(e,t){if("_tuid"!==e)return t},4)}},{key:"tuidFromField",value:function(e){var t=e._tuid,n=e.tuid;if(void 0!==n)return void 0!==t?t:e._tuid=this.entities.getTuid(n,void 0)}},{key:"tuidFromName",value:function(e,t){if(void 0!==this.schema){var n=this.schema,r=n.fields,i=n.arrs,a=this.entities,o=e.toLowerCase();if(void 0===t)return u(o,r);if(void 0!==i){var s=t.toLowerCase(),c=i.find(function(e){return e.name===s});if(void 0!==c)return u(o,c.fields)}}function u(e,t){if(void 0!==t){var n=t.find(function(t){return t.name===e});if(void 0!==n)return a.getTuid(n.tuid,void 0)}}}},{key:"buildParams",value:function(e){var t={},n=this.fields;void 0!==n&&this.buildFieldsParams(t,n,e);var r=this.arrFields;if(void 0!==r){var i=!0,a=!1,o=void 0;try{for(var s,c=r[Symbol.iterator]();!(i=(s=c.next()).done);i=!0){var u=s.value,l=u.name,h=u.fields;if(void 0!==e[l]){var d=[];t[l]=d;var f=!0,p=!1,v=void 0;try{for(var m,y=e[Symbol.iterator]();!(f=(m=y.next()).done);f=!0){var b=m.value,w={};this.buildFieldsParams(w,h,b),d.push(w)}}catch(k){p=!0,v=k}finally{try{f||null==y.return||y.return()}finally{if(p)throw v}}}}}catch(k){a=!0,o=k}finally{try{i||null==c.return||c.return()}finally{if(a)throw o}}}return t}},{key:"buildFieldsParams",value:function(e,t,n){var r=!0,i=!1,a=void 0;try{for(var o,s=t[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){var c=o.value,u=c.name,l=n[u],h=void 0;switch(typeof l){default:h=l;break;case"object":var d=c._tuid;h=void 0===d?l.id:d.getIdFromObj(l)}e[u]=h}}catch(f){i=!0,a=f}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}}},{key:"pack",value:function(e){var t=[],n=this.fields;void 0!==n&&this.packRow(t,n,e);var r=this.arrFields;if(void 0!==r){var i=!0,a=!1,o=void 0;try{for(var s,c=r[Symbol.iterator]();!(i=(s=c.next()).done);i=!0){var u=s.value;this.packArr(t,u.fields,e[u.name])}}catch(l){a=!0,o=l}finally{try{i||null==c.return||c.return()}finally{if(a)throw o}}}return t.join("")}},{key:"escape",value:function(e,t){var n=e[t.name];switch(typeof n){default:return n;case"object":var r=t._tuid;return void 0===r?n.id:r.getIdFromObj(n);case"string":for(var i=n.length,a="",o=0,s=0;s<i;s++){switch(n.charCodeAt(s)){case 9:a+=n.substring(o,s)+"\\t",o=s+1;break;case 10:a+=n.substring(o,s)+"\\n",o=s+1}}return a+n.substring(o);case"undefined":return""}}},{key:"packRow",value:function(e,t,n){var r=t.length;if(0!==r){var i="";i+=this.escape(n,t[0]);for(var a=1;a<r;a++){var o=t[a];i+="\t"+this.escape(n,o)}e.push(i+"\n")}}},{key:"packArr",value:function(e,t,n){if(void 0!==n){var r=!0,i=!1,a=void 0;try{for(var o,s=n[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){var c=o.value;this.packRow(e,t,c)}}catch(u){i=!0,a=u}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}}e.push("\n")}},{key:"unpackSheet",value:function(e){var t={},n=this.fields,r=0;void 0!==n&&(r=this.unpackRow(t,n,e,r));var i=this.arrFields;if(void 0!==i){var a=!0,o=!1,s=void 0;try{for(var c,u=i[Symbol.iterator]();!(a=(c=u.next()).done);a=!0){var l=c.value;r=this.unpackArr(t,l,e,r)}}catch(h){o=!0,s=h}finally{try{a||null==u.return||u.return()}finally{if(o)throw s}}}return t}},{key:"unpackReturns",value:function(e){var t={},n=0,r=this.returns;if(void 0!==r){var i=!0,a=!1,o=void 0;try{for(var s,c=r[Symbol.iterator]();!(i=(s=c.next()).done);i=!0){var u=s.value;n=this.unpackArr(t,u,e,n)}}catch(l){a=!0,o=l}finally{try{i||null==c.return||c.return()}finally{if(a)throw o}}}return t}},{key:"unpackRow",value:function(e,t,n,r){for(var i=0,a=0,o=r,s=0,c=n.length,u=t.length;r<c;r++)if(i=a,9===(a=n.charCodeAt(r))){var l=t[s];if(8!==i){if(r>o){var h=n.substring(o,r);e[l.name]=this.to(e,h,l)}}else e[l.name]=null;if(o=r+1,++s>=u)break}else if(10===a){var d=t[s];if(8!==i){if(r>o){var f=n.substring(o,r);e[d.name]=this.to(e,f,d)}}else e[d.name]=null;++r,++s;break}return r}},{key:"to",value:function(e,t,n){switch(n.type){default:return t;case"datetime":case"date":case"time":return new Date(Number(t));case"tinyint":case"smallint":case"int":case"dec":return Number(t);case"bigint":var r=Number(t),i=n._tuid;return void 0===i?r:(i.useId(r,!0),i.boxId(r))}}},{key:"unpackArr",value:function(e,t,n,r){for(var i=[],a=n.length,o=t.name,s=t.fields;r<a;){if(10===n.charCodeAt(r)){++r;break}var c={};i.push(c),r=this.unpackRow(c,s,n,r)}return e[o]=i,r}},{key:"sName",get:function(){return this.jName||this.name}},{key:"tvApi",get:function(){return this.entities.uqApi}}]),e}(),Ht=n(66),Wt=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},zt=function(e){function t(e,n,r){var i;return Object(It.a)(this,t),(i=Object(Rt.a)(this,Object(Vt.a)(t).call(this,e,n,r))).queue=[],i.waitingIds=[],i.cache=Mt.k.map({},{deep:!1}),i.buildIdBoxer(),i}return Object(Tt.a)(t,e),Object(At.a)(t,[{key:"buildIdBoxer",value:function(){this.BoxId=function(){};var e=this.BoxId.prototype;Object.defineProperty(e,"_$tuid",{value:this,writable:!1,enumerable:!1}),Object.defineProperty(e,"obj",{enumerable:!1,get:function(){if(!(void 0===this.id||this.id<=0))return this._$tuid.valueFromId(this.id)}}),e.valueFromFieldName=function(e){return this._$tuid.valueFromFieldName(e,this.obj)},e.toJSON=function(){return this.id}}},{key:"boxId",value:function(e){this.useId(e);var t=new this.BoxId;return t.id=e,t}},{key:"getTuidContent",value:function(){return this.entities.cUq.getTuidContent(this)}},{key:"getIdFromObj",value:function(e){return e[this.idName]}},{key:"setSchema",value:function(e){Object(qt.a)(Object(Vt.a)(t.prototype),"setSchema",this).call(this,e);var n=e.id,r=e.unique;this.idName=n,this.unique=r,this.schemaFrom=this.schema.from}},{key:"moveToHead",value:function(e){var t=this.queue.findIndex(function(t){return t===e});this.queue.splice(t,1),this.queue.push(e)}},{key:"valueFromId",value:function(e){var t;switch(typeof e){case"object":t=e.id;break;case"number":t=e;break;default:return}var n=this.cache.get(t);return void 0!==this.owner&&"object"===typeof n&&(n.$owner=this.owner.boxId(n.owner)),n}},{key:"valueFromFieldName",value:function(e,t){if(void 0!==t){var n=this.fields.find(function(t){return t.name===e});if(void 0!==n){var r=t[e],i=n._tuid;return void 0===i?r:i.valueFromId(r)}}}},{key:"resetCache",value:function(e){this.cache.delete(e);var t=this.queue.findIndex(function(t){return t===e});this.queue.splice(t,1),this.useId(e)}},{key:"useId",value:function(e,t){if(void 0!==e&&0!==e&&!1!==Object(Ht.isNumber)(e))if(!0!==this.cache.has(e))if(this.entities.cacheTuids(!0===t?70:20),this.cache.set(e,e),this.waitingIds.findIndex(function(t){return t===e})>=0)this.moveToHead(e);else{if(this.queue.length>=1e3){var n=this.queue.shift();if(n===e)return void this.queue.push(n);if(!0===this.cache.has(n))this.cache.delete(n);else{var r=this.waitingIds.findIndex(function(e){return e===n});this.waitingIds.splice(r,1)}}this.waitingIds.push(e),this.queue.push(e)}else this.moveToHead(e)}},{key:"proxied",value:function(e,t){return Wt(this,void 0,void 0,Pt.a.mark(function n(){var r;return Pt.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return this.entities.getTuid(e,void 0).useId(t),n.next=4,this.tvApi.proxied(this.name,e,t);case 4:return r=n.sent,this.cacheValue(r),n.abrupt("return",r);case 7:case"end":return n.stop()}},n,this)}))}},{key:"cacheValue",value:function(e){if(void 0===e)return!1;var t=this.getIdFromObj(e);if(void 0===t)return!1;var n=this.waitingIds.findIndex(function(e){return e===t});return n>=0&&this.waitingIds.splice(n,1),this.cache.set(t,e),!0}},{key:"afterCacheId",value:function(e){var t=!0,n=!1,r=void 0;try{for(var i,a=this.fields[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var o=i.value,s=o._tuid;void 0!==s&&s.useId(e[o.name])}}catch(c){n=!0,r=c}finally{try{t||null==a.return||a.return()}finally{if(n)throw r}}}},{key:"cacheIds",value:function(){return Wt(this,void 0,void 0,Pt.a.mark(function e(){var t,n,r,i,a,o,s,c,u,l;return Pt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==this.waitingIds.length){e.next=2;break}return e.abrupt("return");case 2:return void 0===this.owner?t=this.name:(t=this.owner.name,n=this.name),e.next=5,this.getApiFrom();case 5:return r=e.sent,e.next=8,r.tuidIds(t,n,this.waitingIds);case 8:i=e.sent,a=!0,o=!1,s=void 0,e.prev=12,c=i[Symbol.iterator]();case 14:if(a=(u=c.next()).done){e.next=23;break}if(l=u.value,!1!==this.cacheValue(l)){e.next=18;break}return e.abrupt("continue",20);case 18:this.cacheTuidFieldValues(l),this.afterCacheId(l);case 20:a=!0,e.next=14;break;case 23:e.next=29;break;case 25:e.prev=25,e.t0=e.catch(12),o=!0,s=e.t0;case 29:e.prev=29,e.prev=30,a||null==c.return||c.return();case 32:if(e.prev=32,!o){e.next=35;break}throw s;case 35:return e.finish(32);case 36:return e.finish(29);case 37:return e.next=39,this.cacheDivIds();case 39:case"end":return e.stop()}},e,this,[[12,25,29,37],[30,,32,36]])}))}},{key:"cacheDivIds",value:function(){return Wt(this,void 0,void 0,Pt.a.mark(function e(){return Pt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e,this)}))}},{key:"load",value:function(e){return Wt(this,void 0,void 0,Pt.a.mark(function t(){var n,r;return Pt.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(void 0!==e&&0!==e){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,this.getApiFrom();case 4:return n=t.sent,t.next=7,n.tuidGet(this.name,e);case 7:if(void 0!==(r=t.sent)){t.next=10;break}return t.abrupt("return");case 10:return r._$tuid=this,this.cacheValue(r),this.cacheTuidFieldValues(r),t.abrupt("return",r);case 14:case"end":return t.stop()}},t,this)}))}},{key:"getDiv",value:function(e){}},{key:"cacheTuidFieldValues",value:function(e){var t=this.schema,n=t.fields,r=t.arrs;if(this.cacheFieldsInValue(e,n),void 0!==r){var i=!0,a=!1,o=void 0;try{for(var s,c=r[Symbol.iterator]();!(i=(s=c.next()).done);i=!0){var u=s.value,l=u.name,h=u.fields,d=e[l];if(void 0!==d){var f=this.getDiv(l),p=!0,v=!1,m=void 0;try{for(var y,b=d[Symbol.iterator]();!(p=(y=b.next()).done);p=!0){var w=y.value;w._$tuid=f,w.$owner=this.boxId(w.owner),f.cacheValue(w),this.cacheFieldsInValue(w,h)}}catch(k){v=!0,m=k}finally{try{p||null==b.return||b.return()}finally{if(v)throw m}}}}}catch(k){a=!0,o=k}finally{try{i||null==c.return||c.return()}finally{if(a)throw o}}}}},{key:"cacheFieldsInValue",value:function(e,t){var n=!0,r=!1,i=void 0;try{for(var a,o=t[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value,c=s.name,u=s._tuid;if(void 0!==u){var l=e[c];e[c]=u.boxId(l)}}}catch(h){r=!0,i=h}finally{try{n||null==o.return||o.return()}finally{if(r)throw i}}}},{key:"save",value:function(e,t){return Wt(this,void 0,void 0,Pt.a.mark(function n(){var r,i,a;return Pt.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return(r=Lt.a.clone(t)).$id=e,n.next=4,this.tvApi.tuidSave(this.name,r);case 4:return i=n.sent,a=i.id,i.inId,void 0===a?(r.id=e,this.cacheValue(r)):a>0&&(r.id=a,this.cacheValue(r)),n.abrupt("return",i);case 8:case"end":return n.stop()}},n,this)}))}},{key:"search",value:function(e,t,n){return Wt(this,void 0,void 0,Pt.a.mark(function r(){var i;return Pt.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,this.searchArr(void 0,e,t,n);case 2:return i=r.sent,r.abrupt("return",i);case 4:case"end":return r.stop()}},r,this)}))}},{key:"searchArr",value:function(e,t,n,r){return Wt(this,void 0,void 0,Pt.a.mark(function i(){var a,o,s,c,u,l,h,d,f,p,v;return Pt.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return a=this.schema.fields,void 0!==this.owner?(o=this.owner.name,s=this.name):(o=this.name,s=void 0),i.next=4,this.getApiFrom();case 4:return c=i.sent,i.next=7,c.tuidSearch(o,s,e,t,n,r);case 7:for(u=i.sent,l=!0,h=!1,d=void 0,i.prev=11,f=u[Symbol.iterator]();!(l=(p=f.next()).done);l=!0)v=p.value,this.cacheFieldsInValue(v,a),void 0!==this.owner&&(v.$owner=this.owner.boxId(v.owner));i.next=19;break;case 15:i.prev=15,i.t0=i.catch(11),h=!0,d=i.t0;case 19:i.prev=19,i.prev=20,l||null==f.return||f.return();case 22:if(i.prev=22,!h){i.next=25;break}throw d;case 25:return i.finish(22);case 26:return i.finish(19);case 27:return i.abrupt("return",u);case 28:case"end":return i.stop()}},i,this,[[11,15,19,27],[20,,22,26]])}))}},{key:"loadArr",value:function(e,t,n){return Wt(this,void 0,void 0,Pt.a.mark(function r(){var i;return Pt.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(void 0!==n&&0!==n){r.next=2;break}return r.abrupt("return");case 2:return r.next=4,this.getApiFrom();case 4:return i=r.sent,r.next=7,i.tuidArrGet(this.name,e,t,n);case 7:return r.abrupt("return",r.sent);case 8:case"end":return r.stop()}},r,this)}))}},{key:"saveArr",value:function(e,t,n,r){return Wt(this,void 0,void 0,Pt.a.mark(function i(){var a;return Pt.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return(a=Lt.a.clone(r)).$id=n,i.next=4,this.tvApi.tuidArrSave(this.name,e,t,a);case 4:return i.abrupt("return",i.sent);case 5:case"end":return i.stop()}},i,this)}))}},{key:"posArr",value:function(e,t,n,r){return Wt(this,void 0,void 0,Pt.a.mark(function i(){return Pt.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,this.tvApi.tuidArrPos(this.name,e,t,n,r);case 2:return i.abrupt("return",i.sent);case 3:case"end":return i.stop()}},i,this)}))}},{key:"showInfo",value:function(e){return Wt(this,void 0,void 0,Pt.a.mark(function t(){return Pt.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.entities.cUq.showTuid(this,e);case 2:case"end":return t.stop()}},t,this)}))}},{key:"typeName",get:function(){return"tuid"}}]),t}($t),Kt=function(e){function t(){return Object(It.a)(this,t),Object(Rt.a)(this,Object(Vt.a)(t).apply(this,arguments))}return Object(Tt.a)(t,e),Object(At.a)(t,[{key:"setSchema",value:function(e){Object(qt.a)(Object(Vt.a)(t.prototype),"setSchema",this).call(this,e);var n=e.arrs;if(void 0!==n){this.divs={};var r=!0,i=!1,a=void 0;try{for(var o,s=n[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){var c=o.value,u=c.name,l=new Qt(this.entities,u,this.typeId);l.owner=this,this.divs[u]=l,l.setSchema(c)}}catch(h){i=!0,a=h}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}}}},{key:"getDiv",value:function(e){return this.divs[e]}},{key:"cacheDivIds",value:function(){return Wt(this,void 0,void 0,Pt.a.mark(function e(){var t;return Pt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==this.divs){e.next=2;break}return e.abrupt("return");case 2:e.t0=Pt.a.keys(this.divs);case 3:if((e.t1=e.t0()).done){e.next=9;break}return t=e.t1.value,e.next=7,this.divs[t].cacheIds();case 7:e.next=3;break;case 9:case"end":return e.stop()}},e,this)}))}},{key:"cUqFrom",value:function(){return Wt(this,void 0,void 0,Pt.a.mark(function e(){var t,n,r,i,a,o,s;return Pt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==this.schemaFrom){e.next=2;break}return e.abrupt("return",this.entities.cUq);case 2:return t=this.schemaFrom,n=t.owner,r=t.uq,e.next=5,this.entities.cUq;case 5:if(i=e.sent,void 0!==(a=i.cApp)){e.next=9;break}return e.abrupt("return",i);case 9:return e.next=11,a.getImportUq(n,r);case 11:if(void 0!==(o=e.sent)){e.next=16;break}return console.error("".concat(n,"/").concat(r," \u4e0d\u5b58\u5728")),e.abrupt("return",i);case 16:return e.next=18,o.loadSchema();case 18:if(void 0===(s=e.sent)){e.next=23;break}return console.error("cUq.loadSchema: "+s),e.abrupt("return",i);case 23:return e.abrupt("return",o);case 24:case"end":return e.stop()}},e,this)}))}},{key:"getApiFrom",value:function(){return Wt(this,void 0,void 0,Pt.a.mark(function e(){var t;return Pt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.from();case 2:if(void 0===(t=e.sent)){e.next=5;break}return e.abrupt("return",t.entities.uqApi);case 5:return e.abrupt("return",this.entities.uqApi);case 6:case"end":return e.stop()}},e,this)}))}},{key:"from",value:function(){return Wt(this,void 0,void 0,Pt.a.mark(function e(){var t;return Pt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.cUqFrom();case 2:return t=e.sent,e.abrupt("return",t.tuid(this.name));case 4:case"end":return e.stop()}},e,this)}))}},{key:"cFrom",value:function(){return Wt(this,void 0,void 0,Pt.a.mark(function e(){var t;return Pt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.cUqFrom();case 2:return t=e.sent,e.abrupt("return",t.cTuidMainFromName(this.name));case 4:case"end":return e.stop()}},e,this)}))}},{key:"cEditFrom",value:function(){return Wt(this,void 0,void 0,Pt.a.mark(function e(){var t;return Pt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.cUqFrom();case 2:return t=e.sent,e.abrupt("return",t.cTuidEditFromName(this.name));case 4:case"end":return e.stop()}},e,this)}))}},{key:"cInfoFrom",value:function(){return Wt(this,void 0,void 0,Pt.a.mark(function e(){var t;return Pt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.cUqFrom();case 2:return t=e.sent,e.abrupt("return",t.cTuidInfoFromName(this.name));case 4:case"end":return e.stop()}},e,this)}))}},{key:"cSelectFrom",value:function(){return Wt(this,void 0,void 0,Pt.a.mark(function e(){var t;return Pt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.cUqFrom();case 2:if(void 0!==(t=e.sent)){e.next=5;break}return e.abrupt("return");case 5:return e.abrupt("return",t.cTuidSelectFromName(this.name));case 6:case"end":return e.stop()}},e,this)}))}},{key:"afterCacheId",value:function(e){if(Object(qt.a)(Object(Vt.a)(t.prototype),"afterCacheId",this).call(this,e),void 0!==this.proxies){var n=e.type,r=e.$proxy;this.proxies[n].useId(r)}}},{key:"Main",get:function(){return this}},{key:"uqApi",get:function(){return this.entities.uqApi}}]),t}(zt),Qt=function(e){function t(){return Object(It.a)(this,t),Object(Rt.a)(this,Object(Vt.a)(t).apply(this,arguments))}return Object(Tt.a)(t,e),Object(At.a)(t,[{key:"getApiFrom",value:function(){return Wt(this,void 0,void 0,Pt.a.mark(function e(){return Pt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.owner.getApiFrom();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}))}},{key:"Main",get:function(){return this.owner}}]),t}(zt),Jt=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},Gt=function(e){function t(){return Object(It.a)(this,t),Object(Rt.a)(this,Object(Vt.a)(t).apply(this,arguments))}return Object(Tt.a)(t,e),Object(At.a)(t,[{key:"submit",value:function(e){return Jt(this,void 0,void 0,Pt.a.mark(function t(){var n;return Pt.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.loadSchema();case 2:return n=this.pack(e),t.next=5,this.tvApi.action(this.name,{data:n});case 5:return t.abrupt("return",t.sent);case 6:case"end":return t.stop()}},t,this)}))}},{key:"typeName",get:function(){return"action"}}]),t}($t),Yt=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},Xt=function(e){function t(){return Object(It.a)(this,t),Object(Rt.a)(this,Object(Vt.a)(t).apply(this,arguments))}return Object(Tt.a)(t,e),Object(At.a)(t,[{key:"setSchema",value:function(e){Object(qt.a)(Object(Vt.a)(t.prototype),"setSchema",this).call(this,e),this.states=e.states}},{key:"build",value:function(e){this.states=[];var t=!0,n=!1,r=void 0;try{for(var i,a=e.ops[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var o=i.value;this.states.push({name:o,actions:void 0})}}catch(s){n=!0,r=s}finally{try{t||null==a.return||a.return()}finally{if(n)throw r}}}},{key:"createSheetState",value:function(e,t){var n={name:e,actions:[]},r=n.actions;for(var i in t){var a={name:i};r.push(a)}return n}},{key:"save",value:function(e,t){return Yt(this,void 0,void 0,Pt.a.mark(function n(){var r,i,a;return Pt.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.loadSchema();case 2:return r=this.entities.appId,i=this.pack(t),n.next=6,this.tvApi.sheetSave(this.name,{app:r,discription:e,data:i});case 6:return a=n.sent,n.abrupt("return",a);case 8:case"end":return n.stop()}},n,this)}))}},{key:"action",value:function(e,t,n,r){return Yt(this,void 0,void 0,Pt.a.mark(function i(){return Pt.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,this.loadSchema();case 2:return i.next=4,this.tvApi.sheetAction(this.name,{id:e,flow:t,state:n,action:r});case 4:return i.abrupt("return",i.sent);case 5:case"end":return i.stop()}},i,this)}))}},{key:"unpack",value:function(e){return Yt(this,void 0,void 0,Pt.a.mark(function t(){var n,r,i,a;return Pt.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=e[0],r=n[0],i=this.unpackSheet(r.data),a=e[1],t.abrupt("return",{brief:r,data:i,flows:a});case 5:case"end":return t.stop()}},t,this)}))}},{key:"getSheet",value:function(e){return Yt(this,void 0,void 0,Pt.a.mark(function t(){var n;return Pt.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.loadSchema();case 2:return t.next=4,this.tvApi.getSheet(this.name,e);case 4:if(0!==(n=t.sent)[0].length){t.next=9;break}return t.next=8,this.getArchive(e);case 8:return t.abrupt("return",t.sent);case 9:return t.next=11,this.unpack(n);case 11:return t.abrupt("return",t.sent);case 12:case"end":return t.stop()}},t,this)}))}},{key:"getArchive",value:function(e){return Yt(this,void 0,void 0,Pt.a.mark(function t(){var n;return Pt.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.loadSchema();case 2:return t.next=4,this.tvApi.sheetArchive(this.name,e);case 4:return n=t.sent,t.next=7,this.unpack(n);case 7:return t.abrupt("return",t.sent);case 8:case"end":return t.stop()}},t,this)}))}},{key:"getArchives",value:function(e,t){return Yt(this,void 0,void 0,Pt.a.mark(function n(){var r;return Pt.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.loadSchema();case 2:return n.next=4,this.tvApi.sheetArchives(this.name,{pageStart:e,pageSize:t});case 4:return r=n.sent,n.abrupt("return",r);case 6:case"end":return n.stop()}},n,this)}))}},{key:"getStateSheets",value:function(e,t,n){return Yt(this,void 0,void 0,Pt.a.mark(function r(){var i;return Pt.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,this.loadSchema();case 2:return r.next=4,this.tvApi.stateSheets(this.name,{state:e,pageStart:t,pageSize:n});case 4:return i=r.sent,r.abrupt("return",i);case 6:case"end":return r.stop()}},r,this)}))}},{key:"createPageStateItems",value:function(){return new Zt(this)}},{key:"stateSheetCount",value:function(){return Yt(this,void 0,void 0,Pt.a.mark(function e(){var t;return Pt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.loadSchema();case 2:return e.next=4,this.tvApi.stateSheetCount(this.name);case 4:return t=e.sent,e.abrupt("return",this.states.map(function(e){var n=e.name,r=0,i=t.find(function(e){return e.state===n});return void 0!==i&&(r=i.count),{state:n,count:r}}));case 6:case"end":return e.stop()}},e,this)}))}},{key:"typeName",get:function(){return"sheet"}}]),t}($t),Zt=function(e){function t(e){var n;return Object(It.a)(this,t),(n=Object(Rt.a)(this,Object(Vt.a)(t).call(this,!0))).sheet=e,n.pageSize=10,n}return Object(Tt.a)(t,e),Object(At.a)(t,[{key:"load",value:function(e,t,n){return Yt(this,void 0,void 0,Pt.a.mark(function r(){var i;return Pt.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,this.sheet.getStateSheets(e,t,n);case 2:return i=r.sent,r.abrupt("return",i);case 4:case"end":return r.stop()}},r,this)}))}},{key:"setPageStart",value:function(e){this.pageStart=void 0===e?0:e.id}}]),t}(s.f),en=n(23),tn=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},nn=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},rn=function(e){function t(){return Object(It.a)(this,t),Object(Rt.a)(this,Object(Vt.a)(t).apply(this,arguments))}return Object(Tt.a)(t,e),Object(At.a)(t,[{key:"setSchema",value:function(e){Object(qt.a)(Object(Vt.a)(t.prototype),"setSchema",this).call(this,e);var n=e.returns;this.returns=n,this.isPaged=void 0!==n.find(function(e){return"$page"===e.name})}},{key:"resetPage",value:function(e,t){this.pageStart=void 0,this.pageSize=e,this.params=t,this.more=!1,this.list=void 0}},{key:"loadPage",value:function(){return nn(this,void 0,void 0,Pt.a.mark(function e(){var t,n,r,i;return Pt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==this.pageSize){e.next=2;break}throw"call resetPage(size:number, params:any) first";case 2:if(void 0===this.pageStart){e.next=10;break}e.t0=this.startField.type,e.next="date"===e.t0?8:"time"===e.t0?8:"datetime"===e.t0?8:6;break;case 6:return t=this.pageStart,e.abrupt("break",10);case 8:return t=this.pageStart.getTime(),e.abrupt("break",10);case 10:return e.next=12,this.page(this.params,t,this.pageSize+1);case 12:n=e.sent,this.list=Mt.k.array([],{deep:!1}),void 0!==n&&(n.length>this.pageSize?(this.more=!0,n.pop(),i=this.returns.find(function(e){return"$page"===e.name}),this.startField=i.fields[0],this.pageStart=n[n.length-1][this.startField.name]):this.more=!1,(r=this.list).push.apply(r,Object(en.a)(n)));case 15:case"end":return e.stop()}},e,this)}))}},{key:"page",value:function(e,t,n){return nn(this,void 0,void 0,Pt.a.mark(function r(){var i,a;return Pt.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,this.loadSchema();case 2:return r.next=4,this.tvApi.page(this.name,t,n+1,this.buildParams(e));case 4:return i=r.sent,r.next=7,this.unpackReturns(i);case 7:return a=r.sent,r.abrupt("return",a.$page);case 9:case"end":return r.stop()}},r,this)}))}},{key:"query",value:function(e){return nn(this,void 0,void 0,Pt.a.mark(function t(){var n,r;return Pt.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.loadSchema();case 2:return t.next=4,this.tvApi.query(this.name,this.buildParams(e));case 4:return n=t.sent,t.next=7,this.unpackReturns(n);case 7:return r=t.sent,t.abrupt("return",r);case 9:case"end":return t.stop()}},t,this)}))}},{key:"table",value:function(e){return nn(this,void 0,void 0,Pt.a.mark(function t(){var n,r;return Pt.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.query(e);case 2:n=t.sent,t.t0=Pt.a.keys(n);case 4:if((t.t1=t.t0()).done){t.next=9;break}return r=t.t1.value,t.abrupt("return",n[r]);case 9:case"end":return t.stop()}},t,this)}))}},{key:"obj",value:function(e){return nn(this,void 0,void 0,Pt.a.mark(function t(){var n;return Pt.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.table(e);case 2:if(!((n=t.sent).length>0)){t.next=5;break}return t.abrupt("return",n[0]);case 5:case"end":return t.stop()}},t,this)}))}},{key:"scalar",value:function(e){return nn(this,void 0,void 0,Pt.a.mark(function t(){var n,r;return Pt.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.obj(e);case 2:n=t.sent,t.t0=Pt.a.keys(n);case 4:if((t.t1=t.t0()).done){t.next=9;break}return r=t.t1.value,t.abrupt("return",n[r]);case 9:case"end":return t.stop()}},t,this)}))}},{key:"typeName",get:function(){return"query"}},{key:"hasMore",get:function(){return this.more}}]),t}($t);tn([Mt.k],rn.prototype,"list",void 0);var an=function(e){function t(){var e;return Object(It.a)(this,t),(e=Object(Rt.a)(this,Object(Vt.a)(t).apply(this,arguments))).queryApiName="book",e}return Object(Tt.a)(t,e),Object(At.a)(t,[{key:"typeName",get:function(){return"book"}}]),t}(rn),on=function(e){function t(){var e;return Object(It.a)(this,t),(e=Object(Rt.a)(this,Object(Vt.a)(t).apply(this,arguments))).queryApiName="history",e}return Object(Tt.a)(t,e),Object(At.a)(t,[{key:"typeName",get:function(){return"history"}}]),t}(rn),sn=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},cn=function(e){function t(){var e;return Object(It.a)(this,t),(e=Object(Rt.a)(this,Object(Vt.a)(t).apply(this,arguments))).actions={},e.queries={},e}return Object(Tt.a)(t,e),Object(At.a)(t,[{key:"setSchema",value:function(e){Object(qt.a)(Object(Vt.a)(t.prototype),"setSchema",this).call(this,e),this.schemaFrom=this.schema.from;var n=e.actions,r=e.queries,i=e.keys;for(var a in this.entities.buildFieldTuid(this.keys=i),n){var o=n[a],s=o.name,c=this.entities.newAction(s,void 0);c.setSchema(o),this.actions[a]=c}for(var u in r){var l=r[u],h=(s=l.name,this.entities.newQuery(s,void 0));h.setSchema(l),this.queries[u]=h}}},{key:"add",value:function(e){return sn(this,void 0,void 0,Pt.a.mark(function t(){return Pt.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.loadSchema();case 2:return t.next=4,this.actions.add.submit(e);case 4:return t.abrupt("return",t.sent);case 5:case"end":return t.stop()}},t,this)}))}},{key:"del",value:function(e){return sn(this,void 0,void 0,Pt.a.mark(function t(){return Pt.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.loadSchema();case 2:return t.next=4,this.actions.del.submit(e);case 4:return t.abrupt("return",t.sent);case 5:case"end":return t.stop()}},t,this)}))}},{key:"all",value:function(){return sn(this,void 0,void 0,Pt.a.mark(function e(){return Pt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.loadSchema();case 2:return e.next=4,this.queries.all.query({});case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}},e,this)}))}},{key:"page",value:function(e,t,n){return sn(this,void 0,void 0,Pt.a.mark(function r(){return Pt.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,this.loadSchema();case 2:return r.next=4,this.queries.page.page(e,t,n);case 4:return r.abrupt("return",r.sent);case 5:case"end":return r.stop()}},r,this)}))}},{key:"query",value:function(e){return sn(this,void 0,void 0,Pt.a.mark(function t(){return Pt.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.loadSchema();case 2:return t.next=4,this.queries.query.query(e);case 4:return t.abrupt("return",t.sent);case 5:case"end":return t.stop()}},t,this)}))}},{key:"table",value:function(e){return sn(this,void 0,void 0,Pt.a.mark(function t(){var n,r;return Pt.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.query(e);case 2:n=t.sent,t.t0=Pt.a.keys(n);case 4:if((t.t1=t.t0()).done){t.next=9;break}return r=t.t1.value,t.abrupt("return",n[r]);case 9:case"end":return t.stop()}},t,this)}))}},{key:"obj",value:function(e){return sn(this,void 0,void 0,Pt.a.mark(function t(){var n;return Pt.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.table(e);case 2:if(!((n=t.sent).length>0)){t.next=5;break}return t.abrupt("return",n[0]);case 5:case"end":return t.stop()}},t,this)}))}},{key:"scalar",value:function(e){return sn(this,void 0,void 0,Pt.a.mark(function t(){var n,r;return Pt.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.obj(e);case 2:n=t.sent,t.t0=Pt.a.keys(n);case 4:if((t.t1=t.t0()).done){t.next=9;break}return r=t.t1.value,t.abrupt("return",n[r]);case 9:case"end":return t.stop()}},t,this)}))}},{key:"typeName",get:function(){return"map"}}]),t}($t),un=function(e){function t(){var e;return Object(It.a)(this,t),(e=Object(Rt.a)(this,Object(Vt.a)(t).apply(this,arguments))).queryApiName="pending",e}return Object(Tt.a)(t,e),Object(At.a)(t,[{key:"typeName",get:function(){return"pending"}}]),t}(rn),ln=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})};function hn(e){switch(e){case"tinyint":case"smallint":case"int":case"bigint":case"dec":return 0;case"char":case"text":return"";case"datetime":case"date":return"2000-1-1";case"time":return"0:00"}}var dn=function(){function e(t,n,r){var i=this;Object(It.a)(this,e),this.tuids={},this.actions={},this.sheets={},this.queries={},this.books={},this.maps={},this.histories={},this.pendings={},this.tuidArr=[],this.actionArr=[],this.sheetArr=[],this.queryArr=[],this.bookArr=[],this.mapArr=[],this.historyArr=[],this.pendingArr=[],this.loadIds=function(){for(var e in i.clearCacheTimer(),i.tuids){i.tuids[e].cacheIds()}},this.cUq=t,this.uqApi=n,this.appId=r}return Object(At.a)(e,[{key:"tuid",value:function(e){return this.tuids[e.toLowerCase()]}},{key:"action",value:function(e){return this.actions[e.toLowerCase()]}},{key:"sheet",value:function(e){return this.sheets[e.toLowerCase()]}},{key:"query",value:function(e){return this.queries[e.toLowerCase()]}},{key:"book",value:function(e){return this.books[e.toLowerCase()]}},{key:"map",value:function(e){return this.maps[e.toLowerCase()]}},{key:"history",value:function(e){return this.histories[e.toLowerCase()]}},{key:"pending",value:function(e){return this.pendings[e.toLowerCase()]}},{key:"sheetFromTypeId",value:function(e){for(var t in this.sheets){var n=this.sheets[t];if(n.typeId===e)return n}}},{key:"loadAccess",value:function(){return ln(this,void 0,void 0,Pt.a.mark(function e(){var t;return Pt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.uqApi.loadAccess();case 2:if(void 0!==(t=e.sent)){e.next=5;break}return e.abrupt("return");case 5:this.buildEntities(t);case 6:case"end":return e.stop()}},e,this)}))}},{key:"loadEntities",value:function(){return ln(this,void 0,void 0,Pt.a.mark(function e(){var t;return Pt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.uqApi.loadEntities();case 2:t=e.sent,this.buildEntities(t);case 4:case"end":return e.stop()}},e,this)}))}},{key:"buildEntities",value:function(e){var t=e.access,n=e.tuids;this.buildTuids(n),this.buildAccess(t)}},{key:"getTuid",value:function(e,t,n){var r=this.tuids[e];if(void 0!==r)return void 0===t?r:r.divs[t]}},{key:"cacheTuids",value:function(e){this.clearCacheTimer(),this.cacheTimer=setTimeout(this.loadIds,e)}},{key:"clearCacheTimer",value:function(){void 0!==this.cacheTimer&&(clearTimeout(this.cacheTimer),this.cacheTimer=void 0)}},{key:"buildTuids",value:function(e){var t={};for(var n in e){var r=e[n],i=(r.name,r.typeId),a=r.proxies;this.newTuid(n,i).sys=!0,void 0!==a&&(t[n]=a)}for(var o in e){var s=e[o];s.name;this.getTuid(o).setSchema(s)}for(var c in t){a=t[c];var u=this.tuids[c];u.proxies={};var l=!0,h=!1,d=void 0;try{for(var f,p=a[Symbol.iterator]();!(l=(f=p.next()).done);l=!0){var v=f.value;u.proxies[v]=this.tuids[v]}}catch(m){h=!0,d=m}finally{try{l||null==p.return||p.return()}finally{if(h)throw d}}}}},{key:"buildAccess",value:function(e){for(var t in e){var n=e[t];switch(typeof n){case"string":this.fromType(t,n);break;case"object":this.fromObj(t,n)}}}},{key:"newAction",value:function(e,t){var n=this.actions[e];return void 0!==n?n:(n=this.actions[e]=new Gt(this,e,t),this.actionArr.push(n),n)}},{key:"newTuid",value:function(e,t){var n=this.tuids[e];return void 0!==n?n:(n=this.tuids[e]=new Kt(this,e,t),this.tuidArr.push(n),n)}},{key:"newQuery",value:function(e,t){var n=this.queries[e];return void 0!==n?n:(n=this.queries[e]=new rn(this,e,t),this.queryArr.push(n),n)}},{key:"newBook",value:function(e,t){var n=this.books[e];return void 0!==n?n:(n=this.books[e]=new an(this,e,t),this.bookArr.push(n),n)}},{key:"newMap",value:function(e,t){var n=this.maps[e];return void 0!==n?n:(n=this.maps[e]=new cn(this,e,t),this.mapArr.push(n),n)}},{key:"newHistory",value:function(e,t){var n=this.histories[e];if(void 0===n)return n=this.histories[e]=new on(this,e,t),this.historyArr.push(n),n}},{key:"newPending",value:function(e,t){var n=this.pendings[e];if(void 0===n)return n=this.pendings[e]=new un(this,e,t),this.pendingArr.push(n),n}},{key:"newSheet",value:function(e,t){var n=this.sheets[e];return void 0!==n?n:(n=this.sheets[e]=new Xt(this,e,t),this.sheetArr.push(n),n)}},{key:"fromType",value:function(e,t){var n=t.split("|");t=n[0];var r=Number(n[1]);switch(t){case"uq":this.uqId=r;break;case"tuid":this.newTuid(e,r).sys=!1;break;case"action":this.newAction(e,r);break;case"query":this.newQuery(e,r);break;case"book":this.newBook(e,r);break;case"map":this.newMap(e,r);break;case"history":this.newHistory(e,r);break;case"sheet":this.newSheet(e,r);break;case"pending":this.newPending(e,r)}}},{key:"fromObj",value:function(e,t){switch(t.$){case"sheet":this.buildSheet(e,t)}}},{key:"buildSheet",value:function(e,t){var n=this.sheets[e];void 0===n&&(n=this.newSheet(e,t.id)),n.build(t)}},{key:"buildFieldTuid",value:function(e,t){var n=this;if(void 0!==e){var r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){var c=o.value,u=c.tuid,l=c.arr,h=c.url;void 0!==u&&(c._tuid=this.getTuid(u,l,h))}}catch(b){i=!0,a=b}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}var d=!0,f=!1,p=void 0;try{for(var v,m=function(){var r=v.value,i=r.owner;if(void 0===i)return"continue";var a=e.find(function(e){return e.name===i});if(void 0===a&&(void 0!==t&&(a=t.find(function(e){return e.name===i})),void 0===a))throw"owner field ".concat(i," is undefined");r._ownerField=a;var o=r.arr,s=r.url;if(r._tuid=n.getTuid(a._tuid.name,o,s),void 0===r._tuid)throw"owner field ${owner} is not tuid"},y=e[Symbol.iterator]();!(d=(v=y.next()).done);d=!0)m()}catch(b){f=!0,p=b}finally{try{d||null==y.return||y.return()}finally{if(f)throw p}}}}},{key:"buildArrFieldsTuid",value:function(e,t){if(void 0!==e){var n=!0,r=!1,i=void 0;try{for(var a,o=e[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value.fields;void 0!==s&&this.buildFieldTuid(s,t)}}catch(c){r=!0,i=c}finally{try{n||null==o.return||o.return()}finally{if(r)throw i}}}}}]),e}(),fn=n(15),pn=n.n(fn),vn=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},mn=function(e){function t(e){var n;return Object(It.a)(this,t),(n=Object(Rt.a)(this,Object(Vt.a)(t).call(this))).onClick=function(){return vn(Object(Dt.a)(Object(Dt.a)(n)),void 0,void 0,Pt.a.mark(function e(){return Pt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.controller.start();case 2:case"end":return e.stop()}},e,this)}))},n.controller=e,n.icon=e.icon,n.label=e.label,n}return Object(Tt.a)(t,e),Object(At.a)(t,[{key:"render",value:function(e){return Ft.createElement("div",{className:pn()("px-3","py-2","align-items-center","cursor-pointer",e),onClick:this.onClick},this.icon," \xa0 ",this.label)}}]),t}(function e(){Object(It.a)(this,e)}),yn=n(22),bn=function(){function e(t){Object(It.a)(this,e),this.view=function(){return Ft.createElement("div",null)},this.label=t}return Object(At.a)(e,[{key:"render",value:function(){return Ft.createElement("div",{key:this.key,className:"px-3"},Ft.createElement("div",{className:"form-group row"},Ft.createElement("label",{className:"col-sm-2 col-form-label"},this.label),Ft.createElement("div",{className:"col-sm-10"},this.renderContent())))}},{key:"setAddRow",value:function(e){}},{key:"getVFields",value:function(){}},{key:"getVArr",value:function(){}},{key:"getVSubmit",value:function(){}},{key:"renderContent",value:function(){return Ft.createElement("div",{className:"form-control form-control-plaintext bg-white border border-info rounded "},"content")}},{key:"key",get:function(){return this.label}}]),e}(),wn=function(e){function t(e,n){var r;return Object(It.a)(this,t),(r=Object(Rt.a)(this,Object(Vt.a)(t).call(this,e))).vField=n,r}return Object(Tt.a)(t,e),Object(At.a)(t,[{key:"getVFields",value:function(){return[this.vField]}},{key:"renderContent",value:function(){return this.vField.render()}},{key:"key",get:function(){return this.vField.name}}]),t}(bn),kn=function(e){function t(e,n){var r;return Object(It.a)(this,t),(r=Object(Rt.a)(this,Object(Vt.a)(t).call(this,e))).vArr=n,r}return Object(Tt.a)(t,e),Object(At.a)(t,[{key:"setAddRow",value:function(e){this.vArr.setAddRow(e)}},{key:"getVArr",value:function(){return this.vArr}},{key:"render",value:function(){return Ft.createElement(Ft.Fragment,{key:this.key},this.vArr&&this.vArr.render())}},{key:"key",get:function(){return this.vArr.name}}]),t}(bn),gn=function(e){function t(e){var n;return Object(It.a)(this,t),(n=Object(Rt.a)(this,Object(Vt.a)(t).call(this,void 0))).vSubmit=e,n}return Object(Tt.a)(t,e),Object(At.a)(t,[{key:"getVSubmit",value:function(){return this.vSubmit}},{key:"render",value:function(){return Ft.createElement("div",{key:"$submit",className:"px-3"},Ft.createElement("div",{className:"form-group row"},Ft.createElement("div",{className:"offset-sm-2 col-sm-10"},this.vSubmit.render())))}},{key:"key",get:function(){return"$submit"}}]),t}(bn);function xn(e,t){switch(e.substr(0,1)){default:return t;case"$":case"_":return}}function On(e){return JSON.stringify(e,xn," ")}var jn=Object(yn.a)(function(e){var t=e.tuidValue,n=e.ui,r=e.x,i=e.nullUI,a=typeof t;switch(a){default:if(void 0===n)return Ft.createElement(Ft.Fragment,null,a,"-",t);var o=n(t,r);return void 0!==o?o:Ft.createElement(Ft.Fragment,null,t);case"undefined":break;case"object":if(null!==t)return function(e,t,n){if("number"===typeof e)return Ft.createElement(Ft.Fragment,null,e);var r=e.id,i=e._$tuid,a=e._$com,o=i;if(void 0===o)return void 0!==t?t(e,n):Sn(e,n);var s=t||a;void 0===s&&(s=e._$com=o.getTuidContent());var c=o.valueFromId(r);if("number"===typeof c&&(c={id:c}),void 0!==t){var u=t(c,n);return void 0!==u?u:Ft.createElement(Ft.Fragment,null,r)}return Ft.createElement(s,c)}(t,n,r);break;case"number":return Ft.createElement(Ft.Fragment,null,"id...",t)}return void 0===i?Ft.createElement(Ft.Fragment,null,"null"):i()}),En=function(e,t,n,r){return Ft.createElement(jn,{tuidValue:e,ui:t,x:n,nullUI:r})},Cn=function(){function e(){Object(It.a)(this,e)}return Object(At.a)(e,[{key:"render",value:function(e){return void 0===this.view?Ft.createElement("div",null,"??? viewModel \u5fc5\u987b\u5b9a\u4e49 view ???"):Ft.createElement(this.view,{vm:this,className:e})}}]),e}(),Sn=function(e,t){return Ft.createElement(Ft.Fragment,null,"content: ",On(e))},Nn=Object(yn.a)(Sn),Pn=function(e){return Ft.createElement("div",{className:"px-3 py-2"},On(e))},Fn=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},_n=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},In=function(e){function t(e){var n;return Object(It.a)(this,t),(n=Object(Rt.a)(this,Object(Vt.a)(t).call(this))).onClickSubmit=function(){return _n(Object(Dt.a)(Object(Dt.a)(n)),void 0,void 0,Pt.a.mark(function e(){return Pt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.vForm.submit();case 1:case"end":return e.stop()}},e,this)}))},n.view=Object(yn.a)(function(){var e=n.vForm.isOk;return Ft.createElement("button",{type:"button",onClick:n.onClickSubmit,className:n.className,disabled:!1===e},n.caption)}),n.vForm=e,n.caption=n.vForm.submitCaption,n.className="btn btn-primary w-25",n}return Object(Tt.a)(t,e),t}(Cn);Fn([Mt.k],In.prototype,"caption",void 0),Fn([Mt.k],In.prototype,"className",void 0);var An=function e(){Object(It.a)(this,e)},Rn=function(e){function t(){return Object(It.a)(this,t),Object(Rt.a)(this,Object(Vt.a)(t).apply(this,arguments))}return Object(Tt.a)(t,e),Object(At.a)(t,[{key:"check",value:function(e,t){switch(typeof t){default:case"boolean":return;case"object":if(null!==t)return;break;case"string":if(t.trim().length>0)return;break;case"number":if(NaN!==t)return;break;case"undefined":}e.push("\u4e0d\u80fd\u4e3a\u7a7a")}}]),t}(An),Vn=function(e){function t(){return Object(It.a)(this,t),Object(Rt.a)(this,Object(Vt.a)(t).apply(this,arguments))}return Object(Tt.a)(t,e),Object(At.a)(t,[{key:"check",value:function(e,t){void 0!==t&&null!==t&&(NaN===Number(t)&&e.push("\u5fc5\u987b\u662f\u6570\u5b57"))}}]),t}(An),Tn=function(e){function t(){return Object(It.a)(this,t),Object(Rt.a)(this,Object(Vt.a)(t).apply(this,arguments))}return Object(Tt.a)(t,e),Object(At.a)(t,[{key:"check",value:function(e,t){if(void 0!==t&&null!==t){var n=Number(t);!0!==Number.isNaN(n)&&!1!==Number.isInteger(n)||e.push("\u5fc5\u987b\u662f\u6574\u6570")}}}]),t}(An),Dn=function(e){function t(e){var n;return Object(It.a)(this,t),(n=Object(Rt.a)(this,Object(Vt.a)(t).call(this))).min=e,n}return Object(Tt.a)(t,e),Object(At.a)(t,[{key:"check",value:function(e,n){Object(qt.a)(Object(Vt.a)(t.prototype),"check",this).call(this,e,n),Number(n)<this.min&&e.push("\u4e0d\u80fd\u5c0f\u4e8e"+this.min)}}]),t}(Vn),qn=function(e){function t(e){var n;return Object(It.a)(this,t),(n=Object(Rt.a)(this,Object(Vt.a)(t).call(this))).max=e,n}return Object(Tt.a)(t,e),Object(At.a)(t,[{key:"check",value:function(e,n){Object(qt.a)(Object(Vt.a)(t.prototype),"check",this).call(this,e,n),Number(n)>this.max&&e.push("\u4e0d\u80fd\u5c0f\u4e8e"+this.max)}}]),t}(Vn),Mn=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},Un=function(e){function t(e,n,r,i){var a;return Object(It.a)(this,t),(a=Object(Rt.a)(this,Object(Vt.a)(t).call(this))).form=e,a.field=n,a.name=n.name,a.fieldUI=r||{},a.fieldRes=i||{},a.init(),a}return Object(Tt.a)(t,e),Object(At.a)(t,[{key:"init",value:function(){this.buildRules()}},{key:"buildRules",value:function(){this.rules=[],(!0===this.fieldUI.required||void 0!==this.field&&!1===this.field.null)&&this.rules.push(new Rn)}},{key:"setValue",value:function(e){this.form.values[this.name]=e}},{key:"parse",value:function(e){return e}},{key:"checkRules",get:function(){var e=[],t=!0,n=!1,r=void 0;try{for(var i,a=this.rules[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){i.value.check(e,this.value)}}catch(o){n=!0,r=o}finally{try{t||null==a.return||a.return()}finally{if(n)throw r}}return e}},{key:"isOk",get:function(){return 0===this.rules.length||0===this.checkRules.length}},{key:"value",get:function(){return this.form.values[this.name]}},{key:"error",get:function(){return this.form.errors[this.name]},set:function(e){this.form.errors[this.name]=e}},{key:"readonly",get:function(){var e=this.form.mode;return e===Yn.readonly||e===Yn.edit&&!1===this.fieldUI.editable}}]),t}(Cn);Mn([Mt.d],Un.prototype,"checkRules",null),Mn([Mt.d],Un.prototype,"isOk",null),Mn([Mt.d],Un.prototype,"value",null);var Ln=function(e){function t(){var e;return Object(It.a)(this,t),(e=Object(Rt.a)(this,Object(Vt.a)(t).apply(this,arguments))).renderError=function(t){var n=e.form.errors[e.name];if(void 0!==n)return Ft.createElement("div",{className:t},Ft.createElement(nt,{name:"exclamation-circle"})," ",n)},e.ref=function(t){e.input=t,e.setInputValue()},e.onFocus=function(){e.error=void 0},e.onBlur=function(){var t=e.checkRules;t.length>0&&(e.error=t[0]),e.form.computeFields()},e.onChange=function(t){var n=e.parse(t.currentTarget.value);null!==n&&e.setValue(n)},e.view=Object(yn.a)(function(){var t,n,r,i=e.fieldUI.required,a=e.fieldRes,o=a.placeHolder,s=a.suffix,c=["form-control","form-control-input"];return!0===e.readonly?n=Ft.createElement("input",{className:pn()(c,"bg-light"),ref:e.ref,type:e.inputType,readOnly:!0}):(n=Ft.createElement("input",{className:pn()(c),ref:e.ref,type:e.inputType,onFocus:e.onFocus,onBlur:e.onBlur,onChange:e.onChange,placeholder:o,readOnly:!1,maxLength:e.maxLength,onKeyPress:e.onKeyPress}),!0!==i&&!1!==e.field.null||(t=Ft.createElement(Bn,null))),r=void 0===s?n:Ft.createElement("div",{className:"input-group"},n,Ft.createElement("div",{className:"input-group-append"},Ft.createElement("span",{className:"input-group-text"},s))),Ft.createElement(Ft.Fragment,null,t,r,e.renderError("text-danger small mt-1 mx-2"))}),e}return Object(Tt.a)(t,e),Object(At.a)(t,[{key:"setValue",value:function(e){Object(qt.a)(Object(Vt.a)(t.prototype),"setValue",this).call(this,e),this.setInputValue()}},{key:"setInputValue",value:function(){if(this.input){var e=this.value;this.input.value=null===e||void 0===e?"":e}}},{key:"maxLength",get:function(){}}]),t}(Un),Bn=function(){return Ft.createElement("b",{style:{color:"red",position:"absolute",left:"0.1em",top:"0.5em"}},"*")},$n=function(e){function t(){var e;return Object(It.a)(this,t),(e=Object(Rt.a)(this,Object(Vt.a)(t).apply(this,arguments))).inputType="text",e}return Object(Tt.a)(t,e),Object(At.a)(t,[{key:"maxLength",get:function(){return this.field.size}}]),t}(Ln),Hn=45,Wn=46,zn=function(e){function t(){var e;return Object(It.a)(this,t),(e=Object(Rt.a)(this,Object(Vt.a)(t).apply(this,arguments))).inputType="number",e.onKeyPress=function(t){var n=t.charCode;if(!(8===n||0===n||13===n||n>=48&&n<=57))if(void 0!==e.extraChars&&e.extraChars.indexOf(n)>=0)switch(n){case Wn:e.onKeyDot();break;case Hn:e.onKeyNeg(),t.preventDefault()}else t.preventDefault()},e}return Object(Tt.a)(t,e),Object(At.a)(t,[{key:"init",value:function(){if(Object(qt.a)(Object(Vt.a)(t.prototype),"init",this).call(this),this.extraChars=[],void 0!==this.fieldUI){var e=this.fieldUI,n=e.min;e.max;void 0!==n?n<0&&this.extraChars.push(Hn):this.extraChars.push(Hn)}switch(this.field.type){case"dec":case"bigint":case"int":case"smallint":case"tinyint":this.extraChars.push(Wn)}}},{key:"buildRules",value:function(){Object(qt.a)(Object(Vt.a)(t.prototype),"buildRules",this).call(this),this.rules.push(new Vn);var e=this.fieldUI,n=e.min,r=e.max;void 0!==n&&this.rules.push(new Dn(n)),void 0!==r&&this.rules.push(new qn(r))}},{key:"parse",value:function(e){try{if(0===e.trim().length)return;var t=Number(e);return NaN===t?null:t}catch(n){return null}}},{key:"setInputValue",value:function(){if(this.input){var e=this.value;this.parse(this.input.value)!=e&&(this.input.value=null===e||void 0===e?"":e)}}},{key:"onKeyDot",value:function(){var e=this.input.value;e.indexOf(".")>=0&&(this.input.value=e.replace(".",""))}},{key:"onKeyNeg",value:function(){var e=this.input.value,t=e.indexOf("-");e=t>=0?e.replace("-",""):"-"+e,this.input.value=e}}]),t}(Ln),Kn=function(e){function t(){return Object(It.a)(this,t),Object(Rt.a)(this,Object(Vt.a)(t).apply(this,arguments))}return Object(Tt.a)(t,e),Object(At.a)(t,[{key:"buildRules",value:function(){Object(qt.a)(Object(Vt.a)(t.prototype),"buildRules",this).call(this),this.rules.push(new Tn)}}]),t}(zn),Qn=function(e){function t(){return Object(It.a)(this,t),Object(Rt.a)(this,Object(Vt.a)(t).apply(this,arguments))}return Object(Tt.a)(t,e),t}(zn),Jn=function(e){function t(){return Object(It.a)(this,t),Object(Rt.a)(this,Object(Vt.a)(t).apply(this,arguments))}return Object(Tt.a)(t,e),t}($n),Gn=function(e){function t(){return Object(It.a)(this,t),Object(Rt.a)(this,Object(Vt.a)(t).apply(this,arguments))}return Object(Tt.a)(t,e),t}($n);var Yn,Xn=function(e){function t(e,n,r){var i;return Object(It.a)(this,t),(i=Object(Rt.a)(this,Object(Vt.a)(t).call(this,e,n,void 0,r))).view=Object(yn.a)(function(){var e=i.form.values[i.field.name],t=i.fieldRes,n=t.placeHolder,r=t.suffix;null===e&&(e="");var a=_t.a.createElement("input",{className:"form-control form-control-input bg-light",type:"text",placeholder:n,readOnly:!0,value:e});return void 0===r?a:_t.a.createElement("div",{className:"input-group"},a,_t.a.createElement("div",{className:"input-group-append"},_t.a.createElement("span",{className:"input-group-text"},r)))}),i}return Object(Tt.a)(t,e),t}(Un),Zn=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},er=function(e){function t(e,n,r){var i;Object(It.a)(this,t),(i=Object(Rt.a)(this,Object(Vt.a)(t).call(this))).rowPage=function(){return Ft.createElement(s.e,{header:i.label,back:"close"},i.vForm.render("py-3"))},i.onSubmit=function(){return Zn(Object(Dt.a)(Object(Dt.a)(i)),void 0,void 0,Pt.a.mark(function e(){var t;return Pt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.vForm.valueBoxs,e.next=3,this.onRowChanged(t);case 3:case"end":return e.stop()}},e,this)}))},i.onRowChanged=function(e){return Zn(Object(Dt.a)(Object(Dt.a)(i)),void 0,void 0,Pt.a.mark(function t(){return Pt.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(void 0!==this.rowValues){t.next=11;break}if(e.$owner=this.ownerForm.values,this.list.push(e),void 0!==this.onEditRow){t.next=7;break}this.vForm.reset(),t.next=9;break;case 7:return t.next=9,this.onEditRow(void 0,this.onRowChanged);case 9:t.next=13;break;case 11:Lt.a.merge(this.rowValues,e),void 0===this.onEditRow&&s.o.pop();case 13:case"end":return t.stop()}},t,this)}))},i.renderItem=function(e,t){return void 0===i.rowContent?Ft.createElement("div",{className:"px-3 py-2"},Ft.createElement(Nn,Object.assign({},e))):Ft.createElement(i.rowContent,Object.assign({},e))},i.showRow=function(e){return Zn(Object(Dt.a)(Object(Dt.a)(i)),void 0,void 0,Pt.a.mark(function t(){return Pt.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(void 0===this.onEditRow){t.next=4;break}return t.next=3,this.onEditRow(e,this.onRowChanged);case 3:return t.abrupt("return");case 4:this.vForm.reset(),void 0!==e&&this.vForm.setValues(e),s.o.push(Ft.createElement(this.rowPage,null));case 7:case"end":return t.stop()}},t,this)}))},i.editRow=function(e){return Zn(Object(Dt.a)(Object(Dt.a)(i)),void 0,void 0,Pt.a.mark(function t(){var n;return Pt.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.rowValues=e,void 0!==(n=this.vForm.vSubmit)&&(n.caption=this.editSubmitCaption,n.className="btn btn-outline-success"),this.vForm.mode=this.ownerForm.mode,t.next=6,this.showRow(e);case 6:case"end":return t.stop()}},t,this)}))},i.internalAddRow=function(){return Zn(Object(Dt.a)(Object(Dt.a)(i)),void 0,void 0,Pt.a.mark(function e(){var t;return Pt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.rowValues=void 0,(t=this.vForm.vSubmit).caption=this.newSubmitCaption,t.className="btn btn-outline-success",this.vForm.reset(),this.vForm.mode=Yn.new,e.next=8,this.showRow(void 0);case 8:case"end":return e.stop()}},e,this)}))},i.view=function(){var e;void 0===i.addRow&&i.mode===Yn.readonly||(e=Ft.createElement("button",{onClick:i.addRow||i.internalAddRow,type:"button",className:"btn btn-link p-0"},i.ownerForm.arrTitleNewButton));var t=i.header||Ft.createElement("div",{className:"px-3 bg-light small",style:{paddingTop:"1px",paddingBottom:"1px"}},Ft.createElement("div",{className:"flex-fill align-self-center"},i.label),e);return Ft.createElement(_e,{className:"pb-3",header:t,none:Ft.createElement(at,{className:"px-3 py-2"},i.none),items:i.list,item:{render:i.renderItem,onClick:i.editRow}})},i.ownerForm=e;var a=n.name,o=n.fields;i.name=a;var c=e.ui,u=e.res,l=e.mode,h=e.inputs,d=e.values,f=u.arrs,p=void 0!==f?f[a]:{},v=p.label,m=p.none,y=p.newSubmit,b=p.editSubmit;i.none=m||e.none,i.newSubmitCaption=y||e.arrNewCaption,i.editSubmitCaption=b||e.arrEditCaption,i.label=v||a;var w=c&&c.items[a]||{};return i.rowContent=w.rowContent,i.mode=l,void 0===i.onEditRow?i.vForm=new sr({fields:o,arrs:void 0,ui:w,res:p,inputs:h[a],none:e.none,submitCaption:"submit",arrNewCaption:void 0,arrEditCaption:void 0,arrTitleNewButton:void 0,mode:l},l===Yn.readonly?void 0:i.onSubmit):i.onEditRow=r,i.list=d[a],i}return Object(Tt.a)(t,e),Object(At.a)(t,[{key:"reset",value:function(){this.vForm.reset(),this.list.clear()}},{key:"setAddRow",value:function(e){this.addRow=e}}]),t}(Cn),tr=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},nr={textAlign:"left",paddingLeft:"0.75rem",paddingRight:"0.75rem",overflow:"hidden"},rr=function(e){function t(e,n,r,i){var a;return Object(It.a)(this,t),(a=Object(Rt.a)(this,Object(Vt.a)(t).call(this,e,n,r,i))).onClick=function(){return tr(Object(Dt.a)(Object(Dt.a)(a)),void 0,void 0,Pt.a.mark(function e(){var t;return Pt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!0!==this.readonly){e.next=6;break}if(this.value){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,this.tuid.showInfo(this.value.id);case 5:return e.abrupt("return");case 6:if(void 0===this.input){e.next=12;break}return e.next=9,this.input.select(this.vForm,this.field,this.vForm.getValues());case 9:t=e.sent,e.next=14;break;case 12:alert("call undefined"),t=0;case 14:this.setValue(this.tuid.boxId(t));case 15:case"end":return e.stop()}},e,this)}))},a.view=Object(yn.a)(function(){var e,t,n=a.fieldRes.placeHolder,r=!1,i=a.field._ownerField;if(void 0!==i){var o=i.name;i.arr;r=null===a.vForm.getValue(o)}if(null===a.value)e=Ft.createElement(Ft.Fragment,null,n||a.input.placeHolder);else if("object"===typeof a.value)e=En(a.value);else{var s=a.tuid.boxId(a.value);e=En(s)}return!0===a.readonly?Ft.createElement("div",{className:"form-control form-control-plaintext border border-info rounded bg-light cursor-pointer",onClick:a.onClick},e):(!0!==a.fieldUI.required&&!1!==a.field.null||(t=Ft.createElement(Bn,null)),Ft.createElement(Ft.Fragment,null,t,Ft.createElement("button",{className:"form-control btn btn-outline-info",type:"button",disabled:r,style:nr,onClick:a.onClick},e)))}),a.tuid=n._tuid,a.vForm=e,a.input=e.inputs[n.name],a}return Object(Tt.a)(t,e),t}(Un),ir=function(){function e(t,n,r){Object(It.a)(this,e),this.vForm=t,this.onSubmit=r;var i=n.fields,a=n.arrs,o=n.ui,s=n.res;if(this.fields=i,this.arrs=a,void 0!==o){var c=o.items,u=o.layout;this.formItems=c,this.layout=u}this.res=s}return Object(At.a)(e,[{key:"build",value:function(){return void 0===this.layout?this.bandsOnFly():this.bandsFromLayout()}},{key:"resFromName",value:function(e,t){if(void 0!==t){var n=t.fields;if(void 0!==n)return n[e]||e}}},{key:"bandsOnFly",value:function(){var e=[];if(this.bandsFromFields(e,this.fields,this.res),void 0!==this.arrs){var t=!0,n=!1,r=void 0;try{for(var i,a=this.arrs[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var o=i.value;e.push(this.bandFromArr(o))}}catch(s){n=!0,r=s}finally{try{t||null==a.return||a.return()}finally{if(n)throw r}}}return void 0!==this.onSubmit&&e.push(new gn(new In(this.vForm))),e}},{key:"bandsFromFields",value:function(e,t,n){if(void 0!==t){var r=!0,i=!1,a=void 0;try{for(var o,s=t[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){var c=o.value;e.push(this.bandFromField(c,n))}}catch(u){i=!0,a=u}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}}}},{key:"bandsFromLayout",value:function(){return[]}},{key:"bandFromField",value:function(e,t){var n,r,i,a,o=e.name,s=this.resFromName(o,t);return"object"===typeof s?(r=s.label,n=s):(r=s,n=void 0),void 0!==this.formItems&&(a=this.formItems[o]),void 0===(i="function"===typeof a?new Xn(this.vForm,e,n):function(e,t,n,r){var i;switch(t.type){default:return;case"tinyint":case"smallint":case"int":i=Kn;break;case"bigint":if(void 0!==t._tuid)return;i=Kn;break;case"dec":i=Qn;break;case"char":i=$n;break;case"text":i=Jn;break;case"datetime":i=Gn}return new i(e,t,n,r)}(this.vForm,e,a,n))&&(i=new rr(this.vForm,e,a,n)),new wn(r||o,i)}},{key:"bandFromArr",value:function(e){var t=e.name,n=(e.fields,new er(this.vForm,e));return new kn(t,n)}}]),e}(),ar=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},or=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})};!function(e){e[e.new=0]="new",e[e.edit=1]="edit",e[e.readonly=2]="readonly"}(Yn||(Yn={}));var sr=function(){function e(t,n){var r=this;Object(It.a)(this,e),this.vFields={},this.vArrs={},this.onFormSubmit=function(e){return e.preventDefault(),!1},this.view=Object(yn.a)(function(e){var t=e.className;return Ft.createElement("form",{className:t,onSubmit:r.onFormSubmit},r.bands.map(function(e){return e.render()}))});var i=t.fields,a=t.arrs,o=t.ui,s=t.res,c=t.inputs,u=t.none,l=t.submitCaption,h=t.arrNewCaption,d=t.arrEditCaption,f=t.arrTitleNewButton,p=t.mode;this.fields=i,this.arrs=a,this.ui=o,void 0!==this.ui&&(this.formItems=this.ui.items),this.res=s,this.inputs=c,this.none=u,this.submitCaption=l,this.arrNewCaption=h,this.arrEditCaption=d,this.arrTitleNewButton=f||Ft.createElement("small",null,Ft.createElement(nt,{name:"plus"})," \u65b0\u589e"),this.mode=void 0===n?Yn.readonly:p,this.buildFormValues(),this.buildBands(t,n),this.onSubmit=n}return Object(At.a)(e,[{key:"buildBands",value:function(e,t){this.bandColl={};var n=new ir(this,e,t);this.bands=n.build();var r=!0,i=!1,a=void 0;try{for(var o,s=this.bands[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){var c=o.value;this.bandColl[c.key]=c;var u=c.getVFields();if(void 0!==u){var l=!0,h=!1,d=void 0;try{for(var f,p=u[Symbol.iterator]();!(l=(f=p.next()).done);l=!0){var v=f.value;this.vFields[v.name]=v}}catch(b){h=!0,d=b}finally{try{l||null==p.return||p.return()}finally{if(h)throw d}}}var m=c.getVArr();void 0!==m&&(this.vArrs[m.name]=m);var y=c.getVSubmit();void 0!==y&&(this.vSubmit=y)}}catch(b){i=!0,a=b}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}}},{key:"getBand",value:function(e){return this.bandColl[e]}},{key:"computeFields",value:function(){if(void 0!==this.formItems){var e=this.values;for(var t in this.formItems){var n=this.formItems[t];"function"===typeof n&&(e[t]=n.call(e))}}}},{key:"submit",value:function(){return or(this,void 0,void 0,Pt.a.mark(function e(){return Pt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==this.onSubmit){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.onSubmit();case 4:case"end":return e.stop()}},e,this)}))}},{key:"getValues",value:function(){var e={},t=this.values,n=!0,r=!1,i=void 0;try{for(var a,o=this.fields[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=t[p=a.value.name];e[p]=null!==s&&"object"===typeof s?s.id:s}}catch(R){r=!0,i=R}finally{try{n||null==o.return||o.return()}finally{if(r)throw i}}if(void 0!==this.arrs){var c=!0,u=!1,l=void 0;try{for(var h,d=this.arrs[Symbol.iterator]();!(c=(h=d.next()).done);c=!0){var f=h.value,p=f.name,v=f.fields,m=f.id,y=f.order,b=e[p]=[],w=this.vArrs[p].list,k=!0,g=!1,x=void 0;try{for(var O,j=w[Symbol.iterator]();!(k=(O=j.next()).done);k=!0){var E=O.value,C={};void 0!==m&&(C[m]=E[m]),void 0!==y&&(C[y]=E[y]);var S=!0,N=!1,P=void 0;try{for(var F,_=v[Symbol.iterator]();!(S=(F=_.next()).done);S=!0){var I=F.value.name,A=E[I];C[I]=null!==A&&"object"===typeof A?A.id:A}}catch(R){N=!0,P=R}finally{try{S||null==_.return||_.return()}finally{if(N)throw P}}b.push(C)}}catch(R){g=!0,x=R}finally{try{k||null==j.return||j.return()}finally{if(g)throw x}}}}catch(R){u=!0,l=R}finally{try{c||null==d.return||d.return()}finally{if(u)throw l}}}return e}},{key:"setValues",value:function(e){if(void 0!==e){var t=this.values,n=this.errors,r=!0,i=!1,a=void 0;try{for(var o,s=this.fields[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){var c=o.value.name;n[c]=void 0;var u=e[c];t[c]=u}}catch(f){i=!0,a=f}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}for(var l in this.vArrs){var h=e[l];if(void 0!==h){var d=t[l];d.clear(),d.push.apply(d,Object(en.a)(h))}}}else this.reset()}},{key:"reset",value:function(){var e=this.values,t=this.errors,n=!0,r=!1,i=void 0;try{for(var a,o=this.fields[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value.name;e[s]=null,t[s]=void 0}}catch(h){r=!0,i=h}finally{try{n||null==o.return||o.return()}finally{if(r)throw i}}for(var c in this.vFields){var u=this.vFields[c];void 0!==u.name&&u.setValue(null)}for(var l in this.vArrs){this.vArrs[l].reset()}}},{key:"getValue",value:function(e){return this.values[e]}},{key:"setValue",value:function(e,t){this.values[e]=t}},{key:"setError",value:function(e,t){this.errors[e]=t}},{key:"buildFieldValues",value:function(e){var t={valueFromFieldName:function(e){return this[e]}},n=!0,r=!1,i=void 0;try{for(var a,o=e[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){t[a.value.name]=null}}catch(s){r=!0,i=s}finally{try{n||null==o.return||o.return()}finally{if(r)throw i}}return t}},{key:"buildObservableValues",value:function(){var e=this.buildFieldValues(this.fields);if(void 0!==this.arrs){var t=!0,n=!1,r=void 0;try{for(var i,a=this.arrs[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){e[i.value.name]=Mt.k.array([],{deep:!0})}}catch(o){n=!0,r=o}finally{try{t||null==a.return||a.return()}finally{if(n)throw r}}}return Object(Mt.k)(e)}},{key:"buildFormValues",value:function(){this.values=this.buildObservableValues(),this.errors=Object(Mt.k)(this.buildFieldValues(this.fields))}},{key:"render",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"py-3";return Ft.createElement(this.view,{className:e})}},{key:"valueBoxs",get:function(){var e={},t=this.values,n=!0,r=!1,i=void 0;try{for(var a,o=this.fields[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value,c=s.name,u=s._tuid,l=t[c];e[c]=void 0===u||"object"===typeof l?l:u.boxId(l)}}catch(A){r=!0,i=A}finally{try{n||null==o.return||o.return()}finally{if(r)throw i}}if(void 0===this.arrs)return e;var h=!0,d=!1,f=void 0;try{for(var p,v=this.arrs[Symbol.iterator]();!(h=(p=v.next()).done);h=!0){var m=p.value,y=(c=m.name,m.fields),b=(m.id,m.order,e[c]=this.vArrs[c].list.slice()),w=!0,k=!1,g=void 0;try{for(var x,O=b[Symbol.iterator]();!(w=(x=O.next()).done);w=!0){var j=x.value,E=!0,C=!1,S=void 0;try{for(var N,P=y[Symbol.iterator]();!(E=(N=P.next()).done);E=!0){var F=N.value,_=F.name,I=(u=F._tuid,j[_]);j[_]=void 0===u||"object"===typeof I?I:u.boxId(I)}}catch(A){C=!0,S=A}finally{try{E||null==P.return||P.return()}finally{if(C)throw S}}}}catch(A){k=!0,g=A}finally{try{w||null==O.return||O.return()}finally{if(k)throw g}}}}catch(A){d=!0,f=A}finally{try{h||null==v.return||v.return()}finally{if(d)throw f}}return e}},{key:"isOk",get:function(){for(var e in this.vFields)if(!1===this.vFields[e].isOk)return!1;return!0}}]),e}();function cr(e,t){return _t.a.createElement(nt,{className:e,name:t,fixWidth:!0})}ar([Mt.d],sr.prototype,"isOk",null);var ur={tuid:cr("text-info","list-alt"),action:cr("text-info","hand-o-right"),map:cr("text-muted","list-ul"),book:cr("text-muted","book"),query:cr("text-warning","search"),history:cr("text-info","hand-o-right"),pending:cr("text-info","forward"),sheet:cr("text-primary","wpforms")},lr=function(e){function t(e,n){var r;return Object(It.a)(this,t),(r=Object(Rt.a)(this,Object(Vt.a)(t).call(this,n))).cUq=e,r}return Object(Tt.a)(t,e),t}(s.c),hr=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},dr=function(e){function t(e,n,r,i){var a;Object(It.a)(this,t),a=Object(Rt.a)(this,Object(Vt.a)(t).call(this,e,i)),Object.setPrototypeOf(a.x,e.x);var o=n.name,s=n.typeName;return a.entity=n,a.ui=r,a.label=a.res.label||o,a.icon=ur[s],a}return Object(Tt.a)(t,e),Object(At.a)(t,[{key:"beforeStart",value:function(){return hr(this,void 0,void 0,Pt.a.mark(function e(){return Pt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.entity.loadSchema();case 2:return e.abrupt("return",!0);case 3:case"end":return e.stop()}},e,this)}))}},{key:"createForm",value:function(e,t,n){var r=this.buildFormOptions(n),i=new sr(r,e);return i.setValues(t),i}},{key:"buildFormOptions",value:function(e){var t,n,r,i,a,o=this.entity,s=o.fields,c=o.arrFields;void 0!==this.res&&(t=this.res.none,n=this.res.submit,r=this.res.arrNew,i=this.res.arrEdit,a=this.res.arrTitleNewButton),void 0===t&&(t=this.cUq.res.none||"none"),void 0===n&&(n=this.cUq.res.submit||"Submit"),void 0===r&&(r=this.cUq.res.arrNew||"New"),void 0===i&&(i=this.cUq.res.arrEdit||"Edit"),void 0===a&&(a=this.cUq.res.arrTitleNewButton),void 0===e&&(e=Yn.new);var u=this.ui.form;return{fields:s,arrs:c,ui:u,res:this.res||{},inputs:this.buildInputs(u),none:t,submitCaption:n,arrNewCaption:r,arrEditCaption:i,arrTitleNewButton:a,mode:e}}},{key:"buildInputs",value:function(e){var t=this.entity,n=t.fields,r=t.arrFields,i={};if(this.buildFieldsInputs(i,n,void 0,e),void 0!==r){var a=!0,o=!1,s=void 0;try{for(var c,u=r[Symbol.iterator]();!(a=(c=u.next()).done);a=!0){var l=c.value,h=l.name,d=l.fields,f=e&&e.items;this.buildFieldsInputs(i,d,h,f&&f[h])}}catch(p){o=!0,s=p}finally{try{a||null==u.return||u.return()}finally{if(o)throw s}}}return i}},{key:"buildFieldsInputs",value:function(e,t,n,r){if(void 0!==n){var i=e[n];void 0===i&&(e[n]=i={},e=i)}var a=!0,o=!1,s=void 0;try{for(var c,u=t[Symbol.iterator]();!(a=(c=u.next()).done);a=!0){var l=c.value,h=l.name,d=l._tuid;if(void 0!==d){var f=r&&r.items&&r.items[h];e[h]={select:this.buildSelect(l,n,f),content:this.buildContent(l,n),placeHolder:this.cUq.getTuidPlaceHolder(d)}}}}catch(p){o=!0,s=p}finally{try{a||null==u.return||u.return()}finally{if(o)throw s}}}},{key:"buildSelect",value:function(e,t,n){var r=this;return function(e,t,i){return hr(r,void 0,void 0,Pt.a.mark(function r(){var i,a,o,s,c,u;return Pt.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return i=t._tuid,a=t._ownerField,r.next=3,i.cSelectFrom();case 3:return o=r.sent,s=void 0,void 0!==a&&(s=e.getValue(a.name)),n&&!0===n.autoList&&(console.log("select search set param=empty string"),s=""),r.next=9,o.call(s);case 9:if(c=r.sent,o.removeCeased(),void 0!==c){r.next=13;break}return r.abrupt("return",void 0);case 13:return u=o.idFromItem(c),i.useId(u),r.abrupt("return",u);case 16:case"end":return r.stop()}},r,this)}))}}},{key:"buildContent",value:function(e,t){}},{key:"cQuerySelect",value:function(e){return this.cUq.cQuerySelect(e)}}]),t}(lr),fr=function(e){function t(e){var n;return Object(It.a)(this,t),(n=Object(Rt.a)(this,Object(Vt.a)(t).call(this,e))).entity=e.entity,n.ui=e.ui,n}return Object(Tt.a)(t,e),Object(At.a)(t,[{key:"createForm",value:function(e,t,n){return this.controller.createForm(e,t,n)}},{key:"label",get:function(){return this.controller.label}}]),t}(s.i),pr=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},vr=function(e){function t(){var e;return Object(It.a)(this,t),(e=Object(Rt.a)(this,Object(Vt.a)(t).apply(this,arguments))).view=function(){return Ft.createElement(s.e,{header:e.label},"Book")},e}return Object(Tt.a)(t,e),Object(At.a)(t,[{key:"showEntry",value:function(e){return pr(this,void 0,void 0,Pt.a.mark(function e(){return Pt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.openPage(this.view);case 1:case"end":return e.stop()}},e,this)}))}}]),t}(fr),mr=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},yr=function(e){function t(){return Object(It.a)(this,t),Object(Rt.a)(this,Object(Vt.a)(t).apply(this,arguments))}return Object(Tt.a)(t,e),Object(At.a)(t,[{key:"internalStart",value:function(){return mr(this,void 0,void 0,Pt.a.mark(function e(){return Pt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.showVPage(this.VBookMain);case 2:case"end":return e.stop()}},e,this)}))}},{key:"VBookMain",get:function(){return vr}}]),t}(dr),br=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},wr=function(e){function t(){var e;return Object(It.a)(this,t),(e=Object(Rt.a)(this,Object(Vt.a)(t).apply(this,arguments))).newClick=function(){return e.event("new")},e.schemaClick=function(){return e.event("schema")},e.archivesClick=function(){return e.event("archives")},e.sheetStateClick=function(t){return e.event("state",t)},e.renderState=function(t,n){var r=t.state,i=t.count;if(0===i)return null;var a=Ft.createElement("span",{className:"badge badge-success ml-5 align-self-end"},i);return Ft.createElement(et,{className:"px-3 py-2",left:e.controller.getStateLabel(r),right:a})},e.view=Object(yn.a)(function(){var t,n=e.controller.statesCount.filter(function(e){return e.count}),r=Ft.createElement("button",{className:"btn btn-outline-primary",onClick:e.archivesClick},"\u5df2\u5f52\u6863");return!0===e.isDev&&(t=Ft.createElement("button",{className:"btn btn-primary mr-2",color:"primary",onClick:e.schemaClick},"\u6a21\u677f")),Ft.createElement(s.e,{header:e.label},Ft.createElement(et,{className:"mx-3 my-2",right:r},Ft.createElement("button",{className:"btn btn-primary mr-2",color:"primary",onClick:e.newClick},"\u65b0\u5efa"),t),Ft.createElement(_e,{className:"my-2",header:Ft.createElement(at,{className:"mx-3 my-1"},"\u5f85\u5904\u7406",e.label),none:"[ \u65e0 ]",items:n,item:{render:e.renderState,onClick:e.sheetStateClick}}))}),e}return Object(Tt.a)(t,e),Object(At.a)(t,[{key:"showEntry",value:function(){return br(this,void 0,void 0,Pt.a.mark(function e(){return Pt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.openPage(this.view);case 1:case"end":return e.stop()}},e,this)}))}}]),t}(fr),kr=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},gr=function(e){function t(){var e;return Object(It.a)(this,t),(e=Object(Rt.a)(this,Object(Vt.a)(t).apply(this,arguments))).onSubmit=function(){return kr(Object(Dt.a)(Object(Dt.a)(e)),void 0,void 0,Pt.a.mark(function e(){var t,n;return Pt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.vForm.getValues(),n=this.vForm.values,e.next=4,this.controller.onSave(t,n);case 4:case"end":return e.stop()}},e,this)}))},e.view=function(){return Ft.createElement(s.e,{header:e.label},e.vForm.render())},e}return Object(Tt.a)(t,e),Object(At.a)(t,[{key:"showEntry",value:function(e){return kr(this,void 0,void 0,Pt.a.mark(function t(){return Pt.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:this.vForm=this.createForm(this.onSubmit,e),this.openPage(this.view);case 2:case"end":return t.stop()}},t,this)}))}}]),t}(fr),xr={width:"8rem"},Or=function(e){function t(){var e;return Object(It.a)(this,t),(e=Object(Rt.a)(this,Object(Vt.a)(t).apply(this,arguments))).flowRow=function(e,t){var n,r=e.date,i=(e.user,e.preState,e.state),a=e.action;switch(void 0===a&&(a=Ft.createElement(Ft.Fragment,null,Ft.createElement(nt,{className:"text-primary",name:"pencil-square-o"})," \u5236\u5355")),i){case"$":break;case"#":n=Ft.createElement(Ft.Fragment,null,Ft.createElement(nt,{className:"text-success",name:"file-archive-o"}));break;default:n=Ft.createElement(Ft.Fragment,null,Ft.createElement(nt,{className:"text-muted",name:"arrow-right"})," \xa0 ",i)}return Ft.createElement(et,{left:Ft.createElement("div",{className:"pl-3 py-2",style:xr},a),right:Ft.createElement("div",{className:"p-2"},Ft.createElement(at,null,Ft.createElement(Ve,{date:r})))},Ft.createElement("div",{className:"p-2"},n))},e.sheetView=function(){var t,n=e.sheetData,r=n.brief,i=n.flows;return"-"===r.state&&(t=Ft.createElement("div",{className:"mx-3 my-2",style:{color:"red"}},"\u672c\u5355\u636e\u4f5c\u5e9f")),Ft.createElement("div",null,t,e.vForm.render(),Ft.createElement(_e,{header:Ft.createElement(at,{className:"mx-3 my-1"},"\u6d41\u7a0b"),items:i,item:{render:e.flowRow}}))},e}return Object(Tt.a)(t,e),t}(fr),jr=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},Er=function(e){function t(){var e;return Object(It.a)(this,t),(e=Object(Rt.a)(this,Object(Vt.a)(t).apply(this,arguments))).onSubmit=function(){return jr(Object(Dt.a)(Object(Dt.a)(e)),void 0,void 0,Pt.a.mark(function e(){var t;return Pt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.vForm.getValues(),e.next=3,this.controller.saveSheet(t,this.vForm.values);case 3:this.closePage(),this.returnCall(this.vForm.values);case 5:case"end":return e.stop()}},e,this)}))},e.view=function(){return Ft.createElement(s.e,{header:e.label},e.vForm.render())},e}return Object(Tt.a)(t,e),Object(At.a)(t,[{key:"showEntry",value:function(e){return jr(this,void 0,void 0,Pt.a.mark(function t(){return Pt.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:this.sheetData=e,this.vForm=this.createForm(this.onSubmit,e.data,Yn.edit),this.openPage(this.view);case 3:case"end":return t.stop()}},t,this)}))}}]),t}(Or),Cr=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},Sr=function(e){function t(){var e;return Object(It.a)(this,t),(e=Object(Rt.a)(this,Object(Vt.a)(t).apply(this,arguments))).actionClick=function(t){return Cr(Object(Dt.a)(Object(Dt.a)(e)),void 0,void 0,Pt.a.mark(function e(){var n,r,i,a;return Pt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.sheetData.brief,r=n.id,i=n.flow,a=n.state,e.next=3,this.controller.action(r,i,a,t.name);case 3:e.sent,this.ceasePage(),this.openPage(this.acted);case 6:case"end":return e.stop()}},e,this)}))},e.deleteClick=function(){return Cr(Object(Dt.a)(Object(Dt.a)(e)),void 0,void 0,Pt.a.mark(function e(){return Pt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:alert("\u5355\u636e\u4f5c\u5e9f\uff1a\u7a0b\u5e8f\u6b63\u5728\u8bbe\u8ba1\u4e2d");case 1:case"end":return e.stop()}},e,this)}))},e.editClick=function(){return Cr(Object(Dt.a)(Object(Dt.a)(e)),void 0,void 0,Pt.a.mark(function e(){var t;return Pt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.controller.editSheet(this.sheetData);case 2:t=e.sent,this.vForm.setValues(t);case 4:case"end":return e.stop()}},e,this)}))},e.page=function(){var t,n,r=e.sheetData.brief,i=r.state,a=r.no,o=e.controller.getStateLabel(i),c=e.entity.states.find(function(e){return e.name===i});if(void 0===c){var u,l;switch(i){default:u="\u4e0d\u8ba4\u8bc6\u7684\u5355\u636e\u72b6\u6001'"+i+"'",l="text-info";break;case"-":u="\u5df2\u4f5c\u5e9f",l="text-danger";break;case"#":u="\u5df2\u5f52\u6863",l="text-success"}t=_t.a.createElement("div",{className:pn()(l)},"[",u,"]")}else t=_t.a.createElement("div",{className:"flex-grow-1"},c.actions.map(function(t,n){return _t.a.createElement("button",{key:n,className:"btn btn-primary mr-2",onClick:function(){return e.actionClick(t)}},e.controller.getActionLabel(i,t.name))})),"$"===i&&(n=_t.a.createElement("div",null,_t.a.createElement("button",{className:"btn btn-outline-info ml-2",onClick:e.editClick},"\u4fee\u6539"),_t.a.createElement("button",{className:"btn btn-outline-danger ml-2",onClick:e.deleteClick},"\u4f5c\u5e9f")));return _t.a.createElement(s.e,{header:e.label+":"+o+"-"+a},_t.a.createElement("div",{className:"mb-2"},_t.a.createElement("div",{className:"d-flex px-3 py-2 border-bottom bg-light"},t,n),_t.a.createElement(e.sheetView,null)))},e.acted=function(){var t=e.sheetData.brief.discription;return _t.a.createElement(s.e,{header:"\u5df2\u5904\u7406",back:"close"},_t.a.createElement("div",{className:"p-3 d-flex flex-column align-items-center"},_t.a.createElement("div",{className:"p-3"},t),_t.a.createElement("div",{className:"text-success"},_t.a.createElement(nt,{name:"check-circle-o"})," \u5355\u636e\u5df2\u5904\u7406\uff01"),_t.a.createElement("div",{className:"p-3"},_t.a.createElement("button",{className:"btn btn-outline-info",onClick:function(){return e.backPage()}},"\u8fd4\u56de"))))},e}return Object(Tt.a)(t,e),Object(At.a)(t,[{key:"showEntry",value:function(e){return Cr(this,void 0,void 0,Pt.a.mark(function t(){return Pt.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:this.sheetData=e,this.vForm=this.createForm(void 0,e.data),this.openPage(this.page);case 3:case"end":return t.stop()}},t,this)}))}}]),t}(Or),Nr=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},Pr=function(e){function t(){var e;return Object(It.a)(this,t),(e=Object(Rt.a)(this,Object(Vt.a)(t).apply(this,arguments))).view=function(){return Ft.createElement(s.e,{header:e.label+"\u6a21\u677f"},Ft.createElement("pre",{className:"mx-3 my-2"},e.entity.schemaStringify()))},e}return Object(Tt.a)(t,e),Object(At.a)(t,[{key:"showEntry",value:function(e){return Nr(this,void 0,void 0,Pt.a.mark(function e(){return Pt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.openPage(this.view);case 1:case"end":return e.stop()}},e,this)}))}}]),t}(fr),Fr=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},_r=function(e){function t(){var e;return Object(It.a)(this,t),(e=Object(Rt.a)(this,Object(Vt.a)(t).apply(this,arguments))).archiveClick=function(t){return Fr(Object(Dt.a)(Object(Dt.a)(e)),void 0,void 0,Pt.a.mark(function e(){return Pt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(1!==t.processing){e.next=2;break}return e.abrupt("return");case 2:this.event("archived",t);case 3:case"end":return e.stop()}},e,this)}))},e.archiveRow=function(e,t){e.id,e.no,e.discription;var n=e.date,r=Ft.createElement(Ft.Fragment,null,1===e.processing?"... ":"",e.no," \xa0 ",e.discription),i=Ft.createElement(at,null,Ft.createElement(Ve,{date:n}));return Ft.createElement(et,{className:"px-3 py-2",left:r,right:i})},e.view=function(){return Ft.createElement(s.e,{header:"\u5df2\u5f52\u6863"+e.label},Ft.createElement(_e,{items:e.list,item:{render:e.archiveRow,onClick:e.archiveClick}}))},e}return Object(Tt.a)(t,e),Object(At.a)(t,[{key:"showEntry",value:function(){return Fr(this,void 0,void 0,Pt.a.mark(function e(){return Pt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.entity.getArchives(void 0,10);case 2:this.list=e.sent,this.openPage(this.view);case 4:case"end":return e.stop()}},e,this)}))}}]),t}(fr),Ir=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},Ar=function(e){function t(){var e;return Object(It.a)(this,t),(e=Object(Rt.a)(this,Object(Vt.a)(t).apply(this,arguments))).rowClick=function(t){return Ir(Object(Dt.a)(Object(Dt.a)(e)),void 0,void 0,Pt.a.mark(function e(){return Pt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(1!==t.processing){e.next=3;break}return this.event("processing",t.id),e.abrupt("return");case 3:this.event("action",t.id);case 4:case"end":return e.stop()}},e,this)}))},e.onScrollBottom=function(){console.log("onScrollBottom"),e.controller.pageStateItems.more()},e.rowContent=function(e){e.id;var t=e.no,n=e.discription,r=e.date,i=e.processing,a=Ft.createElement(Ft.Fragment,null,t," \xa0 ",Ft.createElement(at,null,n)," ",1===i?"...":""),o=Ft.createElement(at,null,Ft.createElement(Ve,{date:r}));return Ft.createElement(et,{className:"px-3 py-2",left:a,right:o})},e.renderRow=function(t,n){return Ft.createElement(e.row,Object.assign({},t))},e.view=function(){var t=e.controller.pageStateItems;return Ft.createElement(s.e,{header:e.label+" - "+e.stateLabel,onScrollBottom:e.onScrollBottom},Ft.createElement(_e,{items:t,item:{render:e.renderRow,onClick:e.rowClick}}))},e}return Object(Tt.a)(t,e),Object(At.a)(t,[{key:"showEntry",value:function(e){return Ir(this,void 0,void 0,Pt.a.mark(function t(){return Pt.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.row=this.ui.listRow||this.rowContent,this.stateName=e.state,this.stateLabel=this.controller.getStateLabel(this.stateName),t.next=5,this.controller.pageStateItems.first(this.stateName);case 5:this.openPage(this.view);case 6:case"end":return t.stop()}},t,this)}))}}]),t}(fr),Rr=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},Vr=function(e){function t(){var e;return Object(It.a)(this,t),(e=Object(Rt.a)(this,Object(Vt.a)(t).apply(this,arguments))).view=function(){var t=e.sheetData.brief;return Ft.createElement(s.e,{header:e.label+":-"+t.no},Ft.createElement(e.sheetView,null))},e}return Object(Tt.a)(t,e),Object(At.a)(t,[{key:"showEntry",value:function(e){return Rr(this,void 0,void 0,Pt.a.mark(function t(){return Pt.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:this.sheetData=e,this.vForm=this.createForm(void 0,this.sheetData.data),this.openPage(this.view);case 3:case"end":return t.stop()}},t,this)}))}}]),t}(Or),Tr=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},Dr=function(e){function t(){var e;return Object(It.a)(this,t),(e=Object(Rt.a)(this,Object(Vt.a)(t).apply(this,arguments))).restart=function(){return Tr(Object(Dt.a)(Object(Dt.a)(e)),void 0,void 0,Pt.a.mark(function e(){return Pt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.ceasePage(),e.next=3,this.event("new");case 3:case"end":return e.stop()}},e,this)}))},e.actionClick=function(t){return Tr(Object(Dt.a)(Object(Dt.a)(e)),void 0,void 0,Pt.a.mark(function e(){var n,r,i,a;return Pt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.ceasePage(),n=this.brief,r=n.id,i=n.flow,a=n.state,e.next=4,this.controller.action(r,i,a,t.name);case 4:e.sent,this.openPage(this.acted);case 6:case"end":return e.stop()}},e,this)}))},e.buttons=Ft.createElement(Ft.Fragment,null,Ft.createElement("button",{className:"btn btn-outline-primary mr-3",onClick:e.restart},"\u7ee7\u7eed\u5f00\u5355"),Ft.createElement("button",{className:"btn btn-outline-info",onClick:function(){return e.backPage()}},"\u8fd4\u56de")),e.view=function(){var t=e.entity.states,n=t.find(function(e){return"$"===e.name}),r=Ft.createElement(Ft.Fragment,null,n.actions.map(function(t,n){return Ft.createElement("button",{key:n,className:"btn btn-primary mr-3",onClick:function(){return e.actionClick(t)}},e.controller.getActionLabel("$",t.name))}));return Ft.createElement(s.e,{header:"\u5df2\u4fdd\u5b58",back:"close"},Ft.createElement("div",{className:"p-3 d-flex flex-column align-items-center"},Ft.createElement("div",{className:"text-success"},Ft.createElement(nt,{name:"check-circle-o"})," \u5355\u636e\u5df2\u4fdd\u5b58\uff01\u7cfb\u7edf\u5c1a\u672a\u5904\u7406"),Ft.createElement("div",{className:"p-3"},r,e.buttons)))},e.acted=function(){return Ft.createElement(s.e,null,Ft.createElement("div",{className:"p-3 d-flex flex-column align-items-center"},Ft.createElement("div",{className:"text-success"},Ft.createElement(nt,{name:"check-circle-o"})," \u5355\u636e\u5df2\u5904\u7406\uff01"),Ft.createElement("div",{className:"p-3"},e.buttons)))},e}return Object(Tt.a)(t,e),Object(At.a)(t,[{key:"showEntry",value:function(e){return Tr(this,void 0,void 0,Pt.a.mark(function t(){return Pt.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:this.brief=e,this.openPage(this.view);case 2:case"end":return t.stop()}},t,this)}))}}]),t}(function(e){function t(){return Object(It.a)(this,t),Object(Rt.a)(this,Object(Vt.a)(t).apply(this,arguments))}return Object(Tt.a)(t,e),t}(fr)),qr=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},Mr=function(e){function t(){var e;return Object(It.a)(this,t),(e=Object(Rt.a)(this,Object(Vt.a)(t).apply(this,arguments))).page=function(){var t=e.sheetData.brief,n=t.state,r=t.no,i=e.controller.getStateLabel(n);return _t.a.createElement(s.e,{header:e.label+":"+i+"-"+r},_t.a.createElement("div",{className:"mb-2"},_t.a.createElement("div",{className:"d-flex px-3 py-2 border-bottom bg-light"},"\u6b63\u5728\u5904\u7406\u4e2d..."),_t.a.createElement(e.sheetView,null)))},e}return Object(Tt.a)(t,e),Object(At.a)(t,[{key:"showEntry",value:function(e){return qr(this,void 0,void 0,Pt.a.mark(function t(){return Pt.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:this.sheetData=e,this.vForm=this.createForm(void 0,e.data),this.openPage(this.page);case 3:case"end":return t.stop()}},t,this)}))}}]),t}(Or),Ur=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},Lr=function(e){function t(){var e;return Object(It.a)(this,t),(e=Object(Rt.a)(this,Object(Vt.a)(t).apply(this,arguments))).statesCount=Mt.k.array([],{deep:!0}),e.onSave=function(t,n){return Ur(Object(Dt.a)(Object(Dt.a)(e)),void 0,void 0,Pt.a.mark(function e(){var r;return Pt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.saveSheet(t,n);case 2:return r=e.sent,this.ceasePage(),e.next=6,this.showSaved(r);case 6:case"end":return e.stop()}},e,this)}))},e}return Object(Tt.a)(t,e),Object(At.a)(t,[{key:"internalStart",value:function(){return Ur(this,void 0,void 0,Pt.a.mark(function e(){return Pt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.loadStateSheetCount();case 2:return this.pageStateItems=this.entity.createPageStateItems(),e.next=5,this.showVPage(this.VSheetMain);case 5:case"end":return e.stop()}},e,this)}))}},{key:"onMessage",value:function(e){return Ur(this,void 0,void 0,Pt.a.mark(function t(){var n,r,i,a;return Pt.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:n=e.type,r=e.body,i=e.from,a=e.to,e.push,"sheet"===n&&this.onSheet(i,a,r);case 2:case"end":return t.stop()}},t,this)}))}},{key:"onSheet",value:function(e,t,n){var r=this.user.id,i=n.id,a=n.preState,o=n.state;console.log({$:"onMessage sheet",from:e,to:t.join(","),id:i,preState:a,state:o,me:r,sheetData:n}),e===r&&this.sheetActPreState(i,a),void 0!==t.find(function(e){return e===r})&&this.sheetActState(i,o,n)}},{key:"sheetActPreState",value:function(e,t){if(this.changeStateCount(t,-1),void 0!==this.curState&&this.curState===t){var n=this.pageStateItems.items.findIndex(function(t){return t.id===e});n>=0&&this.pageStateItems.items.splice(n,1)}}},{key:"sheetActState",value:function(e,t,n){this.changeStateCount(t,1),void 0!==this.curState&&this.curState===t&&this.pageStateItems.items.findIndex(function(t){return t.id===e})<0&&this.pageStateItems.items.push(n)}},{key:"changeStateCount",value:function(e,t){if(void 0!==e){var n=this.statesCount.findIndex(function(t){return t.state===e});if(console.log({$:"changeState",state:e,delta:t,index:n}),!(n<0)){var r=this.statesCount[n];r.count+=t,r.count<0&&(r.count=0)}}}},{key:"onEvent",value:function(e,t){return Ur(this,void 0,void 0,Pt.a.mark(function n(){var r;return Pt.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:n.t0=e,n.next="new"===n.t0?4:"schema"===n.t0?6:"archives"===n.t0?8:"state"===n.t0?10:"archived"===n.t0?13:"action"===n.t0?16:"processing"===n.t0?19:3;break;case 3:return n.abrupt("return");case 4:return r=this.VSheetNew,n.abrupt("break",22);case 6:return r=this.VSheetSchema,n.abrupt("break",22);case 8:return r=this.VArchives,n.abrupt("break",22);case 10:return this.curState=t.state,r=this.VSheetList,n.abrupt("break",22);case 13:return n.next=15,this.showArchived(t);case 15:return n.abrupt("return");case 16:return n.next=18,this.showAction(t);case 18:return n.abrupt("return");case 19:return n.next=21,this.showProcessing(t);case 21:return n.abrupt("return");case 22:return n.next=24,this.showVPage(r,t);case 24:case"end":return n.stop()}},n,this)}))}},{key:"startSheet",value:function(e){return Ur(this,void 0,void 0,Pt.a.mark(function t(){return Pt.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.beforeStart();case 2:if(t.t0=t.sent,!1!==t.t0){t.next=5;break}return t.abrupt("return");case 5:return t.next=7,this.onEvent("action",e);case 7:case"end":return t.stop()}},t,this)}))}},{key:"showAction",value:function(e){return Ur(this,void 0,void 0,Pt.a.mark(function t(){var n;return Pt.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getSheetData(e);case 2:return n=t.sent,Object(s.p)({body:{$type:"msg",action:"$sheet",msg:{id:e,uq:this.cUq.id,state:n.brief.state}}}),t.next=6,this.showVPage(this.VSheetAction,n);case 6:case"end":return t.stop()}},t,this)}))}},{key:"showProcessing",value:function(e){return Ur(this,void 0,void 0,Pt.a.mark(function t(){var n;return Pt.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getSheetData(e);case 2:return n=t.sent,t.next=5,this.showVPage(this.VSheetProcessing,n);case 5:case"end":return t.stop()}},t,this)}))}},{key:"editSheet",value:function(e){return Ur(this,void 0,void 0,Pt.a.mark(function t(){var n;return Pt.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.vCall(this.VSheetEdit,e);case 2:return n=t.sent,t.abrupt("return",n);case 4:case"end":return t.stop()}},t,this)}))}},{key:"showArchived",value:function(e){return Ur(this,void 0,void 0,Pt.a.mark(function t(){var n;return Pt.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getArchived(e.id);case 2:return n=t.sent,t.next=5,this.showVPage(this.VArchived,n);case 5:case"end":return t.stop()}},t,this)}))}},{key:"showSaved",value:function(e){return Ur(this,void 0,void 0,Pt.a.mark(function t(){return Pt.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.showVPage(this.VSheetSaved,e);case 2:case"end":return t.stop()}},t,this)}))}},{key:"getStateUI",value:function(e){var t=this.res.states;if(void 0!==t)return t[e]}},{key:"getStateLabel",value:function(e){var t=this.getStateUI(e),n=t&&t.label||e;switch(n){default:return n;case"$":return"\u65b0\u5355"}}},{key:"getActionLabel",value:function(e,t){var n=this.getStateUI(e);if(void 0===n)return t;var r=n.actions;if(void 0===r)return t;var i=r[t];return i&&i.label||t}},{key:"loadStateSheetCount",value:function(){return Ur(this,void 0,void 0,Pt.a.mark(function e(){var t,n;return Pt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.statesCount.clear(),e.next=3,this.entity.stateSheetCount();case 3:n=e.sent,(t=this.statesCount).splice.apply(t,[0,0].concat(Object(en.a)(n)));case 5:case"end":return e.stop()}},e,this)}))}},{key:"getSheetData",value:function(e){return Ur(this,void 0,void 0,Pt.a.mark(function t(){return Pt.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.entity.getSheet(e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}},t,this)}))}},{key:"getArchived",value:function(e){return Ur(this,void 0,void 0,Pt.a.mark(function t(){return Pt.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.entity.getArchive(e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}},t,this)}))}},{key:"saveSheet",value:function(e,t){return Ur(this,void 0,void 0,Pt.a.mark(function n(){var r,i,a;return Pt.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return r=this.ui.sheetTitle,i=void 0===r?this.label:r(t,this.x),n.next=4,this.entity.save(i,e);case 4:return a=n.sent,n.abrupt("return",a);case 6:case"end":return n.stop()}},n,this)}))}},{key:"action",value:function(e,t,n,r){return Ur(this,void 0,void 0,Pt.a.mark(function i(){return Pt.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,this.entity.action(e,t,n,r);case 2:return i.abrupt("return",i.sent);case 3:case"end":return i.stop()}},i,this)}))}},{key:"VSheetMain",get:function(){return this.ui&&this.ui.main||wr}},{key:"VSheetNew",get:function(){return this.ui.sheetNew||gr}},{key:"VSheetSaved",get:function(){return this.ui.sheetSaved||Dr}},{key:"VSheetEdit",get:function(){return this.ui.sheetEdit||Er}},{key:"VSheetSchema",get:function(){return Pr}},{key:"VArchives",get:function(){return _r}},{key:"VArchived",get:function(){return Vr}},{key:"VSheetList",get:function(){return Ar}},{key:"VSheetAction",get:function(){return this.ui.sheetAction||Sr}},{key:"VSheetProcessing",get:function(){return Mr}}]),t}(dr),Br=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},$r=function(e){function t(){var e;return Object(It.a)(this,t),(e=Object(Rt.a)(this,Object(Vt.a)(t).apply(this,arguments))).onSubmit=function(){return Br(Object(Dt.a)(Object(Dt.a)(e)),void 0,void 0,Pt.a.mark(function e(){var t;return Pt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.vForm.getValues(),e.next=3,this.controller.submit(t);case 3:this.returns=e.sent,this.closePage(),this.openPage(this.resultPage);case 6:case"end":return e.stop()}},e,this)}))},e.mainPage=function(){var t=e.controller.label;return Ft.createElement(s.e,{header:t},e.vForm.render("mx-3 my-2"))},e.resultPage=function(){var t=e.controller.label;return Ft.createElement(s.e,{header:t,back:"close"},"\u5b8c\u6210\uff01",Ft.createElement("pre",null,On(e.returns)))},e}return Object(Tt.a)(t,e),Object(At.a)(t,[{key:"showEntry",value:function(e){return Br(this,void 0,void 0,Pt.a.mark(function t(){return Pt.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:this.vForm=this.createForm(this.onSubmit,e),this.openPage(this.mainPage);case 2:case"end":return t.stop()}},t,this)}))}}]),t}(fr),Hr=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},Wr=function(e){function t(){return Object(It.a)(this,t),Object(Rt.a)(this,Object(Vt.a)(t).apply(this,arguments))}return Object(Tt.a)(t,e),Object(At.a)(t,[{key:"internalStart",value:function(){return Hr(this,void 0,void 0,Pt.a.mark(function e(){return Pt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.showVPage(this.VActionMain);case 2:case"end":return e.stop()}},e,this)}))}},{key:"submit",value:function(e){return Hr(this,void 0,void 0,Pt.a.mark(function t(){return Pt.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.entity.submit(e));case 1:case"end":return t.stop()}},t,this)}))}},{key:"VActionMain",get:function(){return $r}}]),t}(dr),zr=function(e){return _t.a.createElement("div",{className:"px-3 py-2"},On(e))},Kr=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},Qr=function(e){function t(){var e;return Object(It.a)(this,t),(e=Object(Rt.a)(this,Object(Vt.a)(t).apply(this,arguments))).onSubmit=function(){return Kr(Object(Dt.a)(Object(Dt.a)(e)),void 0,void 0,Pt.a.mark(function e(){var t,n;return Pt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.vForm.getValues(),!0!==this.entity.isPaged){e.next=9;break}return e.next=4,this.entity.resetPage(30,t);case 4:return e.next=6,this.entity.loadPage();case 6:this.replacePage(this.pageResult),e.next=13;break;case 9:return e.next=11,this.entity.query(t);case 11:n=e.sent,this.replacePage(this.queryResult,n);case 13:case"end":return e.stop()}},e,this)}))},e.again=function(){e.vForm.reset(),e.replacePage(e.view)},e.renderRow=function(t,n){return Ft.createElement(e.row,Object.assign({},t))},e.view=function(){return Ft.createElement(s.e,{header:e.label},e.vForm.render("mx-3 my-2"),e.renderExtra())},e.pageResult=function(){var t=e.entity,n=(t.name,t.list),r=Ft.createElement("button",{className:"btn btn-outline-success",onClick:e.again},Ft.createElement(nt,{name:"search"})," \u518d\u67e5\u8be2");return Ft.createElement(s.e,{header:e.label,right:r},Ft.createElement(_e,{items:n,item:{render:e.renderRow}}))},e.queryResult=Object(yn.a)(function(t){var n=Ft.createElement("button",{className:"btn btn-outline-success",onClick:e.again},Ft.createElement(nt,{name:"search"})," \u518d\u67e5\u8be2");return Ft.createElement(s.e,{header:e.label,right:n},Ft.createElement("pre",null,JSON.stringify(t,void 0,"\t")))}),e}return Object(Tt.a)(t,e),Object(At.a)(t,[{key:"showEntry",value:function(e){return Kr(this,void 0,void 0,Pt.a.mark(function t(){var n,r,i;return Pt.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:this.vForm=this.createForm(this.onSubmit,e),n=this.ui,r=n.row,i=n.queryRow,this.row=i||r||zr,this.openPage(this.view);case 4:case"end":return t.stop()}},t,this)}))}},{key:"renderExtra",value:function(){}}]),t}(fr),Jr=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},Gr=function(e){function t(){var e;return Object(It.a)(this,t),(e=Object(Rt.a)(this,Object(Vt.a)(t).apply(this,arguments))).onSearch=function(t){return Jr(Object(Dt.a)(Object(Dt.a)(e)),void 0,void 0,Pt.a.mark(function e(){return Pt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.PageItems.first(t);case 2:case"end":return e.stop()}},e,this)}))},e.renderRow=function(t,n){return Ft.createElement(e.row,Object.assign({},t))},e.clickRow=function(t){e.callOnSelected(t)},e.view=function(){var t=Ft.createElement(kt,{className:"mx-1 w-100",initKey:"",onSearch:e.onSearch,placeholder:"\u641c\u7d22"+e.label});return Ft.createElement(s.e,{header:t},Ft.createElement(_e,{items:e.PageItems.items,item:{render:e.renderRow,onClick:e.clickRow},before:"\u641c\u7d22"+e.label+"\u8d44\u6599"}))},e}return Object(Tt.a)(t,e),Object(At.a)(t,[{key:"showEntry",value:function(e){return Jr(this,void 0,void 0,Pt.a.mark(function t(){var n,r,i;return Pt.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=this.ui,r=n.row,i=n.selectRow,this.row=i||r||zr,this.PageItems=new Yr(this.entity),t.next=5,this.onSearch(e);case 5:this.openPage(this.view);case 6:case"end":return t.stop()}},t,this)}))}},{key:"callOnSelected",value:function(e){this.closePage(),this.returnCall(e)}}]),t}(fr),Yr=function(e){function t(e){var n;return Object(It.a)(this,t),(n=Object(Rt.a)(this,Object(Vt.a)(t).call(this))).query=e,n}return Object(Tt.a)(t,e),Object(At.a)(t,[{key:"load",value:function(){return Jr(this,void 0,void 0,Pt.a.mark(function e(){var t,n;return Pt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.query.loadSchema();case 2:if(!0!==this.query.isPaged){e.next=8;break}return e.next=5,this.query.page(this.param,this.pageStart,this.pageSize);case 5:t=e.sent,e.next=12;break;case 8:return e.next=10,this.query.query(this.param);case 10:n=e.sent,t=n[this.query.returns[0].name];case 12:return e.abrupt("return",t);case 13:case"end":return e.stop()}},e,this)}))}},{key:"setPageStart",value:function(e){void 0===e&&(this.pageStart=0)}}]),t}(s.f),Xr=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},Zr=function(e){function t(){return Object(It.a)(this,t),Object(Rt.a)(this,Object(Vt.a)(t).apply(this,arguments))}return Object(Tt.a)(t,e),t}(dr),ei=function(e){function t(){return Object(It.a)(this,t),Object(Rt.a)(this,Object(Vt.a)(t).apply(this,arguments))}return Object(Tt.a)(t,e),Object(At.a)(t,[{key:"internalStart",value:function(){return Xr(this,void 0,void 0,Pt.a.mark(function e(){return Pt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.showVPage(this.VQueryMain);case 2:case"end":return e.stop()}},e,this)}))}},{key:"VQueryMain",get:function(){return this.ui&&this.ui.main||Qr}}]),t}(Zr),ti=function(e){function t(){return Object(It.a)(this,t),Object(Rt.a)(this,Object(Vt.a)(t).apply(this,arguments))}return Object(Tt.a)(t,e),Object(At.a)(t,[{key:"internalStart",value:function(e){return Xr(this,void 0,void 0,Pt.a.mark(function t(){return Pt.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.showVPage(this.VQuerySelect,e);case 2:case"end":return t.stop()}},t,this)}))}},{key:"VQuerySelect",get:function(){return Gr}}]),t}(Zr),ni=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},ri=function(e){function t(){var e;return Object(It.a)(this,t),(e=Object(Rt.a)(this,Object(Vt.a)(t).apply(this,arguments))).onNew=function(){return e.event("new")},e.onList=function(){return e.event("list")},e.onSearch=function(t){return ni(Object(Dt.a)(Object(Dt.a)(e)),void 0,void 0,Pt.a.mark(function e(){return Pt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.event("list",t));case 1:case"end":return e.stop()}},e,this)}))},e}return Object(Tt.a)(t,e),Object(At.a)(t,[{key:"showEntry",value:function(e){return ni(this,void 0,void 0,Pt.a.mark(function e(){return Pt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.openPage(this.view);case 1:case"end":return e.stop()}},e,this)}))}},{key:"entityRender",value:function(e,t){return e.render()}},{key:"entityClick",value:function(e){return ni(this,void 0,void 0,Pt.a.mark(function t(){return Pt.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.onClick();case 2:case"end":return t.stop()}},t,this)}))}},{key:"view",get:function(){var e,t=this,n=this.controller,r=n.label,i=n.proxyLinks;return!1===n.isFrom&&(e=Ft.createElement("button",{className:"btn btn-primary ml-3",onClick:this.onNew},"\u65b0\u589e")),function(){return Ft.createElement(s.e,{header:r},void 0===i?Ft.createElement(Ft.Fragment,null,Ft.createElement(kt,{className:"w-100",onSearch:t.onSearch,placeholder:"\u641c\u7d22"+r}),Ft.createElement("div",{className:"my-3"},e,Ft.createElement("button",{className:"btn btn-primary ml-3",onClick:t.onList},"\u5217\u8868"))):Ft.createElement(_e,{className:"my-2",header:Ft.createElement(at,null,r," \u4ee3\u7406\u4e0b\u5217Tuid"),items:i,item:{render:t.entityRender,onClick:t.entityClick}}))}}}]),t}(fr),ii=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},ai=function(e){function t(){var e;return Object(It.a)(this,t),(e=Object(Rt.a)(this,Object(Vt.a)(t).apply(this,arguments))).next=function(){return ii(Object(Dt.a)(Object(Dt.a)(e)),void 0,void 0,Pt.a.mark(function e(){return Pt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.vForm.reset(),this.closePage();case 2:case"end":return e.stop()}},e,this)}))},e.finish=function(){e.closePage(2),e.event("edit-end")},e.onSubmit=function(){return ii(Object(Dt.a)(Object(Dt.a)(e)),void 0,void 0,Pt.a.mark(function e(){var t,n,r,i,a,o,c,u,l,h;return Pt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.vForm.getValues(),e.next=3,this.controller.entity.save(this.id,t);case 3:if(n=e.sent,!((r=n.id)<0)){e.next=28;break}if(void 0===(i=this.controller.entity.unique)){e.next=27;break}for(a=!0,o=!1,c=void 0,e.prev=11,u=i[Symbol.iterator]();!(a=(l=u.next()).done);a=!0)h=l.value,this.vForm.setError(h,"\u4e0d\u80fd\u91cd\u590d");e.next=19;break;case 15:e.prev=15,e.t0=e.catch(11),o=!0,c=e.t0;case 19:e.prev=19,e.prev=20,a||null==u.return||u.return();case 22:if(e.prev=22,!o){e.next=25;break}throw c;case 25:return e.finish(22);case 26:return e.finish(19);case 27:return e.abrupt("return");case 28:if(!this.controller.isCalling){e.next=32;break}return this.returnCall(r),this.closePage(),e.abrupt("return");case 32:return this.openPageElement(Ft.createElement(s.e,{header:this.label+"\u63d0\u4ea4\u6210\u529f",back:"none"},Ft.createElement("div",{className:"m-3"},Ft.createElement("span",{className:"text-success"},Ft.createElement(nt,{name:"check-circle",size:"lg"})," \u6210\u529f\u63d0\u4ea4\uff01"),Ft.createElement("div",{className:"mt-5"},Ft.createElement("button",{className:"btn btn-primary mr-3",onClick:this.next},"\u7ee7\u7eed\u5f55\u5165"),Ft.createElement("button",{className:"btn btn-outline-primary",onClick:this.finish},"\u4e0d\u7ee7\u7eed"))))),this.event("item-changed",{id:this.id,values:t}),e.abrupt("return");case 35:case"end":return e.stop()}},e,this,[[11,15,19,27],[20,,22,26]])}))},e}return Object(Tt.a)(t,e),Object(At.a)(t,[{key:"showEntry",value:function(e){return ii(this,void 0,void 0,Pt.a.mark(function t(){return Pt.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:this.vForm=this.createForm(this.onSubmit,e),void 0!==e&&(this.id=e.id),this.openPage(this.editView);case 3:case"end":return t.stop()}},t,this)}))}},{key:"resetForm",value:function(){this.vForm.reset()}},{key:"editView",get:function(){var e=this;return function(){return Ft.createElement(s.e,{header:(void 0===e.id?"\u65b0\u589e":"\u7f16\u8f91")+" - "+e.label},e.vForm.render("py-3"))}}}]),t}(fr),oi=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},si=function(e){function t(){var e;return Object(It.a)(this,t),(e=Object(Rt.a)(this,Object(Vt.a)(t).apply(this,arguments))).mainView=Object(yn.a)(function(){var t=_t.a.createElement(kt,{className:"mx-1 w-100",initKey:"",onSearch:e.onSearchMain,placeholder:"\u641c\u7d22"+e.label});return _t.a.createElement(s.e,{header:t,back:"close"},_t.a.createElement(_e,{items:e.controller.PageItems.items,item:{render:e.renderMainRow,onClick:e.clickMainRow},before:"\u641c\u7d22"+e.label+"\u8d44\u6599"}))}),e.onSearchMain=function(t){return oi(Object(Dt.a)(Object(Dt.a)(e)),void 0,void 0,Pt.a.mark(function e(){return Pt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.controller.searchMain(t);case 2:case"end":return e.stop()}},e,this)}))},e.renderMainRow=function(t,n){return _t.a.createElement(e.mainRowContent,Object.assign({},t))},e.clickMainRow=function(t){return oi(Object(Dt.a)(Object(Dt.a)(e)),void 0,void 0,Pt.a.mark(function e(){return Pt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.ceasePage(),void 0!==this.controller.entity.owner){e.next=4;break}return this.returnCall(t),e.abrupt("return");case 4:return e.next=6,this.showDiv(this.entity.getIdFromObj(t));case 6:case"end":return e.stop()}},e,this)}))},e.divView=function(t){return _t.a.createElement(s.e,{header:"\u9009\u62e9Div"},_t.a.createElement(_e,{items:t.items,item:{render:e.renderDivRow,onClick:e.clickDivRow}}))},e.renderDivRow=function(t,n){return _t.a.createElement(e.divRowContent,Object.assign({},t))},e.clickDivRow=function(t){e.ceasePage(),e.returnCall(t)},e}return Object(Tt.a)(t,e),Object(At.a)(t,[{key:"showEntry",value:function(e){return oi(this,void 0,void 0,Pt.a.mark(function t(){return Pt.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(void 0!==e){t.next=5;break}return t.next=3,this.showMain(e);case 3:t.next=7;break;case 5:return t.next=7,this.showDiv(e);case 7:case"end":return t.stop()}},t,this)}))}},{key:"showMain",value:function(e){return oi(this,void 0,void 0,Pt.a.mark(function t(){return Pt.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.mainRowContent=this.ui.rowContent||Pn,t.next=3,this.controller.searchMain(e);case 3:this.openPage(this.mainView);case 4:case"end":return t.stop()}},t,this)}))}},{key:"showDiv",value:function(e){return oi(this,void 0,void 0,Pt.a.mark(function t(){var n,r;return Pt.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return void 0!==(n=this.ui.divs)&&(this.divRowContent=n[this.entity.name].rowContent),void 0===this.divRowContent&&(this.divRowContent=Pn),t.next=5,this.controller.getDivItems(e);case 5:r=t.sent,this.openPage(this.divView,{items:r});case 7:case"end":return t.stop()}},t,this)}))}}]),t}(fr),ci=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},ui=function(e){function t(){return Object(It.a)(this,t),Object(Rt.a)(this,Object(Vt.a)(t).apply(this,arguments))}return Object(Tt.a)(t,e),t}(function(e){function t(){var e;return Object(It.a)(this,t),(e=Object(Rt.a)(this,Object(Vt.a)(t).apply(this,arguments))).next=function(){return ci(Object(Dt.a)(Object(Dt.a)(e)),void 0,void 0,Pt.a.mark(function e(){return Pt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.vForm.reset(),this.closePage();case 2:case"end":return e.stop()}},e,this)}))},e.finish=function(){e.closePage(2)},e.onSubmit=function(){return ci(Object(Dt.a)(Object(Dt.a)(e)),void 0,void 0,Pt.a.mark(function e(){var t,n,r=this;return Pt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.vForm.getValues(),e.next=3,this.entity.save(this.id,t);case 3:return(n=e.sent)&&alert("\u8fd9\u91cc\u8fd8\u8981\u5224\u65ad\u8fd4\u56de\u503c\uff0c\u5148\u4e0d\u5904\u7406\u4e86 \n"+On(n)),this.openPage(function(){return Ft.createElement(s.e,{header:r.label+"\u63d0\u4ea4\u6210\u529f",back:"none"},Ft.createElement("div",{className:"m-3"},Ft.createElement("span",{className:"text-success"},Ft.createElement(nt,{name:"check-circle",size:"lg"})," \u6210\u529f\u63d0\u4ea4\uff01"),Ft.createElement("div",{className:"mt-5"},Ft.createElement("button",{className:"btn btn-primary mr-3",onClick:r.next},"\u7ee7\u7eed\u5f55\u5165"),Ft.createElement("button",{className:"btn btn-outline-primary",onClick:r.finish},"\u4e0d\u7ee7\u7eed"))))}),e.abrupt("return");case 7:case"end":return e.stop()}},e,this)}))},e.view=function(){return Ft.createElement(s.e,{header:e.label},e.vForm.render("py-3"))},e}return Object(Tt.a)(t,e),Object(At.a)(t,[{key:"buildForm",value:function(e){this.vForm=this.createForm(void 0,e)}},{key:"showEntry",value:function(e){return ci(this,void 0,void 0,Pt.a.mark(function t(){return Pt.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:this.buildForm(e),this.openPage(this.view);case 2:case"end":return t.stop()}},t,this)}))}},{key:"render",value:function(e){return this.buildForm(e),this.vForm.render()}},{key:"loadId",value:function(e){return ci(this,void 0,void 0,Pt.a.mark(function t(){return Pt.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:this.id=e;case 1:case"end":return t.stop()}},t,this)}))}},{key:"resetForm",value:function(){this.vForm.reset()}}]),t}(fr)),li=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},hi=function(e){function t(e){var n;return Object(It.a)(this,t),(n=Object(Rt.a)(this,Object(Vt.a)(t).call(this,!0))).tuid=e,n}return Object(Tt.a)(t,e),Object(At.a)(t,[{key:"load",value:function(e,t,n){return li(this,void 0,void 0,Pt.a.mark(function r(){var i;return Pt.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,this.tuid.search(e,t,n);case 2:return i=r.sent,r.abrupt("return",i);case 4:case"end":return r.stop()}},r,this)}))}},{key:"setPageStart",value:function(e){this.pageStart=void 0===e?0:e.id}}]),t}(s.f),di=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},fi=function(e){function t(){return Object(It.a)(this,t),Object(Rt.a)(this,Object(Vt.a)(t).apply(this,arguments))}return Object(Tt.a)(t,e),Object(At.a)(t,[{key:"onSelected",value:function(e){return di(this,void 0,void 0,Pt.a.mark(function t(){return Pt.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:!1===this.controller.isFrom?this.event("edit",e.id):this.event("info",e.id);case 1:case"end":return t.stop()}},t,this)}))}}]),t}(function(e){function t(){var e;return Object(It.a)(this,t),(e=Object(Rt.a)(this,Object(Vt.a)(t).apply(this,arguments))).onSearch=function(t){return di(Object(Dt.a)(Object(Dt.a)(e)),void 0,void 0,Pt.a.mark(function e(){return Pt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.controller.searchMain(t);case 2:case"end":return e.stop()}},e,this)}))},e.renderRow=function(t,n){return Ft.createElement(e.rowContent,Object.assign({},t))},e.clickRow=function(t){e.callOnSelected(t)},e.rowKey=function(e){return e.id},e.view=Object(yn.a)(function(){var t,n=Ft.createElement(kt,{className:"mx-1 w-100",initKey:"",onSearch:e.onSearch,placeholder:"\u641c\u7d22"+e.label}),r=e.entity.owner;if(void 0!==r){var i=r.valueFromId(e.ownerId);t=Ft.createElement("div",null,"owner: ",On(i))}return Ft.createElement(s.e,{header:n},t,Ft.createElement(_e,{items:e.controller.PageItems.items,item:{render:e.renderRow,onClick:e.clickRow,key:e.rowKey},before:"\u641c\u7d22"+e.label+"\u8d44\u6599"}))}),e}return Object(Tt.a)(t,e),Object(At.a)(t,[{key:"showEntry",value:function(e){return di(this,void 0,void 0,Pt.a.mark(function t(){return Pt.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.rowContent=this.ui.rowContent||Pn,void 0!==this.entity.owner&&(this.ownerId=Number(e)),t.next=4,this.controller.searchMain("");case 4:this.openPage(this.view);case 5:case"end":return t.stop()}},t,this)}))}},{key:"callOnSelected",value:function(e){void 0!==this.onSelected?this.onSelected(e):alert("onSelect is undefined")}}]),t}(fr)),pi=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},vi=function(e){function t(){return Object(It.a)(this,t),Object(Rt.a)(this,Object(Vt.a)(t).apply(this,arguments))}return Object(Tt.a)(t,e),Object(At.a)(t,[{key:"buildPageItems",value:function(){return new hi(this.entity.owner||this.entity)}},{key:"searchMain",value:function(e){return pi(this,void 0,void 0,Pt.a.mark(function t(){return Pt.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(void 0===this.PageItems&&(this.PageItems=this.buildPageItems()),void 0===e){t.next=4;break}return t.next=4,this.PageItems.first(e);case 4:case"end":return t.stop()}},t,this)}))}},{key:"getDivItems",value:function(e){return pi(this,void 0,void 0,Pt.a.mark(function t(){var n;return Pt.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.entity.searchArr(e,void 0,0,1e3);case 2:return n=t.sent,t.abrupt("return",n);case 4:case"end":return t.stop()}},t,this)}))}}]),t}(dr),mi=function(e){function t(e,n,r,i){var a;Object(It.a)(this,t);var o=(a=Object(Rt.a)(this,Object(Vt.a)(t).call(this,e,n,r,i))).entity;if(a.proxies=o.proxies,void 0!==a.proxies)for(var s in a.proxyLinks=[],a.proxies){var c=a.cUq.linkFromName("tuid",s);a.proxyLinks.push(c)}return a}return Object(Tt.a)(t,e),Object(At.a)(t,[{key:"from",value:function(){return pi(this,void 0,void 0,Pt.a.mark(function e(){var t;return Pt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.entity.cFrom();case 2:if(void 0!==(t=e.sent)){e.next=5;break}return e.abrupt("return",this);case 5:return e.abrupt("return",t);case 6:case"end":return e.stop()}},e,this)}))}},{key:"cUqFrom",value:function(){return pi(this,void 0,void 0,Pt.a.mark(function e(){return Pt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.entity.cUqFrom();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}))}},{key:"cEditFrom",value:function(){return pi(this,void 0,void 0,Pt.a.mark(function e(){var t;return Pt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.entity.cUqFrom();case 2:return t=e.sent,e.next=5,t.cTuidEditFromName(this.entity.name);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}},e,this)}))}},{key:"cInfoFrom",value:function(){return pi(this,void 0,void 0,Pt.a.mark(function e(){var t;return Pt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.entity.cUqFrom();case 2:return t=e.sent,e.next=5,t.cTuidInfoFromName(this.entity.name);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}},e,this)}))}},{key:"cSelectFrom",value:function(){return pi(this,void 0,void 0,Pt.a.mark(function e(){var t;return Pt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.entity.cUqFrom();case 2:return t=e.sent,e.next=5,t.cTuidSelectFromName(this.entity.name);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}},e,this)}))}},{key:"getLable",value:function(e){if(e===this.entity)return this.label;var t=e.name,n=this.res.arrs;if(void 0!==n){var r=n[t];if(void 0!==r){var i=r.label;if(void 0!==i)return i}}return t}},{key:"internalStart",value:function(e){return pi(this,void 0,void 0,Pt.a.mark(function e(){return Pt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.isFrom=void 0!==this.entity.schemaFrom,e.next=3,this.showVPage(this.VTuidMain);case 3:case"end":return e.stop()}},e,this)}))}},{key:"onEvent",value:function(e,t){return pi(this,void 0,void 0,Pt.a.mark(function n(){var r,i;return Pt.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:n.t0=e,n.next="new"===n.t0?4:"list"===n.t0?6:"edit"===n.t0?8:"item-changed"===n.t0?11:"info"===n.t0?13:3;break;case 3:return n.abrupt("return");case 4:return r=this.VTuidEdit,n.abrupt("break",17);case 6:return r=this.VTuidList,n.abrupt("break",17);case 8:return n.next=10,this.edit(t);case 10:return n.abrupt("return");case 11:return this.itemChanged(t),n.abrupt("return");case 13:return i=new ki(this.cUq,this.entity,this.ui,this.res),n.next=16,i.start(t);case 16:return n.abrupt("return");case 17:return n.next=19,this.showVPage(r,t);case 19:case"end":return n.stop()}},n,this)}))}},{key:"edit",value:function(e){return pi(this,void 0,void 0,Pt.a.mark(function t(){var n,r;return Pt.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n=void 0,void 0===e){t.next=5;break}return t.next=4,this.entity.load(e);case 4:n=t.sent;case 5:return r=this.VTuidEdit,t.next=8,this.showVPage(r,n);case 8:case"end":return t.stop()}},t,this)}))}},{key:"itemChanged",value:function(e){var t=e.id,n=e.values;if(void 0!==this.PageItems){var r=this.PageItems.items.find(function(e){return e.id===t});void 0!==r&&Lt.a.merge(r,n)}}},{key:"VTuidMain",get:function(){return ri}},{key:"VTuidEdit",get:function(){return ai}},{key:"VTuidList",get:function(){return fi}}]),t}(vi),yi=function(e){function t(){return Object(It.a)(this,t),Object(Rt.a)(this,Object(Vt.a)(t).apply(this,arguments))}return Object(Tt.a)(t,e),Object(At.a)(t,[{key:"internalStart",value:function(e){return pi(this,void 0,void 0,Pt.a.mark(function t(){return Pt.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.edit(e);case 2:case"end":return t.stop()}},t,this)}))}}]),t}(mi),bi=function(e){function t(){return Object(It.a)(this,t),Object(Rt.a)(this,Object(Vt.a)(t).apply(this,arguments))}return Object(Tt.a)(t,e),Object(At.a)(t,[{key:"internalStart",value:function(e){return pi(this,void 0,void 0,Pt.a.mark(function e(){return Pt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.showVPage(this.VTuidList);case 2:case"end":return e.stop()}},e,this)}))}}]),t}(mi),wi=function(e){function t(){return Object(It.a)(this,t),Object(Rt.a)(this,Object(Vt.a)(t).apply(this,arguments))}return Object(Tt.a)(t,e),Object(At.a)(t,[{key:"internalStart",value:function(e){return pi(this,void 0,void 0,Pt.a.mark(function t(){return Pt.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.showVPage(this.VTuidSelect,e);case 2:case"end":return t.stop()}},t,this)}))}},{key:"beforeStart",value:function(){return pi(this,void 0,void 0,Pt.a.mark(function e(){return Pt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.entity.loadSchema();case 2:return void 0!==this.PageItems&&this.PageItems.reset(),e.abrupt("return",!0);case 4:case"end":return e.stop()}},e,this)}))}},{key:"idFromItem",value:function(e){return e.id}},{key:"VTuidSelect",get:function(){return si}}]),t}(vi),ki=function(e){function t(){return Object(It.a)(this,t),Object(Rt.a)(this,Object(Vt.a)(t).apply(this,arguments))}return Object(Tt.a)(t,e),Object(At.a)(t,[{key:"internalStart",value:function(e){return pi(this,void 0,void 0,Pt.a.mark(function t(){var n;return Pt.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.entity.load(e);case 2:return n=t.sent,t.next=5,this.showVPage(this.VTuidInfo,n);case 5:case"end":return t.stop()}},t,this)}))}},{key:"VTuidInfo",get:function(){return ui}}]),t}(vi),gi=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},xi=function(e){function t(){var e;return Object(It.a)(this,t),(e=Object(Rt.a)(this,Object(Vt.a)(t).apply(this,arguments))).itemRender=function(t,n){return Ft.createElement(e.ItemRow,{item:t})},e.ItemRow=Object(yn.a)(function(t){var n,r,i,a,o,s,c=t.item,u=(c.tuid,c.box),l=c.children,h=c.isLeaf,d=c.keyIndex,f=c.values,p=e.controller.keyUIs[d],v=p.content,m=p.valuesContent,y=p.none;if(!1===e.isFrom&&(n=Ft.createElement("button",{className:"btn btn-link btn-sm",onClick:function(){return e.controller.addClick(c)}},Ft.createElement(nt,{name:"plus"})),r=Ft.createElement("button",{className:"btn btn-link btn-sm",onClick:function(){return e.controller.removeClick(c)}},Ft.createElement(nt,{className:"text-info",name:"trash"}))),!1===h?i=0===d?n:Ft.createElement(Ft.Fragment,null,r," \xa0 ",n):d>0&&(i=r),!0===h)a=void 0,f&&(s=(m||Sn)(f,e.x));else{o="border-bottom";var b=y&&y(e.x);a=Ft.createElement(_e,{className:"ml-4",items:l,item:{onClick:void 0,render:e.itemRender},none:b})}return Ft.createElement("div",{className:"d-flex flex-column"},Ft.createElement(et,{className:pn()("px-3","py-2",o),right:i},Ft.createElement("div",{className:"py-1"},En(u,v,e.x)),Ft.createElement("div",{className:"py-1 font-weight-bold"},s)),a)}),e}return Object(Tt.a)(t,e),Object(At.a)(t,[{key:"showEntry",value:function(e){return gi(this,void 0,void 0,Pt.a.mark(function e(){return Pt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.isFrom=this.controller.isFrom,this.openPage(this.view);case 2:case"end":return e.stop()}},e,this)}))}},{key:"view",get:function(){var e=this;return function(){return Ft.createElement(s.e,{header:e.label},Ft.createElement(_e,{items:e.controller.items,item:{className:"my-2",onClick:void 0,render:e.itemRender}}))}}}]),t}(fr),Oi=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},ji=function(e){function t(){var e;return Object(It.a)(this,t),(e=Object(Rt.a)(this,Object(Vt.a)(t).apply(this,arguments))).onValuesSubmit=function(){return Oi(Object(Dt.a)(Object(Dt.a)(e)),void 0,void 0,Pt.a.mark(function e(){var t;return Pt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.ceasePage(),t=this.vForm.getValues(),this.returnCall(t);case 3:case"end":return e.stop()}},e,this)}))},e.view=function(){return Ft.createElement(s.e,null,e.vForm.render())},e}return Object(Tt.a)(t,e),Object(At.a)(t,[{key:"showEntry",value:function(e){return Oi(this,void 0,void 0,Pt.a.mark(function e(){return Pt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.vForm=this.createForm(this.onValuesSubmit),this.openPageElement(Ft.createElement(this.view,null));case 2:case"end":return e.stop()}},e,this)}))}}]),t}(fr),Ei=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},Ci=function e(t,n,r,i){Object(It.a)(this,e),this.children=Mt.k.array([],{deep:!0}),this.parent=t,this.tuid=n,this.box=r,this.keyIndex=i,this.isLeaf=!1},Si=function(e){function t(){var e;return Object(It.a)(this,t),(e=Object(Rt.a)(this,Object(Vt.a)(t).apply(this,arguments))).addClick=function(t){return Ei(Object(Dt.a)(Object(Dt.a)(e)),void 0,void 0,Pt.a.mark(function e(){var n,r,i,a,o,s,c,u,l,h,d,f,p,v,m,y,b,w,k,g,x,O,j,E,C,S,N,P,F,_,I,A,R;return Pt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.keyIndex,r=t.children,i=this.keyFields.length,a=i-1,!((o=n+1)>=i)){e.next=6;break}return e.abrupt("return");case 6:for(s=this.keyFields[o],c=s.name,u=s._tuid,l={},h={},d=t;void 0!==d;d=d.parent)p=(f=d).keyIndex,v=f.box,m=this.keyFields[p].name,l[m]=h[m]=v.id;return e.next=14,this.searchOnKey(s,l);case 14:if(!(void 0===(y=e.sent)||y<=0)){e.next=17;break}return e.abrupt("return");case 17:if(u.useId(y),b=u.boxId(y),w={},k={},n+1!==a){e.next=31;break}if(u.useId(y),k[c]=w[c]=b,!(this.entity.fields.length>0)){e.next=29;break}return e.next=27,this.vCall(ji,h);case 27:for(x in g=e.sent)k[x]=w[x]=g[x];case 29:e.next=54;break;case 31:for(k[c]=h[c]=b,O=o+1;O<a;O++)h[this.keyFields[O].name]=0;for(w[this.keyFields[a].name]=0,j=this.entity.fields,E=!0,C=!1,S=void 0,e.prev=38,N=j[Symbol.iterator]();!(E=(P=N.next()).done);E=!0)F=P.value,F.name,_=F.type,!0!==F.null&&(w[F.name]=hn(_));e.next=46;break;case 42:e.prev=42,e.t0=e.catch(38),C=!0,S=e.t0;case 46:e.prev=46,e.prev=47,E||null==N.return||N.return();case 49:if(e.prev=49,!C){e.next=52;break}throw S;case 52:return e.finish(49);case 53:return e.finish(46);case 54:return h.arr1=[w],e.next=57,this.entity.actions.add.submit(h);case 57:(I=r.findIndex(function(e){return e.box.id===y}))<0?r.push(this.createItem(t,u,b,o,k)):void 0!==(A=this.entity.fields)&&A.length>0&&(R=r[I],r.splice(I,1),R.values=k,r.splice(I,0,R)),this.removeCeased();case 60:case"end":return e.stop()}},e,this,[[38,42,46,54],[47,,49,53]])}))},e.removeClick=function(t){return Ei(Object(Dt.a)(Object(Dt.a)(e)),void 0,void 0,Pt.a.mark(function e(){var n,r,i,a,o,s,c,u,l,h,d,f,p,v,m,y;return Pt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.keyFields[t.keyIndex],r=n._tuid,i=this.cUq.cTuidMain(r.Main),a=i.getLable(r),o=this.res.confirmDelete||Lt.a.template("do you really want to remove ${label}?"),!1!==confirm(o({label:a}))){e.next=7;break}return e.abrupt("return");case 7:for(s=this.entity,u=(c={}).arr1=[],l={},u.push(l),h=t;void 0!==h;h=h.parent)d=h.keyIndex,l[this.keyFields[d].name]=h.box.id;for(f=this.keyFields.length,p=t.keyIndex+1;p<f;p++)v=this.keyFields[p],l[v.name]=-1;return e.next=17,s.actions.del.submit(c);case 17:m=t.parent.children,(y=m.findIndex(function(e){return e===t}))>=0&&m.splice(y,1);case 20:case"end":return e.stop()}},e,this)}))},e}return Object(Tt.a)(t,e),Object(At.a)(t,[{key:"internalStart",value:function(){return Ei(this,void 0,void 0,Pt.a.mark(function e(){var t,n,r,i,a,o,s,c,u,l,h,d,f,p,v,m,y;return Pt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.entity,n=t.keys,r=t.schemaFrom,this.isFrom=void 0!==r,i=this.entity.queries.all,e.next=5,i.query({});case 5:for(a=e.sent,o=a.ret,s=n.length,this.keyUIs=Lt.a.clone(this.ui.keys||[]),this.keyFields=[],c=i.returns[0].fields,u=0;u<s;u++)this.keyFields.push(c[u]),u>=this.keyUIs.length&&this.keyUIs.push({content:Sn});for(this.items=Object(Mt.k)([]),l=void 0,h=!0,d=!1,f=void 0,e.prev=17,p=o[Symbol.iterator]();!(h=(v=p.next()).done);h=!0)m=v.value,void 0!==(y=this.addItem(l,m))&&(this.items.push(y),l=y);e.next=25;break;case 21:e.prev=21,e.t0=e.catch(17),d=!0,f=e.t0;case 25:e.prev=25,e.prev=26,h||null==p.return||p.return();case 28:if(e.prev=28,!d){e.next=31;break}throw f;case 31:return e.finish(28);case 32:return e.finish(25);case 33:return e.next=35,this.showVPage(this.VMapMain);case 35:case"end":return e.stop()}},e,this,[[17,21,25,33],[26,,28,32]])}))}},{key:"createItem",value:function(e,t,n,r,i){var a=new Ci(e,t,n,r);return r===this.keyFields.length-1&&(a.isLeaf=!0,a.values=i),a}},{key:"addItem",value:function(e,t){for(var n=void 0,r=this.keyFields.length,i=e,a=0;a<r;a++){var o=this.keyFields[a],s=o.name,c=o._tuid,u=t[s];if(void 0===u)break;var l=u.id;if(0!==a){var h=i,d=h.children,f=(h.box,d.length);if(f>0){var p=d[f-1];if(p.box.id===l){i=p;continue}}l>0&&d.push(i=this.createItem(i,c,u,a,t))}else{if(0===l)continue;void 0!==i&&i.box.id===l||(n=i=this.createItem(void 0,c,u,a,t))}}return n}},{key:"searchOnKey",value:function(e,t){return Ei(this,void 0,void 0,Pt.a.mark(function n(){var r,i,a,o,s;return Pt.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return r=e._tuid,i=e._ownerField,a=this.cUq.cTuidSelect(r),o=t,void 0!==i&&"object"===typeof(o=t[i.name])&&(o=o.id),n.next=6,a.call(o);case 6:return s=n.sent,n.abrupt("return",r.getIdFromObj(s));case 8:case"end":return n.stop()}},n,this)}))}},{key:"VMapMain",get:function(){return xi}}]),t}(dr),Ni=function(e){function t(e){var n;Object(It.a)(this,t),(n=Object(Rt.a)(this,Object(Vt.a)(t).call(this,e))).isSysVisible=!1,n.view=function(){var e,t=n.controller,r=t.res,i=t.uq,a=t.error,o={render:function(e,t){return e.render()},onClick:void 0},s=[{header:r.tuid||"TUID",items:n.tuidLinks},{cn:"my-2",header:r.map||"MAP",items:n.mapLinks},{cn:"my-2",header:r.sheet||"SHEET",items:n.sheetLinks},{cn:"my-2",header:r.action||"ACTION",items:n.actionLinks},{cn:"my-2",header:r.query||"QUERY",items:n.queryLinks},{cn:"mt-2 mb-4",header:r.book||"BOOK",items:n.bookLinks},{cn:"mt-2 mb-4",header:r.history||"HISTORY",items:n.historyLinks},{cn:"mt-2 mb-4",header:r.pending||"PENDING",items:n.pendingLinks}];return e=void 0!==a?_t.a.createElement("div",{className:"p-3 text-danger"},"\u8fde\u63a5\u9519\u8bef: ",a):s.map(function(e,t){var n=e.cn,r=e.header,i=e.items;return i.length>0&&_t.a.createElement(_e,{key:t,className:n,header:_t.a.createElement("div",{className:"px-3 py-1 bg-light"},_t.a.createElement(at,null,r)),items:i,item:o})}),_t.a.createElement(_t.a.Fragment,null,_t.a.createElement("div",{className:"px-3 py-1 small"},r.uq||i),e)};var r=e.entities,i=r.tuidArr,a=r.mapArr,o=r.sheetArr,s=r.actionArr,c=r.queryArr,u=r.bookArr,l=r.historyArr,h=r.pendingArr;return n.tuidLinks=i.filter(function(e){return n.isVisible(e)}).map(function(e){return new mn(n.controller.cTuidMain(e))}),n.mapLinks=a.filter(function(e){return n.isVisible(e)}).map(function(e){return new mn(n.controller.cMap(e))}),n.sheetLinks=o.filter(function(e){return n.isVisible(e)}).map(function(e){return new mn(n.controller.cSheet(e))}),n.actionLinks=s.filter(function(e){return n.isVisible(e)}).map(function(e){return new mn(n.controller.cAction(e))}),n.queryLinks=c.filter(function(e){return n.isVisible(e)}).map(function(e){return new mn(n.controller.cQuery(e))}),n.bookLinks=u.filter(function(e){return n.isVisible(e)}).map(function(e){return new mn(n.controller.cBook(e))}),n.historyLinks=l.filter(function(e){return n.isVisible(e)}).map(function(e){return new mn(n.controller.cHistory(e))}),n.pendingLinks=h.filter(function(e){return n.isVisible(e)}).map(function(e){return new mn(n.controller.cPending(e))}),n}return Object(Tt.a)(t,e),Object(At.a)(t,[{key:"isVisible",value:function(e){return!0!==e.sys||this.isSysVisible}},{key:"render",value:function(e){return void 0===this.view?_t.a.createElement("div",null,"??? viewModel \u5fc5\u987b\u5b9a\u4e49 view ???"):_t.a.createElement(this.view)}}]),t}(s.j),Pi=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},Fi=function(e){function t(){var e;return Object(It.a)(this,t),(e=Object(Rt.a)(this,Object(Vt.a)(t).apply(this,arguments))).view=function(){return Ft.createElement(s.e,{header:e.label},"History")},e}return Object(Tt.a)(t,e),Object(At.a)(t,[{key:"showEntry",value:function(e){return Pi(this,void 0,void 0,Pt.a.mark(function e(){return Pt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.openPage(this.view);case 1:case"end":return e.stop()}},e,this)}))}}]),t}(fr),_i=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},Ii=function(e){function t(){return Object(It.a)(this,t),Object(Rt.a)(this,Object(Vt.a)(t).apply(this,arguments))}return Object(Tt.a)(t,e),Object(At.a)(t,[{key:"internalStart",value:function(){return _i(this,void 0,void 0,Pt.a.mark(function e(){return Pt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.showVPage(this.VHistoryMain);case 2:case"end":return e.stop()}},e,this)}))}},{key:"VHistoryMain",get:function(){return Fi}}]),t}(dr),Ai=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},Ri=function(e){function t(){var e;return Object(It.a)(this,t),(e=Object(Rt.a)(this,Object(Vt.a)(t).apply(this,arguments))).view=function(){return Ft.createElement(s.e,{header:e.label},"pending")},e}return Object(Tt.a)(t,e),Object(At.a)(t,[{key:"showEntry",value:function(e){return Ai(this,void 0,void 0,Pt.a.mark(function e(){return Pt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.openPage(this.view);case 1:case"end":return e.stop()}},e,this)}))}}]),t}(fr),Vi=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},Ti=function(e){function t(){return Object(It.a)(this,t),Object(Rt.a)(this,Object(Vt.a)(t).apply(this,arguments))}return Object(Tt.a)(t,e),Object(At.a)(t,[{key:"internalStart",value:function(){return Vi(this,void 0,void 0,Pt.a.mark(function e(){return Pt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.showVPage(this.VPendingMain);case 2:case"end":return e.stop()}},e,this)}))}},{key:"VPendingMain",get:function(){return Ri}}]),t}(dr),Di=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})};function qi(e){if(void 0!==e)for(var t in e)e[t.toLowerCase()]=e[t]}var Mi=function(e){function t(e,n,r,i,a,o){var c;Object(It.a)(this,t),(c=Object(Rt.a)(this,Object(Vt.a)(t).call(this,Object(s.q)(o.res)))).schemaLoaded=!1,c.isSysVisible=!1,c.cApp=e,c.uq=n,c.id=i,qi(o.tuid),qi(o.sheet),qi(o.map),qi(o.query),qi(o.action),qi(o.book),qi(o.history),qi(o.pending),c.ui=o,c.CTuidMain=o.CTuidMain||mi,c.CTuidEdit=o.CTuidEdit||yi,c.CTuidList=o.CTuidList||bi,c.CTuidSelect=o.CTuidSelect||wi,c.CTuidInfo=o.CTuidInfo||ki,c.CQuery=o.CQuery||ei,c.CQuerySelect=o.CQuerySelect||ti,c.CMap=o.CMap||Si,c.CAction=o.CAction||Wr,c.CSheet=o.CSheet||Lr,c.CBook=o.CBook||yr,c.CHistory=o.CHistory||Ii,c.CPending=o.CPending||Ti;var u,l,h=n.split("/");switch(h.length){case 1:u="$$$",l=h[0];break;case 2:u=h[0],l=h[1];break;default:return console.log("uq must be uqOwner/uqName format"),Object(Rt.a)(c)}var d,f,p=document.location.hash,v=void 0===p||""===p?"debug/":"tv/";return d=null===a||void 0===a||"*"===a?[]:a.split(";").map(function(e){return e.trim()}).filter(function(e){return e.length>0}),f="$$$/$unitx"===n?new s.g(s.n.unit):new s.h(v,u,l,d,!0),c.entities=new dn(Object(Dt.a)(Object(Dt.a)(c)),f,r),c}return Object(Tt.a)(t,e),Object(At.a)(t,[{key:"internalStart",value:function(){return Di(this,void 0,void 0,Pt.a.mark(function e(){return Pt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e,this)}))}},{key:"loadEntites",value:function(){return Di(this,void 0,void 0,Pt.a.mark(function e(){return Pt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.entities.loadAccess();case 2:case"end":return e.stop()}},e,this)}))}},{key:"loadSchema",value:function(){return Di(this,void 0,void 0,Pt.a.mark(function e(){var t,n,r,i;return Pt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!0!==this.schemaLoaded){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,this.loadEntites();case 5:void 0===this.id&&(this.id=this.entities.uqId),e.t0=Pt.a.keys(this.ui);case 7:if((e.t1=e.t0()).done){e.next=18;break}if(t=e.t1.value,void 0!==(n=this.ui[t])){e.next=12;break}return e.abrupt("continue",7);case 12:if(n.caption,void 0!==(r=n.collection)){e.next=15;break}return e.abrupt("continue",7);case 15:for(i in r)void 0===this.entities[t](i)&&console.warn(t+":'"+i+"' is not uq entity");e.next=7;break;case 18:return this.schemaLoaded=!0,e.abrupt("return");case 22:return e.prev=22,e.t2=e.catch(0),console.error(e.t2),e.abrupt("return",this.error=e.t2);case 26:case"end":return e.stop()}},e,this,[[0,22]])}))}},{key:"getQuerySearch",value:function(e){return Di(this,void 0,void 0,Pt.a.mark(function t(){var n;return Pt.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(void 0!==(n=this.entities.query(e))){t.next=5;break}alert("QUERY ".concat(e," \u6ca1\u6709\u5b9a\u4e49!")),t.next=9;break;case 5:return t.next=7,n.loadSchema();case 7:n.returns.length>1&&alert("QUERY ".concat(e," \u8fd4\u56de\u591a\u5f20\u8868, \u65e0\u6cd5\u505aQuerySearch"));case 9:return t.abrupt("return",n);case 10:case"end":return t.stop()}},t,this)}))}},{key:"getTuidPlaceHolder",value:function(e){var t=this.res,n=t.tuidPlaceHolder,r=t.entity,i=e.name;if(void 0!==r){var a=r[i];void 0!==a&&a.label}return n||"Select"}},{key:"getNone",value:function(){return this.res.none||"none"}},{key:"isVisible",value:function(e){return!0!==e.sys||this.isSysVisible}},{key:"navSheet",value:function(e,t){return Di(this,void 0,void 0,Pt.a.mark(function n(){var r,i;return Pt.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(void 0!==(r=this.entities.sheetFromTypeId(e))){n.next=4;break}return alert("sheetTypeId "+e+" is not exists!"),n.abrupt("return");case 4:return i=this.cSheet(r),n.next=7,i.startSheet(t);case 7:case"end":return n.stop()}},n,this)}))}},{key:"sheet",value:function(e){return this.entities.sheet(e)}},{key:"action",value:function(e){return this.entities.action(e)}},{key:"query",value:function(e){return this.entities.query(e)}},{key:"book",value:function(e){return this.entities.book(e)}},{key:"map",value:function(e){return this.entities.map(e)}},{key:"history",value:function(e){return this.entities.history(e)}},{key:"pending",value:function(e){return this.entities.pending(e)}},{key:"tuid",value:function(e){return this.entities.tuid(e)}},{key:"tuidDiv",value:function(e,t){var n=this.entities.tuid(e);if(void 0!==n){var r=n.divs;if(void 0!==r)return r[t]}}},{key:"cSheetFromName",value:function(e){var t=this.entities.sheet(e);if(void 0!==t)return this.cSheet(t)}},{key:"cActionFromName",value:function(e){var t=this.entities.action(e);if(void 0!==t)return this.cAction(t)}},{key:"cQueryFromName",value:function(e){var t=this.entities.query(e);if(void 0!==t)return this.cQuery(t)}},{key:"cBookFromName",value:function(e){var t=this.entities.book(e);if(void 0!==t)return this.cBook(t)}},{key:"cMapFromName",value:function(e){var t=this.entities.map(e);if(void 0!==t)return this.cMap(t)}},{key:"cHistoryFromName",value:function(e){var t=this.entities.history(e);if(void 0!==t)return this.cHistory(t)}},{key:"cPendingFromName",value:function(e){var t=this.entities.pending(e);if(void 0!==t)return this.cPending(t)}},{key:"cTuidMainFromName",value:function(e){var t=this.entities.tuid(e);if(void 0!==t)return this.cTuidMain(t)}},{key:"cTuidEditFromName",value:function(e){var t=this.entities.tuid(e);if(void 0!==t)return this.cTuidEdit(t)}},{key:"cTuidInfoFromName",value:function(e){var t=this.entities.tuid(e);if(void 0!==t)return this.cTuidInfo(t)}},{key:"cTuidSelectFromName",value:function(e){var t=this.entities.tuid(e);if(void 0!==t)return this.cTuidSelect(t)}},{key:"cFromName",value:function(e,t){switch(e){case"sheet":var n=this.entities.sheet(t);if(void 0===n)return;return this.cSheet(n);case"action":var r=this.entities.action(t);if(void 0===r)return;return this.cAction(r);case"tuid":var i=this.entities.tuid(t);if(void 0===i)return;return this.cTuidMain(i);case"query":var a=this.entities.query(t);if(void 0===a)return;return this.cQuery(a);case"book":var o=this.entities.book(t);if(void 0===o)return;return this.cBook(o);case"map":var s=this.entities.map(t);if(void 0===s)return;return this.cMap(s);case"history":var c=this.entities.history(t);if(void 0===c)return;return this.cHistory(c);case"pending":var u=this.entities.pending(t);if(void 0===u)return;return this.cPending(u)}}},{key:"linkFromName",value:function(e,t){return this.link(this.cFromName(e,t))}},{key:"getUI",value:function(e){var t,n,r=e.name,i=e.typeName;if(void 0!==this.ui){var a=this.ui[i];void 0!==a&&(t=a[r])}var o=this.res.entity;return void 0!==o&&(n=o[r]),{ui:t||{},res:n||{}}}},{key:"link",value:function(e){return new mn(e)}},{key:"cTuidMain",value:function(e){var t=this.getUI(e),n=t.ui,r=t.res;return new(n&&n.CTuidMain||this.CTuidMain)(this,e,n,r)}},{key:"cTuidEdit",value:function(e){var t=this.getUI(e),n=t.ui,r=t.res;return new(n&&n.CTuidEdit||this.CTuidEdit)(this,e,n,r)}},{key:"cTuidList",value:function(e){var t=this.getUI(e),n=t.ui,r=t.res;return new(n&&n.CTuidList||this.CTuidList)(this,e,n,r)}},{key:"cTuidSelect",value:function(e){var t=this.getUI(e.owner||e),n=t.ui,r=t.res;return new(n&&n.CTuidSelect||this.CTuidSelect)(this,e,n,r)}},{key:"cTuidInfo",value:function(e){var t=this.getUI(e),n=t.ui,r=t.res;return new(n&&n.CTuidInfo||this.CTuidInfo)(this,e,n,r)}},{key:"cSheet",value:function(e){var t=this.getUI(e),n=t.ui,r=t.res;return new(n&&n.CSheet||this.CSheet)(this,e,n,r)}},{key:"cAction",value:function(e){var t=this.getUI(e),n=t.ui,r=t.res;return new(n&&n.CAction||this.CAction)(this,e,n,r)}},{key:"cQuery",value:function(e){var t=this.getUI(e),n=t.ui,r=t.res;return new(n&&n.CQuery||this.CQuery)(this,e,n,r)}},{key:"cQuerySelect",value:function(e){var t=this.entities.query(e);if(void 0!==t){var n=this.getUI(t),r=n.ui,i=n.res;return new(r&&r.CQuerySelect||this.CQuerySelect)(this,t,r,i)}}},{key:"cBook",value:function(e){var t=this.getUI(e),n=t.ui,r=t.res;return new(n&&n.CBook||this.CBook)(this,e,n,r)}},{key:"cHistory",value:function(e){var t=this.getUI(e),n=t.ui,r=t.res;return new(n&&n.CHistory||this.CHistory)(this,e,n,r)}},{key:"cPending",value:function(e){var t=this.getUI(e),n=t.ui,r=t.res;return new(n&&n.CPending||this.CPending)(this,e,n,r)}},{key:"cMap",value:function(e){var t=this.getUI(e),n=t.ui,r=t.res;return new(n&&n.CMap||this.CMap)(this,e,n,r)}},{key:"getTuidContent",value:function(e){var t=e.owner;if(void 0===t){var n=this.getUI(e).ui;return n&&n.content||Sn}var r=this.getUI(t).ui;return r&&r.divs&&r.divs[e.name].content||Sn}},{key:"showTuid",value:function(e,t){return Di(this,void 0,void 0,Pt.a.mark(function n(){var r,i;return Pt.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return r=e.owner,i=this.cTuidInfo(r||e),n.next=4,i.start(t);case 4:case"end":return n.stop()}},n,this)}))}},{key:"render",value:function(){return new this.VUq(this).render()}},{key:"tuidLinks",get:function(){var e=this;return this.entities.tuidArr.filter(function(t){return e.isVisible(t)}).map(function(t){return e.link(e.cTuidMain(t))})}},{key:"sheetLinks",get:function(){var e=this;return this.entities.sheetArr.filter(function(t){return e.isVisible(t)}).map(function(t){return e.link(e.cSheet(t))})}},{key:"actionLinks",get:function(){var e=this;return this.entities.actionArr.filter(function(t){return e.isVisible(t)}).map(function(t){return e.link(e.cAction(t))})}},{key:"queryLinks",get:function(){var e=this;return this.entities.queryArr.filter(function(t){return e.isVisible(t)}).map(function(t){return e.link(e.cQuery(t))})}},{key:"bookLinks",get:function(){var e=this;return this.entities.bookArr.filter(function(t){return e.isVisible(t)}).map(function(t){return e.link(e.cBook(t))})}},{key:"historyLinks",get:function(){var e=this;return this.entities.historyArr.filter(function(t){return e.isVisible(t)}).map(function(t){return e.link(e.cHistory(t))})}},{key:"pendingLinks",get:function(){var e=this;return this.entities.pendingArr.filter(function(t){return e.isVisible(t)}).map(function(t){return e.link(e.cPending(t))})}},{key:"mapLinks",get:function(){var e=this;return this.entities.mapArr.filter(function(t){return e.isVisible(t)}).map(function(t){return e.link(e.cMap(t))})}},{key:"VUq",get:function(){return Ni}}]),t}(s.c),Ui=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},Li=new(function(e){function t(){return Object(It.a)(this,t),Object(Rt.a)(this,Object(Vt.a)(t).apply(this,arguments))}return Object(Tt.a)(t,e),Object(At.a)(t,[{key:"userAppUnits",value:function(e){return Ui(this,void 0,void 0,Pt.a.mark(function t(){return Pt.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.get("tie/user-app-units",{app:e});case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}},t,this)}))}}]),t}(s.b))("tv/",void 0),Bi=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},$i=(s.c,function(e){function t(){var e;return Object(It.a)(this,t),(e=Object(Rt.a)(this,Object(Vt.a)(t).apply(this,arguments))).appContent=function(){var t,n=e.controller.cUqArr;return t=0===n.length?Ft.createElement("div",{className:"text-danger"},Ft.createElement(nt,{name:""})," \u6b64APP\u6ca1\u6709\u7ed1\u5b9a\u4efb\u4f55\u7684UQ"):n.map(function(e,t){return Ft.createElement("div",{key:t},e.render())}),Ft.createElement(Ft.Fragment,null,t)},e}return Object(Tt.a)(t,e),Object(At.a)(t,[{key:"showEntry",value:function(e){return Bi(this,void 0,void 0,Pt.a.mark(function e(){return Pt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.openPage(this.appPage);case 1:case"end":return e.stop()}},e,this)}))}},{key:"render",value:function(e){return this.appContent()}},{key:"appPage",value:function(){var e=this.controller.caption;return Ft.createElement(s.e,{header:e,logout:function(){s.n.unit=void 0}},this.appContent())}}]),t}(s.i));var Hi=n(32),Wi=n.n(Hi),zi=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})};const Ki={};function Qi(e,t,n,r,i){return zi(this,void 0,void 0,function*(){let{url:a,urlDebug:o}=e;if(!a)return void alert("APP: "+e.name+"\n"+e.discription+"\n\u5c1a\u672a\u7ed1\u5b9a\u670d\u52a1");let c=yield s.k.getUrlOrDebug(a,o);e.url=c,e.urlDebug=void 0,s.o.navToApp(c,t,n,r,i)})}let Ji=class extends i.Component{render(){return i.createElement(i.Fragment,null,this.props.userIds.map(e=>i.createElement("small",{key:e},e)))}};Ji=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o}([Et.a],Ji);var Gi=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})};const Yi={fontSize:"x-small",color:"lightgray"};class Xi extends s.j{constructor(){super(...arguments),this.clickMessage=(e=>Gi(this,void 0,void 0,function*(){let{message:t,read:n}=e;if("number"===typeof t)return;let r=t;1!==n&&(yield this.controller.readMessage(r.id));let{unit:i}=this.controller,a=r.obj,{type:o}=a;switch(o){default:this.controller.jobPage(a);break;case"sheetMsg":let e=JSON.parse(a.content),{app:t,id:n,uq:r,sheet:s}=e;yield function(e,t,n,r,i){return zi(this,void 0,void 0,function*(){let a,{apps:o}=jt.store.unit;void 0!==o&&(a=jt.store.unit.apps.find(t=>t.id===e)),void 0===a&&(a=Ki[e]),void 0===a&&(a=yield jt.store.getAppFromId(e),Ki[e]=a),void 0!==a?yield Qi(a,n,t,r,i):alert("cannot get app from id="+e)})}(t,r,i.id,s,n)}})),this.renderMessage=((e,t)=>i.createElement(this.msgRow,Object.assign({},e))),this.msgRow=Object(Et.a)(e=>{let t=s.o.user.id,{message:n,read:r}=e;if("number"===typeof n)return i.createElement(et,{className:"px-3 bg-white my-1 py-2"},i.createElement(at,null,"... ",n," ..."));return En(n,e=>{let n,a,o,s,c,u,l,{date:h,type:d,fromUser:f,subject:p,discription:v,content:m}=e,y=jt.templetDict[d];1===r?(n="mt-2 text-info",a="text-secondary"):(n="mt-2 text-info red-dot",a="text-dark",o=i.createElement("u",{className:"message-dot"}),s="font-weight-bold"),f!=t&&(c=i.createElement(Ji,{userIds:[f]}),u="1x"),void 0!==p&&p.trim().length>0&&(l=i.createElement(i.Fragment,null,i.createElement("span",{className:s},p)," - "));let b=i.createElement("div",{className:Wi()("px-3",n)},i.createElement(nt,{size:u,name:y&&y.icon||"envelope"}),o),w=i.createElement("div",{className:Wi()("py-2",a)},l,i.createElement("small",null,v)),k=i.createElement("div",{className:"py-2 px-2 text-right"},i.createElement("span",{style:Yi},i.createElement(Ve,{date:h})));return i.createElement(et,{className:"bg-white",left:b,right:k},w)})})}render(){let{desk:e}=this.controller,{items:t,bottomDiv:n}=e;return i.createElement(i.Fragment,null,i.createElement(_e,{className:"my-1",before:i.createElement(at,null,"\u8bfb\u53d6\u4e2d..."),none:i.createElement(at,{className:"px-3 py-2"},"\u6682\u65e0\u5f85\u529e\u4e8b\u9879"),items:t,item:{key:e=>e.message.id,className:"bg-transparent",render:this.renderMessage,onClick:this.clickMessage}}),i.createElement("div",{id:n}))}}var Zi=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})};class ea extends s.j{constructor(){super(...arguments),this.onClick=(()=>{}),this.newJob=(()=>Zi(this,void 0,void 0,function*(){yield this.controller.newMessage({type:"a",content:"bbbb",to:[{user:0}]});this.closePage()})),this.rows=["",{type:"component",component:i.createElement(it,{iconClass:"text-info",icon:"envelope",text:"\u65b0\u4efb\u52a1"}),onClick:this.newJob},"",{type:"component",component:i.createElement(it,{iconClass:"text-info",icon:"envelope",text:"\u5f97\u60f3\u60f3\uff0c\u600e\u4e48\u505a"})},""],this.renderRow=((e,t)=>{let{icon:n,name:r,caption:a,discription:o}=e,s=i.createElement(i.Fragment,null,i.createElement(nt,{className:"text-success mr-3",name:n,size:"lg",fixWidth:!0})),c=i.createElement(at,null,o);return i.createElement(et,{className:"px-3 py-2 align-items-center",left:s,right:c},a)}),this.templetClick=(e=>{this.controller.jobEdit(e)})}render(){let{templets:e}=this.controller;return i.createElement("div",null,i.createElement(_e,{className:"py-2",items:jt.sysTemplets,item:{render:this.renderRow,onClick:this.templetClick}}),e&&i.createElement(_e,{items:e,item:{render:this.renderRow,onClick:this.templetClick}}))}}class ta extends s.j{constructor(){super(...arguments),this.rows=["",{type:"component",component:i.createElement(it,{iconClass:"text-primary",textClass:"d-inline-block ml-3",icon:"building",text:"\u9879\u76ee"}),onClick:()=>this.openPageElement(i.createElement(na,null))},{type:"component",component:i.createElement(it,{iconClass:"text-primary",textClass:"d-inline-block ml-3",icon:"archive",text:"\u529e\u4e8b\u4eba"}),onClick:()=>this.openPageElement(i.createElement(ra,null))}]}render(){return i.createElement(i.Fragment,null,i.createElement(Qe,{rows:this.rows,values:{}}),this.controller.myFolders(),this.controller.wholeFolders())}}class na extends i.Component{render(){return i.createElement(s.e,{header:"\u9879\u76ee"},i.createElement("div",{className:"m-3"},"\u6309\u9879\u76ee\u67e5\u770b\u4efb\u52a1\u8fdb\u5c55\u60c5\u51b5"))}}class ra extends i.Component{render(){return i.createElement(s.e,{header:"\u529e\u4e8b\u4eba"},i.createElement("div",{className:"m-3"},"\u6309\u529e\u4e8b\u4eba\u67e5\u770b\u4efb\u52a1\u8fdb\u5c55\u60c5\u51b5"))}}var ia=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})};class aa extends s.j{constructor(){super(...arguments),this.appClick=(e=>ia(this,void 0,void 0,function*(){let t=this.controller.unit.id;0===e.id||(yield Qi(e,t))})),this.renderRow=((e,t)=>{let{id:n,name:r,icon:a,discription:o}=e;return i.createElement(et,{className:"px-3 py-2",left:i.createElement(Ye,null,i.createElement("img",{src:a||St.appItemIcon}))},i.createElement("div",{className:"px-3"},i.createElement("div",null,i.createElement("b",null,r)),i.createElement("small",{className:"text-muted"},o)))}),this.clickToAdmin=(()=>ia(this,void 0,void 0,function*(){Qi(yield jt.store.getAdminApp(),this.controller.unit.id)}))}render(){let e,t,{id:n,name:r,discription:a,apps:o,icon:s,ownerName:c,ownerNick:u,isOwner:l,isAdmin:h}=this.controller.unit;u&&(u="- "+u),1!==l&&1!==h||(e=i.createElement("button",{className:"btn btn-success btn-sm align-self-start",onClick:()=>this.clickToAdmin()},"\u8fdb\u5165\u7ba1\u7406")),void 0!==o&&(t=i.createElement(_e,{items:o,item:{render:this.renderRow,onClick:this.appClick}}));let d=i.createElement("div",{className:"mr-3"},i.createElement("img",{src:s||St.appItemIcon}));return i.createElement("div",null,i.createElement(et,{className:"my-3 container-fluid",left:d,right:e},i.createElement("div",{className:"row"},i.createElement("h6",{className:"col-12"},r)),i.createElement("div",{className:"row"},i.createElement("label",{className:"small text-dark col-3"},"\u7b80\u4ecb\uff1a"),i.createElement("div",{className:"col-9"},a||i.createElement(at,null,"\u65e0"))),i.createElement("div",{className:"row"},i.createElement("label",{className:"small text-dark col-3"},"\u53d1\u5e03\u8005\uff1a"),i.createElement("div",{className:"col-9"},c," ",u))),t)}}var oa=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})};class sa extends s.j{constructor(){super(...arguments),this.renderMessage=((e,t)=>i.createElement(ha,e)),this.clickMessage=(e=>{let{message:t}=e;"number"!==typeof t&&this.controller.jobPage(t.obj)}),this.folderView=(({header:e,folder:t})=>{let{items:n,bottomDiv:r}=t;return i.createElement(s.e,{header:e},i.createElement(da,{bottomId:r},i.createElement(_e,{className:"my-1",before:i.createElement(at,null,"[\u65e0\u5185\u5bb9]"),items:n,item:{className:"bg-transparent",render:this.renderMessage,onClick:this.clickMessage}})))})}}class ca extends sa{constructor(){super(...arguments),this.sendBox=(()=>oa(this,void 0,void 0,function*(){let e=this.controller.sendFolder;e.scrollToBottom(),yield e.first({tag:"$me",undone:1}),this.openPage(this.folderView,{header:"\u6211\u53d1\u51fa\u4efb\u52a1",folder:this.controller.sendFolder})})),this.passBox=(()=>oa(this,void 0,void 0,function*(){let e=this.controller.passFolder;e.scrollToBottom(),yield e.first({tag:"$pass",undone:1}),this.openPage(this.folderView,{header:"\u6211\u7ecf\u624b\u4efb\u52a1",folder:this.controller.passFolder})})),this.ccBox=(()=>oa(this,void 0,void 0,function*(){let e=this.controller.ccFolder;e.scrollToBottom(),yield e.first({tag:"$cc",undone:1}),this.openPage(this.folderView,{header:"\u6284\u9001\u6211\u7684",folder:this.controller.ccFolder})})),this.folderRow=Object(Et.a)(({icon:e,text:t,folder:n})=>{let r,{doing:a,undone:o}=n;return o>0&&(r=i.createElement(i.Fragment,null,a>0?i.createElement("span",{className:"badge badge-info"},a):void 0,i.createElement("span",{className:"badge badge-light"},o))),i.createElement(et,{className:"w-100 align-items-center my-2 text-dark",left:i.createElement(nt,{className:"text-info mr-3",name:e}),right:r},t)})}render(){let{desk:e,sendFolder:t,passFolder:n,ccFolder:r}=this.controller,a=["=",{type:"component",component:i.createElement(this.folderRow,{icon:"share-square-o",text:"\u6211\u53d1\u51fa\u4efb\u52a1",folder:t}),onClick:this.sendBox},{type:"component",component:i.createElement(this.folderRow,{icon:"clipboard",text:"\u6211\u7ecf\u624b\u4efb\u52a1",folder:n}),onClick:this.passBox},{type:"component",component:i.createElement(this.folderRow,{icon:"cc",text:"\u6284\u9001\u6211\u7684",folder:r}),onClick:this.ccBox}];return i.createElement(Qe,{rows:a,values:{}})}}class ua extends sa{constructor(){super(...arguments),this.allBox=(()=>oa(this,void 0,void 0,function*(){let e=this.controller.allFolder;e.scrollToBottom(),yield e.first({tag:"$"}),this.openPage(this.folderView,{header:"\u5168\u90e8\u4efb\u52a1",folder:this.controller.allFolder})})),this.archiveBox=(()=>oa(this,void 0,void 0,function*(){s.o.push(i.createElement(fa,null))})),this.rows=["",{type:"component",component:i.createElement(it,{iconClass:"text-primary",textClass:"d-inline-block ml-3",icon:"building",text:"\u5168\u90e8"}),onClick:this.allBox},{type:"component",component:i.createElement(it,{iconClass:"text-primary",textClass:"d-inline-block ml-3",icon:"archive",text:"\u5df2\u5f52\u6863"}),onClick:this.archiveBox}]}render(){return i.createElement(Qe,{rows:this.rows,values:{}})}}const la={fontSize:"x-small",color:"lightgray"},ha=e=>{let t=s.o.user.id,{message:n,branch:r,done:a,flow:o}=e,c="px-3 bg-white my-1";if("number"===typeof n)return i.createElement(et,{className:c+" py-2"},i.createElement("small",{style:{color:"lightgray"}},"... ",n," ..."));let u=typeof n.obj;if("number"===u||"string"===u)return i.createElement(i.Fragment,null,"MSG: ",n.id);let l,h,{date:d,type:f,fromUser:p,subject:v,discription:m,content:y}=n.obj,b=a<r?o&&i.createElement(nt,{className:"text-info",name:"file-text-o"}):i.createElement(nt,{className:"text-success",name:"check-circle"}),w=i.createElement("div",{style:la},i.createElement(Ve,{date:d}));if(p.id!=t){let e=jt.templetDict[f],t=i.createElement(nt,{className:"mt-1 text-info",size:"2x",name:e&&e.icon||"envelope"});l=i.createElement(et,{left:t,right:b},En(p),w)}else l=i.createElement(et,{left:w,right:b});return void 0!==v&&(h=i.createElement("div",{className:"font-weight-bold"},v)),i.createElement("div",{className:c+" py-1 flex-column"},l,i.createElement("div",{className:"py-1"},h,i.createElement("div",null,m)))};class da extends i.Component{constructor(e){super(e),this.onAnyInput=this.onAnyInput.bind(this)}componentDidMount(){let e=this.props.bottomId;this.bottomTimer=setInterval(()=>{let t=document.getElementById(e);t&&t.scrollIntoView()},100)}onAnyInput(){void 0!==this.bottomTimer&&(clearInterval(this.bottomTimer),this.bottomTimer=void 0)}render(){return i.createElement("div",{onTouchStartCapture:this.onAnyInput,onWheelCapture:this.onAnyInput,onMouseDownCapture:this.onAnyInput,onKeyPressCapture:this.onAnyInput},this.props.children,i.createElement("div",{id:this.props.bottomId}))}}class fa extends i.Component{renderMessage(e,t){return i.createElement(ha,e)}clickMessage(e){}render(){return i.createElement(s.e,{header:"\u5df2\u5f52\u6863"},i.createElement("div",{className:"p-3"},"\u5f52\u6863\u6b63\u5728\u5efa\u8bbe\u4e2d..."))}}var pa=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})};const va={"#":i.createElement("span",{className:"text-succeed"},"\u5b8c\u6210"),"#-":i.createElement("span",{className:"text-danger"},"\u6ca1\u5b8c\u6210")};class ma extends s.i{constructor(){super(...arguments),this.finish=(()=>pa(this,void 0,void 0,function*(){yield this.controller.actMessage(this.msg,"done","#",[{user:0}]),this.closePage()})),this.decline=(()=>pa(this,void 0,void 0,function*(){yield this.controller.actMessage(this.msg,"decline","#-",[{user:0}]),alert("\u663e\u793a\u505a\u4e0d\u4e86\u7684\u7406\u7531, \u7136\u540e\u9009\u62e9\u3002\u6682\u672a\u5b8c\u6210\u8bbe\u8ba1\uff01"),this.closePage()})),this.edit=(()=>pa(this,void 0,void 0,function*(){this.msg.subject+=".1"})),this.flowRender=((e,t)=>{let{id:n,prev:r,date:a,state:o,user:s,action:c}=e,u="$"===o?i.createElement("div",{className:"col-sm-6"},"\u5f00\u59cb"):i.createElement(i.Fragment,null,i.createElement("div",{className:"col-sm-1"}),i.createElement("div",{className:"col-sm-5"},c," \xa0 ",i.createElement(Ji,{userIds:[s]}))),l=r>0?i.createElement("div",{className:"col-sm-4"},i.createElement("div",{className:"row"},i.createElement("div",{className:"col-sm-6 text-right"},i.createElement(nt,{className:"text-info",name:"arrow-right"})),i.createElement("div",{className:"col-sm-6"},function(e){return va[e]||e}(o)))):i.createElement("div",{className:"col-sm-4"});return i.createElement("span",{key:n,className:"container-fluid my-2"},i.createElement("div",{className:"row"},u,l,i.createElement("div",{className:"col-sm-2 align-items-end justify-content-center d-flex flex-column"},i.createElement(at,null,i.createElement(Ve,{date:a})))))}),this.view=(()=>{let{fromUser:e}=this.msg,{tuid_message:t,tuid_user:n}=this.controller,r=n.valueFromId(e),a=[{label:"\u6765\u81ea",type:"component",component:i.createElement("div",{className:"w-100"},"object"===typeof r?i.createElement("small",null,r.nick||r.name):i.createElement("small",null,r))},{label:"\u4efb\u52a1\u63cf\u8ff0",type:"string",name:"discription"},""];return this.buildFlow(a),i.createElement(s.e,{header:"\u5904\u7406\u4efb\u52a1"},i.createElement(Qe,{className:"px-3 py-2",rows:a,values:this.msg}))})}showEntry(e){return pa(this,void 0,void 0,function*(){this.msg=e,this.state=yield this.controller.getMessage(e.id),this.openPage(this.view)})}buildFlow(e){if(!this.state)return;let{flow:t,flows:n}=this.state;e.push({type:"component",full:!0,component:i.createElement(_e,{className:"w-100",header:i.createElement(at,{className:"px-3 py-1"},"\u6d41\u7a0b"),items:n,item:{render:this.flowRender}})}),e.push(""),void 0!==t&&e.push({label:"",type:"component",bk:"tansparent",component:i.createElement("div",{className:"w-100"},i.createElement(et,{left:i.createElement("button",{className:"btn btn-success",onClick:this.finish},"\u5b8c\u6210"),right:i.createElement("button",{className:"btn btn-info",onClick:this.decline},"\u505a\u4e0d\u4e86")}))})}}var ya=n(19),ba=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})};class wa extends f{constructor(e){super(e)}get toList(){return this.ti.list}setError(e,t){this.ti.setError(t)}confirmInput(){return ba(this,void 0,void 0,function*(){return yield this.ti.confirmInput()})}renderControl(){return i.createElement("div",{className:""},i.createElement(ga,{ref:e=>this.ti=e}))}}const ka={borderRadius:"0.7em",border:"1px solid lightgray",background:"#f8f8f8",padding:"0.1em 0.3em 0.1em 0.8em",marginRight:"0.3em"};class ga extends i.Component{constructor(e){super(e),this.list=[],this.keyPress=this.keyPress.bind(this),this.keyDown=this.keyDown.bind(this),this.onFocus=this.onFocus.bind(this),this.state={tos:this.list,error:void 0}}setError(e){this.setState({error:e})}confirmInput(){return ba(this,void 0,void 0,function*(){let e=this.input.value.trim();if(0===e.length)return!0;let t=yield ya.a.membersFromName({unit:jt.store.unit.id,name:e});if(0===t.length)return this.input.style.color="red",this.setState({error:"\u65e0\u6cd5\u53d1\u9001\u6b64\u63a5\u6536\u4eba"}),!1;for(let n of t){let{id:e,name:t,nick:r,assigned:i,icon:a}=n;this.list.findIndex(t=>t.id===e)>=0||this.list.push({id:e,name:t,nick:r,assigned:i,icon:a})}return this.input.value="",this.setState({tos:this.list}),!0})}onFocus(){this.setState({error:void 0})}keyPress(e){return ba(this,void 0,void 0,function*(){switch(this.setState({error:void 0}),this.input.style.color="",e.key){default:return;case"Enter":case";":case",":}e.preventDefault(),this.confirmInput()})}keyDown(e){this.setState({error:void 0})}removeTo(e){let t=this.list.findIndex(t=>t.id===e.id);t<0||(this.list.splice(t,1),this.setState({tos:this.list}))}render(){let e,{tos:t,error:n}=this.state,r=(t.length,"");return void 0!==t&&t.length>0&&(e=i.createElement("div",{className:"form-control-plaintext",style:{display:"flex",flexFlow:"row",flexWrap:"wrap"}},t.map(e=>{let t,{id:n,name:r,nick:a,assigned:o}=e;return t=void 0!==o?o+"("+r+")":void 0!==a?a+"("+r+")":r,i.createElement("div",{key:n,style:ka},t," \xa0",i.createElement("button",{type:"button",className:"close","aria-label":"Close",onClick:()=>this.removeTo(e)},i.createElement("span",{"aria-hidden":"true"},"\xd7")))}))),i.createElement(i.Fragment,null,e,i.createElement("input",{className:"w-100 form-control",ref:e=>this.input=e,type:"text",onKeyPress:this.keyPress,onKeyDown:this.keyDown,onFocus:this.onFocus,placeholder:r}),i.createElement("div",{style:{color:"red",fontSize:"smaller",marginTop:"0.2em"}},n))}}var xa=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})};class Oa extends s.i{constructor(){super(...arguments),this.rowTo={label:"\u63a5\u6536\u4eba",createControl:(e,t)=>this.tosControl=new wa(e)},this.rowSubject={label:"\u4e3b\u9898",field:{name:"subject",type:"string",maxLength:60},face:{type:"string",placeholder:"\u7b80\u660e\u627c\u8981"}},this.rowContent={label:"\u4efb\u52a1\u63cf\u8ff0",field:{name:"discription",maxLength:200,required:!0},face:{type:"textarea",placeholder:"\u7b80\u8981\u8bf4\u660e\u4efb\u52a1",rows:6}},this.onSubmit=(e=>xa(this,void 0,void 0,function*(){if(void 0!==this.tosControl&&!1===(yield this.tosControl.confirmInput()))return;let t,n=this.templet.name,r=e.subject,i=e.discription;switch(n){case"$self":t=[{toUser:0}];break;case"$dispatch":if(void 0===(t=this.validTos()))return}let a={type:n,subject:r,discription:i,to:t};yield this.controller.newMessage(a);this.closePage()})),this.view=(()=>i.createElement(s.e,{header:this.templet.caption},i.createElement(we,{className:"px-3 py-2",formRows:this.rows,onSubmit:this.onSubmit})))}showEntry(e){return xa(this,void 0,void 0,function*(){this.templet=e;let{content:t}=e,{needTo:n}=t;this.rows=[],!0===n&&this.rows.push(this.rowTo),this.rows.push(this.rowContent),this.openPage(this.view)})}validTos(){let{toList:e}=this.tosControl;if(void 0!==e&&0!==e.length)return e.map(e=>({toUser:e.id}));this.tosControl.setError("to","\u8bf7\u8f93\u5165\u63a5\u6536\u4eba")}}var ja=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},Ea=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})};class Ca extends s.f{constructor(e,t){super(!0),this.unit=e,this.query=t,this.appendPosition="head"}load(){return Ea(this,void 0,void 0,function*(){return yield this.query.page(this.param,this.pageStart,this.pageSize)})}setPageStart(e){this.pageStart=void 0===e?void 0:e.message}remove(e){let t=this._items.find(t=>t.message.id===e);void 0!==t&&this.items.remove(t)}updateItem(e,t=!0){let{message:n,branch:r,done:i,flow:a,prevState:o,state:s}=e;if(!0===this.loaded){let o=this._items.findIndex(e=>e.message===n);if(o<0)(void 0===i||i<r)&&(this.append(e),this.undone++);else{let n=this._items[o];!0===t&&i>=r&&(e.done=i,this.undone--,this._items.splice(o,1)),n.branch=r,n.done=i,n.flow=a}}else i<r?this.undone++:this.undone--;s.startsWith("#")&&this.doing--,o||this.doing++}}ja([c.k],Ca.prototype,"undone",void 0),ja([c.k],Ca.prototype,"doing",void 0);class Sa extends Ca{updateItem(e){super.updateItem(e),!0===this.loaded&&(void 0===this.unread&&(this.unread=0),++this.unread)}}ja([c.k],Sa.prototype,"unread",void 0);class Na extends Ca{}class Pa extends Ca{}class Fa extends Ca{}class _a extends Ca{}var Ia=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})};class Aa extends Mi{constructor(e){super(void 0,"$$$/$unitx",0,0,void 0,{}),this.userMeUploaded=!1,this.pushId=0,this.tabs=[{title:"\u5f85\u529e",content:()=>this.renderView(Xi),redDot:Object(c.d)(()=>0)},{title:"\u65b0\u5efa",content:()=>this.renderView(ea),load:()=>Ia(this,void 0,void 0,function*(){this.templets=yield this.getTemplets()})},{title:"\u67e5\u770b",content:()=>this.renderView(ta)},{title:"\u5e94\u7528",content:()=>this.renderView(aa),load:()=>Ia(this,void 0,void 0,function*(){void 0===this.unit.apps&&(yield this.unit.loadApps())})}],this.unleash=(()=>Ia(this,void 0,void 0,function*(){!1!==confirm("\u771f\u7684\u8981\u53d6\u6d88\u5173\u6ce8\u5417\uff1f")&&(yield jt.store.unfollowUnit(),this.closePage())})),this.rightMenu=[{caption:"\u53d6\u6d88\u5173\u6ce8",icon:"trash",action:this.unleash}],this.unit=e}loadEntites(){return Ia(this,void 0,void 0,function*(){yield this.entities.loadEntities()})}internalStart(){return Ia(this,void 0,void 0,function*(){yield this.loadSchema(),this.tuid_message=this.entities.tuid("message"),this.tuid_user=this.entities.tuid("user"),this.action_readMessage=this.entities.action("readMessage"),this.action_newMessage=this.entities.action("newMessage"),this.action_sheetMessage=this.entities.action("sheetMessage"),this.action_actMessage=this.entities.action("actMessage"),this.query_getDesk=this.entities.query("getDesk"),this.query_getFolder=this.entities.query("getFolder"),this.query_getFolderUndone=this.entities.query("getFolderUndone"),this.query_getMessage=this.entities.query("getMessage"),this.query_getTemplets=this.entities.query("getTemplets"),this.desk=new Sa(this.unit,this.query_getDesk),this.desk.scrollToBottom(),yield this.desk.first(void 0),this.sendFolder=new Na(this.unit,this.query_getFolder),this.passFolder=new Pa(this.unit,this.query_getFolder),this.ccFolder=new Fa(this.unit,this.query_getFolder),this.allFolder=new _a(this.unit,this.query_getFolder),yield this.loadFoldsUndone(),yield this.showVPage(Ra)})}onDispose(){return Ia(this,void 0,void 0,function*(){yield this.unit.messageReadClear()})}showAppsPage(){alert("AppsPage cannot show")}jobPage(e){this.showVPage(ma,e)}jobEdit(e){this.showVPage(Oa,e)}myFolders(){return this.renderView(ca)}wholeFolders(){return this.renderView(ua)}getQuery(e){return this.entities.query(e)}readMessage(e){return Ia(this,void 0,void 0,function*(){yield this.action_readMessage.submit({msg:e})})}actMessage(e,t,n,r){return Ia(this,void 0,void 0,function*(){let{id:i}=e;yield this.action_actMessage.submit({msg:i,curState:n,toState:"#",action:t,to:r})})}onMessage(e){return Ia(this,void 0,void 0,function*(){console.log("ws message: ",e);let{unit:t,from:n,to:r,body:i,push:a,subject:o}=e;if(this.pushId=a,void 0===i)return;let{$type:s,$user:c,$unit:u,$io:l,action:h,data:d,msg:f}=i;if("msg"!==s)return;let p=h.split(",");for(let e of p)switch(e){default:this.toFolder(e,this.dataToMsg(d));break;case"$sheet":console.log("ws:$sheet",f),yield this.changeSheetState(f);break;case"$away":this.removeFromDesk(f);break;case"$read":this.messageBeReaden(f)}})}dataToMsg(e){let t=e.split("\t");function n(e){if(e)return Number(e)}let r,i=n(t[0]),a=function(e){if(e)return new Date(1e3*Number(e))}(t[4]),o=n(t[8]),s=n(t[9]),c=t[10],u=t[11];return void 0!==a&&(r={id:i,fromUser:n(t[1]),fromUnit:n(t[2]),type:t[3],date:a,subject:t[5],discription:t[6],content:t[7]}),{id:this.tuid_message.boxId(i),message:r,branch:o,done:s,prevState:c,state:u}}toFolder(e,t){let n,{id:r,message:i,branch:a,done:o,prevState:s,state:c}=t;switch(e){default:return;case"$desk":n=this.desk;break;case"$me":n=this.sendFolder;break;case"$pass":n=this.passFolder;break;case"$cc":n=this.ccFolder}if(void 0===n)return;if(void 0!==i){let{fromUser:e}=i;this.tuid_message.cacheValue(i),this.tuid_user.useId(e)}let u={message:r,read:0,branch:a,done:o,prevState:s,state:c};this.allFolder.updateItem(u,!1),n.updateItem(u),n.scrollToBottom()}changeUread(e){let t=this.unit.unread;void 0!==t&&(t+=e)>=0&&(this.unit.unread=t)}changeSheetState({id:e,uq:t,state:n}){return Ia(this,void 0,void 0,function*(){yield this.action_sheetMessage.submit({sheet:e,uq:t,state:n})})}removeFromDesk(e){void 0!==this.desk&&this.desk.remove(e)}messageBeReaden(e){if(void 0===this.desk)return;let t=this.desk.items.find(t=>t.message.id===e);void 0!==t&&(t.read=1)}newMessage(e){return Ia(this,void 0,void 0,function*(){if(!1===this.userMeUploaded){let{name:t,nick:n,icon:r}=s.o.user;e.meName=t,e.meNick=n,e.meIcon=r,this.userMeUploaded=!0}return yield this.action_newMessage.submit(e)})}loadFoldsUndone(){return Ia(this,void 0,void 0,function*(){let e=yield this.query_getFolderUndone.query({}),{unDesk:t,unMe:n,onMe:r,unPass:i,onPass:a,unCc:o,onCc:s}=e.ret[0];this.sendFolder.undone=n,this.sendFolder.doing=r,this.passFolder.undone=i,this.passFolder.doing=a,this.ccFolder.undone=o,this.ccFolder.doing=s})}getMessage(e){return Ia(this,void 0,void 0,function*(){let t=yield this.query_getMessage.query({msg:e}),{ret:n,flow:r}=t;if(0===n.length)return;let i=n[0];return{msg:n[0],flow:i.flow,flows:r}})}getTemplets(){return Ia(this,void 0,void 0,function*(){if(void 0===this.templets){let e=yield this.query_getTemplets.query({});this.templets=e.ret}return this.templets})}}class Ra extends s.i{constructor(){super(...arguments),this.clickToAdmin=(()=>Ia(this,void 0,void 0,function*(){let e=yield jt.store.getAdminApp(),t=this.controller.unit.id;Object(s.l)(),s.o.navToApp(e.url,t)})),this.view=(()=>{let e,{tabs:t,rightMenu:n,user:r}=this.controller,{id:a,name:o,discription:c,apps:u,icon:l,owner:h,ownerName:d,ownerNick:f,isOwner:p,isAdmin:v}=this.controller.unit;return void 0!==f&&(f="- "+f),a>0&&h!==r.id&&(e=i.createElement(Ae,{actions:n})),i.createElement(s.e,{tabs:t,header:o,keepHeader:!0,right:e})})}showEntry(){return Ia(this,void 0,void 0,function*(){this.openPage(this.view)})}}var Va=n(39),Ta=n.n(Va);let Da=class extends i.Component{constructor(e){super(e)}componentWillMount(){let{id:e}=this.props;jt.store.cacheUnits.get(e)}render(){let e,{id:t,className:n}=this.props,r=jt.store.cacheUnits.get(t);if(null===r)e=t;else{let{name:n,discription:a}=r,o=a&&"- "+a;e=void 0!==n?i.createElement(i.Fragment,null,n," ",i.createElement("small",{className:"text-muted"},o)):t}return i.createElement("span",{className:Hi(n)},e)}};Da=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o}([Et.a],Da);let qa=class extends i.Component{constructor(e){super(e)}componentWillMount(){let{id:e}=this.props;jt.store.cacheUsers.get(e)}render(){let e,{id:t,className:n}=this.props,r=jt.store.cacheUsers.get(t);if(null===r)e=t;else{let{name:n,nick:a}=r,o=a&&"- "+a;e=void 0!==n?i.createElement(i.Fragment,null,n," ",i.createElement("small",{className:"text-muted"},o)):t}return i.createElement("span",{className:Hi(n)},e)}};qa=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o}([Et.a],qa);const Ma={flex:1,maxWidth:"30rem",border:"1px solid green",borderRadius:5,backgroundColor:"white"},Ua={flex:1,maxWidth:"30rem",border:"1px solid lightgray",borderRadius:5,fontSize:"smaller"},La=(e,t,n)=>{let r,a,o,s,{fromUser:c,date:u,state:l}=e;if(0!==l){let e,t,n;r="bg-light",o=Ua,a="py-1",1===l?(e="check",t="text-success",n="\u5df2\u51c6"):-1===l&&(e="times",t="text-danger",n="\u5df2\u62d2"),s=i.createElement("span",{className:Wi()(t,"small")},i.createElement(nt,{name:e}),"\xa0",n)}else o=Ta.a.assign({},Ma),Ta.a.assign(o,{cursor:"pointer"}),a="py-2";return i.createElement(et,{onClick:()=>n(e),className:Wi()("px-3",a,r),right:s},i.createElement("div",null,t,"  \xa0 ",i.createElement("small",{className:"text-muted"},i.createElement(Ve,{date:u}))),i.createElement("div",null,i.createElement("small",null,"\u7533\u8bf7\u4eba: ",i.createElement(qa,{id:c}))))},Ba=(e,t)=>La(e,"\u7533\u8bf7\u5f00\u53d1\u6743\u9650",t),$a=(e,t)=>La(e,"\u7533\u8bf7\u5c0f\u53f7\u6743\u9650",t);var Ha=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})};const Wa=(e,t,n,r)=>{let i,o,s,c,{fromUser:u,date:l,state:h}=e;if(0!==h){let e,t,n;i="bg-transparent",s=Ua,o="py-1",1===h?(e="check",t="text-success",n="\u5df2\u6279\u51c6"):-1===h&&(e="times",t="text-danger",n="\u5df2\u62d2\u7edd"),c=a.a.createElement("span",{className:t},a.a.createElement(nt,{name:e}),n)}else o="py-2";return a.a.createElement(et,{onClick:()=>r(e,t,n),className:Wi()("px-3",o,i),right:c},a.a.createElement("div",null,n),a.a.createElement("div",null,a.a.createElement("small",null,"\u7533\u8bf7\u65f6\u95f4: ",a.a.createElement(Ve,{date:l}))))},za=(e,t)=>{return Wa(e,0,"\u521b\u5efa\u5f00\u53d1\u53f7",t)},Ka=(e,t)=>{return Wa(e,1,"\u521b\u5efa\u5c0f\u53f7",t)};class Qa extends s.i{constructor(){super(...arguments),this.fields={name:{name:"name",type:"string",maxLength:250,required:!0}},this.onSubmit=(e=>Ha(this,void 0,void 0,function*(){let t,{id:n}=this.msg,r=yield this.controller.unitCreate(e.name,n);switch(r){default:return this.closePage(),void this.openPageElement(a.a.createElement(s.e,null,a.a.createElement("div",{className:"p-3 text-success"},a.a.createElement(nt,{name:"check"})," \u521b\u5efa\u5b8c\u6210")));case 0:t="\u540d\u5b57\u5df2\u7ecf\u88ab\u4f7f\u7528\u4e86";break;case-1:case-2:t="\u9519\u8bef\u7f16\u53f7: "+r}this.form.formView.setError("name",t)})),this.view=(()=>{let e=0===this.unitType?"\u5f00\u53d1\u53f7":"\u5c0f\u53f7",t=[{label:e,field:this.fields.name,face:{type:"string",placeholder:"\u552f\u4e00\u540d",notes:e+"\u552f\u4e00\u7684\u8eab\u4efd\u540d\uff0c\u4e00\u65e6\u786e\u5b9a\uff0c\u4e0d\u53ef\u80fd\u66f4\u6539"}}];return a.a.createElement(s.e,{header:this.title},a.a.createElement("div",{className:"m-4"}),a.a.createElement(we,{ref:e=>this.form=e,className:"m-3",formRows:t,onSubmit:this.onSubmit}))})}showEntry({title:e,unitType:t,msg:n}){return Ha(this,void 0,void 0,function*(){this.title=e,this.unitType=t,this.msg=n,this.openPage(this.view)})}onProcessMessage(e){return Ha(this,void 0,void 0,function*(){let{id:t}=this.msg;yield jt.store.unit.messageAct(t,e),s.o.pop()})}}var Ja=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})};class Ga extends s.f{constructor(){super(!0),this.appendPosition="head"}load(){return Ja(this,void 0,void 0,function*(){return yield ya.a.unitMessages(0,this.pageStart,this.pageSize)})}setPageStart(e){this.pageStart=void 0===e?void 0:e.id}end(e){this.items.find(t=>t.id===e)}remove(e){let t=this.items.find(t=>t.id===e);void 0!==t&&this.items.remove(t)}addMessage(e){this.remove(e.id),this.append(e),void 0===this.unread&&(this.unread=0),++this.unread}}(function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);a>3&&o&&Object.defineProperty(t,n,o)})([c.k],Ga.prototype,"unread",void 0);var Ya=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})};class Xa extends s.c{constructor(){super({}),this.onApplyItemClick=(e=>Ya(this,void 0,void 0,function*(){this.openPage(this.applyPage(e))})),this.onApproveItemClick=((e,t,n)=>Ya(this,void 0,void 0,function*(){yield this.showVPage(Qa,{msg:e,unitType:t,title:n})})),this.approve=(e=>Ya(this,void 0,void 0,function*(){yield ya.a.actMessage({unit:0,id:e.id,action:"approve"}),e.state=1,this.closePage()})),this.refuse=(e=>Ya(this,void 0,void 0,function*(){yield ya.a.actMessage({unit:0,id:e.id,action:"refuse"}),e.state=-1,this.closePage()})),this.applyPage=(e=>{let t,{state:n}=e;return 0===n&&(t=a.a.createElement("div",{className:"m-3"},a.a.createElement("button",{className:"btn btn-success",onClick:()=>this.approve(e)},"\u6279\u51c6"),a.a.createElement("button",{onClick:()=>this.refuse(e),className:"btn btn-outline-primary ml-3"},"\u62d2\u7edd"))),a.a.createElement(s.e,{header:"\u5904\u7406\u7533\u8bf7"},a.a.createElement("div",{className:"my-3 mx-2"},a.a.createElement("div",{className:"bg-white"},Ba(e,void 0)),t))})}internalStart(e){return Ya(this,void 0,void 0,function*(){this.messages=new Ga,yield this.messages.first(void 0),this.showVPage(Za)})}unitCreate(e,t){return Ya(this,void 0,void 0,function*(){return yield ya.a.unitCreate(e,t)})}}class Za extends s.i{constructor(){super(...arguments),this.renderMessage=(e=>{let t,n;switch(e.type){default:throw e.type;case"apply-unit":t=$a,n=this.controller.onApplyItemClick;break;case"apply-dev":t=Ba,n=this.controller.onApplyItemClick;break;case"approve-unit":t=Ka,n=this.controller.onApproveItemClick;break;case"approve-dev":t=za,n=this.controller.onApproveItemClick}return t(e,n)}),this.messagesPage=(()=>{let{items:e}=this.controller.messages;return a.a.createElement(s.e,{header:"\u6d88\u606f"},a.a.createElement(_e,{items:e,item:{render:this.renderMessage,onClick:void 0}}))})}showEntry(e){return Ya(this,void 0,void 0,function*(){this.openPage(this.messagesPage)})}}var eo=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})};let to=class extends i.Component{constructor(){super(...arguments),this.stickyClick=(e=>eo(this,void 0,void 0,function*(){let t=e.objId;if(0===t){let e=new Xa;return void(yield e.start())}let n=t;if(s.n.unit=n,yield jt.store.setUnit(n),1===jt.store.unit.type){return void Qi(yield jt.store.getAdminApp(),n)}let r=new Aa(jt.store.unit);yield r.start()})),this.stickyRender=((e,t)=>{let n,{type:r,date:i,objId:a,obj:o}=e,s=jt.store.units.get(a);switch(void 0!==s&&(n=s.unread,i=s.date),r){case 3:case 0:if(void 0===o)return;return this.stickyUnit(i,o,n)}})}componentDidMount(){return eo(this,void 0,void 0,function*(){yield jt.store.loadStickies()})}stickyUnit(e,t,n){let r,{name:a,nick:o,discription:s,icon:c,date:u,subject:l}=t;return r=void 0!==l?i.createElement("div",{className:"small text-success"},l):i.createElement("div",{className:"small text-muted"},s),i.createElement(et,{className:"px-3 py-2",left:i.createElement(Ye,{badge:n||t.unread},i.createElement("img",{src:c||St.appItemIcon})),right:i.createElement("small",{className:"text-muted"},i.createElement(Ve,{date:e}))},i.createElement("div",{className:"px-3"},i.createElement("div",null,i.createElement("b",null,o||a)),r))}render(){let e=jt.store.stickies;return i.createElement("div",null,i.createElement(_e,{items:e,item:{render:this.stickyRender,onClick:this.stickyClick},loading:"\u8bfb\u53d6..."}))}};var no=to=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o}([Et.a],to),ro=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})};let io=class extends i.Component{constructor(e){super(e),this.converter=this.converter.bind(this),this.accept=this.accept.bind(this),this.refuse=this.refuse.bind(this)}test0(){return ro(this,void 0,void 0,function*(){yield ya.a.postMessage(1,{type:"new-follow",count:0})})}test1(){return ro(this,void 0,void 0,function*(){yield ya.a.postMessage(1,{type:"new-follow",count:1})})}componentDidMount(){return ro(this,void 0,void 0,function*(){let e=jt.store.follow;yield e.loadInvites(),e.newInvitesCount=void 0})}componentWillUnmount(){return ro(this,void 0,void 0,function*(){jt.store.follow.newInvitesCount=0})}accept(e){return ro(this,void 0,void 0,function*(){yield jt.store.acceptFellowInvite(e),s.o.replace(i.createElement(s.e,{header:"\u63a5\u53d7\u9080\u8bf7",back:"close"},i.createElement("div",{className:"card"},i.createElement("div",{className:"card-body"},i.createElement("div",{className:"card-title"},"\u5c0f\u53f7\u6210\u5458"),i.createElement("div",{className:"card-text"},"\u4f60\u5df2\u6210\u4e3a","-","\u7684\u6210\u5458\u3002"),i.createElement("button",{className:"btn btn-primary",onClick:()=>s.o.back()},"\u5b8c\u6210")))))})}refuse(e){return ro(this,void 0,void 0,function*(){yield jt.store.follow.refuseInvite(e)})}converter(e){let{name:t,nick:n,icon:r}={name:"name",nick:"nick",icon:"icon"},a=t;void 0!==n&&(a+=" - "+n);return{key:e.id,main:a,icon:r||St.appIcon,middle:"\u9080\u8bf7\u6210\u4e3a\u5c0f\u53f7\u7ba1\u7406\u5458",midSize:3,right:i.createElement("div",null,i.createElement("button",{className:"mr-2 btn btn-success btn-sm",onClick:()=>ro(this,void 0,void 0,function*(){return yield this.accept(e)})},"\u63a5\u53d7"),i.createElement("button",{className:"btn btn-sm btn-outline-danger",onClick:()=>ro(this,void 0,void 0,function*(){return yield this.refuse(e)})},"\u62d2\u7edd"))}}render(){let e=jt.store.follow.invites;return i.createElement(s.e,{header:"\u9080\u8bf7"},"\u65b0\u6536\u5f55",i.createElement("button",{className:"btn btn-primary",onClick:this.test1},"WS1"),i.createElement("button",{className:"btn btn-primary",onClick:this.test0},"WS0"),i.createElement(vt,{items:e,converter:this.converter}))}};var ao=io=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o}([Et.a],io);const oo={backgroundColor:"#cfcfff",margin:"0",padding:"6px"},so={color:"green"},co=e=>i.createElement("div",{style:oo},i.createElement("i",{style:so,className:"fa fa-lg fa-"+e}));let uo=class extends i.Component{constructor(e){super(e),this.actions=[{key:1,main:"\u9080\u8bf7\u4f60\u6210\u4e3a\u7ba1\u7406\u5458",icon:co("user-plus"),onClick:()=>s.o.push(i.createElement(ao,null)),unread:Object(c.d)(()=>jt.store.follow.newInvitesCount)}]}tieConverter(e){return{key:e.id,date:void 0,main:void 0,icon:St.appItemIcon}}render(){return i.createElement("div",{className:"px-3 py-2 small text-muted"},"\u6b63\u5728\u5f00\u53d1\u4e2d...")}};var lo=uo=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o}([Et.a],uo);class ho extends i.Component{render(){return i.createElement("div",{className:"m-3"},"\u540c\u82b1")}}var fo=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})};const po="\u7533\u8bf7\u521b\u5efa\u5c0f\u53f7",vo="\u7533\u8bf7\u5f00\u53d1\u5e94\u7528";class mo extends i.Component{constructor(){super(...arguments),this.onSubmit=(e=>fo(this,void 0,void 0,function*(){let{formView:t}=this.form,{orgPassword:n,newPassword:r,newPassword1:a}=e;r===a?!1!==(yield ya.a.resetPassword({orgPassword:n,newPassword:r}))?s.o.replace(i.createElement(s.e,{header:"\u4fee\u6539\u5bc6\u7801",back:"close"},i.createElement("div",{className:"m-3  text-success"},"\u5bc6\u7801\u4fee\u6539\u6210\u529f\uff01"))):t.setError("orgPassword","\u539f\u5bc6\u7801\u9519\u8bef"):t.setError("newPassword1","\u65b0\u5bc6\u7801\u9519\u8bef\uff0c\u8bf7\u91cd\u65b0\u8f93\u5165")}))}render(){return i.createElement(s.e,{header:"\u4fee\u6539\u5bc6\u7801"},i.createElement(we,{ref:e=>this.form=e,className:"m-3",formRows:[{label:"\u539f\u5bc6\u7801",field:{name:"orgPassword",type:"string",maxLength:60,required:!0},face:{type:"password",placeholder:"\u8f93\u5165\u539f\u6765\u7684\u5bc6\u7801"}},{label:"\u65b0\u5bc6\u7801",field:{name:"newPassword",type:"string",maxLength:60,required:!0},face:{type:"password",placeholder:"\u8f93\u5165\u65b0\u8bbe\u7684\u5bc6\u7801"}},{label:"\u786e\u8ba4\u5bc6\u7801",field:{name:"newPassword1",type:"string",maxLength:60,required:!0},face:{type:"password",placeholder:"\u518d\u6b21\u8f93\u5165\u65b0\u8bbe\u5bc6\u7801"}}],onSubmit:this.onSubmit}))}}var yo=class extends i.Component{constructor(e){super(e),this.changePassword=(()=>{s.o.push(i.createElement(mo,null))}),this.exit=this.exit.bind(this),this.about=this.about.bind(this),this.apply=this.apply.bind(this),this.applyUnit=this.applyUnit.bind(this),this.applyDev=this.applyDev.bind(this),this.onApplySubmit=this.onApplySubmit.bind(this)}exit(){confirm("\u9000\u51fa\u5f53\u524d\u8d26\u53f7\u4e0d\u4f1a\u5220\u9664\u4efb\u4f55\u5386\u53f2\u6570\u636e\uff0c\u4e0b\u6b21\u767b\u5f55\u4f9d\u7136\u53ef\u4ee5\u4f7f\u7528\u672c\u8d26\u53f7")&&(s.o.logout(),jt.store.logout())}about(){let e=i.createElement("button",{className:"btn btn-success btn-sm",onClick:this.showLogs},"log");s.o.push(i.createElement(s.e,{header:"\u5173\u4e8e\u540c\u82b1",right:e},i.createElement(ho,null)))}showLogs(){s.o.push(i.createElement(s.e,{header:"Logs"},s.o.logs.map((e,t)=>i.createElement("div",{key:t,className:"px-3 py-1"},e))))}apply(){let e=["",{type:"component",component:i.createElement(it,{iconClass:"text-info",icon:"envelope",text:po}),onClick:this.applyUnit},"=",{type:"component",component:i.createElement(it,{iconClass:"text-info",icon:"envelope-o",text:vo}),onClick:this.applyDev}];s.o.push(i.createElement(s.e,{header:"\u7533\u8bf7"},i.createElement(Qe,{rows:e,values:{}})))}applyUnit(){this.showApplyPage("unit")}applyDev(){this.showApplyPage("dev")}showApplyPage(e){let t={name:{name:"name",type:"string",maxLength:50,required:!0},phone:{name:"phone",type:"string",maxLength:20},owner:{name:"owner",type:"string",maxLength:100}},n=[{label:"\u7533\u8bf7\u4eba",field:t.name,face:{type:"string",placeholder:"\u771f\u5b9e\u59d3\u540d"}},{label:"\u7535\u8bdd",field:t.phone},{label:"\u5355\u4f4d",field:t.owner,face:{type:"textarea",placeholder:"\u7533\u8bf7\u5355\u4f4d"}}];s.o.push(i.createElement(s.e,{header:"unit"===e?po:vo},i.createElement(we,{className:"m-3",formRows:n,onSubmit:t=>this.onApplySubmit(e,t)})))}onApplySubmit(e,t){return fo(this,void 0,void 0,function*(){yield ya.a.saveMessage({toUser:-1,fromApp:0,type:"apply-"+e,content:t}),s.o.pop(2),s.o.push(i.createElement(s.e,{header:"\u5b8c\u6210",back:"close"},i.createElement("div",{className:"card"},i.createElement("div",{className:"card-body"},i.createElement("div",{className:"card-title"},"\u7533\u8bf7\u5df2\u53d1\u9001"),i.createElement("div",{className:"card-text"},"\u8bf7\u7a0d\u7b49\uff0c\u6211\u4eec\u4f1a\u5c3d\u5feb\u5904\u7406\u3002"),i.createElement("button",{className:"btn btn-primary",onClick:()=>s.o.back()},"\u5b8c\u6210")))))})}render(){const{user:e}=s.o;let t=["",{type:"component",component:i.createElement(ct,{icon:St.appIcon,main:e.name,discription:String(e.id)})},"",{type:"component",component:i.createElement(it,{iconClass:"text-info",icon:"envelope",text:"\u7533\u8bf7"}),onClick:this.apply},"",{type:"component",component:i.createElement(it,{iconClass:"text-info",icon:"envelope",text:"\u4fee\u6539\u5bc6\u7801"}),onClick:this.changePassword},"",{type:"component",component:i.createElement(it,{iconClass:"text-info",icon:"envelope",text:"\u5173\u4e8e\u540c\u82b1"}),onClick:this.about},"","",{type:"component",bk:"",component:i.createElement("button",{className:"btn btn-danger w-100",onClick:this.exit},i.createElement(nt,{name:"sign-out",size:"lg"})," \u9000\u51fa\u767b\u5f55")}];return i.createElement(Qe,{rows:t,values:{}})}},bo=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})};class wo extends i.Component{constructor(e){super(e),this.state={loaded:!1,hao:{unit:this.props.unit,id:this.props.hao,name:e.name,nick:e.nick,discription:e.discription,icon:e.icon,isFollowed:e.isFollowed}},this.follow=this.follow.bind(this)}follow(){return bo(this,void 0,void 0,function*(){let{hao:e,name:t,nick:n,discription:r,icon:i}=this.props;yield jt.store.followUnit(e),s.o.ceaseTop(2),yield jt.store.setUnit(e);let a=new Aa(jt.store.unit);yield a.start()})}render(){let e=this.state.hao,{nick:t,discription:n,name:r,icon:a,isFollowed:o}=e;return i.createElement(s.e,{header:"APP\u8be6\u60c5"},i.createElement("div",{className:"px-3 d-flex flex-column"},i.createElement("div",{className:"my-3"},i.createElement(ct,{icon:a||St.appIcon,main:r,discription:n})),i.createElement("div",{className:"w-75 align-self-center"},1===o?i.createElement("button",{className:"btn btn-outline-primary form-control",disabled:!0},"\u5df2\u5173\u6ce8"):i.createElement("button",{className:"btn btn-primary form-control",onClick:this.follow},"\u5173\u6ce8"))))}}var ko=class extends i.Component{constructor(e){super(e),this.onSearch=(e=>bo(this,void 0,void 0,function*(){this.setState({loading:!0});let t=yield ya.a.searchUnits(e,0,30);this.setState({hasMore:!1,loading:!1,haos:t})})),this.onScrollBottom=(()=>{!1!==this.hasMore&&this.search()}),this.haoClicked=(e=>{s.o.push(i.createElement(wo,{unit:e.unit,hao:e.id,name:e.name,nick:e.nick,discription:e.discription,icon:e.icon,isFollowed:e.isFollowed}))}),this.renderUnit=((e,t)=>{let{nick:n,discription:r,name:a,icon:o}=e,s=i.createElement(Ye,null,i.createElement("img",{src:o||St.appItemIcon}));return i.createElement(et,{className:"px-3 py-2",left:s},i.createElement("div",{className:"px-3"},i.createElement("div",null,a),i.createElement(at,null,r)))}),this.isSearching=!1,this.hasMore=!1,this.state={hasMore:this.hasMore,loading:this.isSearching,haos:this.haos}}search(){this.isSearching=!0}render(){let e,t,n,r=i.createElement(kt,{onSearch:this.onSearch,className:"w-100 mx-1",placeholder:"\u641c\u7d22\u5c0f\u53f7",maxLength:100}),a=this.state.haos;return void 0!==a&&(e=0===a.length?i.createElement("div",{className:"p-3 small text-muted"},"\u6ca1\u6709\u627e\u5230\u5c0f\u53f7"):i.createElement(_e,{items:a,item:{render:this.renderUnit,onClick:this.haoClicked}})),this.state.loading?t="\u6b63\u5728\u641c\u7d22...":this.state.hasMore&&(t="\u66f4\u591a\u5185\u5bb9..."),t&&(n=i.createElement("div",{style:{height:"50px",textAlign:"center"}},t)),i.createElement(s.e,{header:r,onScrollBottom:this.onScrollBottom},e,n)}},go=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})};const xo=[{title:"\u540c\u82b1",content:i.createElement(no,null),redDot:Object(c.d)(()=>{let e=0;return jt.store.units.forEach(t=>{let n=t.unread;void 0!==n&&(e+=n)}),-e})},{title:"\u6536\u5f55",content:i.createElement(lo,null),redDot:Object(c.d)(()=>jt.store.follow.newInvitesCount)},{title:"\u53d1\u73b0",content:i.createElement(class extends i.Component{render(){return i.createElement("div",{className:"px-3 py-2 small text-muted"},"\u53d1\u73b0\u5404\u79cd\u8d44\u6e90\uff0c\u6b63\u5728\u5f00\u53d1\u4e2d...")}},null)},{title:"\u6211",content:i.createElement(yo,null)}];class Oo extends i.Component{constructor(){super(...arguments),this.addXiaoHao=(()=>go(this,void 0,void 0,function*(){return s.o.push(i.createElement(ko,null))})),this.rightMenu=[{caption:"\u6dfb\u52a0\u5c0f\u53f7",icon:"plus",action:this.addXiaoHao}],this.onWs=(e=>go(this,void 0,void 0,function*(){console.log("ws received: %s",e),yield jt.store.onWs(e)}))}componentDidMount(){return go(this,void 0,void 0,function*(){this.rcvHandler=s.o.registerReceiveHandler(this.onWs)})}componentWillUnmount(){s.o.unregisterReceiveHandler(this.rcvHandler)}render(){null===parent||parent.location.href;let e=i.createElement(Ae,{actions:this.rightMenu});return i.createElement(s.e,{tabs:xo,right:e})}}n(106),n(108);var jo=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})};var Eo=class extends i.Component{onLogined(){return jo(this,void 0,void 0,function*(){s.o.clear(),s.o.push(i.createElement(Oo,null))})}render(){return i.createElement(s.d,{onLogined:this.onLogined})}};const Co=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function So(e){navigator.serviceWorker.register(e).then(e=>{e.onupdatefound=(()=>{const t=e.installing;t&&(t.onstatechange=(()=>{"installed"===t.state&&(navigator.serviceWorker.controller?console.log("New content is available; please refresh."):console.log("Content is cached for offline use."))}))})}).catch(e=>{console.error("Error during service worker registration:",e)})}n(110);o.render(i.createElement(Eo,null),document.getElementById("root")),function(){if("serviceWorker"in navigator){if(new URL("/app",window.location.toString()).origin!==window.location.origin)return;window.addEventListener("load",()=>{const e="/app/service-worker.js";Co?function(e){fetch(e).then(t=>{404===t.status||-1===t.headers.get("content-type").indexOf("javascript")?navigator.serviceWorker.ready.then(e=>{e.unregister().then(()=>{window.location.reload()})}):So(e)}).catch(()=>{console.log("No internet connection found. App is running in offline mode.")})}(e):So(e)})}}()}],[[69,3,2]]]);
//# sourceMappingURL=main.341fff75.chunk.js.map