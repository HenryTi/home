(window.webpackJsonp=window.webpackJsonp||[]).push([[0],[,,,function(e,t,i){"use strict";i(37),i(19);var n=i(10);i.d(t,"CenterApi",function(){return n.a}),i.d(t,"host",function(){return n.d}),i.d(t,"meInFrame",function(){return n.g});var r=i(15);i.o(r,"Controller")&&i.d(t,"Controller",function(){return r.Controller}),i.o(r,"Form")&&i.d(t,"Form",function(){return r.Form}),i.o(r,"NavView")&&i.d(t,"NavView",function(){return r.NavView}),i.o(r,"Page")&&i.d(t,"Page",function(){return r.Page}),i.o(r,"VPage")&&i.d(t,"VPage",function(){return r.VPage}),i.o(r,"View")&&i.d(t,"View",function(){return r.View}),i.o(r,"nav")&&i.d(t,"nav",function(){return r.nav});i(18);var s=i(46);i.d(t,"PageItems",function(){return s.a});var o=i(47);i.d(t,"CacheIds",function(){return o.a})},,function(e,t,i){"use strict";var n=i(28);i.o(n,"Badge")&&i.d(t,"Badge",function(){return n.Badge}),i.o(n,"EasyDate")&&i.d(t,"EasyDate",function(){return n.EasyDate}),i.o(n,"FA")&&i.d(t,"FA",function(){return n.FA}),i.o(n,"IconText")&&i.d(t,"IconText",function(){return n.IconText}),i.o(n,"Image")&&i.d(t,"Image",function(){return n.Image}),i.o(n,"LMR")&&i.d(t,"LMR",function(){return n.LMR}),i.o(n,"List")&&i.d(t,"List",function(){return n.List}),i.o(n,"Media")&&i.d(t,"Media",function(){return n.Media}),i.o(n,"Muted")&&i.d(t,"Muted",function(){return n.Muted}),i.o(n,"PropGrid")&&i.d(t,"PropGrid",function(){return n.PropGrid}),i.o(n,"TonvaForm")&&i.d(t,"TonvaForm",function(){return n.TonvaForm});var r=i(60);i.d(t,"List",function(){return r.a});i(52);var s=i(53);i.d(t,"EasyDate",function(){return s.a});var o=i(61);i.d(t,"PropGrid",function(){return o.a});var a=i(59);i.d(t,"Badge",function(){return a.a}),i.d(t,"FA",function(){return a.b}),i.d(t,"IconText",function(){return a.c}),i.d(t,"Image",function(){return a.d}),i.d(t,"LMR",function(){return a.e}),i.d(t,"Muted",function(){return a.f});var l=i(54);i.d(t,"Media",function(){return l.a});i(62),i(55),i(56),i(14)},,function(e,t,i){"use strict";(function(e){i.d(t,"b",function(){return g}),i.d(t,"a",function(){return E}),i.d(t,"c",function(){return k});var n=i(0),r=i(1),s=i(19),o=i(17),a=i(34),l=i(65),c=i(11),u=i(66),d=i(10),h=(i(38),i(68),i(81),i(83),i(13)),p=i(22),f=i(27),m=function(e,t,i,n){var r,s=arguments.length,o=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,i,o):r(t,i))||o);return s>3&&o&&Object.defineProperty(t,i,o),o},v=function(e,t,i,n){return new(i||(i=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(t){s(t)}}function a(e){try{l(n.throw(e))}catch(t){s(t)}}function l(e){e.done?r(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};const g=new RegExp("Android|webOS|iPhone|iPad|BlackBerry|Windows Phone|Opera Mini|IEMobile|Mobile","i").test(navigator.userAgent)?{minHeight:"3em"}:void 0;i(69);let y;const b=[];let w=1;class E extends n.Component{constructor(e){super(e),this.waitCount=0,this.isHistoryBack=!1,this.clearError=(()=>{this.setState({fetchError:void 0})}),this.back=this.back.bind(this),this.navBack=this.navBack.bind(this),this.stack=[],this.state={stack:this.stack,wait:0,fetchError:void 0}}componentWillMount(){return v(this,void 0,void 0,function*(){window.addEventListener("popstate",this.navBack)})}componentDidMount(){return v(this,void 0,void 0,function*(){k.set(this),yield k.start()})}get level(){return this.stack.length}startWait(){0===this.waitCount&&(this.setState({wait:1}),this.waitTimeHandler=e.setTimeout(()=>{this.waitTimeHandler=void 0,this.setState({wait:2})},1e3)),++this.waitCount,this.setState({fetchError:void 0})}endWait(){setTimeout(()=>{--this.waitCount,0===this.waitCount&&(void 0!==this.waitTimeHandler&&(clearTimeout(this.waitTimeHandler),this.waitTimeHandler=void 0),this.setState({wait:0}))},100)}onError(e){return v(this,void 0,void 0,function*(){let t=e.error;void 0===t||!0!==t.unauthorized?this.setState({fetchError:e}):yield k.showLogin()})}show(e,t){return this.clear(),this.push(e,t)}push(e,t){this.removeCeased(),this.stack.length>0&&window.history.pushState("forward",null,null);let i=w++;return this.stack.push({key:i,view:e,ceased:!1,disposer:t}),this.refresh(),i}replace(e,t){let i=void 0,n=this.stack;n.length>0&&(i=n.pop());let r=w++;return this.stack.push({key:r,view:e,ceased:!1,disposer:t}),void 0!==i&&this.dispose(i.disposer),this.refresh(),r}ceaseTop(e=1){let t=this.stack.length-1;for(let i=0;i<e&&!(t<0);i++,t--){this.stack[t].ceased=!0}}pop(e=1){let t=this.stack,i=t.length;if(e<=0||i<=1)return;i<e&&(e=i);let n=0;for(let r=0;r<e&&0!==t.length;r++)this.popAndDispose(),++n;n>=i&&n--,this.refresh(),this.isHistoryBack}popTo(e){throw new Error("to be designed")}removeCeased(){for(;;){let e=this.stack.length-1;if(e<0)break;if(!1===this.stack[e].ceased)break;let t=this.stack.pop(),{disposer:i}=t;this.dispose(i)}this.refresh()}popAndDispose(){this.removeCeased();let e=this.stack.pop();if(void 0===e)return;let{disposer:t}=e;return this.dispose(t),this.removeCeased(),e}dispose(e){if(void 0===e)return;void 0===this.stack.find(t=>t.disposer===e)&&e()}clear(){this.stack.length;for(;this.stack.length>0;)this.popAndDispose();this.refresh()}regConfirmClose(e){let t=this.stack,i=t.length;0!==i&&(t[i-1].confirmClose=e)}navBack(){k.log("backbutton pressed - nav level: "+this.stack.length),this.isHistoryBack=!0,this.back(!0),this.isHistoryBack=!1}back(e=!0){return v(this,void 0,void 0,function*(){let t=this.stack,i=t.length;if(0===i)return;if(1===i)return void(self!=window.top&&window.top.postMessage({type:"pop-app"},"*"));let n=t[i-1];!0===e&&n.confirmClose?!0===(yield n.confirmClose())&&this.pop():this.pop()})}confirmBox(e){return window.confirm(e)}render(){const{wait:e,fetchError:t}=this.state;let i=this.state.stack,r=i.length-1,s=null,o=null;switch(e){case 1:s=n.createElement("li",{className:"va-wait va-wait1"});break;case 2:s=n.createElement("li",{className:"va-wait va-wait2"},n.createElement("i",{className:"fa fa-spinner fa-spin fa-3x fa-fw"}),n.createElement("span",{className:"sr-only"},"Loading..."))}return t&&(o=n.createElement(l.a,Object.assign({clearError:this.clearError},t))),n.createElement("ul",{className:"va"},i.map((e,t)=>{let{key:i,view:s}=e;return n.createElement("li",{key:i,style:t<r?{visibility:"hidden"}:void 0},s)}),s,o)}refresh(){this.setState({stack:this.stack})}}class x{constructor(){this.local=new u.a,this.user=void 0;let{lang:e,district:t}=p.b;this.language=e,this.culture=t}get guest(){let e=this.local.guest;if(void 0===e)return 0;let t=e.get();return void 0===t?0:t.guest}set(e){this.nav=e}registerReceiveHandler(e){if(void 0!==this.ws)return this.ws.onWsReceiveAny(e)}unregisterReceiveHandler(e){void 0!==this.ws&&void 0!==e&&this.ws.endWsReceive(e)}onReceive(e){return v(this,void 0,void 0,function*(){void 0!==this.ws&&(yield this.ws.receive(e))})}getUnitName(){return v(this,void 0,void 0,function*(){try{let t=yield fetch("unit.json",{});return(yield t.json()).unit}catch(e){return void this.local.unit.clear()}})}loadUnit(){return v(this,void 0,void 0,function*(){let e,t=this.local.unit.get();if(void 0!==t){if(!0!==d.e)return t.id;if(void 0===(e=yield this.getUnitName()))return;if(t.name===e)return t.id}else if(void 0===(e=yield this.getUnitName()))return;let i=yield d.c.unitFromName(e);return void 0!==i&&this.local.unit.set({id:i,name:e}),i})}start(){return v(this,void 0,void 0,function*(){k.clear(),k.push(n.createElement(o.a,{header:!1},n.createElement(f.a,null))),yield d.d.start();let{url:e,ws:t}=d.d;this.centerHost=e,this.wsHost=t,Object(d.j)(e);let i=yield this.loadUnit();d.g.unit=i;let r=this.local.guest.get();void 0===r&&(r=yield d.c.guest()),k.setGuest(r);let s=document.location.hash;if(console.log("url=%s hash=%s",document.location.origin,s),this.isInFrame=void 0!==s&&""!==s&&s.startsWith("#tv"),!0===this.isInFrame){let e=Object(c.g)(s);if(void 0!==e)return this.ws=h.c,console.log("this.ws = wsBridge in sub frame"),void(self!==window.parent&&window.parent.postMessage({type:"sub-frame-started",hash:e.hash},"*"))}let a=this.local.user.get();if(void 0!==a)yield k.logined(a);else{let{notLogined:e}=this.nav.props;void 0!==e?yield e():yield k.showLogin()}})}showAppView(){return v(this,void 0,void 0,function*(){let{onLogined:e}=this.nav.props;void 0!==e?(k.clear(),yield e(),console.log("logined: AppView shown")):k.push(n.createElement("div",null,"NavView has no prop onLogined"))})}setGuest(e){this.local.guest.set(e),a.a.set(0,e.token)}logined(e){return v(this,void 0,void 0,function*(){(this.ws=new d.b(this.wsHost,e.token)).connect(),console.log("logined: %s",JSON.stringify(e)),this.local.user.set(e),a.a.set(e.id,e.token),this.user=new s.a(e),yield this.showAppView()})}showLogin(e){return v(this,void 0,void 0,function*(){let t=yield i.e(1).then(i.bind(null,100)),r=n.createElement(t.default,{withBack:e});!0!==e&&(this.nav.clear(),this.pop()),this.nav.push(r)})}logout(e){return v(this,void 0,void 0,function*(){this.local.logoutClear(),this.user=void 0,Object(d.f)(),Object(c.e)();let t=this.local.guest.get();Object(d.i)(0,t&&t.token),this.ws=void 0,!0!==e&&(yield k.start())})}get level(){return this.nav.level}startWait(){this.nav.startWait()}endWait(){this.nav.endWait()}onError(e){return v(this,void 0,void 0,function*(){yield this.nav.onError(e)})}show(e,t){this.nav.show(e,t)}push(e,t){this.nav.push(e,t)}replace(e,t){this.nav.replace(e,t)}pop(e=1){this.nav.pop(e)}clear(){this.nav.clear()}navBack(){this.nav.navBack()}ceaseTop(e){this.nav.ceaseTop(e)}removeCeased(){this.nav.removeCeased()}back(e=!0){return v(this,void 0,void 0,function*(){yield this.nav.back(e)})}regConfirmClose(e){this.nav.regConfirmClose(e)}confirmBox(e){return this.nav.confirmBox(e)}navToApp(e,t,i,r,s){return v(this,void 0,void 0,function*(){return new Promise((o,a)=>{let l=!0===this.centerHost.includes("http://localhost:")?"sheet_debug":"sheet",u=void 0===s?Object(c.b)(e,t):Object(c.b)(e,t,l,[i,r,s]);console.log("navToApp: %s",JSON.stringify(u)),k.push(n.createElement("article",{className:"app-container"},n.createElement("span",{id:u.hash,onClick:()=>this.back(),style:g},n.createElement("i",{className:"fa fa-arrow-left"})),n.createElement("iframe",{src:u.url})),()=>{o()})})})}navToSite(e){window.open(e)}get logs(){return b}log(e){b.push(e)}logMark(){let e=new Date;y=e.getTime(),b.push("log-mark: "+e.toTimeString())}logStep(e){b.push(e+": "+((new Date).getTime()-y))}}m([r.l],x.prototype,"user",void 0);const k=new x}).call(this,i(32))},function(e,t,i){"use strict";i.d(t,"c",function(){return c}),i.d(t,"b",function(){return u}),i.d(t,"a",function(){return d});var n=i(0),r=i(1),s=i(6),o=function(e,t,i,n){var r,s=arguments.length,o=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,i,o):r(t,i))||o);return s>3&&o&&Object.defineProperty(t,i,o),o};class a{constructor(e,t,i,r,o){if(this.widgets={},this.errors=[],this.errorWidgets=[],this.renderErrors=Object(s.a)(()=>{let{errors:e}=this;return 0===e.length?null:n.createElement(n.Fragment,null,e.map(e=>n.createElement("span",{key:e,className:"text-danger inline-block my-1 ml-3"},n.createElement("i",{className:"fa fa-exclamation-circle"})," \xa0",e)))}),this.form=e,this.uiSchema=t,this.initData=i,this.inNode=r,this.isRow=o,void 0!==t){let{rules:e}=t;void 0!==e&&(this.rules=[],!1===Array.isArray(e)?this.rules.push(e):this.rules.push(...e))}}getArrRowContexts(e){void 0===this.subContexts&&(this.subContexts={});let t=this.subContexts[name];return void 0===t&&(this.subContexts[name]=t={}),t}get arrName(){}getValue(e){return this.initData[e]}setValue(e,t){this.initData[e]=t;let i=this.widgets[e];void 0!==i&&i.setValue(t)}getDisabled(e){let t=this.widgets[e];if(void 0!==t)return t.getDisabled()}setDisabled(e,t){let i=this.widgets[e];void 0!==i&&i.setDisabled(t)}getReadOnly(e){let t=this.widgets[e];void 0!==t&&t.getReadOnly()}setReadOnly(e,t){let i=this.widgets[e];void 0!==i&&i.setReadOnly(t)}getVisible(e){let t=this.widgets[e];void 0!==t&&t.getVisible()}setVisible(e,t){let i=this.widgets[e];void 0!==i&&i.setVisible(t)}checkFieldRules(){for(let e in this.widgets)this.widgets[e].checkRules();if(void 0!==this.subContexts)for(let e in this.subContexts){let t=this.subContexts[e];for(let e in t)t[e].checkFieldRules()}}checkContextRules(){if(void 0!==this.rules){this.clearContextErrors();for(let e of this.rules){let t=e(this);if(void 0!==t)if(!0===Array.isArray(t))this.errors.push(...t);else if("string"===typeof t)this.errors.push(t);else for(let e in t)this.setError(e,t[e])}if(void 0!==this.subContexts)for(let e in this.subContexts){let t=this.subContexts[e];for(let e in t){let i=t[e];i.removeErrors(),i.checkContextRules()}}}}setError(e,t){let i=this.widgets[e];void 0!==i&&(i.setContextError(t),this.addErrorWidget(i))}clearContextErrors(){for(let e in this.widgets)this.widgets[e].clearContextError()}checkRules(){this.checkFieldRules(),this.checkContextRules()}addErrorWidget(e){this.errorWidgets.findIndex(t=>t===e)<0&&this.errorWidgets.push(e)}removeErrorWidget(e){let t=this.errorWidgets.findIndex(t=>t===e);t>=0&&this.errorWidgets.splice(t,1)}checkHasError(){if(!0===this.errorWidgets.length+this.errors.length>0)return!0;if(void 0===this.subContexts)return!1;for(let e in this.subContexts){let t=this.subContexts[e];for(let e in t)if(!0===t[e].hasError)return!0}return!1}get hasError(){return this.checkHasError()}removeErrors(){this.errors.splice(0),this.errorWidgets.splice(0);for(let e in this.widgets){let t=this.widgets[e];void 0!==t&&t.clearContextError()}}}o([r.l],a.prototype,"errors",void 0),o([r.l],a.prototype,"errorWidgets",void 0),o([r.e],a.prototype,"hasError",null);let l=1;class c extends a{constructor(e,t,i,n){let r,{uiSchema:s}=e;if(void 0!==s){let{items:e}=s;void 0!==e&&(r=e[t.name])}super(e.form,r,i,n,!0),this.parentContext=e,this.arrSchema=t,this.rowKey=l++,this.data=i}getItemSchema(e){return this.arrSchema.itemSchemas[e]}getUiItem(e){if(void 0===this.uiSchema)return;let{items:t}=this.uiSchema;return void 0!==t?t[e]:void 0}get arrName(){return this.arrSchema.name}removeErrors(){super.removeErrors(),this.parentContext.removeErrors()}get parentData(){return this.parentContext.data}}class u extends a{constructor(e,t){super(e,e.uiSchema,e.data,t,!1)}get data(){return this.form.data}getItemSchema(e){return this.form.itemSchemas[e]}getUiItem(e){let{uiSchema:t}=this.form;if(void 0===t)return;let{items:i}=t;return void 0!==i?i[e]:void 0}}const d=n.createContext({})},function(e,t,i){"use strict";i.d(t,"b",function(){return o});var n=i(3),r=function(e,t,i,n){return new(i||(i=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(t){s(t)}}function a(e){try{l(n.throw(e))}catch(t){s(t)}}function l(e){e.done?r(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};const s=new class extends n.CenterApi{stickies(){return r(this,void 0,void 0,function*(){return yield this.get("sticky/list",{start:0,pageSize:30})})}ties(){return r(this,void 0,void 0,function*(){return yield this.get("tie/list",{start:0,pageSize:30})})}searchUnits(e,t,i){return r(this,void 0,void 0,function*(){return yield this.get("tie/search-unit",{key:e,pageStart:t,pageSize:i})})}searchUnitsFollow(e){return r(this,void 0,void 0,function*(){return yield this.get("tie/search-unit-follow",{unit:e})})}unitNotFollow(e){return r(this,void 0,void 0,function*(){yield this.get("tie/unit-not-follow",{unit:e})})}apps(e){return r(this,void 0,void 0,function*(){return yield this.get("tie/apps",{unit:e})})}unitxApi(e){return r(this,void 0,void 0,function*(){return yield this.get("tie/apps",{unit:e})})}adminUrl(){return r(this,void 0,void 0,function*(){return yield this.get("tie/admin-url",{})})}appFromId(e){return r(this,void 0,void 0,function*(){return yield this.get("tie/app-id",{appId:e})})}appApi(e,t,i){return r(this,void 0,void 0,function*(){return yield this.get("tie/app-api",{unit:e,app:t,apiName:i})})}unitMessages(e,t,i){return r(this,void 0,void 0,function*(){return yield this.get("tie/message-inbox",{unit:e,pageStart:t,pageSize:i})})}messagesRead(e){return r(this,void 0,void 0,function*(){return yield this.get("tie/message-read",{unit:e})})}unitAddFellow(e){return r(this,void 0,void 0,function*(){return yield this.get("unit/add-fellow",{invite:e})})}removeMessage(e){return r(this,void 0,void 0,function*(){yield this.get("tie/remove-message",{id:e})})}unitAdmins(e){return r(this,void 0,void 0,function*(){return yield this.get("unit/admins",{unit:e})})}unitCreate(e,t){return r(this,void 0,void 0,function*(){return yield this.post("unit/create",{name:e,message:t})})}saveMessage(e){return r(this,void 0,void 0,function*(){return yield this.post("tie/message-save",e)})}actMessage(e){return r(this,void 0,void 0,function*(){yield this.post("tie/message-act",e)})}userBase(e){return r(this,void 0,void 0,function*(){return yield this.get("tie/user",{id:e})})}unitBase(e){return r(this,void 0,void 0,function*(){return yield this.get("tie/unit",{id:e})})}postMessage(e,t){return r(this,void 0,void 0,function*(){return yield this.post("test/post",{to:e,message:t})})}membersFromName(e){return r(this,void 0,void 0,function*(){return yield this.get("unit/members-from-name",e)})}resetPassword(e){return r(this,void 0,void 0,function*(){return yield this.post("tie/reset-password",e)})}}("tv/",void 0);t.a=s;const o=new class extends n.CenterApi{messageUnread(){return r(this,void 0,void 0,function*(){return yield this.get("tie/message-unread",{})})}messageRead(e){return r(this,void 0,void 0,function*(){return yield this.get("tie/message-read",{unit:e})})}typeMessageCount(){return r(this,void 0,void 0,function*(){return yield this.get("tie/message-type-count",{})})}readMessages(e){return r(this,void 0,void 0,function*(){0!==e.length&&(yield this.post("tie/read-messages",{ids:e.join(";")}))})}}("tv/",!1)},function(e,t,i){"use strict";var n=i(13),r=i(25),s=i(19),o=i(12),a=function(e,t,i,n){return new(i||(i=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(t){s(t)}}function a(e){try{l(n.throw(e))}catch(t){s(t)}}function l(e){e.done?r(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};const l=new class extends o.a{guest(){return a(this,void 0,void 0,function*(){let e=yield this.get("",{});switch(typeof e){default:return;case"string":return Object(s.b)(e);case"object":return Object(s.b)(e.token)}})}unitFromName(e){return a(this,void 0,void 0,function*(){let t=yield this.get(e);return t&&t.unit})}}("tv/guest/",void 0);var c=i(11),u=i(16);i(20);i.d(t,"b",function(){return n.a}),i.d(t,"h",function(){return r.b}),i.d(t,"c",function(){return l}),i.d(t,"f",function(){return o.e}),i.d(t,"j",function(){return o.g}),i.d(t,"i",function(){return o.f}),i.d(t,"a",function(){return o.a}),i.d(t,"g",function(){return c.f}),i.d(t,"e",function(){return u.b}),i.d(t,"d",function(){return u.a})},function(e,t,i){"use strict";i.d(t,"e",function(){return h}),i.d(t,"f",function(){return f}),i.d(t,"d",function(){return m}),i.d(t,"g",function(){return v}),i.d(t,"b",function(){return g}),i.d(t,"a",function(){return y}),i.d(t,"c",function(){return w});var n=i(4),r=i.n(n),s=i(15),o=i(18),a=i(12),l=i(13),c=i(16),u=function(e,t,i,n){return new(i||(i=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(t){s(t)}}function a(e){try{l(n.throw(e))}catch(t){s(t)}}function l(e){e.done?r(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};const d={};function h(){for(let e in d)d[e]=void 0}const p={};let f=new class{get unit(){return this._unit}set unit(e){this._unit=e}};function m(){return self!==window.parent}function v(e){let t=e.split("-"),i=t.length;return f.hash=t[0].substr(3),i>0&&(f.unit=Number(t[1])),i>1&&(f.page=t[2]),i>2&&(f.param=t.slice(3)),f}function g(e,t,i,n){let r;for(;;){if(r=Object(o.a)(),void 0===p[r]){p[r]={hash:r,unit:t};break}}if(e+="#tv"+r+"-"+t,void 0!==i&&(e+="-"+i,void 0!==n))for(let s=0;s<n.length;s++)e+="-"+n[s];return{url:e,hash:r}}function y(e,t,i){return u(this,void 0,void 0,function*(){let n=d[e];if(void 0!==n)return n;if(!m()){if(void 0===(n=yield a.h.uq({unit:f.unit,uqOwner:t,uqName:i}))){throw"unauthorized call: uqTokenApi center return undefined!"}void 0===n.token&&(n.token=a.d);let{url:r,urlDebug:s}=n,o=c.a.getUrlOrDebug(r,s);return console.log("realUrl: %s",o),n.url=o,d[e]=n,n}return console.log("appApi parent send: %s",f.hash),n={name:e,url:void 0,urlDebug:void 0,token:void 0,resolve:void 0,reject:void 0},d[e]=n,new Promise((t,i)=>{n.resolve=(e=>u(this,void 0,void 0,function*(){let i=yield e;console.log("return from parent window: %s",JSON.stringify(i)),n.url=i.url,n.urlDebug=i.urlDebug,n.token=i.token,t(n)})),n.reject=i,(window.opener||window.parent).postMessage({type:"app-api",apiName:e,hash:f.hash},"*")})})}window.addEventListener("message",function(e){return u(this,void 0,void 0,function*(){var t=e.data;switch(t.type){case"sub-frame-started":!function(e){var t=e.data;let i=e.source;Object(l.b)(i),function(e){let t=document.getElementById(e);void 0!==t&&(t.hidden=!0)}(t.hash);let n=r.a.clone(s.nav.user);n.type="init-sub-win",i.postMessage(n,"*")}(e);break;case"ws":yield s.nav.onReceive(t.msg);break;case"init-sub-win":yield function(e){return u(this,void 0,void 0,function*(){console.log("initSubWin: set nav.user",e),s.nav.user=e,yield s.nav.showAppView()})}(t);break;case"pop-app":s.nav.navBack();break;case"center-api":yield function(e,t){return u(this,void 0,void 0,function*(){let{callId:i,url:n,method:r,body:s}=t,o=yield a.c.directCall(n,r,s);e.postMessage({type:"center-api-return",callId:i,result:o},"*")})}(e.source,t);break;case"center-api-return":!function(e){let{callId:t,result:i}=e,n=b[t];if(void 0===n)return;b[t]=void 0,n.resolve(i)}(t);break;case"app-api":console.log("receive PostMessage: %s",JSON.stringify(t));let i=yield function(e,t){return u(this,void 0,void 0,function*(){let i=p[e];if(void 0===i)return{name:t,url:void 0,urlDebug:void 0,token:void 0};let{unit:n}=i,r=t.split("/"),s=yield a.h.uq({unit:n,uqOwner:r[0],uqName:r[1]});if(void 0===s)throw console.log("apiTokenApi.api return undefined. api=%s, unit=%s",t,n),"api not found";return{name:t,url:s.url,urlDebug:s.urlDebug,token:s.token}})}(t.hash,t.apiName);console.log("onReceiveAppApiMessage: %s",JSON.stringify(i)),e.source.postMessage({type:"app-api-return",apiName:t.apiName,url:i.url,urlDebug:i.urlDebug,token:i.token},"*");break;case"app-api-return":console.log("app-api-return: %s",JSON.stringify(t)),console.log("await onAppApiReturn(message);"),yield function(e){return u(this,void 0,void 0,function*(){let{apiName:t,url:i,urlDebug:n,token:r}=e,s=d[t];if(void 0===s)throw"error app api return";let o=c.a.getUrlOrDebug(i,n);console.log("onAppApiReturn(message:any): url="+i+", debug="+n+", real="+o),s.url=o,s.token=r,s.resolve(s)})}(t);break;default:this.console.log("message: %s",JSON.stringify(t))}})});const b={};function w(e,t,i){return u(this,void 0,void 0,function*(){return console.log("bridgeCenterApi: url=%s, method=%s",e,t),yield new Promise((n,r)=>u(this,void 0,void 0,function*(){let s;for(;;){if(s=Object(o.a)(),void 0===b[s]){b[s]={id:s,resolve:n,reject:r};break}}(window.opener||window.parent).postMessage({type:"center-api",callId:s,url:e,method:t,body:i},"*")}))})}},function(e,t,i){"use strict";var n=i(4),r=i.n(n),s=i(20),o=i(7),a=function(e,t,i,n){return new(i||(i=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(t){s(t)}}function a(e){try{l(n.throw(e))}catch(t){s(t)}}function l(e){e.done?r(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class l{startWait(){o.c.startWait()}endWait(){o.c.endWait()}showError(e){return a(this,void 0,void 0,function*(){o.c.endWait(),yield o.c.onError(e)})}}i(11);var c=i(25);i(16);i.d(t,"e",function(){return p}),i.d(t,"g",function(){return g}),i.d(t,"d",function(){return w}),i.d(t,"f",function(){return x}),i.d(t,"a",function(){return k}),i.d(t,"h",function(){return N}),i.d(t,"c",function(){return P}),i.d(t,"b",function(){return O});var u=function(e,t,i,n){return new(i||(i=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(t){s(t)}}function a(e){try{l(n.throw(e))}catch(t){s(t)}}function l(e){e.done?r(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};let d={},h={};function p(){d={},h={},v={}}const f="uqLocalEntities";new class{loadAccess(e){return u(this,void 0,void 0,function*(){try{let i,{uqOwner:n,uqName:s}=e;if(void 0===this.local){let e=localStorage.getItem(f);null!==e&&(this.local=JSON.parse(e))}if(void 0!==this.local){let{user:e,uqs:t}=this.local;if(e!==E||void 0===t)this.local=void 0;else for(let i in t)t[i].isNet=void 0}void 0===this.local&&(this.local={user:E,unit:void 0,uqs:{}});let o=n+"/"+s,a=this.local.uqs[o];if(void 0!==a){let{value:e}=a;i=e}return void 0===i&&(i=yield e.__loadAccess(),this.saveLocal(o,i)),r.a.cloneDeep(i)}catch(t){throw this.local=void 0,localStorage.removeItem(f),t}})}saveLocal(e,t){this.local.uqs[e]={value:t,isNet:!0};let i=JSON.stringify(this.local);localStorage.setItem(f,i)}checkAccess(e){return u(this,void 0,void 0,function*(){let{uqOwner:t,uqName:i}=e,n=t+"/"+i,s=this.local.uqs[n];if(void 0===s)return!1;let{isNet:o,value:a}=s;if(!0===o)return!0;let l=yield e.__loadAccess(),c=r.a.isMatch(a,l);return!1===c&&this.saveLocal(n,l),c})}};let m,v={};function g(e){console.log("setCenterUrl %s",e),m=e,w=void 0,b=void 0,y=void 0}let y,b,w=void 0,E=0;function x(e,t){w=t,console.log("setCenterToken %s",t),b=void 0,y=void 0}class k extends c.a{constructor(e,t){super(e,t)}getHttpChannel(){return u(this,void 0,void 0,function*(){return!0===this.showWaiting||void 0===this.showWaiting?void 0!==y?y:y=new s.a(!0,m,w,new l):void 0!==b?b:b=new s.a(!0,m,w)})}}const C="uqTokens";const N=new class extends k{uq(e){return u(this,void 0,void 0,function*(){try{let{unit:i,uqOwner:n,uqName:r}=e;if(void 0===this.local){let e=localStorage.getItem(C);null!==e&&(this.local=JSON.parse(e))}if(void 0!==this.local){let{unit:e,user:t}=this.local;e===i&&t===E||(this.local=void 0)}void 0===this.local&&(this.local={user:E,unit:e.unit,uqs:{}});let s=n+"/"+r,o=(new Date).getTime(),a=this.local.uqs[s];if(void 0!==a){let{tick:e,value:t}=a;if(o-e<864e5)return t}let l=yield this.get("app-uq",e);return this.local.uqs[s]={tick:o,value:l},localStorage.setItem(C,JSON.stringify(this.local)),l}catch(t){throw this.local=void 0,localStorage.removeItem(C),t}})}}("tv/tie/",void 0);const P=new class extends k{directCall(e,t,i){return this.call(e,t,i)}}("",void 0);class O extends k{uqs(e,t,i){return u(this,void 0,void 0,function*(){let n,s=localStorage.getItem("appUqs");if(null!==s){let r=JSON.parse(s),{unit:o,appOwner:a,appName:l,value:c}=r;e===o&&t===a&&i===l&&(n=c)}if(void 0===n){n=yield this.uqsPure(e,t,i);let r={unit:e,appOwner:t,appName:i,value:n};localStorage.setItem("appUqs",JSON.stringify(r))}return this.cachedUqs=r.a.cloneDeep(n)})}uqsPure(e,t,i){return u(this,void 0,void 0,function*(){return yield this.get("tie/app-uqs",{unit:e,appOwner:t,appName:i})})}checkUqs(e,t,i){return u(this,void 0,void 0,function*(){let n=yield this.uqsPure(e,t,i);return r.a.isMatch(this.cachedUqs,n)})}unitxUq(e){return u(this,void 0,void 0,function*(){return yield this.get("tie/unitx-uq",{unit:e})})}}},function(e,t,i){"use strict";i.d(t,"b",function(){return s}),i.d(t,"c",function(){return l}),i.d(t,"a",function(){return c});var n=function(e,t,i,n){return new(i||(i=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(t){s(t)}}function a(e){try{l(n.throw(e))}catch(t){s(t)}}function l(e){e.done?r(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};let r;function s(e){r=e}class o{constructor(){this.handlerSeed=1,this.anyHandlers={},this.msgHandlers={}}onWsReceiveAny(e){let t=this.handlerSeed++;return this.anyHandlers[t]=e,t}onWsReceive(e,t){let i=this.handlerSeed++;return this.msgHandlers[i]={type:e,handler:t},i}endWsReceive(e){delete this.anyHandlers[e],delete this.msgHandlers[e]}receive(e){return n(this,void 0,void 0,function*(){let{$type:t}=e;for(let i in this.anyHandlers)yield this.anyHandlers[i](e);for(let i in this.msgHandlers){let{type:n,handler:r}=this.msgHandlers[i];n===t&&(yield r(e))}})}}let a=1;const l=new class extends o{constructor(){super(...arguments),this.wsBaseId="WsBridge seed "+a++}};class c extends o{constructor(e,t){super(),this.wsBaseId="WSChannel seed "+a++,this.wsHost=e,this.token=t}static setCenterToken(e){c.centerToken=e}connect(){if(void 0!==this.ws)return;let e=this;return new Promise((t,i)=>{let r=new WebSocket(this.wsHost,this.token||c.centerToken);console.log("connect webSocket %s",this.wsHost),r.onopen=(i=>{console.log("webSocket connected %s",this.wsHost),e.ws=r,t()}),r.onerror=(e=>{i("webSocket can't open!")}),r.onmessage=(t=>n(this,void 0,void 0,function*(){return yield e.wsMessage(t)})),r.onclose=(t=>{e.ws=void 0,console.log("webSocket closed!")})})}close(){void 0!==this.ws&&(this.ws.close(),this.ws=void 0)}wsMessage(e){return n(this,void 0,void 0,function*(){try{console.log("websocket message: %s",e.data);let i=JSON.parse(e.data);!function(e){void 0!==r&&r.postMessage({type:"ws",msg:e},"*")}(i),yield this.receive(i)}catch(t){console.log("ws msg error: ",t)}})}sendWs(e){let t=this;this.connect().then(()=>{t.ws.send(e)})}}},function(e,t,i){"use strict";i.d(t,"a",function(){return s});const n="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",r=8;function s(){let e=n.length,t="";for(let i=0;i<r;i++)t+=n.charAt(Math.floor(Math.random()*e));return t}},function(e,t,i){"use strict";var n=i(7);i.d(t,"NavView",function(){return n.a}),i.d(t,"nav",function(){return n.c});i(26);var r=i(17);i.d(t,"Page",function(){return r.a});i(39),i(40);var s=i(41);i.d(t,"Controller",function(){return s.a}),i.d(t,"VPage",function(){return s.b}),i.d(t,"View",function(){return s.c});var o=i(42);i.o(o,"Form")&&i.d(t,"Form",function(){return o.Form}),i.o(o,"resLang")&&i.d(t,"resLang",function(){return o.resLang});var a=i(22);i.d(t,"resLang",function(){return a.a});i(63),i(27)},function(e,t,i){"use strict";i.d(t,"b",function(){return r}),i.d(t,"a",function(){return a});var n=function(e,t,i,n){return new(i||(i=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(t){s(t)}}function a(e){try{l(n.throw(e))}catch(t){s(t)}}function l(e){e.done?r(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};const r=!1,s="101.200.46.56",o={centerhost:{value:Object({NODE_ENV:"production",PUBLIC_URL:"/app",REACT_APP_CENTER_HOST:"101.200.46.56"}).REACT_APP_CENTER_DEBUG_HOST||"localhost:3000",local:!1},uqhost:{value:Object({NODE_ENV:"production",PUBLIC_URL:"/app",REACT_APP_CENTER_HOST:"101.200.46.56"}).REACT_APP_UQ_DEBUG_HOST||"localhost:3015",local:!1},unitxhost:{value:Object({NODE_ENV:"production",PUBLIC_URL:"/app",REACT_APP_CENTER_HOST:"101.200.46.56"}).REACT_APP_UQ_DEBUG_HOST||"localhost:3015",local:!1},"uq-build":{value:Object({NODE_ENV:"production",PUBLIC_URL:"/app",REACT_APP_CENTER_HOST:"101.200.46.56"}).REACT_APP_UQ_DEBUG_BUILDER_HOST||"localhost:3009",local:!1}};const a=new class{start(){return n(this,void 0,void 0,function*(){!0===r&&(yield this.tryLocal());let e=this.getCenterHost();this.url=function(e){return`http://${e}/`}(e),this.ws=function(e){return`ws://${e}/tv/`}(e)})}debugHostUrl(e){return`http://${e}/hello`}tryLocal(){return n(this,void 0,void 0,function*(){let e=[];for(let n in o){let t=o[n],{value:i}=t,r=this.debugHostUrl(i),s={method:"GET",mode:"no-cors",headers:{"Content-Type":"text/plain"}};e.push(c(r,s))}let t=yield Promise.all(e),i=0;for(let n in o)o[n].local=t[i],++i})}getCenterHost(){let{value:e,local:t}=o.centerhost;return!0===document.location.hash.includes("sheet_debug")?e:!0===r&&!0===t?e:s}getUrlOrDebug(e,t){if(!0!==r)return e;if(!t)return e;for(let i in o){let n=o[i],{value:r,local:s}=n,a=`://${i}/`;if(t.indexOf(a)>0)return!1===s?e:t=t.replace(a,`://${r}/`)}return e}},l=100;function c(e,t){return n(this,void 0,void 0,function*(){try{return yield function(e,t){return new Promise((i,n)=>{fetch(e,t).then(e=>{e.text().then(i).catch(n)}).catch(n);const r=new Error("Connection timed out");setTimeout(n,l,r)})}(e,t),!0}catch(i){return!1}})}},function(e,t,i){"use strict";i.d(t,"a",function(){return p});var n=i(0),r=i(6),s=i(2),o=i.n(s),a=i(4),l=i.n(a),c=i(26),u=function(e,t,i,n){return new(i||(i=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(t){s(t)}}function a(e){try{l(n.throw(e))}catch(t){s(t)}}function l(e){e.done?r(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};const d=100;class h extends n.Component{constructor(){super(...arguments),this.bottomTime=0,this.topTime=0,this.onScroll=(e=>u(this,void 0,void 0,function*(){let{onScroll:t,onScrollTop:i,onScrollBottom:n}=this.props;t&&this.props.onScroll(e);let r=e.target;if(r.scrollTop<30&&void 0!==i){let e=(new Date).getTime();e-this.topTime>d&&(this.topTime=e,i())}if(r.scrollTop+r.offsetHeight>r.scrollHeight-30&&void 0!==n){let e=(new Date).getTime();e-this.bottomTime>d&&(this.bottomTime=e,n())}}))}eachChild(e,t){let{props:i}=e;if(void 0===i)return;let{children:r}=i;void 0!==r&&n.Children.forEach(r,(e,i)=>{let{_$scroll:n}=e;n&&n(t),console.log(e.toString()),this.eachChild(e,t)})}render(){return n.createElement("main",{className:this.props.className,onScroll:this.onScroll},this.props.children)}}let p=class extends n.Component{constructor(e){super(e);let t,{tabs:i}=e;if(void 0===i||0===i.length)return;this.tabs=i;let n=[];for(let r of i){let e=l.a.clone(r);void 0===t&&!0===e.isSelected?t=e:e.isSelected=!1,e.isMounted=!1,n.push(e)}this.state={cur:t,tabs:n}}componentDidMount(){return u(this,void 0,void 0,function*(){if(void 0===this.tabs)return;let e=this.state.tabs[0];void 0!==e&&(yield this.onTabClick(e))})}onTabClick(e){return u(this,void 0,void 0,function*(){if(!0===e.isSelected)return;let t,i=this.state.tabs;for(let n of i)n===e?(n.isSelected=!0,t=n):n.isSelected=!1;if(!0!==t.isMounted){let{load:e}=t;void 0!==e&&(yield e())}this.setState({cur:t,tabs:i})})}onTouchStart(e){}renderTabs(e){const{header:t,back:i,right:r,keepHeader:s}=this.props;let a,l=this.state.cur,u=n.createElement("div",null,this.state.tabs.map((e,t)=>{const{icon:i,isSelected:r,title:s,redDot:a}=e;let l,c,u;if(void 0!==i&&(l=n.createElement("img",{src:i})),void 0!==a){let e=a.get();e<0?(u=o()("red-dot"),c=n.createElement("u",null)):e>0&&(u=o()("red-dot","num"),c=n.createElement("u",null,e))}return n.createElement("div",{key:t,className:o()("va-tab",{cur:r}),onClick:()=>this.onTabClick(e)},l,n.createElement("div",{className:u},s,c))}));return!1!==t&&(a=n.createElement(c.a,{back:i,center:!0===s?t:l&&(l.header||l.title),right:r})),n.createElement("article",{className:"page-container"},a,n.createElement("section",{className:"position-relative"},this.props.sideBar,this.state.tabs.map((e,t)=>{let{isSelected:i,isMounted:r,content:s}=e;if(!0===i||!0===r)return e.isMounted=!0,n.createElement(h,{key:t,className:o()({invisible:!1===i}),onScroll:e.onScroll,onScrollTop:e.onScrollTop,onScrollBottom:e.onScrollBottom},"function"===typeof s?s():s)})),u,e)}renderSingle(e){const{back:t,header:i,right:r,onScroll:s,onScrollTop:o,onScrollBottom:a,children:l}=this.props;let u;return!1!==i&&(u=n.createElement(c.a,{back:t,center:i,right:r,logout:this.props.logout})),n.createElement("article",{className:"page-container",onTouchStart:this.onTouchStart},u,n.createElement("section",{className:"position-relative"},this.props.sideBar,n.createElement(h,{onScroll:s,onScrollTop:o,onScrollBottom:a},l)),e)}render(){const{footer:e}=this.props;let t;return void 0!==e&&(t=n.createElement("footer",null,e)),void 0!==this.tabs?this.renderTabs(t):this.renderSingle(t)}};p=function(e,t,i,n){var r,s=arguments.length,o=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,i,o):r(t,i))||o);return s>3&&o&&Object.defineProperty(t,i,o),o}([r.a],p)},function(e,t,i){"use strict";i.d(t,"a",function(){return s});const n="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",r=8;function s(){let e=n.length,t="";for(let i=0;i<r;i++)t+=n.charAt(Math.floor(Math.random()*e));return t}},function(e,t,i){"use strict";i.d(t,"a",function(){return s}),i.d(t,"c",function(){return o}),i.d(t,"b",function(){return a});var n=i(33),r=i.n(n);class s{constructor(e){this.user=e}get id(){return this.user.id}get name(){return this.user.name}get nick(){return this.user.nick}get icon(){return this.user.icon||"http://101.200.46.56/imgs/Bear-icon.png"}get guest(){return this.user.guest}get token(){return this.user.token}}function o(e){let t=r()(e);return{id:t.id,name:t.name,guest:t.guest,token:e}}function a(e){return{id:0,guest:r()(e).guest,token:e}}},function(e,t,i){"use strict";i.d(t,"a",function(){return a});var n=i(11),r=i(7),s=i(16),o=function(e,t,i,n){return new(i||(i=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(t){s(t)}}function a(e){try{l(n.throw(e))}catch(t){s(t)}}function l(e){e.done?r(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class a{constructor(e,t,i,n){this.startWait=(()=>{void 0!==this.ui&&this.ui.startWait()}),this.endWait=((e,t)=>{void 0!==this.ui&&this.ui.endWait(),void 0!==t&&t("\u8bbf\u95eewebapi\u8d85\u65f6 "+e)}),this.showError=(e=>o(this,void 0,void 0,function*(){void 0!==this.ui&&(yield this.ui.showError(e))})),this.isCenter=e,this.hostUrl=t,this.apiToken=i,this.ui=n,this.timeout=!0===s.b?5e5:5e3}used(){this.post("",{})}get(e,t){return o(this,void 0,void 0,function*(){if(t){let i=Object.keys(t);if(i.length>0){let n="?";for(let r of i){void 0!==t[r]&&(e+=n+r+"="+t[r],n="&")}}}let i=this.buildOptions();return i.method="GET",yield this.innerFetch(e,i)})}post(e,t){return o(this,void 0,void 0,function*(){let i=this.buildOptions();return i.method="POST",i.body=JSON.stringify(t),yield this.innerFetch(e,i)})}put(e,t){return o(this,void 0,void 0,function*(){let i=this.buildOptions();return i.method="PUT",i.body=JSON.stringify(t),yield this.innerFetch(e,i)})}delete(e,t){return o(this,void 0,void 0,function*(){let i=this.buildOptions();return i.method="DELETE",i.body=JSON.stringify(t),yield this.innerFetch(e,i)})}fetch(e,t,i,n){return o(this,void 0,void 0,function*(){let s=this;this.startWait();let a=e;function l(e){return{channel:s,url:a,options:t,resolve:i,reject:n,error:e}}try{console.log("%s %s",t.method,a);let u=setTimeout(()=>s.endWait(e,n),this.timeout),d=yield fetch(encodeURI(a),t);if(!1===d.ok)throw clearTimeout(u),s.endWait(),console.log("call error %s",d.statusText),d.statusText;let h=d.headers.get("content-type");if(h&&h.indexOf("json")>=0)return d.json().then(e=>o(this,void 0,void 0,function*(){if(clearTimeout(u),s.endWait(),!0===e.ok)return i(e.res);void 0===e.error?yield s.showError(l("not valid tonva json")):(yield s.showError(l(e.error)),n(e.error))})).catch(e=>o(this,void 0,void 0,function*(){yield s.showError(l(e.message))}));{let e=yield d.text();clearTimeout(u),s.endWait(),i(e)}}catch(c){if("string"===typeof c&&!0===c.toLowerCase().startsWith("unauthorized"))return void r.c.logout();yield this.showError(l(c.message))}})}innerFetch(e,t){return o(this,void 0,void 0,function*(){let i=this.hostUrl+e;return!0===this.isCenter&&void 0===this.apiToken&&Object(n.d)()?yield Object(n.c)(i,t.method,t.body):yield new Promise((e,n)=>o(this,void 0,void 0,function*(){yield this.fetch(i,t,e,n)}))})}callFetch(e,t,i){return o(this,void 0,void 0,function*(){let n=this.buildOptions();return n.method=t,n.body=i,yield new Promise((t,i)=>o(this,void 0,void 0,function*(){yield this.fetch(e,n,t,i)}))})}buildOptions(){let{language:e,culture:t}=r.c,i=new Headers;i.append("Content-Type","application/json;charset=UTF-8");let n=e;return t&&(n+="-"+t),i.append("Accept-Language",n),this.apiToken&&i.append("Authorization",this.apiToken),{headers:i}}}},,function(e,t,i){"use strict";i.d(t,"b",function(){return s}),i.d(t,"a",function(){return o});var n=i(4),r=i.n(n);const s={lang:void 0,district:void 0};function o(e){let{lang:t,district:i}=s,n={};if(void 0===e)return n;r.a.merge(n,e._);let o=e[t];if(void 0===o)return n;r.a.merge(n,o._);let a=o[i];if(void 0===a)return n;r.a.merge(n,a);let{entity:l}=n;if(void 0!==l)for(let r in l)l[r.toLowerCase()]=l[r];return n}!function(){let e,t,i=navigator.languages&&navigator.languages[0]||navigator.language;if(i){let n=i.split("-");e=n[0],n.length>1&&(t=n[1])}else e="zh",t="CN";!function(e,t){s.lang=e,s.district=t}(e,t)}()},function(e,t,i){"use strict";var n=i(0),r=i(1),s=function(e,t,i,n){var r,s=arguments.length,o=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,i,o):r(t,i))||o);return s>3&&o&&Object.defineProperty(t,i,o),o};class o{constructor(e){this.formView=e}render(){return n.createElement("div",{className:"col-sm-10"},this.renderControl())}get hasError(){return!1}get filled(){return!1}clear(){}clearErrors(){}readValues(e){}setError(e,t){}setInitValues(e){}isOk(){return this.validate(),!this.hasError}validate(){}}s([r.e],o.prototype,"hasError",null),s([r.e],o.prototype,"filled",null);class a extends o{constructor(e,t,i){super(e),this.field=t,this.face=i,this.init(),this.setProps()}ref(e){this.element=e}init(){this.rules=[];let e=this.field.rules;void 0!==e&&(!0===Array.isArray(e)?this.rules.push(...e):this.rules.push(e))}setProps(){return this.props={ref:this.ref.bind(this),name:this.field.name}}get hasError(){return void 0!==this.error}get filled(){return void 0!==this.value&&this.value!==this.field.defaultValue}clearValue(){this.value=void 0}clear(){this.clearErrors(),this.clearValue()}clearErrors(){this.isOK=void 0,this.error=void 0}readValues(e){e[this.field.name]=this.value}setError(e,t){}setInitValues(e){}getValueFromElement(){return this.value}validate(){try{let t=this.getValueFromElement();if(this.rules.length>0){let e;for(let i of this.rules){console.log("validate: %s",t);let n=i(t);if(console.log("validate: %s err: %s",t,n),!0===n)this.error=void 0,e=!0;else if(void 0!==n)return this.error=n,void(this.isOK=!1)}this.isOK=e}this.value=t}catch(e){this.error=e.message}}render(){let e;if(void 0!==this.face){let{notes:t}=this.face;void 0!==t&&(e=n.createElement("small",{className:"text-muted"},t))}return n.createElement("div",{className:"col-sm-10"},this.renderControl(),e)}}s([r.l],a.prototype,"isOK",void 0),s([r.l],a.prototype,"error",void 0),s([r.l],a.prototype,"value",void 0),s([r.e],a.prototype,"hasError",null),s([r.e],a.prototype,"filled",null);class l extends o{constructor(e){super(e),this.otherClick=this.otherClick.bind(this)}otherClick(){let e=this.formView.props.onOther;void 0!==e&&e(this.formView.readValues())}renderControl(){console.log("buttons.renderControl");let e=this.formView.nothing,t=this.formView.hasError,i=this.formView.props;console.log("buttons.renderControl nothing:%s hasError:%s",e,t);let r,{submitButton:s,otherButton:o,onOther:a}=i;return void 0!==o&&(r=n.createElement("button",{className:"btn btn-outline-info ml-auto",onClick:this.otherClick},o)),n.createElement("div",{className:"d-flex justify-content-start"},n.createElement("button",{className:"btn btn-primary",type:"submit",disabled:e||t},s||"\u63d0\u4ea4"),r)}}var c=i(4),u=i(2);const d="\u5fc5\u987b\u586b\u5165\u8981\u6c42\u5185\u5bb9";class h extends a{init(){super.init(),!0===this.field.required&&this.rules.push(e=>null!==e&&void 0!==e&&0!==e.trim().length||d)}getValueFromElement(){return this.parseValue(this.element.value)}setProps(){super.setProps(),c.assign(this.props,{onBlur:this.onBlur.bind(this),onFocus:this.onFocus.bind(this),onChange:this.onChange.bind(this)});let e=this.face;return void 0!==e&&c.assign(this.props,{placeholder:e.placeholder}),this.props}parseValue(e){return e}onBlur(){this.validate()}onChange(){console.log("onChange"),this.validate()}onFocus(){this.clearErrors()}className(){return u({"form-control":!0,"has-success":!0===this.isOK,"is-invalid":void 0!==this.error,"is-valid":void 0===this.error&&!0===this.isOK})}renderInput(){return n.createElement("input",Object.assign({className:this.className()},this.props))}ref(e){super.ref(e),e&&(e.value=void 0===this.value?"":this.value)}renderError(){return void 0===this.error?null:n.createElement("div",{className:"invalid-feedback"},this.error)}clearValue(){super.clearValue(),this.element.value=""}setError(e,t){this.field.name===e&&(this.error=t)}setInitValues(e){let t=e[this.field.name];void 0!==t&&(this.value=t)}renderControl(){return n.createElement(n.Fragment,null,this.renderInput(),this.renderError())}}class p extends h{setProps(){let e=super.setProps();return c.assign(e,{type:"text",maxLength:this.field.maxLength}),e}parseValue(e){if(void 0!==e&&0!==e.trim().length)return e}}const f="\u65e0\u6548\u7684\u6570\u5b57",m="\u6700\u5c0f\u503c\u4e3a",v="\u6700\u5927\u503c\u4e3a",g=45,y=46;class b extends a{renderControl(){return n.createElement("div",{className:"form-control-plaintext"},n.createElement("div",{className:"alert alert-primary",role:"alert"},"don't know how to create control",n.createElement("br",null),"field: ",JSON.stringify(this.field)," must be object ",n.createElement("br",null),"face: ",JSON.stringify(this.face)," must be object ",n.createElement("br",null)))}}class w extends o{constructor(e,t){super(e),this.element=t}renderControl(){return n.createElement("div",{className:"form-control-plaintext"},this.element)}}var E=function(e,t,i,n){return new(i||(i=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(t){s(t)}}function a(e){try{l(n.throw(e))}catch(t){s(t)}}function l(e){e.done?r(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class x extends a{constructor(){super(...arguments),this.onClick=(()=>E(this,void 0,void 0,function*(){let{pick:e,fromPicked:t}=this.face,i=yield e(this.face,this.formView.props,this.formView.readValues());if(void 0===i)return void(this.value=void 0);if(void 0===t)return void(this.value=i.id);let{id:n,caption:r}=t(i);this.value=n,this.caption=r})),this.onPicked=(e=>{this.value=e.id})}setInitValues(e){let t=e[this.field.name];this.value=t}controlContent(){let{itemFromId:e,fromPicked:t,initCaption:i}=this.face;if(void 0===this.value)return i||"\u8bf7\u9009\u62e9Id";if(void 0!==this.caption)return this.caption;if(void 0!==e&&void 0!==t){let i=e(this.value);if(i){let e=t(i);if(void 0!==e)return e.caption}}return String(this.value)}renderControl(){let{tuid:e,input:t}=this.face;return void 0===t?n.createElement("div",{className:"form-control-plaintext px-2 border text-primary rounded cursor-pointer",onClick:this.onClick},this.controlContent()):n.createElement("div",{className:"form-control-static "},n.createElement(t.component,{id:this.value,ui:e}))}}(function(e,t,i,n){var r,s=arguments.length,o=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,i,o):r(t,i))||o);s>3&&o&&Object.defineProperty(t,i,o)})([r.l],x.prototype,"caption",void 0);class k extends a{constructor(e,t,i){super(e,t,i),this.onIdChanged=this.onIdChanged.bind(this)}onIdChanged(e){this.value=e.id}setInitValues(e){let t=e[this.field.name];this.value=t}buildContent(){return n.createElement(this.face.input.component,Object.assign({},this.face,{id:this.value,onFormValues:()=>this.formView.readValues(),onIdChanged:this.onIdChanged}))}renderControl(){return n.createElement("div",{className:"form-control-static "},this.buildContent())}}(function(e,t,i,n){var r,s=arguments.length,o=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,i,o):r(t,i))||o);s>3&&o&&Object.defineProperty(t,i,o)})([r.l],k.prototype,"caption",void 0);var C=i(6),N=function(e,t,i,n){return new(i||(i=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(t){s(t)}}function a(e){try{l(n.throw(e))}catch(t){s(t)}}function l(e){e.done?r(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class P extends a{constructor(){super(...arguments),this.onClick=(()=>N(this,void 0,void 0,function*(){let{pick:e,fromPicked:t}=this.face,i=yield e(this.face,this.formView.props,this.formView.readValues());if(void 0===i)return void(this.value=void 0);let{id:n,caption:r}=t(i);this.value=n,this.caption=r})),this.view=Object(C.a)(()=>{let e,{content:t}=this.face;return e=void 0===this.value||null===this.value?"\u8bf7\u9009\u62e9":n.createElement(t,{id:this.value}),n.createElement("div",{className:"form-control-plaintext px-2 border text-primary rounded cursor-pointer bg-light",onClick:this.onClick},e)})}setInitValues(e){let t=e[this.field.name];this.value=t}renderControl(){return n.createElement(this.view,null)}}(function(e,t,i,n){var r,s=arguments.length,o=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,i,o):r(t,i))||o);s>3&&o&&Object.defineProperty(t,i,o)})([r.l],P.prototype,"caption",void 0),i.d(t,"b",function(){return O}),i.d(t,"a",function(){return l});const O=(e,t)=>{t.label;return void 0!==t.group?function(e,t,i){return new b(e,i,void 0)}(e,0,t):void 0!==t.field?function(e,t,i){let{field:n,face:r}=i;switch(typeof n){case"string":n={name:n,type:"string"};break;case"object":break;default:return new b(e,n,r)}let s=n.type||"string";if(void 0===r){if(void 0===(r=R[s]))return new b(e,n,r)}else if(void 0===r.type){let e=R[s];r.type=void 0===e?"string":e.type}return new(S[r.type||s]||b)(e,n,r)}(e,0,t):new w(e,t.help)},S={string:p,password:class extends p{setProps(){let e=super.setProps();return c.assign(e,{type:"password",maxLength:this.field.maxLength}),e}},number:class extends h{init(){super.init(),this.extraChars=[];let{min:e,max:t}=this.field;switch(void 0!==e?(this.rules.push(t=>{if(void 0!==t)return!(t<e)||m+e}),e<0&&this.extraChars.push(g)):this.extraChars.push(g),void 0!==t&&this.rules.push(e=>{if(void 0!==e)return!(e>t)||v+t}),this.field.type){case"dec":case"number":this.extraChars.push(y)}}parseValue(e){if(void 0===e)return;if(0===e.trim().length)return;let t=Number.parseFloat(e);if(isNaN(t))throw new Error(f);return t}setProps(){super.setProps(),c.assign(this.props,{type:"number",step:this.field.step,onKeyPress:this.onKeyPress.bind(this)})}onKeyPress(e){let t=e.charCode;if(!(8===t||0===t||13===t||t>=48&&t<=57))if(void 0!==this.extraChars&&this.extraChars.indexOf(t)>=0)switch(t){case y:this.onKeyDot();break;case g:this.onKeyNeg(),e.preventDefault()}else e.preventDefault()}onKeyDot(){let e=this.element.value;e.indexOf(".")>=0&&(this.element.value=e.replace(".",""))}onKeyNeg(){let e=this.element.value,t=e.indexOf("-");e=t>=0?e.replace("-",""):"-"+e,this.element.value=e}},checkbox:class extends a{init(){super.init();let{trueValue:e,falseValue:t}=this.field;void 0===e&&(this.trueValue=1),void 0===t&&(this.falseValue=0)}setProps(){super.setProps(),c.assign(this.props,{onChange:this.onChange.bind(this)})}clearValue(){this.element.checked=this.field.defaultValue===this.trueValue,this.value=this.getValueFromElement()}setInitValues(e){let t=e[this.field.name];void 0===t&&(t=this.field.defaultValue)}getValueFromElement(){return this.element.checked?this.trueValue:this.falseValue}onChange(){this.value=this.getValueFromElement()}renderControl(){return n.createElement("div",{className:"form-control-static"},n.createElement("label",{className:"form-control"},n.createElement("label",{className:"custom-control custom-checkbox mb-0"},n.createElement("input",{type:"checkbox",name:this.field.name,ref:this.props.ref,onChange:this.props.onChange,className:"custom-control-input"}),n.createElement("span",{className:"custom-control-indicator"}),n.createElement("span",{className:"custom-control-description"},this.face.label))))}},radiobox:class extends a{renderControl(){return n.createElement("div",{className:"form-control-static"},n.createElement("div",{className:"form-control"},this.face.list.map((e,t)=>{let i,r;return"object"!==typeof e?i=r=e:(i=e.text,r=e.value),n.createElement("label",{key:t,className:"custom-control custom-radio w-25"},n.createElement("input",{type:"radio",name:this.field.name,className:"custom-control-input"}),n.createElement("span",{className:"custom-control-indicator"}),n.createElement("span",{className:"custom-control-description"},i))})))}},select:class extends a{constructor(e,t,i){super(e,t,i),this.ref=this.ref.bind(this)}getValueFromElement(){let{selectedIndex:e,selectedOptions:t}=this.element,i=t[0].value;switch(this.field.type){case"number":i=Number(i);break;case"date":i=new Date(i);break;case"bool":"string"===typeof i&&(i="true"===i.toLowerCase())}return i}renderControl(){let{list:e}=this.face,t=[];return void 0===this.face.default&&t.push(n.createElement("option",{key:-1,value:void 0},"\u8bf7\u9009\u62e9")),t.push(...e.map((e,t)=>{let i,r;return"object"!==typeof e?i=r=e:(i=e.text,r=e.value),n.createElement("option",{key:t,value:r},i)})),n.createElement("div",{className:"form-control-static"},n.createElement("select",{name:this.field.name,className:"form-control",ref:this.ref},t))}},"pick-id":x,"pick-tuid":k,textarea:class extends h{setProps(){let e=super.setProps(),{maxLength:t}=this.field,{rows:i}=this.face;return c.assign(e,{maxLength:t,rows:i}),e}renderInput(){return n.createElement("textarea",Object.assign({ref:e=>{this.el=e,void 0!==e&&(e.value="")},className:this.className()},this.props))}},pick:P},R={string:{type:"string"},number:{type:"number"},int:{type:"number"},dec:{type:"number"},bool:{type:"checkbox"}}},function(e,t,i){"use strict";i.d(t,"a",function(){return l}),i.d(t,"b",function(){return c});var n=i(0),r=i(23);class s{constructor(e,t){if(this.form=e,this.row=t,void 0===t.type){let i=t.createControl;void 0===i&&(i=e.createControl),void 0===i&&(i=r.b),this.control=i(e,t)}}isOk(){return void 0===this.control||this.control.isOk()}contains(e){let t=this.row.field;if(void 0!==t)return e===t.name;let i=this.row.group;return void 0!==i&&void 0!==i.find(t=>t.field.name===e)}get hasError(){return this.control.hasError}get filled(){return this.control.filled}clear(){void 0!==this.control&&this.control.clear()}clearErrors(){void 0!==this.control&&this.control.clearErrors()}readValues(e){void 0!==this.control&&this.control.readValues(e)}setError(e,t){void 0!==this.control&&this.control.setError(e,t)}setInitValues(e){void 0!==this.control&&this.control.setInitValues(e)}}class o extends s{render(e){return n.createElement("div",{key:e,className:"form-group"},this.row)}get hasError(){return!1}get filled(){return!1}}class a extends s{render(e){return n.createElement("div",{key:e,className:"form-group row"},n.createElement("label",{className:"col-sm-2 col-form-label"},this.row.label),this.control.render())}}function l(e,t){return new a(e,t)}function c(e,t){return new o(e,t)}},function(e,t,i){"use strict";i.d(t,"b",function(){return r}),i.d(t,"a",function(){return s});var n=function(e,t,i,n){return new(i||(i=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(t){s(t)}}function a(e){try{l(n.throw(e))}catch(t){s(t)}}function l(e){e.done?r(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};function r(e,t,i,r,s){return n(this,void 0,void 0,function*(){yield e.fetch(t,i,r,s)})}class s{constructor(e,t){this.path=e||"",this.showWaiting=t}call(e,t,i){return n(this,void 0,void 0,function*(){let n=yield this.getHttpChannel();return yield n.callFetch(e,t,i)})}get(e,t){return n(this,void 0,void 0,function*(){let i=yield this.getHttpChannel();return yield i.get(this.path+e,t)})}post(e,t){return n(this,void 0,void 0,function*(){let i=yield this.getHttpChannel();return yield i.post(this.path+e,t)})}put(e,t){return n(this,void 0,void 0,function*(){let i=yield this.getHttpChannel();return yield i.put(this.path+e,t)})}delete(e,t){return n(this,void 0,void 0,function*(){let i=yield this.getHttpChannel();return yield i.delete(this.path+e,t)})}}},function(e,t,i){"use strict";i.d(t,"a",function(){return a});var n=i(0),r=i(7),s=i(17),o=function(e,t,i,n){return new(i||(i=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(t){s(t)}}function a(e){try{l(n.throw(e))}catch(t){s(t)}}function l(e){e.done?r(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class a extends n.Component{constructor(e){super(e),this.logoutClick=(()=>{r.c.push(n.createElement(s.a,{header:"\u5b89\u5168\u9000\u51fa",back:"close"},n.createElement("div",{className:"m-5 border border-info bg-white rounded p-3 text-center"},n.createElement("div",null,"\u9000\u51fa\u5f53\u524d\u8d26\u53f7\u4e0d\u4f1a\u5220\u9664\u4efb\u4f55\u5386\u53f2\u6570\u636e\uff0c\u4e0b\u6b21\u767b\u5f55\u4f9d\u7136\u53ef\u4ee5\u4f7f\u7528\u672c\u8d26\u53f7"),n.createElement("div",{className:"mt-3"},n.createElement("button",{className:"btn btn-danger",onClick:()=>this.logout()},"\u9000\u51fa")))))}),this.navChange=this.navChange.bind(this),this.state={hasBack:!1}}navChange(){this.setState({hasBack:r.c.level>1})}componentWillMount(){this.navChange()}componentWillUnmount(){}back(){return o(this,void 0,void 0,function*(){yield r.c.back()})}openWindow(){window.open(document.location.href)}logout(){let{logout:e}=this.props;"function"===typeof e&&e(),r.c.logout()}render(){let e,t,i,s,o=this.state.hasBack||self!=top,{right:a,center:l,logout:c}=this.props;if(void 0!==c&&self===top&&("boolean"===typeof c&&!0===c||"function"===typeof c)){let{nick:e,name:t}=r.c.user;i=n.createElement("div",{className:"d-flex align-items-center"},n.createElement("small",{className:"text-light"},e||t),n.createElement("a",{className:"dropdown-toggle btn btn-secondary btn-sm ml-2",role:"button",onClick:this.logoutClick},n.createElement("i",{className:"fa fa-sign-out"})))}if(o)switch(this.props.back){case"none":e=void 0;break;default:case"back":e=n.createElement("nav",{onClick:this.back},n.createElement("i",{className:"fa fa-arrow-left"}));break;case"close":e=n.createElement("nav",{onClick:this.back},n.createElement("i",{className:"fa fa-close"}))}return self!=top&&(console.log(document.location.href),t=n.createElement("header",{onClick:this.openWindow})),(a||i)&&(s=n.createElement("aside",null,a," ",i)),n.createElement("header",{style:r.b},t,e,n.createElement("div",null,l),s)}}},function(e,t,i){"use strict";i.d(t,"a",function(){return r});var n=i(0);function r(){return n.createElement("div",{style:{height:"100%"},className:"d-flex flex-fill align-items-center justify-content-center"},n.createElement("div",{className:"d-flex align-items-center justify-content-center slide text-info",style:{width:"5em",height:"2em"}},"\u52a0\u8f7d\u4e2d..."))}},function(e,t,i){"use strict";var n=i(48);i.o(n,"Badge")&&i.d(t,"Badge",function(){return n.Badge}),i.o(n,"EasyDate")&&i.d(t,"EasyDate",function(){return n.EasyDate}),i.o(n,"FA")&&i.d(t,"FA",function(){return n.FA}),i.o(n,"IconText")&&i.d(t,"IconText",function(){return n.IconText}),i.o(n,"Image")&&i.d(t,"Image",function(){return n.Image}),i.o(n,"LMR")&&i.d(t,"LMR",function(){return n.LMR}),i.o(n,"List")&&i.d(t,"List",function(){return n.List}),i.o(n,"Media")&&i.d(t,"Media",function(){return n.Media}),i.o(n,"Muted")&&i.d(t,"Muted",function(){return n.Muted}),i.o(n,"PropGrid")&&i.d(t,"PropGrid",function(){return n.PropGrid}),i.o(n,"TonvaForm")&&i.d(t,"TonvaForm",function(){return n.TonvaForm});var r=i(49);i.o(r,"Badge")&&i.d(t,"Badge",function(){return r.Badge}),i.o(r,"EasyDate")&&i.d(t,"EasyDate",function(){return r.EasyDate}),i.o(r,"FA")&&i.d(t,"FA",function(){return r.FA}),i.o(r,"IconText")&&i.d(t,"IconText",function(){return r.IconText}),i.o(r,"Image")&&i.d(t,"Image",function(){return r.Image}),i.o(r,"LMR")&&i.d(t,"LMR",function(){return r.LMR}),i.o(r,"List")&&i.d(t,"List",function(){return r.List}),i.o(r,"Media")&&i.d(t,"Media",function(){return r.Media}),i.o(r,"Muted")&&i.d(t,"Muted",function(){return r.Muted}),i.o(r,"PropGrid")&&i.d(t,"PropGrid",function(){return r.PropGrid}),i.o(r,"TonvaForm")&&i.d(t,"TonvaForm",function(){return r.TonvaForm});var s=i(50);i.o(s,"Badge")&&i.d(t,"Badge",function(){return s.Badge}),i.o(s,"EasyDate")&&i.d(t,"EasyDate",function(){return s.EasyDate}),i.o(s,"FA")&&i.d(t,"FA",function(){return s.FA}),i.o(s,"IconText")&&i.d(t,"IconText",function(){return s.IconText}),i.o(s,"Image")&&i.d(t,"Image",function(){return s.Image}),i.o(s,"LMR")&&i.d(t,"LMR",function(){return s.LMR}),i.o(s,"List")&&i.d(t,"List",function(){return s.List}),i.o(s,"Media")&&i.d(t,"Media",function(){return s.Media}),i.o(s,"Muted")&&i.d(t,"Muted",function(){return s.Muted}),i.o(s,"PropGrid")&&i.d(t,"PropGrid",function(){return s.PropGrid}),i.o(s,"TonvaForm")&&i.d(t,"TonvaForm",function(){return s.TonvaForm});i(24),i(29);var o=i(51);i.d(t,"TonvaForm",function(){return o.a});i(23)},function(e,t,i){"use strict";i.d(t,"a",function(){return u});var n=i(0),r=i(1),s=i(14),o=i(23),a=i(24),l=function(e,t,i,n){var r,s=arguments.length,o=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,i,o):r(t,i))||o);return s>3&&o&&Object.defineProperty(t,i,o),o},c=function(e,t,i,n){return new(i||(i=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(t){s(t)}}function a(e){try{l(n.throw(e))}catch(t){s(t)}}function l(e){e.done?r(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class u{constructor(e){this.rows=[],this.uid=Object(s.a)(),this.props=e,this.buildRows(e),this.createControl=e.createControl,this.onSubmit=this.onSubmit.bind(this)}get hasError(){let e=this.rows.map((e,t)=>t+": "+e.hasError+"\n");return console.log(e),this.rows.some(e=>e.hasError)}get nothing(){return this.rows.every(e=>!e.filled)}readValues(){let e={};for(let t of this.rows)t.readValues(e);return e}clear(){for(let e of this.rows)e.clear()}clearErrors(){for(let e of this.rows)e.clearErrors()}setError(e,t){for(let i of this.rows)i.setError(e,t)}setInitValues(e){if(void 0!==e)for(let t of this.rows)t.setInitValues(e)}buildRows(e){let{formRows:t,createRow:i}=e;if(void 0!==t){for(let e of t)this.rows.push(this.buildRow(e,i));!0!==this.props.readOnly&&(this.buttonsRow=this.buildRow({createControl:this.createButtons.bind(this)},void 0))}else this.rows.push(Object(a.b)(this,n.createElement("div",{className:"text-warning"},"TonvaForm need formRows defined")))}buildRow(e,t){let i;return void 0!==e.type?i=a.b:void 0===(i=e.createRow)&&void 0===(i=t)&&(i=a.a),i(this,e)}createButtons(e,t){return new o.a(e)}isOk(){let e=!0;for(let t of this.rows)t.isOk()||(e=!1);return e}render(){return n.createElement("form",{onSubmit:this.onSubmit},this.rows.map((e,t)=>e.render(this.uid+t)),this.buttons())}buttons(){if(void 0!==this.buttonsRow)return this.buttonsRow.render(this.uid+this.rows.length)}onSubmit(e){return c(this,void 0,void 0,function*(){if(e.preventDefault(),!this.isOk())return;let t=this.readValues();yield this.props.onSubmit(t)})}}l([r.e],u.prototype,"hasError",null),l([r.e],u.prototype,"nothing",null)},function(e,t,i){"use strict";var n=i(0),r=i(6),s=i(2),o=i.n(s),a=i(4),l=i.n(a);class c{}class u extends c{constructor(e){super(),this.func=e}check(e,t){let i=this.func(t);if(void 0!==i)switch(typeof i){case"undefined":return;case"string":return void e.push(i);default:return void e.push(...i)}}}class d extends c{constructor(e){super(),this.res=e}}class h extends d{check(e,t){switch(typeof t){default:case"boolean":return;case"object":if(null!==t)return;break;case"string":if(t.trim().length>0)return;break;case"number":if(NaN!==t)return;break;case"undefined":}e.push(this.res.required)}}class p extends d{constructor(e,t,i){super(e),this.minMsg=l.a.template(e.min),this.maxMsg=l.a.template(e.max),this.min=t,this.max=i}check(e,t){if(void 0===t||null===t)return;let i=Number(t);NaN===i?e.push(this.res.number):this.checkMore(e,i)}checkMore(e,t){void 0!==this.min&&Number(t)<this.min&&e.push(this.minMsg({min:this.min})),void 0!==this.max&&Number(t)>this.max&&e.push(this.maxMsg({max:this.max}))}}class f extends p{checkMore(e,t){super.checkMore(e,t),!1===Number.isInteger(t)&&e.push(this.res.integer)}}var m=i(1),v=function(e,t,i,n){var r,s=arguments.length,o=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,i,o):r(t,i))||o);return s>3&&o&&Object.defineProperty(t,i,o),o};class g{constructor(e,t,i,n){this.errors=[],this.contextErrors=[],this.onInputChange=(e=>{this.changeValue(e.target.value,!0)}),this.context=e;let{name:r}=t;if(this.name=r,this.itemSchema=t,this.fieldProps=i,this.children=n,this.ui=e.getUiItem(r),void 0===this.ui)this.readOnly=!1,this.disabled=!1,this.visible=!0;else{let{readOnly:e,disabled:t,visible:i}=this.ui;this.readOnly=!0===e,this.disabled=!0===t,this.visible=!(!1===i)}this.value=this.defaultValue=e.getValue(r),this.init()}get hasError(){return this.errors.length+this.contextErrors.length>0}init(){if(this.rules=[],!0===this.itemSchema.required&&this.rules.push(new h(this.context.form.res)),this.buildRules(),void 0===this.ui)return;let{rules:e}=this.ui;if(void 0!==e)if(!1!==Array.isArray(e))for(let t of e)this.rules.push(new u(t));else this.rules.push(new u(e))}buildRules(){}checkRules(){let e=[];for(let t of this.rules)t.check(e,this.value);0===e.length?this.context.removeErrorWidget(this):(this.context.addErrorWidget(this),this.errors.push(...e))}get isOk(){return 0===this.errors.length}setError(e){void 0!==e&&("string"===typeof e?this.errors.push(e):this.errors.push(...e))}setContextError(e){void 0!==e&&("string"===typeof e?this.contextErrors.push(e):this.contextErrors.push(...e))}clearError(){this.errors.splice(0)}clearContextError(){this.contextErrors.splice(0)}parse(e){return e}setElementValue(e){}setDataValue(e){!0!==this.isChanging&&(this.context.initData[this.name]=this.value=this.parse(e))}setValue(e){!0!==this.isChanging&&this.changeValue(e,!1)}getValue(){return this.context.getValue(this.name)}getReadOnly(){return this.readOnly}getDisabled(){return this.disabled}getVisible(){return this.visible}setReadOnly(e){this.readOnly=e}setDisabled(e){this.disabled=e}setVisible(e){this.visible=e}changeValue(e,t){let i,n,r=this.value;void 0!==this.ui&&(i=this.ui.onChanging,n=this.ui.onChanged);let s=!0;void 0!==i&&(this.isChanging=!0,s=i(this.context,this.value,r),this.isChanging=!1),!0===s&&(this.setDataValue(e),!0!==t&&this.setElementValue(e),void 0!==n&&(this.isChanging=!0,n(this.context,this.value,r),this.isChanging=!1))}get className(){let e;return!1===this.context.inNode&&(e="form-control"),o()(e,this.context.form.FieldClass,this.ui&&this.ui.className)}renderContainer(){if(!1===this.visible)return null;let e,{form:t,inNode:i}=this.context;if(!0===i)return this.render();if(void 0===this.ui)e=this.name;else{let t=this.ui.label;null===t&&(e=null),e=t||this.name}return!0===this.itemSchema.required&&!1!==t.props.requiredFlag&&null!==e&&(e=n.createElement(n.Fragment,null,e,"\xa0",n.createElement("span",{className:"text-danger"},"*"))),t.FieldContainer(e,this.render())}renderTemplet(){if(void 0!==this.children)return n.createElement(n.Fragment,null,this.children);if(void 0===this.ui)return;let{Templet:e}=this.ui;return"function"===typeof e?e(this.value):e}renderErrors(){let e=[...this.errors,...this.contextErrors];if(0===e.length)return null;let{inNode:t}=this.context,i=!0===t?"span":"div";return e.map(e=>n.createElement(i,{key:e,className:"text-danger d-inline-block my-2 ml-3"},n.createElement(n.Fragment,null,n.createElement("i",{className:"fa fa-exclamation-circle"})," \xa0",e)))}}v([m.l],g.prototype,"errors",void 0),v([m.l],g.prototype,"contextErrors",void 0),v([m.e],g.prototype,"hasError",null),v([m.l],g.prototype,"visible",void 0),v([m.e],g.prototype,"isOk",null);class y extends g{constructor(){super(...arguments),this.inputType="text"}setElementValue(e){null!==this.input&&(this.input.value=e)}get placeholder(){return this.ui&&this.ui.placeholder||this.name}onBlur(e){this.onInputChange(e),this.checkRules(),this.context.checkContextRules()}onFocus(e){this.clearError(),this.context.removeErrorWidget(this),this.context.removeErrors()}onChange(e){}setReadOnly(e){null!==this.input&&(this.input.readOnly=this.readOnly=e)}setDisabled(e){null!==this.input&&(this.input.disabled=this.disabled=e)}render(){let e=this.renderTemplet();if(void 0!==e)return e;let t={};return!0===this.hasError?t["is-invalid"]=!0:t["required-item"]=!0===this.itemSchema.required,n.createElement(n.Fragment,null,n.createElement("input",{ref:e=>this.input=e,className:o()(this.className,t),type:this.inputType,defaultValue:this.value,onChange:e=>this.onChange(e),placeholder:this.placeholder,readOnly:this.readOnly,disabled:this.disabled,onKeyDown:this.onKeyDown,onFocus:e=>this.onFocus(e),onBlur:e=>this.onBlur(e),maxLength:this.itemSchema.maxLength}),this.renderErrors())}}class b extends y{constructor(){super(...arguments),this.inputType="number"}buildRules(){super.buildRules();let e=this.context.form.res,{min:t,max:i}=this.itemSchema;this.rules.push("integer"===this.itemSchema.type?new p(e,t,i):new f(e,t,i))}parse(e){if(void 0!==e&&null!==e)return Number(e)}}class w extends b{constructor(){super(...arguments),this.inputType="number",this.onKeyDown=(e=>{let t=e.keyCode;event.returnValue=this.isValidKey(t)})}isValidKey(e){return 46===e||8===e||37===e||39===e||e>=48&&e<=57||e>=96&&e<=105||109===e||189===e}}class E extends y{constructor(){super(...arguments),this.inputType="date"}}class x extends g{constructor(){super(...arguments),this.onInputChange=(e=>{this.setDataValue(!0===e.target.checked?this.trueValue:this.falseValue)}),this.onClick=(()=>{this.context.removeErrors()})}init(){if(super.init(),void 0!==this.ui){let{trueValue:e,falseValue:t}=this.ui;this.trueValue=void 0===e||e,this.falseValue=void 0!==t&&t}else this.trueValue=!0,this.falseValue=!1}setElementValue(e){this.input.checked=e===this.trueValue}setReadOnly(e){this.input.readOnly=this.readOnly=e}setDisabled(e){this.input.disabled=this.disabled=e}render(){let e=o()(this.className,"form-check-inline"),t=n.createElement("input",{ref:e=>this.input=e,className:"align-self-center",type:"checkbox",defaultChecked:this.defaultValue,onChange:this.onInputChange,onClick:this.onClick});return this.context.inNode?n.createElement("label",{className:e},t," ",this.ui&&this.ui.label||this.name):n.createElement("div",{className:e},t)}}class k extends g{constructor(){super(...arguments),this.onInputChange=(e=>{this.setDataValue(e.target.value)})}setElementValue(e){this.select.value=e}setReadOnly(e){this.select.disabled=this.readOnly=!e}setDisabled(e){this.select.disabled=this.disabled=e}render(){if(!0===this.readOnly){let e=this.ui.list.find(e=>e.value===this.value),t=void 0===e?"(???)":e.title;return n.createElement("span",{className:"form-control w-min-6c"},t)}return n.createElement("select",{ref:e=>this.select=e,className:o()(this.className,"form-control"),defaultValue:this.defaultValue,onChange:this.onInputChange},this.ui.list.map((e,t)=>{let{title:i,value:r}=e;return n.createElement("option",{className:void 0,key:t,value:r},i||r)}))}}(function(e,t,i,n){var r,s=arguments.length,o=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,i,o):r(t,i))||o);s>3&&o&&Object.defineProperty(t,i,o)})([m.l],k.prototype,"readOnly",void 0);var C=function(e,t,i,n){return new(i||(i=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(t){s(t)}}function a(e){try{l(n.throw(e))}catch(t){s(t)}}function l(e){e.done?r(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class N extends g{constructor(){super(...arguments),this.onClick=(()=>C(this,void 0,void 0,function*(){let e=this.ui&&this.ui.pickId;if(void 0===e)return void alert("no pickId defined!");let t=yield e(this.context,this.name,this.value);this.setDataValue(t),this.clearError(),this.clearContextError(),this.checkRules()}))}setReadOnly(e){this.readOnly=e}setDisabled(e){this.disabled=e}render(){let e,t;void 0!==this.ui&&(e=this.ui.placeholder,t=this.ui.Templet);let i,r={"form-control":!0,"required-item":!0===this.itemSchema.required,"cursor-pointer":!0,"is-invalid":this.hasError};return void 0===this.value||null===this.value?(i=e||"placeholder",r["text-muted"]=!0):i=void 0===t?n.createElement(n.Fragment,null,this.value):"function"===typeof t?t(this.value):t,n.createElement(n.Fragment,null,n.createElement("div",{className:o()(r),onClick:this.onClick},i),this.renderErrors())}}(function(e,t,i,n){var r,s=arguments.length,o=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,i,o):r(t,i))||o);s>3&&o&&Object.defineProperty(t,i,o)})([m.l],N.prototype,"value",void 0);const P=(e,t,i)=>n.createElement("span",{className:"text-danger"},"!!data type ",e," only support ",(i||[]).join(", "),", can't use ui ",t,"!!");var O=function(e,t,i,n){return new(i||(i=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(t){s(t)}}function a(e){try{l(n.throw(e))}catch(t){s(t)}}function l(e){e.done?r(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class S extends g{constructor(){super(...arguments),this.onClick=(()=>O(this,void 0,void 0,function*(){this.clearError(),this.clearContextError();let{name:e,type:t}=this.itemSchema;if("submit"===t&&(this.context.checkRules(),!0===this.context.hasError))return;let{onButtonClick:i}=this.context.form.props;if(void 0===i)return void alert(`button ${e} clicked. you should define form onButtonClick`);let n=yield i(e,this.context);void 0!==n&&this.context.setError(e,n)})),this.observerRender=Object(r.a)(()=>{let e,t,i,{name:r,type:s}=this.itemSchema;if(void 0!==this.ui){let{widget:n}=this.ui;if("button"!==n)return P(s,n,["button"]);e=this.ui.Templet,t=this.ui.className,i=this.ui.label}let o,{form:a,hasError:l}=this.context,c=this.context,u="submit"===s&&l;o=void 0!==this.children?this.children:"function"===typeof e?e():void 0!==e?e:i;let d=n.createElement("button",{className:t,type:"button",disabled:u,onClick:this.onClick},o||r);return!0===c.inNode?n.createElement(n.Fragment,null,d,this.renderErrors()):n.createElement("div",{className:a.ButtonClass},n.createElement("div",null,this.renderErrors()),d)})}render(){return n.createElement(this.observerRender,null)}renderContainer(){if(!1===this.visible)return null;let{form:e,inNode:t}=this.context;return!0===t?this.render():e.FieldContainer(null,this.render())}}var R=i(8);const I=Object(r.a)(({parentContext:e,arrSchema:t,children:i})=>{let s,a,l,c,{name:u,arr:d}=t,h=e.initData[u],{form:p}=e,f=e.getArrRowContexts(u),m=e.getUiItem(u),v=u,{ArrContainer:g,RowContainer:y,RowSeperator:b,uiSchema:w}=p;if(void 0!==w){let{selectable:e,deletable:t,restorable:i}=w;!0!==a&&(a=e),!0!==l&&(l=t),!0!==c&&(c=i)}if(void 0!==m){let{widget:e,label:i,selectable:n,deletable:r,restorable:o,ArrContainer:u,RowContainer:d,RowSeperator:h}=m;if(void 0!==n&&(a=n),void 0!==r&&(l=r),void 0!==o&&(c=o),void 0!==u&&(g=u),void 0!==d&&(y=d),void 0!==h&&(b=h),s=m.Templet,"arr"!==e)return P(t.type,e,["arr"]);v=i||v}let E=!0;return g(v,n.createElement(n.Fragment,null,h.map((u,p)=>{let m,v,g=void 0;if(!1===E?g=b:E=!1,void 0!==i)m=new R.c(e,t,u,!0),v=n.createElement(n.Fragment,null,i);else{let i=typeof s;"function"===i?(m=new R.c(e,t,u,!0),v=n.createElement(Object(r.a)(s),u)):"object"===i?(m=new R.c(e,t,u,!0),v=s):(m=new R.c(e,t,u,!1),v=n.createElement(n.Fragment,null,d.map((e,t)=>n.createElement(n.Fragment,{key:e.name},T(m,e,void 0)))))}let w,x,{rowKey:k}=m;if(f[k]=m,!0===a){let e=e=>{let{checked:t}=e.target;u.$isSelected=t;let{$source:i}=u;void 0!==i&&(i.$isSelected=t),m.removeErrors()};w=n.createElement("div",{className:"form-row-checkbox"},n.createElement("input",{type:"checkbox",onClick:e,defaultChecked:u.$isSelected}))}let C=!(void 0===u.$isDeleted||!1===u.$isDeleted);if(!0===l){let e=C?"fa-undo":"fa-trash",t=()=>{if(!0===c){u.$isDeleted=!C;let{$source:e}=u;void 0!==e&&(e.$isDeleted=!C)}else{let e=h.indexOf(u);e>=0&&h.splice(e,1)}m.removeErrors()};x=n.createElement("div",{className:"form-row-edit text-info",onClick:t},n.createElement("i",{className:o()("fa",e,"fa-fw")}))}let N=!0===a||!0===l?e=>n.createElement("fieldset",{disabled:C},n.createElement("div",{className:o()("d-flex",{deleted:C,"row-selected":u.$isSelected})},w,n.createElement("div",{className:"flex-grow-1"},e),x)):e=>e;return n.createElement(R.a.Provider,{key:k,value:m},g,y(N(n.createElement(n.Fragment,null,n.createElement(m.renderErrors,null),v))))})))}),j={id:{dataTypes:["id"],widget:N},text:{dataTypes:["integer","number","string"],widget:y},textarea:{dataTypes:["string"],widget:class extends g{constructor(){super(...arguments),this.onInputChange=(e=>{this.setValue(e.currentTarget.value)})}setElementValue(e){this.input.value=e}setReadOnly(e){this.input.readOnly=this.readOnly=e}setDisabled(e){this.input.disabled=this.disabled=e}render(){return n.createElement("textarea",{ref:e=>this.input=e,rows:this.ui&&this.ui.rows,maxLength:this.itemSchema.maxLength,defaultValue:this.defaultValue,onChange:this.onInputChange})}}},password:{dataTypes:["string"],widget:class extends y{constructor(){super(...arguments),this.inputType="password"}}},date:{dataTypes:["date"],widget:E},datetime:{dataTypes:["date"],widget:class extends y{constructor(){super(...arguments),this.inputType="datetime"}}},time:{dataTypes:["date"],widget:class extends y{constructor(){super(...arguments),this.inputType="time"}}},month:{dataTypes:["date"],widget:class extends y{constructor(){super(...arguments),this.inputType="month"}}},select:{dataTypes:["integer","number","string","date","boolean"],widget:k},url:{dataTypes:["string"],widget:class extends y{constructor(){super(...arguments),this.inputType="url"}}},email:{dataTypes:["string"],widget:class extends y{constructor(){super(...arguments),this.inputType="email"}}},number:{dataTypes:["integer","number"],widget:b},updown:{dataTypes:["integer","number"],widget:w},color:{},checkbox:{dataTypes:["boolean","integer","number"],widget:x},checkboxes:{},radio:{dataTypes:["integer","number","string","date","boolean"],widget:class extends g{constructor(){super(...arguments),this.inputs={}}setElementValue(e){for(let t in this.inputs){let i=this.inputs[t];i.checked=e===i.value}}setReadOnly(e){this.readOnly=e;for(let t in this.inputs)this.inputs[t].readOnly=e}setDisabled(e){this.disabled=e;for(let t in this.inputs)this.inputs[t].disabled=e}render(){let e,{defaultValue:t,list:i}=this.ui,{isRow:r,inNode:s}=this.context;!0===r&&(e=this.context.rowKey);let a=o()(this.className,"form-radio-inline");return n.createElement("span",{className:a},i.map((i,r)=>{let{value:s,title:o}=i,a=this.name;return void 0!==e&&(a+="-"+e),n.createElement("label",{key:r,className:"form-radio-inline"},n.createElement("input",{ref:e=>this.inputs[r]=e,type:"radio",name:a,value:s,defaultChecked:(this.defaultValue||t)===s}),o||s)}))}}},range:{dataTypes:["integer"],widget:class extends g{constructor(){super(...arguments),this.inputType="range"}setReadOnly(e){this.input.readOnly=this.readOnly=e}setDisabled(e){this.input.disabled=this.disabled=e}render(){let{min:e,max:t,step:i}=this.ui;return n.createElement(n.Fragment,null,n.createElement("input",{ref:e=>this.input=e,className:o()(this.className,"form-control","w-min-6c"),type:this.inputType,defaultValue:this.defaultValue,onChange:this.onInputChange,max:t,min:e,step:i}))}}},button:{dataTypes:["button","submit"],widget:S}};function T(e,t,i,s){if(void 0===e)return null;if(void 0===t)return;let o,{name:a,type:l}=t;switch(l){case"arr":let t=e.getItemSchema(a);return n.createElement(I,{parentContext:e,arrSchema:t,children:i})}let c=e.getUiItem(a);function u(e){switch(e){default:return y;case"id":return N;case"integer":return w;case"number":return b;case"string":return y;case"date":return E;case"boolean":return x;case"button":case"submit":return S}}if(void 0===c)o=u(l);else{let{widget:e}=c;switch(e){default:if(void 0!==e){o=j[e].widget}void 0===o&&(o=u(l));break;case"custom":o=c.WidgetClass;break;case"group":return n.createElement("span",null,"impletment group")}}let{isRow:d,widgets:h}=e,p=new o(e,t,s,i);if(h[a]=p,!1===d){let e=Object(r.a)(()=>p.renderContainer());return n.createElement(e,null)}return p.renderContainer()}i.d(t,"a",function(){return T})},function(e,t,i){"use strict";i.d(t,"store",function(){return v});var n=i(1),r=i(4),s=i.n(r),o=i(3),a=i(9),l=i(67),c=i(35),u=(i(57),i(58),function(e,t,i,n){var r,s=arguments.length,o=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,i,o):r(t,i))||o);return s>3&&o&&Object.defineProperty(t,i,o),o}),d=function(e,t,i,n){return new(i||(i=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(t){s(t)}}function a(e){try{l(n.throw(e))}catch(t){s(t)}}function l(e){e.done?r(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};const h={id:0,name:"\u540c\u82b1\u7cfb\u7edf",nick:void 0,discription:"\u540c\u82b1\u5e73\u53f0",icon:void 0,date:void 0};class p extends o.PageItems{constructor(e,t){super(!0),this.unit=e,this.query=t,this.appendPosition="head"}load(){return d(this,void 0,void 0,function*(){return yield this.query.loadSchema(),(yield this.query.page(this.param,this.pageStart,this.pageSize)).$page})}setPageStart(e){this.pageStart=void 0===e?void 0:e.id}end(e){this.items.find(t=>t.id===e)}remove(e){let t=this.items.find(t=>t.id===e);void 0!==t&&this.items.remove(t)}addMessage(e){this.remove(e.id),this.append(e),void 0===this.unread&&(this.unread=0),++this.unread}}u([n.l],p.prototype,"unread",void 0);class f{constructor(e){this.id=e,this.messages=new p(this,void 0)}get isOwner(){return this._isOwner}set isOwner(e){this._isOwner=e}get isAdmin(){return this._isAdmin}set isAdmin(e){this._isAdmin=e}loadProps(){return d(this,void 0,void 0,function*(){let e=yield a.a.unitBase(this.id);if(void 0===e)return;let{name:t,discription:i,icon:n,nick:r,isOwner:s,isAdmin:o,owner:l,ownerName:c,ownerNick:u,ownerIcon:d}=e;this.name=t,this.discription=i,this.nick=r,this.icon=n,this.isOwner=s,this.isAdmin=o,this.owner=l,this.ownerName=c,this.ownerNick=u,this.ownerIcon=d})}loadApps(){return d(this,void 0,void 0,function*(){let e,t=yield a.a.apps(this.id);e=void 0===t?[]:t.apps,void 0===t?(t={},s.a.assign(t,h)):0===t.id&&s.a.assign(t,h),s.a.assign(this,t),this.apps=e})}loadMessages(){return d(this,void 0,void 0,function*(){yield a.a.messagesRead(this.id),void 0===this.messages.items&&(yield this.messages.first(void 0))})}messageReadClear(){return d(this,void 0,void 0,function*(){this.unread=0,this.messages.unread=0;let e=v.stickies.find(e=>e.objId===this.id);if(void 0!==e){e.date=void 0;let t=e.obj;void 0!==t&&(t.subject=void 0,t.unread=0)}yield a.a.messagesRead(this.id)})}messageAct(e,t){return d(this,void 0,void 0,function*(){yield a.a.actMessage({unit:this.id,id:e,action:t})})}}u([n.l],f.prototype,"apps",void 0),u([n.l],f.prototype,"unread",void 0),u([n.l],f.prototype,"date",void 0);class m{constructor(){this.unitArray=[],this.units=new Map,this.unit=void 0,this.cacheUsers=new c.b,this.cacheUnits=new c.a,this.follow=new l.a(this)}onWs(e){return d(this,void 0,void 0,function*(){let{from:t,to:i,body:n,push:r}=e;if(void 0===n)return;let{$type:s,$user:o,$unit:a,$io:l,action:c,data:u,msg:d}=n;if("msg"!==s)return;if(!u)return;let h=new Date,p=v.dataToMsg(u);for(let e of this.units){let t=e[1];if(a===t.id){this.onStickyMessage(t,l,h,p.message&&p.message.subject);break}}void 0!==e.id?this.processMessage(e):this.processCommand(e)})}dataToMsg(e){let t=e.split("\t");function i(e){if(e)return Number(e)}let n,r=i(t[0]),s=function(e){if(e)return new Date(1e3*Number(e))}(t[4]),o=i(t[8]),a=i(t[9]),l=t[10],c=t[11];return void 0!==s&&(n={id:r,fromUser:i(t[1]),fromUnit:i(t[2]),type:t[3],date:s,subject:t[5],discription:t[6],content:t[7]}),{id:r,message:n,branch:o,done:a,prevState:l,state:c}}onStickyMessage(e,t,i,n){if(e.unread+=t,e.date=i,void 0!==this.stickies)for(let r of this.stickies)if(r.objId===e.id){void 0!==r.obj&&(r.obj.subject=n);break}}processCommand(e){let{type:t,content:i}=e;switch(t){case"message-end":this.messageEnd(i);break;case"message-removed":this.messageRemoved(i)}}messageEnd(e){let{id:t,unit:i,state:n}=e,r=this.units.get(i);void 0!==r&&r.messages.end(t)}messageRemoved(e){let{id:t,unit:i}=e;this.removeMessage(i,t)}removeMessage(e,t){let i=this.units.get(e);void 0!==i&&i.messages.remove(t)}processMessage(e){}logout(){this.stickies.splice(0,this.stickies.length),this.units.clear(),this.unit=void 0,this.cacheUsers.dict.clear(),this.cacheUnits.dict.clear(),this.follow.logout()}getAdminApp(){return d(this,void 0,void 0,function*(){return void 0!==this.adminApp?this.adminApp:this.adminApp=yield a.a.adminUrl()})}getAppFromId(e){return d(this,void 0,void 0,function*(){return yield a.a.appFromId(e)})}loadStickies(){return d(this,void 0,void 0,function*(){let e=[],t=yield a.a.stickies(),i=t[0],n=t[4];for(let s of i)switch(s.type){case 3:let e=s.obj=n.find(e=>e.id===s.objId),{id:t,type:i,name:r,discription:o,icon:a,unread:l,date:c,owner:u}=e,d=new f(t);d.type=i,d.name=r,d.discription=o,d.icon=a,d.unread=l,d.date=c,d.owner=u,this.units.set(t,d)}e.push(...i);let r=t[5][0];if(void 0!==r){let{unread:t,date:i}=r;this.addSysUnitStick(e,t,i)}this.stickies=e})}newUnit(e){return d(this,void 0,void 0,function*(){let t=new f(e);if(yield t.loadProps(),this.units.set(e,t),this.unitArray.unshift(t),this.unitArray.length>m.maxUnitCount){let e=this.unitArray.pop();this.units.delete(e.id)}return t})}setUnit(e){return d(this,void 0,void 0,function*(){let t=this.units.get(e);if(void 0===t)t=yield this.newUnit(e);else{let e=this.unitArray.findIndex(e=>e===t);e>0&&(this.unitArray.splice(e,1),this.unitArray.unshift(t))}o.meInFrame.unit=e,this.unit=t})}setUnitRead(){return d(this,void 0,void 0,function*(){let{unread:e,id:t}=this.unit;e>0&&(yield a.b.messageRead(t),this.unit.unread=0)})}acceptFellowInvite(e){return d(this,void 0,void 0,function*(){let t=yield a.a.unitAddFellow(e.id);this.follow.removeInvite(e),void 0!==t&&this.stickies.unshift(t)})}addSysUnitStick(e,t,i){if(void 0===t||t<=0)return;let n=e.findIndex(e=>(0===e.type||3===e.type)&&0===e.objId);if(n<0){let i=s.a.clone(h);return i.unread=t,void e.unshift({id:0,date:new Date,type:0,objId:0,obj:i})}if(n>0){let t=e.splice(n,1)[0];e.unshift(t)}}followUnit(e){return d(this,void 0,void 0,function*(){let t=yield a.a.searchUnitsFollow(e),i=this.units.get(e);void 0===i?i=yield this.newUnit(e):i.apps=void 0,this.stickies.unshift({id:t,date:new Date,type:3,objId:e,obj:i})})}unfollowUnit(){return d(this,void 0,void 0,function*(){if(void 0===this.unit)return;this.unit.apps=void 0;let e=this.unit.id;yield a.a.unitNotFollow(e);let t=this.stickies.findIndex(t=>t.objId===e);t<0||this.stickies.splice(t,1)})}}m.maxUnitCount=2,u([n.l],m.prototype,"stickies",void 0),u([n.l],m.prototype,"units",void 0),u([n.l],m.prototype,"unit",void 0);const v=new m},,,function(e,t,i){"use strict";i.d(t,"a",function(){return s});var n=i(12),r=i(13);const s={set(e,t){Object(n.f)(e,t),r.a.setCenterToken(t)},clear(){Object(n.f)(0,void 0),r.a.setCenterToken(void 0)}}},function(e,t,i){"use strict";i.d(t,"b",function(){return o}),i.d(t,"a",function(){return a});var n=i(3),r=i(9),s=function(e,t,i,n){return new(i||(i=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(t){s(t)}}function a(e){try{l(n.throw(e))}catch(t){s(t)}}function l(e){e.done?r(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class o extends n.CacheIds{_loadIds(e){return s(this,void 0,void 0,function*(){})}_loadId(e){return s(this,void 0,void 0,function*(){return yield r.a.userBase(e)})}}class a extends n.CacheIds{_loadIds(e){return s(this,void 0,void 0,function*(){})}_loadId(e){return s(this,void 0,void 0,function*(){return yield r.a.unitBase(e)})}}},,function(e,t,i){"use strict"},,function(e,t,i){"use strict";i(0)},function(e,t,i){"use strict";i(0),i(2)},function(e,t,i){"use strict";i.d(t,"a",function(){return l}),i.d(t,"c",function(){return c}),i.d(t,"b",function(){return u});var n=i(0),r=i(7),s=i(17),o=i(10),a=function(e,t,i,n){return new(i||(i=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(t){s(t)}}function a(e){try{l(n.throw(e))}catch(t){s(t)}}function l(e){e.done?r(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class l{constructor(e){this.isDev=o.e,this.onMessageReceive=(e=>a(this,void 0,void 0,function*(){yield this.onMessage(e)})),this.res=e||{},this.x=this.res.x||{}}get user(){return r.c.user}get isLogined(){let{user:e}=r.c;return void 0!==e&&e.id>0}dispose(){r.c.unregisterReceiveHandler(this.receiveHandlerId),this.onDispose()}onDispose(){}openVPage(e,t){return a(this,void 0,void 0,function*(){yield new e(this).open(t)})}renderView(e,t){return new e(this).render(t)}event(e,t){return a(this,void 0,void 0,function*(){yield this.onEvent(e,t)})}onEvent(e,t){return a(this,void 0,void 0,function*(){})}msg(e){alert(e)}errorPage(e,t){this.openPage(n.createElement(s.a,{header:"App error!"},n.createElement("pre",null,"string"===typeof t?t:t.message)))}onMessage(e){}beforeStart(){return a(this,void 0,void 0,function*(){return!0})}registerReceiveHandler(){this.receiveHandlerId=r.c.registerReceiveHandler(this.onMessageReceive)}start(e){return a(this,void 0,void 0,function*(){this.disposer=this.dispose.bind(this),this.registerReceiveHandler(),!1!==(yield this.beforeStart())&&(yield this.internalStart(e))})}get isCalling(){return void 0!==this._resolve_$}call(e){return a(this,void 0,void 0,function*(){return void 0===this._resolve_$&&(this._resolve_$=[]),new Promise((t,i)=>a(this,void 0,void 0,function*(){this._resolve_$.push(t),yield this.start(e)}))})}vCall(e,t){return a(this,void 0,void 0,function*(){return void 0===this._resolve_$&&(this._resolve_$=[]),new Promise((i,n)=>a(this,void 0,void 0,function*(){this._resolve_$.push(i),yield new e(this).open(t)}))})}returnCall(e){if(void 0===this._resolve_$)return;let t=this._resolve_$.pop();void 0!==t?t(e):alert("the Coordinator call already returned, or not called")}openPage(e){r.c.push(e,this.disposer),this.disposer=void 0}replacePage(e){r.c.replace(e,this.disposer),this.disposer=void 0}backPage(){r.c.back()}closePage(e){r.c.pop(e)}ceasePage(e){r.c.ceaseTop(e)}removeCeased(){r.c.removeCeased()}regConfirmClose(e){r.c.regConfirmClose(e)}}class c{constructor(e){this.controller=e,this.res=e.res,this.x=e.x}get isDev(){return o.e}renderVm(e,t){return new e(this.controller).render(t)}openVPage(e,t){return a(this,void 0,void 0,function*(){yield new e(this.controller).open(t)})}event(e,t){return a(this,void 0,void 0,function*(){yield this.controller.event(e,t)})}returnCall(e){this.controller.returnCall(e)}openPage(e,t){this.controller.openPage(n.createElement(e,t))}replacePage(e,t){this.controller.replacePage(n.createElement(e,t))}openPageElement(e){this.controller.openPage(e)}replacePageElement(e){this.controller.replacePage(e)}backPage(){this.controller.backPage()}closePage(e){this.controller.closePage(e)}ceasePage(e){this.controller.ceasePage(e)}removeCeased(){this.controller.removeCeased()}regConfirmClose(e){this.controller.regConfirmClose(e)}}class u extends c{constructor(e){super(e)}render(e){return null}}},function(e,t,i){"use strict";var n=i(64);i.d(t,"Form",function(){return n.a});i(43);var r=i(44);i.o(r,"resLang")&&i.d(t,"resLang",function(){return r.resLang});var s=i(45);i.o(s,"resLang")&&i.d(t,"resLang",function(){return s.resLang});i(8)},function(e,t,i){"use strict";var n=i(0),r=i(30),s=i(8);(class extends n.Component{render(){let{name:e,children:t}=this.props,i=this.context;if(void 0===i)return n.createElement("span",{className:"text-danger"},"!only in Form!");let s=i.getItemSchema(e),o=Object(r.a)(i,s,t,this.props);return void 0===o?n.createElement("span",{className:"text-danger"},"!!",e," is not defined!!"):o}}).contextType=s.a},function(e,t){},function(e,t){},function(e,t,i){"use strict";i.d(t,"a",function(){return a});var n=i(1),r=i(18),s=function(e,t,i,n){var r,s=arguments.length,o=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,i,o):r(t,i))||o);return s>3&&o&&Object.defineProperty(t,i,o),o},o=function(e,t,i,n){return new(i||(i=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(t){s(t)}}function a(e){try{l(n.throw(e))}catch(t){s(t)}}function l(e){e.done?r(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class a{constructor(e=!1){this.isFirst=!0,this.loading=!1,this.beforeLoad=!0,this.loaded=!1,this.allLoaded=!1,this.firstSize=100,this.pageStart=void 0,this.pageSize=30,this.appendPosition="tail",this._items=n.l.array([],{deep:e})}get items(){return!0===this.beforeLoad?null:!1!==this.loaded?this._items:void 0}scrollToTop(){this.topDiv="$$"+Object(r.a)()}scrollToBottom(){this.bottomDiv="$$"+Object(r.a)()}reset(){this.isFirst=!0,this.beforeLoad=!0,this.loaded=!1,this.param=void 0,this.allLoaded=!1,this._items.clear(),this.setPageStart(void 0)}append(e){"tail"===this.appendPosition?this._items.unshift(e):this._items.push(e)}first(e){return o(this,void 0,void 0,function*(){this.reset(),this.beforeLoad=!1,this.param=e,yield this.more()})}more(){return o(this,void 0,void 0,function*(){if(!0===this.allLoaded)return;if(!0===this.loading)return;this.loading=!0;let e=this.pageSize+1;!0===this.isFirst&&this.firstSize>this.pageSize&&(e=this.firstSize+1);let t=yield this.load(this.param,this.pageStart,e);this.loading=!1,this.loaded=!0;let i=t.length;!0===this.isFirst&&i>this.firstSize||!1===this.isFirst&&i>this.pageSize?(this.allLoaded=!1,--i,t.splice(i,1)):this.allLoaded=!0,0!==i?(this.setPageStart(t[i-1]),"tail"===this.appendPosition?this._items.push(...t):this._items.unshift(...t.reverse()),this.isFirst=!1):this._items.clear()})}}s([n.l],a.prototype,"loading",void 0),s([n.l],a.prototype,"beforeLoad",void 0),s([n.l],a.prototype,"loaded",void 0),s([n.l],a.prototype,"allLoaded",void 0),s([n.e],a.prototype,"items",null),s([n.l],a.prototype,"topDiv",void 0),s([n.l],a.prototype,"bottomDiv",void 0)},function(e,t,i){"use strict";i.d(t,"a",function(){return s});var n=i(1),r=function(e,t,i,n){return new(i||(i=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(t){s(t)}}function a(e){try{l(n.throw(e))}catch(t){s(t)}}function l(e){e.done?r(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class s{constructor(e=100){this.arr=[],this.dict=new Map,this.maxCount=e}loadIds(e){let t=[];for(let i of e){if(null===i)continue;let e=this.dict.get(i);void 0===e&&(t.push(i),e={id:i},this.dict.set(i,e))}this.loadId(t)}get(e){if(void 0===e||null===e)return null;let t=this.dict.get(e);return void 0===t&&(this.dict.set(e,{id:e}),this.loadId([e]),t=this.dict.get(e)),t}setItem(e,t){void 0===t?(this.dict.set(e,null),this.arr.push({id:e})):(this.dict.set(e,t),this.arr.push(t)),this.arr.length>this.maxCount&&(t=this.arr.shift(),this.dict.delete(t.id))}loadId(e){return r(this,void 0,void 0,function*(){let t=yield this._loadIds(e);if(void 0===t)for(let i of e){if(null===i)continue;let e=yield this._loadId(i);this.setItem(i,e)}else for(let i of e){let e=t.find(e=>e.id===i);this.setItem(i,e)}})}}(function(e,t,i,n){var r,s=arguments.length,o=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,i,o):r(t,i))||o);s>3&&o&&Object.defineProperty(t,i,o)})([n.l],s.prototype,"dict",void 0)},function(e,t){},function(e,t){},function(e,t){},function(e,t,i){"use strict";i.d(t,"a",function(){return o});var n=i(0),r=i(6),s=i(29);let o=class extends n.Component{constructor(e){super(e),this.formView=new s.a(this.props)}componentWillMount(){this.formView.setInitValues(this.props.initValues)}debug(){}render(){let{className:e,children:t,initValues:i}=this.props;return n.createElement("div",{className:e},void 0===t?this.formView.render():n.createElement("form",{onSubmit:this.formView.onSubmit},t))}};o=function(e,t,i,n){var r,s=arguments.length,o=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,i,o):r(t,i))||o);return s>3&&o&&Object.defineProperty(t,i,o),o}([r.a],o)},function(e,t,i){"use strict";i(0),i(2)},function(e,t,i){"use strict";i.d(t,"a",function(){return r});var n=i(0);class r extends n.Component{render(){let{date:e}=this.props;if(!e)return null;let t="string"===typeof e?new Date(Date.parse(e)):e,i=new Date,n=i.getTime()-t.getTime(),r=i.getDate(),s=t.getDate(),o=t.getHours(),a=t.getMinutes(),l=t.getMonth()+1,c=o+(a<10?":0":":")+a;return n<-864e5?t.getFullYear()+"\u5e74"+l+"\u6708"+s+"\u65e5 "+c:n<864e5?s!==r?(n<0?"\u660e\u5929 ":"\u6628\u5929 ")+c:c:n<31536e6?l+"\u6708"+s+"\u65e5 ":t.getFullYear()+"\u5e74"+l+"\u6708"+s+"\u65e5"}}},function(e,t,i){"use strict";i.d(t,"a",function(){return o});var n=i(0),r=i(2);const s={width:"4rem",height:"4rem"};class o extends n.Component{render(){let e,{icon:t,main:i,discription:o,px:a,py:l}=this.props;e="string"===typeof o?n.createElement("div",null,o):o;let c=t;"string"===typeof t&&(c=n.createElement("img",{className:"d-flex mr-3",src:t,alt:"img",style:s}));let u=r("media",void 0===a?"px-0":"px-"+a,void 0===l?"py-2":"py-"+l);return n.createElement("div",{className:u},c,n.createElement("div",{className:"media-body"},n.createElement("h5",{className:"mt-0"},i),e))}}},function(e,t,i){"use strict";var n=i(0),r=i(2),s=i.n(r),o=i(1),a=function(e,t,i,n){return new(i||(i=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(t){s(t)}}function a(e){try{l(n.throw(e))}catch(t){s(t)}}function l(e){e.done?r(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};(function(e,t,i,n){var r,s=arguments.length,o=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,i,o):r(t,i))||o);s>3&&o&&Object.defineProperty(t,i,o)})([o.l],class extends n.Component{constructor(){super(...arguments),this.key=null,this.onChange=(e=>{this.key=e.target.value,void 0!==this.key&&(this.key=this.key.trim()),this.disabled=!this.key}),this.onSubmit=(e=>a(this,void 0,void 0,function*(){e.preventDefault(),null===this.key&&(this.key=this.props.initKey||""),this.key&&(this.input&&(this.input.disabled=!0),yield this.props.onSearch(this.key),this.input&&(this.input.disabled=!1))}))}render(){let e,t,{className:i,inputClassName:r,label:o,placeholder:a,buttonText:l,maxLength:c,size:u}=this.props;switch(u){default:case"sm":e="input-group-sm";break;case"md":e="input-group-md";break;case"lg":e="input-group-lg"}return void 0!==o&&(t=n.createElement("label",{className:"input-group-addon"},o)),n.createElement("form",{className:i,onSubmit:this.onSubmit},n.createElement("div",{className:s()("input-group",e)},t,n.createElement("input",{onChange:this.onChange,type:"text",name:"key",className:s()("form-control",r||"border-primary"),placeholder:a,defaultValue:this.props.initKey,maxLength:c}),n.createElement("div",{className:"input-group-append"},n.createElement("button",{className:"btn btn-primary",type:"submit",disabled:this.disabled},n.createElement("i",{className:"fa fa-search"}),n.createElement("i",{className:"fa"}),l))))}}.prototype,"disabled",void 0)},function(e,t,i){"use strict";i(0),i(4),i(2),i(28)},function(e,t){},function(e,t,i){"use strict";const n=[{id:-99,name:"$self",icon:"tasks",caption:"\u81ea\u5df1\u5f85\u529e",discription:void 0,content:{needTo:!1}},{id:-98,name:"$dispatch",icon:"share-square",caption:"\u7ed9\u540c\u4e8b\u53d1\u4efb\u52a1",discription:void 0,content:{needTo:!0}}],r={};for(let s of n)r[s.name]=s},function(e,t,i){"use strict";var n=i(0),r=i(6),s=i(2);i(91);let o=class extends n.Component{render(){let e,{className:t,badge:i,size:r,color:o,badgeAlign:a,badgeVertical:l,children:c}=this.props,u=s(t,"va-badge",r&&"va-badge-"+r,"va-badge-"+(o||"secondary"),a&&"va-badg-"+a,l&&"va-badg-"+l);return i&&(e=n.createElement("b",null,i)),n.createElement("div",{className:u},c,e)}};o=function(e,t,i,n){var r,s=arguments.length,o=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,i,o):r(t,i))||o);return s>3&&o&&Object.defineProperty(t,i,o),o}([r.a],o);i(93);let a=class extends n.Component{render(){let e,t,i,{className:r,left:o,children:a,right:l,onClick:c}=this.props;return void 0!==o&&(e=n.createElement("header",null,o)),void 0!==l&&(t=n.createElement("footer",null,l)),void 0!==c&&(i="cursor-pointer"),n.createElement("div",{className:s("va-lmr",r,i),onClick:c},e,n.createElement("div",null,a),t)}};a=function(e,t,i,n){var r,s=arguments.length,o=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,i,o):r(t,i))||o);return s>3&&o&&Object.defineProperty(t,i,o),o}([r.a],a);class l extends n.Component{render(){let{name:e,className:t,size:i,spin:r,fixWidth:o,border:a,pull:l,pulse:c,rotate:u,flip:d,inverse:h}=this.props,p=s(t,"fa",e&&"fa-"+e,i&&"fa-"+i,o&&"fa-fw",a&&"fa-border",l&&"fa-pull-"+l,r&&"fa-spin",c&&"fa-pulse",u&&"fa-rotate-"+u,d&&"fa-flip-"+d,h&&"fa-inverse");return n.createElement("i",{className:p})}}class c extends n.Component{render(){let{icon:e,iconClass:t,text:i,textClass:r}=this.props;return n.createElement("div",{className:"py-2"},n.createElement(l,{className:t,name:e,fixWidth:!0}),n.createElement("span",{className:r},i))}}const u=e=>n.createElement("small",{className:s("text-muted",e.className),style:e.style},e.children);var d=i(1),h=function(e,t,i,n){var r,s=arguments.length,o=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,i,o):r(t,i))||o);return s>3&&o&&Object.defineProperty(t,i,o),o},p=function(e,t,i,n){return new(i||(i=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(t){s(t)}}function a(e){try{l(n.throw(e))}catch(t){s(t)}}function l(e){e.done?r(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};const f="http://101.200.46.56/imgs/Bear-icon.png";let m=class extends n.Component{componentWillMount(){return p(this,void 0,void 0,function*(){let{src:e}=this.props;e?!1!==e.startsWith(":")?this.src=f:this.src=e:this.src=f})}render(){let{className:e,style:t}=this.props;return n.createElement("img",{src:this.src,className:e,style:t})}};h([d.l],m.prototype,"src",void 0),m=h([r.a],m),i.d(t,"a",function(){return o}),i.d(t,"e",function(){return a}),i.d(t,"b",function(){return l}),i.d(t,"c",function(){return c}),i.d(t,"f",function(){return u}),i.d(t,"d",function(){return m})},function(e,t,i){"use strict";var n=i(0),r=i(2),s=i.n(r),o=i(6),a=i(1);class l{constructor(e){this.list=e}get isPaged(){let e=this.list.props.items;return null!==e&&void 0!==e&&!1===Array.isArray(e)}get items(){let e=this.list.props.items;return null===e?null:void 0!==e?!0===Array.isArray(e)?e:e.items:void 0}get loading(){let e=this.list.props.items;if(null===e)return!1;if(void 0===e)return!0;let t=e;return void 0!==t.items&&t.loading}get selectedItems(){}updateProps(e){}renderContent(e,t){let{render:i}=this.list.props.item;return void 0===i?n.createElement("div",{className:"px-3 py-2"},JSON.stringify(e)):i(e,t)}}(function(e,t,i,n){var r,s=arguments.length,o=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,i,o):r(t,i))||o);s>3&&o&&Object.defineProperty(t,i,o)})([a.e],l.prototype,"loading",null);class c extends l{render(e,t){let{className:i,key:s,onClick:o}=this.list.props.item;return n.createElement("li",{key:void 0===s?t:s(e),className:r("va-row-clickable",i),onClick:()=>o(e)},this.renderContent(e,t))}}var u=i(14);class d extends l{render(e,t){let{className:i,key:s,render:o}=this.list.props.item;if("string"===typeof e){let t=r("va-list-gap","px-3","pt-1");return n.createElement("li",{key:Object(u.a)(),className:t},e)}return n.createElement("li",{key:void 0===s?t:s(e),className:r(i)},this.renderContent(e,t))}}class h extends l{buildItems(){console.log("buildItems in selectable.tsx");let e,{items:t,selectedItems:i,compare:n}=this.list.props;return void 0===t?this._items=void 0:null===t?this._items=null:(e=!0===Array.isArray(t)?t:t.items,this._selectedItems=i,this._items=void 0===i?e.map(e=>({selected:!1,item:e,labelId:Object(u.a)()})):void 0===n?e.map(e=>({selected:void 0!==i.find(t=>t===e),item:e,labelId:Object(u.a)()})):e.map(e=>({selected:void 0!==i.find(t=>n(e,t)),item:e,labelId:Object(u.a)()})))}get items(){return this.buildItems(),this._items}updateProps(e){e.selectedItems!==this._selectedItems&&this.buildItems()}onSelect(e,t){e.selected=t;let i=this._items.some(e=>e.selected);this.list.props.item.onSelect(e.item,t,i)}get selectedItems(){return this._items.filter(e=>!0===e.selected).map(e=>e.item)}render(e,t){let{className:i,key:s,render:o,onSelect:a}=this.list.props.item,{labelId:l,selected:c}=e;return n.createElement("li",{key:void 0===s?t:s(e),className:r(i)},n.createElement("div",{className:"d-flex align-items-center px-3"},n.createElement("input",{ref:e=>{e&&(this.input=e,e.checked=c)},className:"",type:"checkbox",value:"",id:l,defaultChecked:c,onChange:t=>{this.onSelect(e,t.target.checked)}}),n.createElement("label",{className:"",style:{flex:1,marginBottom:0},htmlFor:l},this.renderContent(e.item,t))))}}(function(e,t,i,n){var r,s=arguments.length,o=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,i,o):r(t,i))||o);s>3&&o&&Object.defineProperty(t,i,o)})([a.e],h.prototype,"items",null);i(89);i.d(t,"a",function(){return p});let p=class extends n.Component{constructor(e){super(e),this._$scroll=(e=>{console.log("############### items scroll to "+e)});let{item:t}=this.props,{onClick:i,onSelect:n}=t;this.listBase=void 0!==n?new h(this):void 0!==i?new c(this):new d(this)}componentWillUpdate(e,t,i){this.listBase.updateProps(e)}get selectedItems(){return this.listBase.selectedItems}render(){let{className:e,header:t,footer:i,before:r,loading:o,none:a,item:l,selectedItems:c}=this.props;void 0===r&&(r="before"),void 0===o&&(o="loading"),void 0===a&&(a="none");let u,{isPaged:d,items:h,loading:p}=this.listBase;function f(e,t){if(e)switch(typeof e){default:case"string":return n.createElement("li",{className:"va-list-"+t},e);case"function":return n.createElement("li",{className:"va-list-"+t},e());case"object":return n.createElement("li",null,e)}}return u=null===h?f(r,"before"):void 0===h?f(o,"loading"):0===h.length?f(a,"none"):h.map((e,t)=>this.listBase.render(e,t)),n.createElement("ul",{className:s()("va-list",e)},f(t,"header"),u,f(i,"footer"))}};p=function(e,t,i,n){var r,s=arguments.length,o=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,i,o):r(t,i))||o);return s>3&&o&&Object.defineProperty(t,i,o),o}([o.a],p)},function(e,t,i){"use strict";var n=i(0),r=i(2);class s{setValues(e){}}class o extends s{render(e){return n.createElement("div",{key:"_b_"+e,className:""},n.createElement("div",{className:"col-sm-12"},n.createElement("div",{style:{borderTop:"1px solid #f0f0f0"}})))}}class a extends s{constructor(e){super(),this.param=e}render(e){let t;switch(this.param){default:t="py-2";break;case"=":t="py-1";break;case"-":t="pb-1"}let i=r(t);return n.createElement("div",{key:"_g_"+e,className:i,style:{backgroundColor:"#f0f0f0"}})}}const l="justify-content-start",c="justify-content-center",u="justify-content-end";class d extends s{constructor(e,t){super(),this.gridProps=e,this.prop=t}render(e){let{onClick:t,bk:i}=this.prop,s=r({"cursor-pointer":void 0!==t,"bg-white":void 0===i,row:!0});return n.createElement("div",{key:e,className:s,onClick:t},this.renderLabel(),this.renderProp())}renderLabel(){let{label:e}=this.prop;return void 0===e?null:n.createElement("label",{className:"col-sm-2 col-form-label"},e)}renderProp(){let e,t,i,{label:s,full:o}=this.prop;switch(this.gridProps.alignValue){case"left":e=l;break;case"center":e=c;break;case"right":e=u}switch(this.prop.vAlign){case"top":t="align-items-start";break;default:case"center":t="align-items-center";break;case"bottom":t="align-items-end";break;case"stretch":t="align-items-stretch"}let a=r(e,t,i=!0!==o?void 0===s?"col-sm-12":"col-sm-10":"w-100","d-flex");return n.createElement("div",{className:a},this.renderPropBody())}renderPropBody(){return n.createElement("div",{className:"form-control-plaintext"},this.renderPropContent())}renderPropContent(){return this.content}}class h extends d{setValues(e){this.content=void 0===e?void 0:e[this.prop.name]}}class p extends d{setValues(e){this.content=void 0===e?void 0:e[this.prop.name]}}class f extends d{setValues(e){if(void 0===e)this.content=void 0;else{let t=this.prop.list;this.content="string"===typeof t?e[t]:void 0}}renderPropBody(){let{list:e,row:t}=this.prop,i="string"===typeof e?this.content:e;return void 0===i?n.createElement("div",null):n.createElement("div",{className:"w-100"},i.map((e,i)=>n.createElement(n.Fragment,{key:i},0===i?null:n.createElement("div",{style:{width:"100%",borderBottom:"1px solid #f0f0f0"}}),n.createElement(t,e))))}}class m extends d{renderPropBody(){let{component:e}=this.prop;return e}}class v{constructor(e,t){this.gridProps=e,this.props=t,this.buildRows()}buildRows(){this.rows=[];let e=!0;for(let t of this.props)if("string"===typeof t)this.rows.push(new a(t)),e=!0;else{let i;switch(e||this.rows.push(new o),t.type){default:continue;case"string":i=new h(this.gridProps,t);break;case"number":i=new p(this.gridProps,t);break;case"list":i=new f(this.gridProps,t);break;case"component":i=new m(this.gridProps,t)}this.rows.push(i),e=!1}}setValues(e){for(let t of this.rows)t.setValues(e)}render(){return this.rows.map((e,t)=>e.render(String(t)))}}var g=i(6);let y=class extends n.Component{render(){let{className:e,rows:t,values:i}=this.props,s=new v(this.props,t);s.setValues(i);let o=r("container-fluid",e);return n.createElement("div",{className:o},s.render())}};y=function(e,t,i,n){var r,s=arguments.length,o=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,i,o):r(t,i))||o);return s>3&&o&&Object.defineProperty(t,i,o),o}([g.a],y),i.d(t,"a",function(){return y})},function(e,t,i){"use strict";var n=i(0),r=i(2),s=i(6);i(95);let o=class extends n.Component{constructor(e){super(e),this.state={pressed:!1}}render(){let e,t,i,s,o,a,{date:l,main:c,vice:u,middle:d,midSize:h,icon:p,unread:f,right:m,onClick:v}=this.props;if(void 0!==f){let e;(e="number"===typeof f?f:f.get())>0?i=n.createElement("b",null,e):e<0&&(i=n.createElement("b",{className:"dot"}))}switch(typeof p){case"object":e=n.createElement("header",null,p,i),t=!1;break;case"string":e=n.createElement("header",{className:"icon"},n.createElement("img",{src:p}),i),t=!0}if(void 0!==d)switch(typeof d){case"string":s=n.createElement("div",{style:{flex:h}},d);break;default:s=d}void 0!==m&&(o="string"===typeof m?n.createElement("footer",null,n.createElement("small",{className:"text-muted"},m)):n.createElement("footer",null,m)),void 0!==u&&(a=n.createElement("span",null,u));let g=r("va-row",{icon:t,pressed:this.state.pressed},{"va-action":void 0!==v});return n.createElement("li",{className:g,onClick:v},e,n.createElement("div",null,n.createElement("div",null,c),a),s,o)}};o=function(e,t,i,n){var r,s=arguments.length,o=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,i,o):r(t,i))||o);return s>3&&o&&Object.defineProperty(t,i,o),o}([s.a],o);let a=class extends n.Component{render(){let e,t,{header:i,items:s,beforeLoad:a,none:l,renderRow:c,className:u,footer:d,itemClick:h,converter:p}=this.props,f=r(u,"va-list");return e=void 0===s?null===a?null:n.createElement("li",{className:"empty"},a||"..."):0===s.length?n.createElement("li",{className:"empty"},l||"[none]"):void 0!==c?s.map((e,t)=>c(e,t,this.props.ex)):s.map((e,t)=>{let i,r=e.onClick;if(void 0===r&&void 0!==h&&(r=(()=>h(e))),void 0!==p){if(void 0===(i=p(e)))return null}else i=Object.assign({},e);return void 0===i.key&&(i.key=i.main),n.createElement(o,Object.assign({onClick:r},i))}),void 0!==i&&(t="string"===typeof i?n.createElement("div",{className:"va-list-header"},i):i),n.createElement("div",{className:f},t,n.createElement("ul",null,e),d)}};a=function(e,t,i,n){var r,s=arguments.length,o=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,i,o):r(t,i))||o);return s>3&&o&&Object.defineProperty(t,i,o),o}([s.a],a)},function(e,t,i){"use strict";var n=i(0),r=i(1),s=i(6),o=i(2),a=i.n(o),l=function(e,t,i,n){var r,s=arguments.length,o=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,i,o):r(t,i))||o);return s>3&&o&&Object.defineProperty(t,i,o),o};class c{get content(){return!0!==this.selected?this._content:void 0!==this._content?this._content:this._content=this.contentBuilder()}}l([r.l],c.prototype,"selected",void 0);let u=class extends n.Component{constructor(e){super(e),this.tabs=[],this.tabClick=(e=>{this.selectedTab.selected=!1,e.selected=!0,this.selectedTab=e});let{size:t,tabs:i,tabBack:n,contentBack:r,sep:s,selected:o}=this.props;switch(t){default:case"md":this.size="3.2rem";break;case"sm":this.size="4rem";break;case"lg":this.size="2.5rem"}this.tabs.push(...i.map(e=>{let t=new c;return t.name=e.name,t.selected=!1,t.caption=e.caption,t.contentBuilder=e.content,t.notify=e.notify,t})),this.tabBack=n||"bg-light",this.contentBack=r,this.sep=s||"border-top border-gray",void 0!==o&&(this.selectedTab=this.tabs.find(e=>e.name===o)),void 0===this.selectedTab&&(this.selectedTab=this.tabs[0]),this.selectedTab.selected=!0}render(){return n.createElement("div",{className:"tab"},n.createElement("div",{className:this.contentBack,style:{height:"calc(100% - "+this.size+")"}},this.tabs.map((e,t)=>{let i={display:!0===e.selected?void 0:"none"};return n.createElement("div",{key:t,style:i},e.content)})),n.createElement("div",{className:a()(this.tabBack,this.sep),style:{height:this.size}},this.tabs.map((e,t)=>{let i,{selected:r,caption:s,notify:o}=e;if(void 0!==o){let e=o.get();void 0!==e&&(e>0?i=n.createElement("u",null,e>99?"99+":e):e<0&&(i=n.createElement("u",{className:"dot"})))}return n.createElement("div",{key:t,className:"",onClick:()=>this.tabClick(e)},n.createElement("div",{className:"align-self-center"},i,s(r)))})))}};l([r.l],u.prototype,"selectedTab",void 0),l([r.l],u.prototype,"tabs",void 0),u=l([s.a],u)},function(e,t,i){"use strict";var n=i(0),r=i(1),s=i(2),o=i.n(s),a=i(30),l=(i(38),i(8));const c={_:{required:"required",number:"not valid number",integer:"not valid integer",min:"min value is ${min}",max:"max value is ${max}"},zh:{_:{required:"\u5fc5\u987b\u586b",number:"\u9700\u8981\u6570\u5b57",integer:"\u9700\u8981\u6574\u6570",min:"\u4e0d\u80fd\u5c0f\u4e8e${min}",max:"\u4e0d\u80fd\u5927\u4e8e${max}"}}};var u=i(22);i.d(t,"a",function(){return d});class d extends n.Component{constructor(e){super(e),this.calcSelectOrDelete=(()=>{if(void 0!==this.formData)for(let e of this.schema)this.arrItemOperated(e)}),this.DefaultContainer=(e=>n.createElement("form",{className:o()(this.props.className)},e)),this.DefaultFieldContainer=((e,t)=>{let{fieldLabelSize:i}=this.props;if(i>0){let r;null===e?i=0:r=n.createElement("label",{className:o()("col-sm-"+i,"col-form-label")},e);let s="col-sm-"+(12-i);return n.createElement("div",{className:"form-group row"},r,n.createElement("div",{className:s},t))}return n.createElement("div",{className:"form-group"},null===e?null:n.createElement("label",{className:"col-form-label"},e),t)}),this.DefaultFieldClass=void 0,this.DefaultButtonClass="text-center py-2",this.DefaultRes=Object(u.a)(c),this.ArrContainer=((e,t)=>n.createElement("div",null,n.createElement("div",{className:o()("small text-muted text-center bg-light py-1 px-3 mt-4 mb-1")},e),t)),this.RowContainer=(e=>{let t=o()({"py-3":!0});return n.createElement("div",{className:t},e)}),this.RowSeperator=n.createElement("div",{className:"border border-gray border-top"});let{schema:t,uiSchema:i,formData:s,Container:d,FieldContainer:h,FieldClass:p,ButtonClass:f,res:m}=e;this.Container=d||this.DefaultContainer,this.FieldContainer=h||this.DefaultFieldContainer,this.FieldClass=void 0!==p&&""!==p&&null!==p?p:this.DefaultFieldClass,this.res=m||this.DefaultRes,this.ButtonClass=f||this.DefaultButtonClass,this.schema=t,this.itemSchemas={};for(let n of this.schema)this.itemSchemas[n.name]=n;this.uiSchema=i,this.formData=s,this.disposer=Object(r.d)(this.calcSelectOrDelete),this.data={},this.initData(s);void 0!==this.props.children||this.uiSchema&&this.uiSchema.Templet;let{children:v}=this.props;if(void 0!==v)this.content=n.createElement(n.Fragment,null,v),this.formContext=new l.b(this,!0);else{let e;void 0!==this.uiSchema&&(e=this.uiSchema.Templet),void 0!==e?(this.content="function"===typeof e?e(this.data):e,this.formContext=new l.b(this,!0)):(this.formContext=new l.b(this,!1),this.content=n.createElement(n.Fragment,null,this.schema.map((e,t)=>n.createElement(n.Fragment,{key:t},Object(a.a)(this.formContext,e,v)))))}}initData(e){void 0===e&&(e={});for(let t of this.schema)this.initDataItem(t,this.data,e)}initDataItem(e,t,i){let{name:n,type:s}=e;if("button"!==s)if("arr"!==s)t[n]=i[n];else{let s=e,{arr:o}=s;if(void 0===o)return;let a=s.itemSchemas={};for(let e of o)a[e.name]=e;let l=i[n];void 0===l?l=[]:!1===Array.isArray(l)&&(l=[l]);let c=[];for(let e of l){let{$isSelected:t,$isDeleted:i}=e,n={$source:e,$isSelected:t,$isDeleted:i};for(let r of o)this.initDataItem(r,n,e);c.push(n)}t[n]=Object(r.l)(c)}}arrItemOperated(e){let{name:t,type:i}=e;if("arr"!==i)return;let n=this.data[t],{arr:r}=e;for(let s of n){let{$source:e}=s;if(void 0===e)continue;let{$isSelected:t,$isDeleted:i}=e;s.$isSelected=t,s.$isDeleted=i;for(let n of r)this.arrItemOperated(n)}}componentDidMount(){let{beforeShow:e}=this.props;void 0!==e&&e(this.formContext)}componentWillUnmount(){this.disposer()}render(){return n.createElement(l.a.Provider,{value:this.formContext},n.createElement(this.formContext.renderErrors,null),this.Container(this.content))}}(function(e,t,i,n){var r,s=arguments.length,o=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,i,o):r(t,i))||o);s>3&&o&&Object.defineProperty(t,i,o)})([r.l],d.prototype,"data",void 0)},function(e,t,i){"use strict";i.d(t,"a",function(){return o});var n=i(0),r=i(10),s=function(e,t,i,n){return new(i||(i=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(t){s(t)}}function a(e){try{l(n.throw(e))}catch(t){s(t)}}function l(e){e.done?r(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class o extends n.Component{constructor(){super(...arguments),this.reApi=(()=>s(this,void 0,void 0,function*(){this.props.clearError();const{channel:e,url:t,options:i,resolve:n,reject:s}=this.props;yield Object(r.h)(e,t,i,n,s)})),this.close=(()=>s(this,void 0,void 0,function*(){this.props.clearError()}))}render(){let e,{error:t,url:i}=this.props;if("object"===typeof t){let i=[];for(let e in t)i.push(n.createElement("li",{key:e},n.createElement("label",null,e),n.createElement("div",null,t[e])));e=n.createElement("ul",null,i)}else e=n.createElement("div",null,t);return n.createElement("li",null,n.createElement("article",{className:"page-container"},n.createElement("section",null,n.createElement("div",{className:"va-error"},n.createElement("div",null,"\u7f51\u7edc\u51fa\u73b0\u95ee\u9898"),n.createElement("div",null,"\u70b9\u51fb\u91cd\u65b0\u8bbf\u95ee"),n.createElement("div",null,"url: ",i),e,n.createElement("div",{className:"p-3"},n.createElement("button",{type:"button",onClick:this.reApi},"\u91cd\u65b0API"),n.createElement("button",{type:"button",onClick:this.close},"\u5173\u95ed"))))))}}},function(e,t,i){"use strict";i.d(t,"a",function(){return r});class n{constructor(e){this.name=e}get(){if(void 0!==this.value)return this.value;let e=localStorage.getItem(this.name);return this.value=null===e?void 0:JSON.parse(e)}set(e){e?(this.value=e,localStorage.setItem(this.name,JSON.stringify(e))):this.clear()}clear(){this.value=void 0,localStorage.removeItem(this.name)}}class r{constructor(){this.user=new n("user"),this.guest=new n("guest"),this.unit=new n("unit"),this.homeTabCur=new n("homeTabCur")}logoutClear(){[this.user,this.homeTabCur].map(e=>e.clear())}}},function(e,t,i){"use strict";i.d(t,"a",function(){return a});var n=i(1),r=i(9),s=function(e,t,i,n){var r,s=arguments.length,o=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,i,o):r(t,i))||o);return s>3&&o&&Object.defineProperty(t,i,o),o},o=function(e,t,i,n){return new(i||(i=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(t){s(t)}}function a(e){try{l(n.throw(e))}catch(t){s(t)}}function l(e){e.done?r(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class a{constructor(e){this.invites=void 0,this.newInvitesCount=0,this.store=e}logout(){this.invites=void 0,this.newInvitesCount=0}msgUnitInvited(e){void 0===this.invites?this.newInvitesCount++:void 0===this.invites.find(t=>t.id===e.id)&&this.invites.push(e)}loadInvites(){return o(this,void 0,void 0,function*(){if(void 0===this.invites){let e;if(this.invites=[],void 0===e)return}})}refuseInvite(e){return o(this,void 0,void 0,function*(){yield r.a.removeMessage(e.id),this.removeInvite(e)})}removeInvite(e){let t=this.invites.findIndex(t=>t.id===e.id);this.invites.splice(t,1)}}s([n.l],a.prototype,"invites",void 0),s([n.l],a.prototype,"newInvitesCount",void 0)},function(e,t,i){},function(e,t,i){e.exports=i.p+"static/media/logo.ee7cd8ed.svg"},function(e,t,i){e.exports=i(99)},,,,,,,,,,,function(e,t,i){},,function(e,t,i){},,function(e,t,i){},,,,function(e,t,i){},,function(e,t,i){},,function(e,t,i){},,function(e,t,i){},,function(e,t,i){},,function(e,t,i){"use strict";i.r(t);var n=i(0),r=i(21),s=i(3),o=(i(85),i(87),i(4)),a=i.n(o),l=i(1),c=function(e,t,i,n){return new(i||(i=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(t){s(t)}}function a(e){try{l(n.throw(e))}catch(t){s(t)}}function l(e){e.done?r(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};var u=new class extends s.CenterApi{stickies(){return c(this,void 0,void 0,function*(){return yield this.get("sticky/list",{start:0,pageSize:30})})}ties(){return c(this,void 0,void 0,function*(){return yield this.get("tie/list",{start:0,pageSize:30})})}searchUnits(e,t,i){return c(this,void 0,void 0,function*(){return yield this.get("tie/search-unit",{key:e,pageStart:t,pageSize:i})})}searchUnitsFollow(e){return c(this,void 0,void 0,function*(){return yield this.get("tie/search-unit-follow",{unit:e})})}unitNotFollow(e){return c(this,void 0,void 0,function*(){yield this.get("tie/unit-not-follow",{unit:e})})}apps(e){return c(this,void 0,void 0,function*(){return yield this.get("tie/apps",{unit:e})})}unitxApi(e){return c(this,void 0,void 0,function*(){return yield this.get("tie/apps",{unit:e})})}adminUrl(){return c(this,void 0,void 0,function*(){return yield this.get("tie/admin-url",{})})}adminUnits(){return c(this,void 0,void 0,function*(){return yield this.get("tie/user-admin-units")})}appFromId(e){return c(this,void 0,void 0,function*(){return yield this.get("tie/app-id",{appId:e})})}appApi(e,t,i){return c(this,void 0,void 0,function*(){return yield this.get("tie/app-api",{unit:e,app:t,apiName:i})})}unitMessages(e,t,i){return c(this,void 0,void 0,function*(){return yield this.get("tie/message-inbox",{unit:e,pageStart:t,pageSize:i})})}messagesRead(e){return c(this,void 0,void 0,function*(){return yield this.get("tie/message-read",{unit:e})})}unitAddFellow(e){return c(this,void 0,void 0,function*(){return yield this.get("unit/add-fellow",{invite:e})})}removeMessage(e){return c(this,void 0,void 0,function*(){yield this.get("tie/remove-message",{id:e})})}unitAdmins(e){return c(this,void 0,void 0,function*(){return yield this.get("unit/admins",{unit:e})})}unitCreate(e,t){return c(this,void 0,void 0,function*(){return yield this.post("unit/create",{name:e,message:t})})}unitCreateDirect(e){return c(this,void 0,void 0,function*(){return yield this.post("unit/create-direct",e)})}saveMessage(e){return c(this,void 0,void 0,function*(){return yield this.post("tie/message-save",e)})}actMessage(e){return c(this,void 0,void 0,function*(){yield this.post("tie/message-act",e)})}userBase(e){return c(this,void 0,void 0,function*(){return yield this.get("tie/user",{id:e})})}unitBase(e){return c(this,void 0,void 0,function*(){return yield this.get("tie/unit",{id:e})})}postMessage(e,t){return c(this,void 0,void 0,function*(){return yield this.post("test/post",{to:e,message:t})})}membersFromName(e){return c(this,void 0,void 0,function*(){return yield this.get("unit/members-from-name",e)})}resetPassword(e){return c(this,void 0,void 0,function*(){return yield this.post("tie/reset-password",e)})}}("tv/",void 0);new class extends s.CenterApi{messageUnread(){return c(this,void 0,void 0,function*(){return yield this.get("tie/message-unread",{})})}messageRead(e){return c(this,void 0,void 0,function*(){return yield this.get("tie/message-read",{unit:e})})}typeMessageCount(){return c(this,void 0,void 0,function*(){return yield this.get("tie/message-type-count",{})})}readMessages(e){return c(this,void 0,void 0,function*(){0!==e.length&&(yield this.post("tie/read-messages",{ids:e.join(";")}))})}}("tv/",!1);const d={id:0,name:"\u540c\u82b1\u7cfb\u7edf",nick:void 0,discription:"\u540c\u82b1\u5e73\u53f0",icon:void 0,date:void 0};var h=function(e,t,i,n){var r,s=arguments.length,o=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,i,o):r(t,i))||o);return s>3&&o&&Object.defineProperty(t,i,o),o},p=function(e,t,i,n){return new(i||(i=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(t){s(t)}}function a(e){try{l(n.throw(e))}catch(t){s(t)}}function l(e){e.done?r(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class f{constructor(e){this.id=e}get isOwner(){return this._isOwner}set isOwner(e){null===e&&(e=0),this._isOwner=e}get isAdmin(){return this._isAdmin}set isAdmin(e){null===e&&(e=0),this._isAdmin=e}get isDev(){return 0!==(1&this.type)}get isHao(){return 0!==(2&this.type)}loadProps(){return p(this,void 0,void 0,function*(){let e=yield u.unitBase(this.id);if(void 0===e)return;let{name:t,discription:i,icon:n,nick:r,type:s,isOwner:o,isAdmin:a,owner:l,ownerName:c,ownerNick:d,ownerIcon:h}=e;this.name=t,this.discription=i,this.nick=r,this.icon=n,this.type=s,this.isOwner=o,this.isAdmin=a,this.owner=l,this.ownerName=c,this.ownerNick=d,this.ownerIcon=h})}loadApps(){return p(this,void 0,void 0,function*(){let e,t=yield u.apps(this.id);e=void 0===t?[]:t.apps,void 0===t?(t={},a.a.assign(t,d)):0===t.id&&a.a.assign(t,d),a.a.assign(this,t),this.apps=e})}loadMessages(){return p(this,void 0,void 0,function*(){})}messageReadClear(){return p(this,void 0,void 0,function*(){})}messageAct(e,t){return p(this,void 0,void 0,function*(){})}}h([l.l],f.prototype,"apps",void 0),h([l.l],f.prototype,"unread",void 0),h([l.l],f.prototype,"date",void 0);var m=i(5);const v="192.168.0.199";var g={serverUrl:v+":3000/",systemAdmin:{name:"\u540c\u82b1",role:"\u7cfb\u7edf\u603b\u7ba1",urlDebug:v+":3001"},phonePatter:"/^(0[0-9]{2,3}\\-)?([2-9]([0-9]|\\-){6,8})+(\\-[0-9]{1,4})?$|^(13[0-9]|15[0|3|6|7|8|9]|18[8|9])\\-*(\\d|\\-){8}$/",form:{label:{sm:3,md:2},input:{sm:9,md:9},submit:{xs:void 0,sm:{offset:3,size:3},md:{offset:2,size:3},lg:void 0}},appIcon:"http://101.200.46.56/imgs/Bear-icon.png",appItemIcon:"http://101.200.46.56/imgs/Bear-icon.png"},y=i(9),b=function(e,t,i,n){return new(i||(i=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(t){s(t)}}function a(e){try{l(n.throw(e))}catch(t){s(t)}}function l(e){e.done?r(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class w extends s.VPage{constructor(){super(...arguments),this.page=(()=>{let e=n.createElement("button",{className:"btn btn-success btn-sm",onClick:this.showLogs},"log");return n.createElement(s.Page,{header:"\u5173\u4e8e\u540c\u82b1",right:e},n.createElement("div",{className:"p-3 bg-white h-100"},n.createElement("p",null,n.createElement("b",null,n.createElement("span",{className:"text-primary"},"\u540c"),n.createElement("span",{className:"text-danger"},"\u82b1"),"\uff0c \u5c31\u8981",n.createElement("span",{className:"text-success"},"\u987a")," \uff01")),n.createElement("p",null,"\u6570\u636e\u5982\u82b1\uff0c\u8ba9\u534f\u4f5c\u66f4\u987a\u7545")))}),this.showLogs=(()=>{this.openPage(this.logs)}),this.logs=(()=>n.createElement(s.Page,{header:"Logs"},s.nav.logs.map((e,t)=>n.createElement("div",{key:t,className:"px-3 py-1"},e))))}open(){return b(this,void 0,void 0,function*(){this.openPage(this.page)})}}var E=function(e,t,i,n){return new(i||(i=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(t){s(t)}}function a(e){try{l(n.throw(e))}catch(t){s(t)}}function l(e){e.done?r(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};const x="\u521b\u5efa\u5c0f\u53f7",k="\u521b\u5efa\u5f00\u53d1\u53f7";class C extends s.VPage{constructor(){super(...arguments),this.exit=(()=>{this.openPage(this.confirmLogout)}),this.confirmLogout=(()=>n.createElement(s.Page,{header:"\u5b89\u5168\u9000\u51fa",back:"close"},n.createElement("div",{className:"m-5 border border-info bg-white rounded p-3 text-center"},n.createElement("div",null,"\u9000\u51fa\u5f53\u524d\u8d26\u53f7\u4e0d\u4f1a\u5220\u9664\u4efb\u4f55\u5386\u53f2\u6570\u636e\uff0c\u4e0b\u6b21\u767b\u5f55\u4f9d\u7136\u53ef\u4ee5\u4f7f\u7528\u672c\u8d26\u53f7"),n.createElement("div",{className:"mt-3"},n.createElement("button",{className:"btn btn-danger",onClick:()=>this.controller.logout()},"\u9000\u51fa"))))),this.about=(()=>{this.openVPage(w)}),this.apply=(()=>{let{allowDev:e,sumDev:t,allowUnit:i,sumUnit:r}=this.controller.grant,o=[];e>t&&o.push("",{type:"component",component:n.createElement(m.IconText,{iconClass:"text-info mr-2",icon:"laptop",text:x}),onClick:this.applyUnit}),i>r&&o.push("=",{type:"component",component:n.createElement(m.IconText,{iconClass:"text-info mr-2",icon:"desktop",text:k}),onClick:this.applyDev}),s.nav.push(n.createElement(s.Page,{header:"\u521b\u5efa"},n.createElement(m.PropGrid,{rows:o,values:{}})))}),this.applyUnit=(()=>{this.showApplyPage("unit")}),this.applyDev=(()=>{this.showApplyPage("dev")}),this.onApplySubmit=((e,t)=>E(this,void 0,void 0,function*(){yield y.a.saveMessage({toUser:-1,fromApp:0,type:"apply-"+e,content:t});s.nav.pop(2),s.nav.push(n.createElement(s.Page,{header:"\u5b8c\u6210",back:"close"},n.createElement("div",{className:"card"},n.createElement("div",{className:"card-body"},n.createElement("div",{className:"card-title"},"\u7533\u8bf7\u5df2\u53d1\u9001"),n.createElement("div",{className:"card-text"},"\u8bf7\u7a0d\u7b49\uff0c\u6211\u4eec\u4f1a\u5c3d\u5feb\u5904\u7406\u3002"),n.createElement("button",{className:"btn btn-primary",onClick:()=>s.nav.back()},"\u5b8c\u6210")))))})),this.changePassword=(()=>{s.nav.push(n.createElement(N,null))}),this.renderAdminUnit=((e,t)=>{let i,r,{name:s,icon:o,isAdmin:a,isOwner:l,isDev:c,isHao:u}=e,d=[];l&&d.push("\u6240\u6709\u8005"),a&&d.push("\u7ba1\u7406\u5458"),d.length>0&&(i=n.createElement("small",{className:"text-muted"},d.join(", ")));let h=[];return!0===u&&h.push("\u5c0f\u53f7"),!0===c&&h.push("\u5f00\u53d1\u53f7"),h.length>0&&(r=n.createElement(n.Fragment,null," \xa0 ",n.createElement("small",{className:"text-muted"},h.join(", ")))),n.createElement(m.LMR,{className:"py-2",right:i},n.createElement(m.Image,{className:"w-1-5c mr-2",src:o}),s,r)}),this.clickAdminUnit=(e=>{this.controller.navToAdmin(e)}),this.page=(()=>{const{user:e}=s.nav;let t=["",{type:"component",component:n.createElement(m.Media,{icon:g.appIcon,main:e.name,discription:String(e.id)})}];this.controller.adminUnits.length>0&&(t.push(""),t.push({type:"component",component:n.createElement(m.List,{className:"w-100",items:this.controller.adminUnits,item:{render:this.renderAdminUnit,onClick:this.clickAdminUnit}})}));let{allowDev:i,sumDev:r,allowUnit:o,sumUnit:a}=this.controller.grant;return(i>r||o>a)&&t.push("",{type:"component",component:n.createElement(m.IconText,{iconClass:"text-info mr-2",icon:"envelope-o",text:"\u521b\u5efa"}),onClick:this.apply}),t.push("",{type:"component",component:n.createElement(m.IconText,{iconClass:"text-info mr-2",icon:"key",text:"\u4fee\u6539\u5bc6\u7801"}),onClick:this.changePassword},{type:"component",component:n.createElement(m.IconText,{iconClass:"text-info mr-2",icon:"smile-o",text:"\u5173\u4e8e\u540c\u82b1"}),onClick:this.about},"","",{type:"component",bk:"",component:n.createElement("button",{className:"btn btn-danger w-100",onClick:this.exit},n.createElement(m.FA,{name:"sign-out",size:"lg"})," \u9000\u51fa\u767b\u5f55")}),n.createElement(s.Page,{header:"\u6211"},n.createElement(m.PropGrid,{rows:t,values:{}}))})}open(){return E(this,void 0,void 0,function*(){this.openPage(this.page)})}showApplyPage(e){let t={name:{name:"name",type:"string",maxLength:50,required:!0},phone:{name:"phone",type:"string",maxLength:20},owner:{name:"owner",type:"string",maxLength:100}},i=[{label:"\u7533\u8bf7\u4eba",field:t.name,face:{type:"string",placeholder:"\u771f\u5b9e\u59d3\u540d"}},{label:"\u7535\u8bdd",field:t.phone},{label:"\u5355\u4f4d",field:t.owner,face:{type:"textarea",placeholder:"\u7533\u8bf7\u5355\u4f4d"}}];s.nav.push(n.createElement(s.Page,{header:"unit"===e?x:k},n.createElement(m.TonvaForm,{className:"m-3",formRows:i,onSubmit:t=>this.onApplySubmit(e,t)})))}}class N extends n.Component{constructor(){super(...arguments),this.onSubmit=(e=>E(this,void 0,void 0,function*(){let{formView:t}=this.form,{orgPassword:i,newPassword:r,newPassword1:o}=e;r===o?!1!==(yield y.a.resetPassword({orgPassword:i,newPassword:r}))?s.nav.replace(n.createElement(s.Page,{header:"\u4fee\u6539\u5bc6\u7801",back:"close"},n.createElement("div",{className:"m-3  text-success"},"\u5bc6\u7801\u4fee\u6539\u6210\u529f\uff01"))):t.setError("orgPassword","\u539f\u5bc6\u7801\u9519\u8bef"):t.setError("newPassword1","\u65b0\u5bc6\u7801\u9519\u8bef\uff0c\u8bf7\u91cd\u65b0\u8f93\u5165")}))}render(){return n.createElement(s.Page,{header:"\u4fee\u6539\u5bc6\u7801"},n.createElement(m.TonvaForm,{ref:e=>this.form=e,className:"m-3",formRows:[{label:"\u539f\u5bc6\u7801",field:{name:"orgPassword",type:"string",maxLength:60,required:!0},face:{type:"password",placeholder:"\u8f93\u5165\u539f\u6765\u7684\u5bc6\u7801"}},{label:"\u65b0\u5bc6\u7801",field:{name:"newPassword",type:"string",maxLength:60,required:!0},face:{type:"password",placeholder:"\u8f93\u5165\u65b0\u8bbe\u7684\u5bc6\u7801"}},{label:"\u786e\u8ba4\u5bc6\u7801",field:{name:"newPassword1",type:"string",maxLength:60,required:!0},face:{type:"password",placeholder:"\u518d\u6b21\u8f93\u5165\u65b0\u8bbe\u5bc6\u7801"}}],onSubmit:this.onSubmit}))}}var P=i(2),O=i.n(P),S=i(6),R=(i(31),function(e,t,i,n){return new(i||(i=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(t){s(t)}}function a(e){try{l(n.throw(e))}catch(t){s(t)}}function l(e){e.done?r(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})});function I(e,t,i,n,r){return R(this,void 0,void 0,function*(){let{url:o,urlDebug:a}=e;if(!o)return void alert("APP: "+e.name+"\n"+e.discription+"\n\u5c1a\u672a\u7ed1\u5b9a\u670d\u52a1");let l=yield s.host.getUrlOrDebug(o,a);e.url=l,e.urlDebug=void 0,yield s.nav.navToApp(l,t,i,n,r)})}var j=function(e,t,i,n){return new(i||(i=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(t){s(t)}}function a(e){try{l(n.throw(e))}catch(t){s(t)}}function l(e){e.done?r(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class T extends s.View{constructor(){super(...arguments),this.appClick=(e=>j(this,void 0,void 0,function*(){let t=this.controller.unit.id;0===e.id||(yield I(e,t))})),this.renderRow=((e,t)=>{let{id:i,name:r,icon:s,discription:o}=e;return n.createElement(m.LMR,{className:"px-3 py-2",left:n.createElement(m.Badge,null,n.createElement(m.Image,{src:s}))},n.createElement("div",{className:"px-3"},n.createElement("div",null,n.createElement("b",null,r)),n.createElement("small",{className:"text-muted"},o)))}),this.clickToAdmin=(()=>j(this,void 0,void 0,function*(){let e=this.controller.unit.id;yield I(void 0,e)}))}render(){let{unit:e}=this.controller;if(!e)return null;let t,{apps:i}=e;return void 0!==i&&(t=n.createElement(m.List,{items:i,item:{render:this.renderRow,onClick:this.appClick}})),t}}var D=function(e,t,i,n){return new(i||(i=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(t){s(t)}}function a(e){try{l(n.throw(e))}catch(t){s(t)}}function l(e){e.done?r(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};const A={dev:"\u5f00\u53d1\u53f7",unit:"\u5c0f\u53f7"};class V extends s.VPage{constructor(){super(...arguments),this.page=(()=>{let{type:e,caption:t}=this.param,i=A[e],r=[{name:"name",type:"string",maxLength:50,required:!0}];"unit"===e&&r.push({name:"isPublic",type:"boolean"}),r.push({name:"submit",type:"button"});let o={items:{name:{widget:"text",label:i,placeholder:"\u533a\u522b\u4e8e\u5176\u5b83\u7684\u552f\u4e00\u540d\u79f0"},isPublic:{widget:"checkbox",label:"\u516c\u5f00"},submit:{widget:"button",label:"\u63d0\u4ea4",className:"btn btn-primary"}}};return n.createElement(s.Page,{header:t,back:"close"},n.createElement(s.Form,{onButtonClick:this.onSubmit,className:"m-3",schema:r,uiSchema:o,formData:{isPublic:!0},fieldLabelSize:2}))}),this.onSubmit=((e,t)=>D(this,void 0,void 0,function*(){let e=a.a.clone(t.data),i=e.isPublic;void 0!==i&&(e.isPulic=!0===i?1:0),e.type=this.param.type;let r,o=(yield this.controller.unitCreate(e)).unit;switch(o){default:return this.controller.reloadStickies(),this.closePage(),void this.openPageElement(n.createElement(s.Page,null,n.createElement("div",{className:"p-3 text-success"},n.createElement(m.FA,{name:"check"})," \u521b\u5efa\u5b8c\u6210",n.createElement("br",null),n.createElement("br",null),"\u968f\u540e\u53ef\u4ee5\u8fdb\u5165\u7ba1\u7406\uff0c\u5f00\u542f\u5e94\u7528\uff0c\u7ba1\u7406\u7528\u6237\u3002")));case 0:r="\u540d\u5b57\u5df2\u7ecf\u88ab\u4f7f\u7528\u4e86";break;case-1:this.closePage(),this.openPageElement(n.createElement(s.Page,null,n.createElement("div",{className:"p-3 text-success"},n.createElement(m.FA,{name:"check"})," \u65e0\u6cd5\u521b\u5efa",n.createElement("br",null),n.createElement("br",null),"\u5df2\u5230\u521b\u5efa\u4e0a\u9650")));break;case-2:r="\u9519\u8bef\u7f16\u53f7: "+o}t.setError("name",r)}))}open(e){return D(this,void 0,void 0,function*(){this.param=e,this.openPage(this.page)})}}var F=function(e,t,i,n){return new(i||(i=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(t){s(t)}}function a(e){try{l(n.throw(e))}catch(t){s(t)}}function l(e){e.done?r(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class M extends s.VPage{constructor(){super(...arguments),this.sideBarOpened=!1,this.confirmClose=(()=>F(this,void 0,void 0,function*(){return document.removeEventListener("click",this.handleDocumentClick),document.removeEventListener("touchstart",this.handleDocumentClick),!0})),this.handleDocumentClick=(e=>F(this,void 0,void 0,function*(){if(this.elToggleButton&&this.elToggleButton.contains(e.target))return!1===this.sideBarOpened&&(yield Promise.all([this.controller.loadStickies(),this.controller.loadAdminUnits()])),void this.toggleOpen();this.elSideBar&&(this.elSideBar.contains(e.target)||this.closeSideBar())})),this.page=Object(S.a)(()=>{let{unit:e}=this.controller,t=n.createElement("div",{ref:e=>this.elToggleButton=e,className:"p-2 cursor-pointer"},n.createElement(m.FA,{name:"navicon",size:"lg"})),i=e?e.name:"\u540c\u82b1",r=this.sideBar();return n.createElement(s.Page,{header:i,right:t,sideBar:r},n.createElement("div",{className:"d-flex h-100"},n.createElement("div",{className:"flex-fill"},this.renderVm(T))))}),this.toggleOpen=(()=>{this.sideBarOpened=!this.sideBarOpened}),this.onMeClick=(()=>F(this,void 0,void 0,function*(){this.closeSideBar(),yield this.controller.showMe()})),this.onAboutUnit=(()=>F(this,void 0,void 0,function*(){this.closeSideBar(),yield this.controller.showUnitAbout()})),this.cnItems="py-2 cursor-pointer border-bottom border-info align-items-center",this.stickyClick=(e=>F(this,void 0,void 0,function*(){this.closeSideBar(),yield this.controller.showUnit(e.objId)})),this.stickyRender=((e,t)=>{let i,{type:n,date:r,objId:s,obj:o}=e,a=this.controller.units.get(s);void 0!==a&&(i=a.unread,r=a.date);let{unit:l}=this.controller,c=l&&l.id;switch(n){case 3:return void 0===o?null:o.id===c?null:this.stickyUnit(r,o,i);case 0:if(void 0===o)return;return this.stickyUnit(r,o,i)}})}open(){return F(this,void 0,void 0,function*(){document.addEventListener("click",this.handleDocumentClick),document.addEventListener("touchstart",this.handleDocumentClick),this.regConfirmClose(this.confirmClose),this.openPage(this.page)})}closeSideBar(){this.sideBarOpened=!1}aboutUnit(){let{unit:e}=this.controller;if(void 0===e)return null;let{icon:t,name:i}=e,r=n.createElement(m.Image,{className:"w-2c mr-3",src:t}),s=n.createElement(m.FA,{name:"ellipsis-h"});return n.createElement(m.LMR,{className:O()("px-2",this.cnItems),left:r,right:s,onClick:this.onAboutUnit},n.createElement("span",null,i))}itemCreate(){let{allowDev:e,sumDev:t,allowUnit:i,sumUnit:r}=this.controller.grant,s=[];if(e>t&&s.push({icon:"laptop",type:"dev",caption:"\u521b\u5efa\u5f00\u53d1\u53f7"}),i>r&&s.push({icon:"desktop",type:"unit",caption:"\u521b\u5efa\u5c0f\u53f7"}),0===s.length)return;let o=!0;return n.createElement(n.Fragment,null,s.map((e,t)=>{let i=["px-3",this.cnItems];!0===o&&(i.push("border-top"),o=!1);let{icon:r,type:s,caption:a}=e,l=n.createElement(m.FA,{name:r,size:"lg",className:"text-info mr-3"});return n.createElement(m.LMR,{key:t,className:O()(i),left:l,onClick:()=>this.openVPage(V,e)},a)}))}meItem(){let{user:e}=s.nav,{nick:t,icon:i,name:r}=e,o=t?n.createElement("span",null,t," ",r):n.createElement("span",null,r),a=n.createElement(m.Image,{className:"w-2c mr-3",src:i});return n.createElement(m.LMR,{className:O()("px-2",this.cnItems),left:a,onClick:this.onMeClick},n.createElement("div",{className:"my-3"},o))}sideBar(){if(!1===this.sideBarOpened)return null;let{stickies:e}=this.controller;return n.createElement("div",{className:"w-30c position-absolute bg-white h-100 shadow-lg border-right border-light",style:{zIndex:1001,right:0,overflowX:"hidden",overflowY:"auto"},ref:e=>this.elSideBar=e},this.meItem(),this.aboutUnit(),n.createElement(m.List,{items:e,item:{render:this.stickyRender,onClick:this.stickyClick,key:e=>String(e.objId)}}),this.itemCreate())}stickyUnit(e,t,i){let r,{name:s,nick:o,discription:a,icon:l,date:c,subject:u}=t;return r=void 0!==u?n.createElement("div",{className:"small text-success"},u):n.createElement("div",{className:"small text-muted"},a),n.createElement(m.LMR,{className:"px-2 py-2",left:n.createElement(m.Badge,{size:"xs",badge:i||t.unread},n.createElement(m.Image,{src:l})),right:n.createElement("small",{className:"text-muted"},n.createElement(m.EasyDate,{date:e}))},n.createElement("div",{className:"px-3"},n.createElement("div",null,o||s),r))}}(function(e,t,i,n){var r,s=arguments.length,o=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,i,o):r(t,i))||o);s>3&&o&&Object.defineProperty(t,i,o)})([l.l],M.prototype,"sideBarOpened",void 0);var B=function(e,t,i,n){return new(i||(i=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(t){s(t)}}function a(e){try{l(n.throw(e))}catch(t){s(t)}}function l(e){e.done?r(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class L extends s.VPage{constructor(){super(...arguments),this.clickToAdmin=(()=>B(this,void 0,void 0,function*(){yield this.controller.navToAdmin()})),this.page=(()=>{let e,{unit:t}=this.controller,{id:i,name:r,discription:o,apps:a,icon:l,ownerName:c,ownerNick:u,isOwner:d,isAdmin:h}=t;u&&(u="- "+u),1!==d&&1!==h||(e=n.createElement("button",{className:"btn btn-success btn-sm align-self-start",onClick:()=>this.clickToAdmin()},"\u8fdb\u5165\u7ba1\u7406"));let p=n.createElement("div",{className:"mr-3"},n.createElement(m.Image,{src:l}));return n.createElement(s.Page,{header:"\u5173\u4e8e "+r},n.createElement(m.LMR,{className:"my-3 container-fluid",left:p,right:e},n.createElement("div",{className:"row"},n.createElement("h6",{className:"col-12"},r)),n.createElement("div",{className:"row"},n.createElement("label",{className:"small text-dark col-3"},"\u7b80\u4ecb\uff1a"),n.createElement("div",{className:"col-9"},o||n.createElement(m.Muted,null,"\u65e0"))),n.createElement("div",{className:"row"},n.createElement("label",{className:"small text-dark col-3"},"\u53d1\u5e03\u8005\uff1a"),n.createElement("div",{className:"col-9"},c," ",u))))})}open(){return B(this,void 0,void 0,function*(){this.openPage(this.page)})}}var U=function(e,t,i,n){var r,s=arguments.length,o=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,i,o):r(t,i))||o);return s>3&&o&&Object.defineProperty(t,i,o),o},_=function(e,t,i,n){return new(i||(i=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(t){s(t)}}function a(e){try{l(n.throw(e))}catch(t){s(t)}}function l(e){e.done?r(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class W extends s.Controller{constructor(){super(...arguments),this.units=new Map,this.unit=void 0}internalStart(){return _(this,void 0,void 0,function*(){yield this.showUnit(void 0),this.openVPage(M)})}showUnit(e){return _(this,void 0,void 0,function*(){if(void 0===this.unit)return this.unit=new f(void 0),yield this.unit.loadApps(),void(this.units[this.unit.id]=this.unit);this.unit.id!==e&&(this.unit=this.units.get(e),this.unit?yield this.unit.loadApps():alert(e+"not exists"))})}showUnitAbout(){return _(this,void 0,void 0,function*(){this.openVPage(L)})}reloadStickies(){this.stickies=void 0}loadStickies(){return _(this,void 0,void 0,function*(){if(void 0!==this.stickies)return;let e=[],t=yield u.stickies(),i=t[0],n=t[4];for(let s of i)switch(s.type){case 3:let e=s.obj=n.find(e=>e.id===s.objId),{id:t,type:i,name:r,discription:o,icon:a,unread:l,date:c,owner:u}=e,d=new f(t);d.type=i,d.name=r,d.discription=o,d.icon=a,d.owner=u,this.units.set(t,d)}e.push(...i);let r=t[5][0];if(void 0!==r){let{unread:t,date:i}=r;this.addSysUnitStick(e,t,i)}this.stickies=e})}addSysUnitStick(e,t,i){if(void 0===t||t<=0)return;let n=a.a.clone(d);n.unread=t,e.unshift({id:0,date:new Date,type:0,objId:0,obj:n})}loadAdminUnits(){return _(this,void 0,void 0,function*(){if(void 0!==this.adminUnits)return;let e=yield u.adminUnits();this.adminUnits=[];for(let i of e[0]){let{id:e,name:t,nick:n,discription:r,icon:s,type:o,isAdmin:a,isOwner:l}=i,c=new f(e);c.name=t,c.nick=n,c.discription=r,c.icon=s,c.type=o,c.isAdmin=a,c.isOwner=l,this.adminUnits.push(c)}let t=e[1];0===t.length?this.grant={allowDev:0,sumDev:0,allowUnit:0,sumUnit:0}:this.grant=t[0]})}showMe(){return _(this,void 0,void 0,function*(){this.openVPage(C)})}navToAdmin(e){return _(this,void 0,void 0,function*(){void 0===this.adminApp&&(this.adminApp=yield u.adminUrl()),e||(e=this.unit),e&&(yield I(this.adminApp,e.id),yield this.unit.loadApps())})}logout(){return _(this,void 0,void 0,function*(){this.stickies.splice(0,this.stickies.length),this.units.clear(),this.unit=void 0,s.nav.logout()})}unitCreate(e){return _(this,void 0,void 0,function*(){return yield u.unitCreateDirect(e)})}}U([l.l],W.prototype,"stickies",void 0),U([l.l],W.prototype,"units",void 0),U([l.l],W.prototype,"unit",void 0);var H=function(e,t,i,n){return new(i||(i=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(t){s(t)}}function a(e){try{l(n.throw(e))}catch(t){s(t)}}function l(e){e.done?r(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};var q=class extends n.Component{onLogined(){return H(this,void 0,void 0,function*(){s.nav.clear();let e=new W(void 0);yield e.start()})}render(){return n.createElement(s.NavView,{onLogined:this.onLogined})}};const $=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function z(e){navigator.serviceWorker.register(e).then(e=>{e.onupdatefound=(()=>{const t=e.installing;t&&(t.onstatechange=(()=>{"installed"===t.state&&(navigator.serviceWorker.controller?console.log("New content is available; please refresh."):console.log("Content is cached for offline use."))}))})}).catch(e=>{console.error("Error during service worker registration:",e)})}i(97);r.render(n.createElement(q,null),document.getElementById("root")),function(){if("serviceWorker"in navigator){if(new URL("/app",window.location.toString()).origin!==window.location.origin)return;window.addEventListener("load",()=>{const e="/app/service-worker.js";$?function(e){fetch(e).then(t=>{404===t.status||-1===t.headers.get("content-type").indexOf("javascript")?navigator.serviceWorker.ready.then(e=>{e.unregister().then(()=>{window.location.reload()})}):z(e)}).catch(()=>{console.log("No internet connection found. App is running in offline mode.")})}(e):z(e)})}}()}],[[70,3,2]]]);
//# sourceMappingURL=main.ff6a723e.chunk.js.map