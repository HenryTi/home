(window.webpackJsonp=window.webpackJsonp||[]).push([[0],[,function(e,t,i){"use strict";var n=i(9);i.d(t,"NavView",function(){return n.a}),i.d(t,"nav",function(){return n.b});i(41);var s=i(14);i.d(t,"Page",function(){return s.a});var r=i(80);i.d(t,"Controller",function(){return r.a}),i.d(t,"VPage",function(){return r.b}),i.d(t,"View",function(){return r.c});var o=i(81);i.o(o,"Badge")&&i.d(t,"Badge",function(){return o.Badge}),i.o(o,"EasyDate")&&i.d(t,"EasyDate",function(){return o.EasyDate}),i.o(o,"Edit")&&i.d(t,"Edit",function(){return o.Edit}),i.o(o,"EditMeInfo")&&i.d(t,"EditMeInfo",function(){return o.EditMeInfo}),i.o(o,"FA")&&i.d(t,"FA",function(){return o.FA}),i.o(o,"Form")&&i.d(t,"Form",function(){return o.Form}),i.o(o,"IconText")&&i.d(t,"IconText",function(){return o.IconText}),i.o(o,"Image")&&i.d(t,"Image",function(){return o.Image}),i.o(o,"LMR")&&i.d(t,"LMR",function(){return o.LMR}),i.o(o,"List")&&i.d(t,"List",function(){return o.List}),i.o(o,"Muted")&&i.d(t,"Muted",function(){return o.Muted}),i.o(o,"PropGrid")&&i.d(t,"PropGrid",function(){return o.PropGrid}),i.o(o,"SearchBox")&&i.d(t,"SearchBox",function(){return o.SearchBox}),i.o(o,"emailRegex")&&i.d(t,"emailRegex",function(){return o.emailRegex}),i.o(o,"mobileRegex")&&i.d(t,"mobileRegex",function(){return o.mobileRegex}),i.o(o,"resLang")&&i.d(t,"resLang",function(){return o.resLang});var a=i(106);i.d(t,"Form",function(){return a.a});var l=i(108);i.d(t,"Edit",function(){return l.a});var c=i(37);i.d(t,"resLang",function(){return c.a});i(111),i(49);var u=i(27);i.d(t,"Image",function(){return u.a});i(50);var d=i(85);i.d(t,"emailRegex",function(){return d.a}),i.d(t,"mobileRegex",function(){return d.b});var h=i(109);i.d(t,"List",function(){return h.a});i(86);var m=i(87);i.d(t,"EasyDate",function(){return m.a});var f=i(110);i.d(t,"PropGrid",function(){return f.a});var v=i(60);i.d(t,"Badge",function(){return v.a}),i.d(t,"FA",function(){return v.b}),i.d(t,"IconText",function(){return v.c}),i.d(t,"LMR",function(){return v.d}),i.d(t,"Muted",function(){return v.e});i(88);var p=i(89);i.d(t,"SearchBox",function(){return p.a})},,function(e,t,i){"use strict";var n=i(10);i.d(t,"CacheIds",function(){return n.a}),i.d(t,"PageItems",function(){return n.c});var s=i(7);i.d(t,"CenterApiBase",function(){return s.b}),i.d(t,"appInFrame",function(){return s.g}),i.d(t,"host",function(){return s.j});var r=i(1);i.o(r,"Badge")&&i.d(t,"Badge",function(){return r.Badge}),i.o(r,"Controller")&&i.d(t,"Controller",function(){return r.Controller}),i.o(r,"EasyDate")&&i.d(t,"EasyDate",function(){return r.EasyDate}),i.o(r,"EditMeInfo")&&i.d(t,"EditMeInfo",function(){return r.EditMeInfo}),i.o(r,"FA")&&i.d(t,"FA",function(){return r.FA}),i.o(r,"Form")&&i.d(t,"Form",function(){return r.Form}),i.o(r,"IconText")&&i.d(t,"IconText",function(){return r.IconText}),i.o(r,"Image")&&i.d(t,"Image",function(){return r.Image}),i.o(r,"LMR")&&i.d(t,"LMR",function(){return r.LMR}),i.o(r,"List")&&i.d(t,"List",function(){return r.List}),i.o(r,"NavView")&&i.d(t,"NavView",function(){return r.NavView}),i.o(r,"Page")&&i.d(t,"Page",function(){return r.Page}),i.o(r,"PropGrid")&&i.d(t,"PropGrid",function(){return r.PropGrid}),i.o(r,"VPage")&&i.d(t,"VPage",function(){return r.VPage}),i.o(r,"View")&&i.d(t,"View",function(){return r.View}),i.o(r,"nav")&&i.d(t,"nav",function(){return r.nav});var o=i(112);i.d(t,"EditMeInfo",function(){return o.a});var a=i(23);i.o(a,"Badge")&&i.d(t,"Badge",function(){return a.Badge}),i.o(a,"Controller")&&i.d(t,"Controller",function(){return a.Controller}),i.o(a,"EasyDate")&&i.d(t,"EasyDate",function(){return a.EasyDate}),i.o(a,"FA")&&i.d(t,"FA",function(){return a.FA}),i.o(a,"Form")&&i.d(t,"Form",function(){return a.Form}),i.o(a,"IconText")&&i.d(t,"IconText",function(){return a.IconText}),i.o(a,"Image")&&i.d(t,"Image",function(){return a.Image}),i.o(a,"LMR")&&i.d(t,"LMR",function(){return a.LMR}),i.o(a,"List")&&i.d(t,"List",function(){return a.List}),i.o(a,"NavView")&&i.d(t,"NavView",function(){return a.NavView}),i.o(a,"Page")&&i.d(t,"Page",function(){return a.Page}),i.o(a,"PropGrid")&&i.d(t,"PropGrid",function(){return a.PropGrid}),i.o(a,"VPage")&&i.d(t,"VPage",function(){return a.VPage}),i.o(a,"View")&&i.d(t,"View",function(){return a.View}),i.o(a,"nav")&&i.d(t,"nav",function(){return a.nav});var l=i(94);i.o(l,"Badge")&&i.d(t,"Badge",function(){return l.Badge}),i.o(l,"Controller")&&i.d(t,"Controller",function(){return l.Controller}),i.o(l,"EasyDate")&&i.d(t,"EasyDate",function(){return l.EasyDate}),i.o(l,"FA")&&i.d(t,"FA",function(){return l.FA}),i.o(l,"Form")&&i.d(t,"Form",function(){return l.Form}),i.o(l,"IconText")&&i.d(t,"IconText",function(){return l.IconText}),i.o(l,"Image")&&i.d(t,"Image",function(){return l.Image}),i.o(l,"LMR")&&i.d(t,"LMR",function(){return l.LMR}),i.o(l,"List")&&i.d(t,"List",function(){return l.List}),i.o(l,"NavView")&&i.d(t,"NavView",function(){return l.NavView}),i.o(l,"Page")&&i.d(t,"Page",function(){return l.Page}),i.o(l,"PropGrid")&&i.d(t,"PropGrid",function(){return l.PropGrid}),i.o(l,"VPage")&&i.d(t,"VPage",function(){return l.VPage}),i.o(l,"View")&&i.d(t,"View",function(){return l.View}),i.o(l,"nav")&&i.d(t,"nav",function(){return l.nav});i(107)},,,function(e,t,i){"use strict";i.d(t,"a",function(){return l}),i.d(t,"b",function(){return c});var n=i(1),s=i(33),r=i(57),o=i(58),a=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class l extends o.a{constructor(e,t,i,n){super(e,n),Object.setPrototypeOf(this.x,e.x);let{name:s,typeName:o}=t;this.entity=t,this.ui=i,this.label=this.res.label||s,this.icon=r.a[o]}beforeStart(){return a(this,void 0,void 0,function*(){return yield this.entity.loadSchema(),!0})}createForm(e,t,i){let n=this.buildFormOptions(i),r=new s.b(n,e);return r.setValues(t),r}buildFormOptions(e){let t,i,n,r,o,{fields:a,arrFields:l}=this.entity;void 0!==this.res&&(t=this.res.none,i=this.res.submit,n=this.res.arrNew,r=this.res.arrEdit,o=this.res.arrTitleNewButton),void 0===t&&(t=this.cUq.res.none||"none"),void 0===i&&(i=this.cUq.res.submit||"Submit"),void 0===n&&(n=this.cUq.res.arrNew||"New"),void 0===r&&(r=this.cUq.res.arrEdit||"Edit"),void 0===o&&(o=this.cUq.res.arrTitleNewButton),void 0===e&&(e=s.a.new);let c=this.ui.form;return{fields:a,arrs:l,ui:c,res:this.res||{},inputs:this.buildInputs(c),none:t,submitCaption:i,arrNewCaption:n,arrEditCaption:r,arrTitleNewButton:o,mode:e}}buildInputs(e){let{fields:t,arrFields:i}=this.entity,n={};if(this.buildFieldsInputs(n,t,void 0,e),void 0!==i)for(let s of i){let{name:t,fields:i}=s,r=e&&e.items;this.buildFieldsInputs(n,i,t,r&&r[t])}return n}buildFieldsInputs(e,t,i,n){if(void 0!==i){let t=e[i];void 0===t&&(e[i]=t={},e=t)}for(let s of t){let{name:t,_tuid:r}=s;if(void 0===r)continue;let{tuid:o}=r,a=n&&n.items&&n.items[t];e[t]={select:this.buildSelect(s,i,a),content:this.buildContent(s,i),placeHolder:this.cUq.getTuidPlaceHolder(o)}}}buildSelect(e,t,i){return(e,t,n)=>a(this,void 0,void 0,function*(){let{_tuid:n}=t,{ownerField:s}=n,r=void 0,o=void 0;void 0!==s&&(o=e.getValue(s.name)),i&&!0===i.autoList&&(console.log("select search set param=empty string"),o="");let a=yield r.call(o);if(r.removeCeased(),void 0===a)return;let l=r.idFromItem(a);return n.useId(l),l})}buildContent(e,t){}cQuerySelect(e){return this.cUq.cQuerySelect(e)}}class c extends n.VPage{constructor(e){super(e),this.entity=e.entity,this.ui=e.ui}get label(){return this.controller.label}createForm(e,t,i){return this.controller.createForm(e,t,i)}}},function(e,t,i){"use strict";var n=i(22),s=i(40),r=i(28),o=i(17),a=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};const l=new class extends o.a{guest(){return a(this,void 0,void 0,function*(){let e=yield this.get("",{});switch(typeof e){default:return;case"string":return Object(r.a)(e);case"object":return Object(r.a)(e.token)}})}unitFromName(e){return a(this,void 0,void 0,function*(){let t=yield this.get(e);return t&&t.unit})}}("tv/guest/",void 0);class c{constructor(e){this.method="POST",this.params=e}buildParams(){return this.params}get headers(){}}var u=i(13),d=i(29);i.d(t,"f",function(){return n.a}),i.d(t,"m",function(){return n.b}),i.d(t,"n",function(){return s.b}),i.d(t,"i",function(){return l}),i.d(t,"a",function(){return c}),i.d(t,"l",function(){return o.h}),i.d(t,"e",function(){return o.d}),i.d(t,"d",function(){return o.c}),i.d(t,"q",function(){return o.j}),i.d(t,"p",function(){return o.i}),i.d(t,"b",function(){return o.a}),i.d(t,"c",function(){return o.b}),i.d(t,"k",function(){return o.g}),i.d(t,"g",function(){return u.a}),i.d(t,"h",function(){return u.f}),i.d(t,"o",function(){return d.b}),i.d(t,"j",function(){return d.a})},,function(e,t,i){"use strict";(function(e){i.d(t,"a",function(){return b}),i.d(t,"b",function(){return x});var n=i(0),s=i(2),r=i(14),o=i(76),a=i(113),l=i(13),c=i(10),u=i(7),d=i(22),h=i(37),m=i(49),f=(i(79),i(116),i(127),i(129),i(60)),v=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};let p;const g=[];let y=1;class b extends n.Component{constructor(e){super(e),this.waitCount=0,this.upgradeUq=(()=>{x.start()}),this.isHistoryBack=!1,this.clearError=(()=>{this.setState({fetchError:void 0})}),this.back=this.back.bind(this),this.navBack=this.navBack.bind(this),this.stack=[],this.state={stack:this.stack,wait:0,fetchError:void 0}}componentDidMount(){return v(this,void 0,void 0,function*(){window.addEventListener("popstate",this.navBack),x.set(this),yield x.start()})}get level(){return this.stack.length}startWait(){0===this.waitCount&&(this.setState({wait:1}),this.waitTimeHandler=e.setTimeout(()=>{this.waitTimeHandler=void 0,this.setState({wait:2})},1e3)),++this.waitCount,this.setState({fetchError:void 0})}endWait(){setTimeout(()=>{--this.waitCount,0===this.waitCount&&(void 0!==this.waitTimeHandler&&(clearTimeout(this.waitTimeHandler),this.waitTimeHandler=void 0),this.setState({wait:0}))},100)}onError(e){return v(this,void 0,void 0,function*(){let t=e.error;void 0===t||!0!==t.unauthorized?this.setState({fetchError:e}):yield x.showLogin(void 0)})}showUpgradeUq(e,t){return v(this,void 0,void 0,function*(){this.show(n.createElement(r.a,{header:!1},n.createElement("div",null,"UQ\u5347\u7ea7\u4e86\uff0c\u8bf7\u70b9\u51fb\u6309\u94ae\u5347\u7ea7 ",n.createElement("br",null),n.createElement("small",{className:"text-muted"},e," ver-",t),n.createElement("button",{className:"btn btn-primary",onClick:this.upgradeUq},"\u5347\u7ea7"))))})}show(e,t){return this.clear(),this.push(e,t)}push(e,t){this.removeCeased(),this.stack.length>0&&window.history.pushState("forward",null,null);let i=y++;return this.stack.push({key:i,view:e,ceased:!1,disposer:t}),this.refresh(),i}replace(e,t){let i=void 0,n=this.stack;n.length>0&&(i=n.pop());let s=y++;return this.stack.push({key:s,view:e,ceased:!1,disposer:t}),void 0!==i&&this.dispose(i.disposer),this.refresh(),s}ceaseTop(e=1){let t=this.stack.length-1;for(let i=0;i<e&&!(t<0);i++,t--){this.stack[t].ceased=!0}}pop(e=1){let t=this.stack,i=t.length;if(e<=0||i<=1)return;i<e&&(e=i);let n=0;for(let s=0;s<e&&0!==t.length;s++)this.popAndDispose(),++n;n>=i&&n--,this.refresh(),this.isHistoryBack}popTo(e){if(void 0!==e&&void 0!==this.stack.find(t=>t.key===e))for(;this.stack.length>0;){let t=this.stack.length;if(this.stack[t-1].key===e)break;this.pop()}}topKey(){let e=this.stack.length;if(0!==e)return this.stack[e-1].key}removeCeased(){for(;;){let e=this.stack.length-1;if(e<0)break;if(!1===this.stack[e].ceased)break;let t=this.stack.pop(),{disposer:i}=t;this.dispose(i)}this.refresh()}popAndDispose(){this.removeCeased();let e=this.stack.pop();if(void 0===e)return;let{disposer:t}=e;return this.dispose(t),this.removeCeased(),e}dispose(e){if(void 0===e)return;void 0===this.stack.find(t=>t.disposer===e)&&e()}clear(){this.stack.length;for(;this.stack.length>0;)this.popAndDispose()}regConfirmClose(e){let t=this.stack,i=t.length;0!==i&&(t[i-1].confirmClose=e)}navBack(){x.log("backbutton pressed - nav level: "+this.stack.length),this.isHistoryBack=!0,this.back(!0),this.isHistoryBack=!1}back(e=!0){return v(this,void 0,void 0,function*(){let t=this.stack,i=t.length;if(0===i)return;if(1===i)return void(window.self!==window.top&&window.top.postMessage({type:"pop-app"},"*"));let n=t[i-1];!0===e&&n.confirmClose?!0===(yield n.confirmClose())&&this.pop():this.pop()})}confirmBox(e){return window.confirm(e)}render(){const{wait:e,fetchError:t}=this.state;let i=this.state.stack,s=i.length-1,r=null,o=null;switch(e){case 1:r=n.createElement("li",{className:"va-wait va-wait1"});break;case 2:r=n.createElement("li",{className:"va-wait va-wait2"},n.createElement(m.a,null))}t&&(o=n.createElement(a.a,Object.assign({clearError:this.clearError},t)));let l=!0===x.testing&&n.createElement("span",{className:"cursor-pointer position-absolute",style:{lineHeight:0}},n.createElement(f.b,{className:"text-warning",name:"info-circle"}));return n.createElement("ul",{className:"va"},i.map((e,t)=>{let{key:i,view:r}=e;return n.createElement("li",{key:i,style:t<s?{visibility:"hidden"}:void 0},r)}),r,o,l)}refresh(){this.setState({stack:this.stack})}}class w{constructor(){this.local=new c.b,this.user=void 0,this.arrs=["/test","/test/"];let{lang:e,district:t}=h.b;this.language=e,this.culture=t,this.testing=!1}get guest(){let e=this.local.guest;if(void 0===e)return 0;let t=e.get();return void 0===t?0:t.guest}set(e){this.nav=e}registerReceiveHandler(e){if(void 0!==this.ws)return this.ws.onWsReceiveAny(e)}unregisterReceiveHandler(e){void 0!==this.ws&&void 0!==e&&this.ws.endWsReceive(e)}onReceive(e){return v(this,void 0,void 0,function*(){void 0!==this.ws&&(yield this.ws.receive(e))})}getPredefinedUnitName(){return v(this,void 0,void 0,function*(){try{let t=this.unitJsonPath(),i=yield fetch(t,{});return(yield i.json()).unit}catch(e){return void this.local.unit.remove()}})}loadPredefinedUnit(){return v(this,void 0,void 0,function*(){return Number("0")})}setSettings(e){this.navSettings=e}unitJsonPath(){let{href:e}=document.location;e=e.toLowerCase();for(let t of this.arrs)if(!0===e.endsWith(t)){e=e.substr(0,e.length-t.length);break}return!0!==e.endsWith("/")&&!0!==e.endsWith("\\")||(e=e.substr(0,e.length-1)),e+"/unit.json"}start(){return v(this,void 0,void 0,function*(){try{this.testing=c.d.testing,yield u.j.start(this.testing);let t=document.location.hash;if(void 0!==t&&t.length>0){let e=Object(l.g)();e<0&&(e=void 0),this.hashParam=t.substring(1,e)}x.clear(),this.startWait();let{url:i,ws:n,resHost:s}=u.j;this.centerHost=i,this.resUrl=Object(u.o)(s),this.wsHost=n,Object(u.q)(i);let r=this.local.guest.get();void 0===r&&(r=yield u.i.guest()),x.setGuest(r);let o=Object(l.f)(),a=Object(l.j)(o);if(void 0!==o&&window!==window.parent&&void 0!==a)return this.ws=d.d,console.log("this.ws = wsBridge in sub frame"),void(window.self!==window.parent&&window.parent.postMessage({type:"sub-frame-started",hash:a.hash},"*"));let h=yield this.loadPredefinedUnit();a.predefinedUnit=h;let m=this.local.user.get();if(void 0===m){let{notLogined:e}=this.nav.props;return void(void 0!==e?yield e():yield x.showLogin(void 0))}yield x.logined(m)}catch(e){}finally{this.endWait()}})}showAppView(){return v(this,void 0,void 0,function*(){let{onLogined:e}=this.nav.props;void 0!==e?(x.clear(),yield e(),console.log("logined: AppView shown")):x.push(n.createElement("div",null,"NavView has no prop onLogined"))})}setGuest(e){this.local.guest.set(e),o.a.set(0,e.token)}saveLocalUser(){this.local.user.set(this.user)}logined(e,t){return v(this,void 0,void 0,function*(){Object(u.l)(),console.log("logined: %s",JSON.stringify(e)),this.user=e,this.saveLocalUser(),o.a.set(e.id,e.token),void 0!==t?t(e):yield this.showAppView()})}wsConnect(){(this.ws=new u.f(this.wsHost,this.user.token)).connect()}loginTop(e){return this.navSettings&&this.navSettings.loginTop||e}showLogin(e,t){return v(this,void 0,void 0,function*(){let s=yield i.e(1).then(i.bind(null,229)),r=n.createElement(s.default,{withBack:t,callback:e});!0!==t&&(this.nav.clear(),this.pop()),this.nav.push(r)})}showLogout(e){return v(this,void 0,void 0,function*(){x.push(n.createElement(r.a,{header:"\u5b89\u5168\u9000\u51fa",back:"close"},n.createElement("div",{className:"m-5 border border-info bg-white rounded p-3 text-center"},n.createElement("div",null,"\u9000\u51fa\u5f53\u524d\u8d26\u53f7\u4e0d\u4f1a\u5220\u9664\u4efb\u4f55\u5386\u53f2\u6570\u636e\uff0c\u4e0b\u6b21\u767b\u5f55\u4f9d\u7136\u53ef\u4ee5\u4f7f\u7528\u672c\u8d26\u53f7"),n.createElement("div",{className:"mt-3"},n.createElement("button",{className:"btn btn-danger",onClick:()=>this.logout(e)},"\u9000\u51fa")))))})}logout(e){return v(this,void 0,void 0,function*(){u.g.unit=void 0,this.local.logoutClear(),this.user=void 0,Object(u.l)();let t=this.local.guest.get();Object(u.p)(0,t&&t.token),this.ws=void 0,void 0===e?yield x.start():yield e()})}changePassword(){return v(this,void 0,void 0,function*(){let e=yield i.e(2).then(i.bind(null,228));x.push(n.createElement(e.ChangePasswordPage,null))})}get level(){return this.nav.level}startWait(){this.nav.startWait()}endWait(){this.nav.endWait()}onError(e){return v(this,void 0,void 0,function*(){yield this.nav.onError(e)})}showUpgradeUq(e,t){return v(this,void 0,void 0,function*(){yield this.nav.showUpgradeUq(e,t)})}show(e,t){this.nav.show(e,t)}push(e,t){this.nav.push(e,t)}replace(e,t){this.nav.replace(e,t)}pop(e=1){this.nav.pop(e)}topKey(){return this.nav.topKey()}popTo(e){this.nav.popTo(e)}clear(){this.nav.clear()}navBack(){this.nav.navBack()}ceaseTop(e){this.nav.ceaseTop(e)}removeCeased(){this.nav.removeCeased()}back(e=!0){return v(this,void 0,void 0,function*(){yield this.nav.back(e)})}regConfirmClose(e){this.nav.regConfirmClose(e)}confirmBox(e){return this.nav.confirmBox(e)}navToApp(e,t,i,s,r){return v(this,void 0,void 0,function*(){return new Promise((o,a)=>{let c=!0===this.centerHost.includes("http://localhost:")?"sheet_debug":"sheet",u=void 0===r?Object(l.c)(e,t):Object(l.c)(e,t,c,[i,s,r]);console.log("navToApp: %s",JSON.stringify(u)),x.push(n.createElement("article",{className:"app-container"},n.createElement("span",{id:u.hash,onClick:()=>this.back()},n.createElement("i",{className:"fa fa-arrow-left"})),n.createElement("iframe",{src:u.url,title:String(r)})),()=>{o()})})})}navToSite(e){window.open(e)}get logs(){return g}log(e){g.push(e)}logMark(){let e=new Date;p=e.getTime(),g.push("log-mark: "+e.toTimeString())}logStep(e){g.push(e+": "+((new Date).getTime()-p))}}(function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);r>3&&o&&Object.defineProperty(t,i,o)})([s.l],w.prototype,"user",void 0);const x=new w}).call(this,i(69))},function(e,t,i){"use strict";i(28),i(21);var n=i(48),s=i(2),r=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class o{constructor(e=100){this.arr=[],this.dict=new Map,this.maxCount=e}loadIds(e){let t=[];for(let i of e){if(null===i)continue;let e=this.dict.get(i);void 0===e&&(t.push(i),e={id:i},this.dict.set(i,e))}this.loadId(t)}get(e){if(void 0===e||null===e)return null;let t=this.dict.get(e);return void 0===t&&(this.dict.set(e,{id:e}),this.loadId([e]),t=this.dict.get(e)),t}setItem(e,t){void 0===t?(this.dict.set(e,null),this.arr.push({id:e})):(this.dict.set(e,t),this.arr.push(t)),this.arr.length>this.maxCount&&(t=this.arr.shift(),this.dict.delete(t.id))}loadId(e){return r(this,void 0,void 0,function*(){let t=yield this._loadIds(e);if(void 0===t)for(let i of e){if(null===i)continue;let e=yield this._loadId(i);this.setItem(i,e)}else for(let i of e){let e=t.find(e=>e.id===i);this.setItem(i,e)}})}}(function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);r>3&&o&&Object.defineProperty(t,i,o)})([s.l],o.prototype,"dict",void 0);var a=i(8),l=i.n(a);const c=new class{getItem(e){return localStorage.getItem(e)}setItem(e,t){localStorage.setItem(e,t)}removeItem(e){localStorage.removeItem(e)}};class u{constructor(e,t){this.local=e,this.key=t}get(){try{let t=this.local.getItem(this.key);if(null===t)return;if(void 0===t)return;return JSON.parse(t)}catch(e){return void this.local.removeItem(this.key)}}set(e){let t=JSON.stringify(e);this.local.setItem(this.key,t)}remove(e){void 0===e?this.local.removeItem(this.key):this.local.removeLocal(e)}child(e){return this.local.child(e)}arr(e){return this.local.arr(e)}map(e){return this.local.map(e)}}class d{constructor(e){this.name=e,this.caches={},this.locals={}}getItem(e){let t=this.keyForGet(e);if(void 0!==t)return c.getItem(t)}setItem(e,t){let i=this.keyForSet(e);c.setItem(i,t)}removeItem(e){let t=this.keyForSet(e);void 0!==t&&localStorage.removeItem(t)}arr(e){let t=String(e),i=this.locals[t];if(void 0===i){let n=this.keyForSet(e);this.locals[t]=i=new m(n)}return i}map(e){let t=String(e),i=this.locals[t];if(void 0===i){let n=this.keyForSet(e);this.locals[t]=i=new f(n)}return i}removeLocal(e){let t=e.name,i=this.keyForRemove(t);if(void 0===i)return;let n=this.locals[t];void 0===n?n=new m(i):this.locals[t]=void 0,n.removeAll()}child(e){let t=String(e),i=this.caches[t];return void 0!==i?i:this.caches[t]=new u(this,e)}}const h=500;class m extends d{constructor(e){super(e);let t=c.getItem(this.name);this.index=null===t?[]:t.split("\n").map(e=>Number(e))}saveIndex(){c.setItem(this.name,this.index.join("\n"))}keyForGet(e){if(!(l.a.indexOf(this.index,e)<0))return`${this.name}.${e}`}keyForSet(e){let t=l.a.indexOf(this.index,e);return t<0?(this.index.unshift(e),this.index.length>h&&this.index.pop()):(this.index.splice(t,1),this.index.unshift(e)),this.saveIndex(),`${this.name}.${e}`}keyForRemove(e){let t=l.a.indexOf(this.index,e);if(!(t<0))return this.index.splice(t,1),this.saveIndex(),`${this.name}.${e}`}removeAll(){for(let e of this.index)c.removeItem(`${this.name}.${e}`);c.removeItem(this.name),this.index.splice(0)}item(e){return this.child(e)}}class f extends d{constructor(e){super(e),this.max=0,this.index={};let t=c.getItem(this.name);if(null!==t){t.split("\n").forEach(e=>{let t=e.indexOf("\t");if(t<0)return;let i=e.substr(0,t),n=Number(e.substr(t+1));!0!==isNaN(n)&&(this.index[i]=n,n>this.max&&(this.max=n))})}}saveIndex(){let e=[];for(let t in this.index){let i=this.index[t];void 0!==i&&e.push(`${t}\t${i}`)}c.setItem(this.name,e.join("\n"))}keyForGet(e){let t=this.index[e];if(void 0!==t)return`${this.name}.${t}`}keyForSet(e){let t=this.index[e];return void 0===t&&(++this.max,t=this.max,this.index[e]=t,this.saveIndex()),`${this.name}.${t}`}keyForRemove(e){let t=this.index[e];if(void 0!==t)return this.index[e]=void 0,this.saveIndex(),`${this.name}.${t}`}removeAll(){for(let e in this.index)c.removeItem(`${this.name}.${this.index[e]}`),this.index[e]=void 0;c.removeItem(this.name),this.max=0}item(e){return this.child(e)}}const v=["/test","/test/","-test","-test/"];const p=function(){let e=function(){let{pathname:e}=document.location,t=e.toLowerCase();for(let i of v)if(!0===t.endsWith(i))return!0;return!1}();return{testing:e,isDevelopment:!1,localDb:new f(!0===e?"$$":"$")}}();class g{constructor(){this.user=p.localDb.child("user"),this.guest=p.localDb.child("guest"),this.unit=p.localDb.child("unit")}logoutClear(){[this.user,this.unit].forEach(e=>e.remove())}}i.d(t,"c",function(){return n.a}),i.d(t,"a",function(){return o}),i.d(t,"b",function(){return g}),i.d(t,"d",function(){return p})},function(e,t,i){"use strict";i.d(t,"b",function(){return o});var n=i(3),s=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};const r=new class extends n.CenterApiBase{stickies(){return s(this,void 0,void 0,function*(){return yield this.get("sticky/list",{start:0,pageSize:30})})}ties(){return s(this,void 0,void 0,function*(){return yield this.get("tie/list",{start:0,pageSize:30})})}searchUnits(e,t,i){return s(this,void 0,void 0,function*(){return yield this.get("tie/search-unit",{key:e,pageStart:t,pageSize:i})})}searchUnitsFollow(e){return s(this,void 0,void 0,function*(){return yield this.get("tie/search-unit-follow",{unit:e})})}unitNotFollow(e){return s(this,void 0,void 0,function*(){yield this.get("tie/unit-not-follow",{unit:e})})}apps(e){return s(this,void 0,void 0,function*(){return yield this.get("tie/apps",{unit:e})})}unitxApi(e){return s(this,void 0,void 0,function*(){return yield this.get("tie/apps",{unit:e})})}adminUrl(){return s(this,void 0,void 0,function*(){return yield this.get("tie/admin-url",{})})}adminUnits(){return s(this,void 0,void 0,function*(){return yield this.get("tie/user-admin-units")})}appFromId(e){return s(this,void 0,void 0,function*(){return yield this.get("tie/app-id",{appId:e})})}appApi(e,t,i){return s(this,void 0,void 0,function*(){return yield this.get("tie/app-api",{unit:e,app:t,apiName:i})})}unitMessages(e,t,i){return s(this,void 0,void 0,function*(){return yield this.get("tie/message-inbox",{unit:e,pageStart:t,pageSize:i})})}messagesRead(e){return s(this,void 0,void 0,function*(){return yield this.get("tie/message-read",{unit:e})})}unitAddFellow(e){return s(this,void 0,void 0,function*(){return yield this.get("unit/add-fellow",{invite:e})})}removeMessage(e){return s(this,void 0,void 0,function*(){yield this.get("tie/remove-message",{id:e})})}unitAdmins(e){return s(this,void 0,void 0,function*(){return yield this.get("unit/admins",{unit:e})})}unitCreate(e,t){return s(this,void 0,void 0,function*(){return yield this.post("unit/create",{name:e,message:t})})}unitCreateDirect(e){return s(this,void 0,void 0,function*(){return yield this.post("unit/create-direct",e)})}saveMessage(e){return s(this,void 0,void 0,function*(){return yield this.post("tie/message-save",e)})}actMessage(e){return s(this,void 0,void 0,function*(){yield this.post("tie/message-act",e)})}userBase(e){return s(this,void 0,void 0,function*(){return yield this.get("tie/user",{id:e})})}unitBase(e){return s(this,void 0,void 0,function*(){return yield this.get("tie/unit",{id:e})})}postMessage(e,t){return s(this,void 0,void 0,function*(){return yield this.post("test/post",{to:e,message:t})})}membersFromName(e){return s(this,void 0,void 0,function*(){return yield this.get("unit/members-from-name",e)})}changePassword(e){return s(this,void 0,void 0,function*(){return yield this.post("tie/change-password",e)})}userSetProp(e,t){return s(this,void 0,void 0,function*(){yield this.post("tie/user-set-prop",{prop:e,value:t})})}}("tv/",void 0);t.a=r;const o=new class extends n.CenterApiBase{messageUnread(){return s(this,void 0,void 0,function*(){return yield this.get("tie/message-unread",{})})}messageRead(e){return s(this,void 0,void 0,function*(){return yield this.get("tie/message-read",{unit:e})})}typeMessageCount(){return s(this,void 0,void 0,function*(){return yield this.get("tie/message-type-count",{})})}readMessages(e){return s(this,void 0,void 0,function*(){0!==e.length&&(yield this.post("tie/read-messages",{ids:e.join(";")}))})}}("tv/",!1)},function(e,t,i){"use strict";function n(e,t){switch(e.substr(0,1)){default:return t;case"$":case"_":return}}function s(e){return JSON.stringify(e,n," ")}var r=i(0);const o=(e,t)=>r.createElement(r.Fragment,null,"content: ",JSON.stringify(e));i.d(t,"b",function(){return s}),i.d(t,"a",function(){return o})},function(e,t,i){"use strict";i.d(t,"i",function(){return h}),i.d(t,"a",function(){return f}),i.d(t,"h",function(){return v}),i.d(t,"j",function(){return p}),i.d(t,"g",function(){return g}),i.d(t,"f",function(){return y}),i.d(t,"c",function(){return b}),i.d(t,"e",function(){return x}),i.d(t,"b",function(){return E}),i.d(t,"d",function(){return C});var n=i(8),s=i.n(n),r=i(1),o=i(21),a=i(17),l=i(22),c=i(29),u=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};const d={};function h(){for(let e in d)d[e]=void 0}const m={};let f=new class{get unit(){return this._unit}set unit(e){this._unit=e}};function v(){return window.self!==window.parent}function p(e){if(e){let t=e.split("-"),i=t.length;if(i>0){let e=1;f.hash=t[e++],i>0&&(f.unit=Number(t[e++])),i>1&&(f.page=t[e++]),i>2&&(f.param=t.slice(e++))}}return f}function g(){let e=document.location.hash;if(void 0!==e&&e.length>0){let t=e.lastIndexOf("#tv-");return t<0&&(t=e.lastIndexOf("#tvdebug-")),t}return-1}function y(){let e=g();if(!(e<0))return document.location.hash.substring(e)}function b(e,t,i,n){let s;for(;;){if(s=Object(o.a)(),void 0===m[s]){m[s]={hash:s,unit:t};break}}if(e+="#tv-"+s+"-"+t,void 0!==i&&(e+="-"+i,void 0!==n))for(let r=0;r<n.length;r++)e+="-"+n[r];return{url:e,hash:s}}window.addEventListener("message",function(e){return u(this,void 0,void 0,function*(){var t=e.data;switch(t.type){case"sub-frame-started":!function(e){var t=e.data;let i=e.source;Object(l.c)(i),function(e){let t=document.getElementById(e);void 0!==t&&(t.hidden=!0)}(t.hash);let n=s.a.clone(r.nav.user);n.type="init-sub-win",i.postMessage(n,"*")}(e);break;case"ws":yield r.nav.onReceive(t.msg);break;case"init-sub-win":yield function(e){return u(this,void 0,void 0,function*(){console.log("initSubWin: set nav.user",e);let t=r.nav.user=e;Object(a.i)(t.id,t.token),yield r.nav.showAppView()})}(t);break;case"pop-app":r.nav.navBack();break;case"center-api":yield function(e,t){return u(this,void 0,void 0,function*(){let{callId:i,url:n,method:s,body:r}=t,o=yield a.e.directCall(n,s,r);e.postMessage({type:"center-api-return",callId:i,result:o},"*")})}(e.source,t);break;case"center-api-return":!function(e){let{callId:t,result:i}=e,n=k[t];if(void 0===n)return;k[t]=void 0,n.resolve(i)}(t);break;case"app-api":let i=yield function(e,t){return u(this,void 0,void 0,function*(){let i=m[e];if(void 0===i)return{name:t,db:void 0,url:void 0,token:void 0};let{unit:n,predefinedUnit:s}=i;(n=n||s)||console.error("no unit defined in unit.json or not logined in",n);let r=t.split("/"),o={unit:n,uqOwner:r[0],uqName:r[1]};console.log("uqTokenApi.uq onReceiveAppApiMessage",o);let l=yield a.k.uq(o),{db:c,url:u,token:d}=l;return{name:t,db:c,url:u,token:d}})}(t.hash,t.apiName);e.source.postMessage({type:"app-api-return",apiName:t.apiName,db:i.db,url:i.url,token:i.token},"*");break;case"app-api-return":console.log("app-api-return: %s",JSON.stringify(t)),console.log("await onAppApiReturn(message);"),yield function(e){return u(this,void 0,void 0,function*(){let{apiName:t,db:i,url:n,urlTest:s,token:r}=e,o=w[t];if(void 0===o)throw new Error("error app api return");let a=c.a.getUrlOrTest(i,n,s);console.log("onAppApiReturn(message:any): url="+n+", real="+a),o.resolve({name:t,db:i,url:a,token:r})})}(t);break;default:this.console.log("message: %s",JSON.stringify(t))}})});const w={};function x(e,t,i){return u(this,void 0,void 0,function*(){if(!v()){let n=function(){let{unit:e,predefinedUnit:t}=f,i=e||t;if(void 0===i)throw new Error("no unit defined in unit.json or not logined in");return i}(),s=yield a.k.uq({unit:n,uqOwner:t,uqName:i});void 0===s.token&&(s.token=a.f);let{db:r,url:o,urlTest:l}=s,u=c.a.getUrlOrTest(r,o,l);return console.log("realUrl: %s",u),s.url=u,d[e]=s,s}if(console.log("**** before buildAppUq ****",f),void 0===w[e])return new Promise((t,i)=>{w[e]={resolve:i=>u(this,void 0,void 0,function*(){let{db:n,url:s,token:r}=yield i;d[e]={name:e,db:n,url:s,token:r},w[e]=void 0,console.log("**** after buildAppUq ****",f),t()}),reject:i},(window.opener||window.parent).postMessage({type:"app-api",apiName:e,hash:f.hash},"*")})})}function E(e){return d[e]}const k={};function C(e,t,i){return u(this,void 0,void 0,function*(){return console.log("bridgeCenterApi: url=%s, method=%s",e,t),yield new Promise((n,s)=>u(this,void 0,void 0,function*(){let r;for(;;){if(r=Object(o.a)(),void 0===k[r]){k[r]={id:r,resolve:n,reject:s};break}}(window.opener||window.parent).postMessage({type:"center-api",callId:r,url:e,method:t,body:i},"*")}))})}},function(e,t,i){"use strict";i.d(t,"a",function(){return m});var n=i(0),s=i(5),r=i(4),o=i.n(r),a=i(8),l=i.n(a),c=i(41),u=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};const d=100;class h extends n.Component{constructor(){super(...arguments),this.bottomTime=0,this.topTime=0,this.onScroll=(e=>u(this,void 0,void 0,function*(){let{onScroll:t,onScrollTop:i,onScrollBottom:n}=this.props;t&&this.props.onScroll(e);let s=e.target;if(s.scrollTop<30&&void 0!==i){let e=(new Date).getTime();e-this.topTime>d&&(this.topTime=e,i())}if(s.scrollTop+s.offsetHeight>s.scrollHeight-30&&void 0!==n){let e=(new Date).getTime();e-this.bottomTime>d&&(this.bottomTime=e,n())}}))}eachChild(e,t){let{props:i}=e;if(void 0===i)return;let{children:s}=i;void 0!==s&&n.Children.forEach(s,(e,i)=>{let{_$scroll:n}=e;n&&n(t),console.log(e.toString()),this.eachChild(e,t)})}render(){return n.createElement("main",{className:this.props.className,onScroll:this.onScroll},this.props.children)}}let m=class extends n.Component{constructor(e){super(e);let t,{tabs:i}=e;if(void 0===i||0===i.length)return;this.tabs=i;let n=[];for(let s of i){let e=l.a.clone(s);void 0===t&&!0===e.isSelected?t=e:e.isSelected=!1,e.isMounted=!1,n.push(e)}this.state={cur:t,tabs:n}}componentDidMount(){return u(this,void 0,void 0,function*(){if(void 0===this.tabs)return;let e=this.state.tabs.find(e=>!0===e.isSelected);void 0===e&&void 0===(e=this.state.tabs[0])||(yield e.load)&&(yield e.load())})}onTabClick(e){return u(this,void 0,void 0,function*(){if(!0===e.isSelected)return;let t,i=this.state.tabs;for(let n of i)n===e?(n.isSelected=!0,t=n):n.isSelected=!1;if(!0!==t.isMounted){let{load:e}=t;void 0!==e&&(yield e())}this.setState({cur:t,tabs:i})})}onTouchStart(e){}renderTabs(e){const{header:t,back:i,right:s,keepHeader:r,headerClassName:a,tabPosition:l}=this.props;let u=this.state.cur,d=n.createElement("div",null,this.state.tabs.map((e,t)=>{const{icon:i,isSelected:s,title:r,redDot:a,className:l}=e;let c,u,d;if(void 0!==i&&(c=n.createElement("img",{src:i,alt:"tab icon"})),void 0!==a){let e=a.get();e<0?(d=o()("red-dot",l),u=n.createElement("u",null)):e>0&&(d=o()("red-dot","num",l),u=n.createElement("u",null,e))}return n.createElement("div",{key:t,className:o()("va-tab",{cur:s}),onClick:()=>this.onTabClick(e)},c,n.createElement("div",{className:d},r,u))})),m=!1!==t&&n.createElement(c.a,{back:i,center:!0===r?t:u&&(u.header||u.title),right:s,className:a});return n.createElement("article",{className:"page-container"},m,"top"===l&&d,n.createElement("section",{className:"position-relative"},this.props.sideBar,this.state.tabs.map((e,t)=>{let{isSelected:i,isMounted:s,content:r}=e;if(!0===i||!0===s)return e.isMounted=!0,n.createElement(h,{key:t,className:o()({invisible:!1===i}),onScroll:e.onScroll,onScrollTop:e.onScrollTop,onScrollBottom:e.onScrollBottom},"function"===typeof r?r():r)})),"top"!==l&&d,e)}renderSingle(e){const{back:t,header:i,right:s,onScroll:r,onScrollTop:o,onScrollBottom:a,children:l,headerClassName:u}=this.props;let d=!1!==i&&n.createElement(c.a,{back:t,center:i,right:s,logout:this.props.logout,className:u});return n.createElement("article",{className:"page-container",onTouchStart:this.onTouchStart},d,n.createElement("section",{className:"position-relative"},this.props.sideBar,n.createElement(h,{onScroll:r,onScrollTop:o,onScrollBottom:a},l)),e)}render(){const{footer:e}=this.props;let t=void 0!==e&&n.createElement("footer",null,e);return void 0!==this.tabs?this.renderTabs(t):this.renderSingle(t)}};m=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o}([s.a],m)},function(e,t,i){"use strict";i.d(t,"b",function(){return r}),i.d(t,"a",function(){return o}),i.d(t,"d",function(){return a}),i.d(t,"c",function(){return l});var n=i(7),s=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class r extends n.a{constructor(e,t){super(t),this.tries=0,this._entity=e}get entity(){return this._entity}request(){return s(this,void 0,void 0,function*(){return yield this.entity.loadSchema(),yield this.innerRequest()})}innerCall(){return s(this,void 0,void 0,function*(){return yield this.entity.uqApi.xcall(this)})}innerRequest(){return s(this,void 0,void 0,function*(){let e=yield this.innerCall(),{$uq:t,$modify:i,res:n}=e;if(this.entity.uq.pullModify(i),void 0===t){return this.xresult(n)}return yield this.retry(t)})}xresult(e){return e}get headers(){let{ver:e,uq:t}=this.entity,{uqVersion:i}=t;return{uq:`${i}`,en:`${e}`}}retry(e){return s(this,void 0,void 0,function*(){if(++this.tries,this.tries>5)throw new Error("can not get right uq response schema, 5 tries");return this.rebuildSchema(e),yield this.innerRequest()})}rebuildSchema(e){let{uq:t,entity:i}=e;void 0!==t&&this.entity.uq.buildEntities(t),void 0!==i&&this.entity.setSchema(i)}}class o extends r{get entity(){return this._entity}}class a extends r{get entity(){return this._entity}get path(){return`query/${this.entity.name}`}xresult(e){return this.entity.unpackReturns(e)}buildParams(){return this.entity.buildParams(this.params)}}class l extends r{get entity(){return this._entity}get path(){return`query-page/${this.entity.name}`}buildParams(){let e,{pageStart:t,pageSize:i,params:n}=this.params;return(e=void 0===n?{key:""}:this.entity.buildParams(n)).$pageStart=t,e.$pageSize=i,e}xresult(e){return this.entity.unpackReturns(e).$page}}},function(e,t,i){"use strict";i.d(t,"c",function(){return o}),i.d(t,"a",function(){return a}),i.d(t,"b",function(){return l});var n=i(0),s=i(5),r=i(12);class o{render(e){return void 0===this.view?n.createElement("div",null,"??? viewModel \u5fc5\u987b\u5b9a\u4e49 view ???"):n.createElement(this.view,{vm:this,className:e})}}const a=Object(s.a)(r.a),l=e=>n.createElement("div",{className:"px-3 py-2"},Object(r.b)(e))},function(e,t,i){"use strict";var n=i(8),s=i.n(n),r=i(13),o=i(9),a=i(10),l=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};const c=["POST","PUT"];class u{constructor(e,t,i){this.startWait=(()=>{void 0!==this.ui&&this.ui.startWait()}),this.endWait=((e,t)=>{void 0!==this.ui&&this.ui.endWait(),void 0!==t&&t("\u8bbf\u95eewebapi\u8d85\u65f6 "+e)}),this.showError=(e=>l(this,void 0,void 0,function*(){void 0!==this.ui&&(yield this.ui.showError(e))})),this.hostUrl=e,this.apiToken=t,this.ui=i,this.timeout=!0===a.d.isDevelopment?5e5:5e3}used(){this.post("",{})}xcall(e,t){return l(this,void 0,void 0,function*(){let i=this.buildOptions(),{headers:n,path:s,method:r}=t;if(void 0!==n){let e=i.headers;for(let t in n)e.append(t,encodeURI(n[t]))}i.method=r;let o=t.buildParams();return c.indexOf(r)>=0&&void 0!==o&&(i.body=JSON.stringify(o)),yield this.innerFetch(e+s,i)})}innerFetchResult(e,t){return l(this,void 0,void 0,function*(){return(yield this.innerFetch(e,t)).res})}get(e,t){return l(this,void 0,void 0,function*(){if(t){let i=Object.keys(t);if(i.length>0){let n="?";for(let s of i){void 0!==t[s]&&(e+=n+s+"="+t[s],n="&")}}}let i=this.buildOptions();return i.method="GET",yield this.innerFetchResult(e,i)})}post(e,t){return l(this,void 0,void 0,function*(){let i=this.buildOptions();return i.method="POST",i.body=JSON.stringify(t),yield this.innerFetchResult(e,i)})}put(e,t){return l(this,void 0,void 0,function*(){let i=this.buildOptions();return i.method="PUT",i.body=JSON.stringify(t),yield this.innerFetchResult(e,i)})}delete(e,t){return l(this,void 0,void 0,function*(){let i=this.buildOptions();return i.method="DELETE",i.body=JSON.stringify(t),yield this.innerFetchResult(e,i)})}fetch(e,t,i,n){return l(this,void 0,void 0,function*(){let s=this;this.startWait();let r=e;function a(e){return{channel:s,url:r,options:t,resolve:i,reject:n,error:e}}try{console.log("%s %s",t.method,r);let u=setTimeout(()=>s.endWait(e,n),this.timeout),d=yield fetch(encodeURI(r),t);if(!1===d.ok)throw clearTimeout(u),s.endWait(),console.log("call error %s",d.statusText),d.statusText;let h=d.headers.get("content-type");if(h&&h.indexOf("json")>=0)return d.json().then(e=>l(this,void 0,void 0,function*(){if(clearTimeout(u),s.endWait(),!0===e.ok)return"object"!==typeof e||Array.isArray(e),i(e);let t=e.error;void 0===t?yield s.showError(a("not valid tonva json")):(yield s.showError(a(t)),n(t))})).catch(e=>l(this,void 0,void 0,function*(){yield s.showError(a(e))}));{let e=yield d.text();clearTimeout(u),s.endWait(),i(e)}}catch(c){if("string"===typeof c){if(!0===c.toLowerCase().startsWith("unauthorized"))return void o.b.logout()}yield this.showError(a(c.message))}})}callFetch(e,t,i){return l(this,void 0,void 0,function*(){let n=this.buildOptions();return n.method=t,n.body=i,yield new Promise((t,i)=>l(this,void 0,void 0,function*(){yield this.fetch(e,n,t,i)}))})}buildOptions(){return{headers:this.buildHeaders(),method:void 0,body:void 0}}buildHeaders(){let{language:e,culture:t}=o.b,i=new Headers;i.append("Content-Type","application/json;charset=UTF-8");let n=e;return t&&(n+="-"+t),i.append("Accept-Language",n),this.apiToken&&i.append("Authorization",this.apiToken),i}}class d extends u{innerFetch(e,t){return l(this,void 0,void 0,function*(){let i=this.hostUrl+e;return void 0===this.apiToken&&Object(r.h)()?yield Object(r.d)(i,t.method,t.body):yield new Promise((e,n)=>l(this,void 0,void 0,function*(){yield this.fetch(i,t,e,n)}))})}}class h extends u{innerFetch(e,t){return l(this,void 0,void 0,function*(){let i=this.hostUrl+e;return yield new Promise((e,n)=>l(this,void 0,void 0,function*(){yield this.fetch(i,t,e,n)}))})}}var m=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class f{startWait(){o.b.startWait()}endWait(){o.b.endWait()}showError(e){return m(this,void 0,void 0,function*(){o.b.endWait(),yield o.b.onError(e)})}showUpgradeUq(e,t){return m(this,void 0,void 0,function*(){yield o.b.showUpgradeUq(e,t)})}}var v=i(40),p=i(29),g=i(1);i.d(t,"h",function(){return x}),i.d(t,"d",function(){return E}),i.d(t,"c",function(){return P}),i.d(t,"j",function(){return N}),i.d(t,"f",function(){return F}),i.d(t,"i",function(){return O}),i.d(t,"a",function(){return R}),i.d(t,"k",function(){return V}),i.d(t,"e",function(){return q}),i.d(t,"b",function(){return U}),i.d(t,"g",function(){return L});var y=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};let b={},w={};function x(){b={},w={},C={},Object(r.i)()}class E extends v.a{constructor(e,t,i,n,s){super(e,s),i&&(this.uqOwner=t,this.uqName=i,this.uq=t+"/"+i),this.access=n,this.showWaiting=s}init(){return y(this,void 0,void 0,function*(){yield Object(r.e)(this.uq,this.uqOwner,this.uqName)})}getHttpChannel(){return y(this,void 0,void 0,function*(){let e,t;!0===this.showWaiting||void 0===this.showWaiting?(e=b,t=new f):e=w;let i=e[this.uq];if(void 0!==i)return i;let n=Object(r.b)(this.uq);n||(yield this.init(),n=Object(r.b)(this.uq));let{url:s,token:o}=n;return this.token=o,i=new h(s,o,t),e[this.uq]=i})}loadAccess(){return y(this,void 0,void 0,function*(){let e=void 0===this.access?"":this.access.join("|");return yield this.get("access",{acc:e})})}schema(e){return y(this,void 0,void 0,function*(){return yield this.get("schema/"+e)})}queueModify(e,t,i){return y(this,void 0,void 0,function*(){return yield this.post("queue-modify",{start:e,page:t,entities:i})})}}let k,C={};class P extends E{constructor(e){super("tv/",void 0,void 0,void 0,!0),this.unitId=e}getHttpChannel(){return y(this,void 0,void 0,function*(){let e=C[this.unitId];return void 0!==e?e:C[this.unitId]=yield this.buildChannel()})}buildChannel(){return y(this,void 0,void 0,function*(){let e=new f,t=new U("tv/",void 0),i=yield t.unitxUq(this.unitId),{token:n,db:s,url:r,urlTest:o}=i,a=p.a.getUrlOrTest(s,r,o);return this.token=n,new h(a,n,e)})}}function N(e){console.log("setCenterUrl %s",e),k=e,F=void 0,S=void 0,I=void 0}let I,S,F=void 0,T=0;function O(e,t){T=e,F=t,console.log("setCenterToken %s",t),S=void 0,I=void 0}class R extends v.a{getHttpChannel(){return y(this,void 0,void 0,function*(){return!0===this.showWaiting||void 0===this.showWaiting?void 0!==I?I:I=new d(k,F,new f):void 0!==S?S:S=new d(k,F)})}}const A="uqTokens";const V=new class extends R{constructor(){super(...arguments),this.localMap=a.d.localDb.map(A)}uq(e){return y(this,void 0,void 0,function*(){let{uqOwner:t,uqName:i}=e,n=t+"/"+i,r=this.localMap.child(n);try{let t=r.get();if(void 0!==t){let{unit:i,user:n}=t;i===e.unit&&n===T||(r.remove(),t=void 0)}let i=Math.floor(Date.now()/1e3);if(void 0!==t){let{tick:e,value:n}=t;if(void 0!==n&&i-e<86400)return s.a.clone(n)}let n=s.a.clone(e);n.testing=p.a.testing;let a=yield this.get("app-uq",n);if(void 0===a){let{unit:t,uqOwner:i,uqName:n}=e;throw`center get app-uq(unit=${t}, '${i}/${n}') - not exists or no unit-service`}return t={unit:e.unit,user:T,tick:i,value:a},r.set(t),s.a.clone(a)}catch(o){throw r.remove(),o}})}}("tv/tie/",void 0);const q=new class extends R{directCall(e,t,i){return this.call(e,t,i)}}("",void 0),j="appUqs";class U extends R{constructor(){super(...arguments),this.local=a.d.localDb.item(j)}uqs(e,t){return y(this,void 0,void 0,function*(){let i,n=this.local.get();if(n){let{appOwner:s,appName:r}=n;e===s&&t===r&&(i=n)}return void 0===i&&((i=yield this.uqsPure(e,t)).appName=t,i.appOwner=e,this.local.set(i)),i})}uqsPure(e,t){return y(this,void 0,void 0,function*(){return yield this.get("tie/app-uqs",{appOwner:e,appName:t})})}isOkCheckUqs(e,t){return y(this,void 0,void 0,function*(){let i=yield this.uqsPure(e,t),{id:n,uqs:r}=this.local.get(),{id:o,uqs:a}=i;if(n!==o)return!1;if(r.length!==a.length)return!1;let l=r.length;for(let e=0;e<l;e++)if(!1===s.a.isMatch(r[e],a[e]))return!1;return!0})}checkUqs(e,t){return y(this,void 0,void 0,function*(){let i=yield this.isOkCheckUqs(e,t);return!1===i&&(this.local.remove(),g.nav.start()),i})}unitxUq(e){return y(this,void 0,void 0,function*(){return yield this.get("tie/unitx-uq",{unit:e})})}changePassword(e){return y(this,void 0,void 0,function*(){return yield this.post("tie/change-password",e)})}}function L(e,t){return y(this,void 0,void 0,function*(){let i=new U("tv/",void 0),n=yield i.uqs(e,t);return yield i.checkUqs(e,t),n})}},function(e,t,i){"use strict";var n=i(0),s=i(4),r=i.n(s),o=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class a{}class l extends a{constructor(e){super(),this.onClick=(()=>o(this,void 0,void 0,function*(){yield this.controller.start()})),this.controller=e,this.icon=e.icon,this.label=e.label}render(e){return n.createElement("div",{className:r()("px-3","py-2","align-items-center","cursor-pointer",e),onClick:this.onClick},this.icon," \xa0 ",this.label)}}i.d(t,"a",function(){return l})},,function(e,t,i){"use strict";i.d(t,"a",function(){return o});var n=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};const s="\t",r="\n";class o{constructor(e,t,i){this.ver=0,this.fieldMaps={},this.uq=e,this.name=t,this.typeId=i,this.sys=this.name.indexOf("$")>=0,this.cache=this.uq.localMap.item(this.name),this.uqApi=this.uq.uqApi}get sName(){return this.jName||this.name}fieldMap(e){void 0===e&&(e="$");let t=this.fieldMaps[e];if(void 0===t){let i;if("$"===e)i=this.fields;else if(void 0!==this.arrFields){let t=this.arrFields.find(t=>t.name===e);void 0!==t&&(i=t.fields)}else if(void 0!==this.returns){let t=this.returns.find(t=>t.name===e);void 0!==t&&(i=t.fields)}if(void 0===i)return{};t={};for(let e of i)t[e.name]=e;this.fieldMaps[e]=t}return t}loadSchema(){return n(this,void 0,void 0,function*(){if(void 0!==this.schema)return;let e=this.cache.get();e||(e=yield this.uq.loadEntitySchema(this.name)),this.setSchema(e),this.buildFieldsTuid()})}clearSchema(){this.schema=void 0}setSchema(e){if(void 0===e)return;let{name:t,version:i}=e;this.ver=i||0,t!==this.name&&(this.jName=t),this.cache.set(e),this.schema=e}buildFieldsTuid(){let{fields:e,arrs:t,returns:i}=this.schema;this.uq.buildFieldTuid(this.fields=e),this.uq.buildArrFieldsTuid(this.arrFields=t,e),this.uq.buildArrFieldsTuid(this.returns=i,e)}schemaStringify(){return JSON.stringify(this.schema,(e,t)=>{if("_tuid"!==e)return t},4)}tuidFromName(e,t){if(void 0===this.schema)return;let{fields:i,arrs:n}=this.schema,s=this.uq;function r(e,t){if(void 0===t)return;let i=t.find(t=>t.name===e);return void 0!==i?s.getTuid(i.tuid):void 0}let o=e.toLowerCase();if(void 0===t)return r(o,i);if(void 0===n)return;let a=t.toLowerCase(),l=n.find(e=>e.name===a);return void 0!==l?r(o,l.fields):void 0}buildParams(e){let t={},i=this.fields;void 0!==i&&this.buildFieldsParams(t,i,e);let n=this.arrFields;if(void 0!==n)for(let s of n){let{name:i,fields:n}=s;if(void 0===e[i])continue;let r=[];t[i]=r;for(let t of e){let e={};this.buildFieldsParams(e,n,t),r.push(e)}}return t}buildFieldsParams(e,t,i){for(let n of t){let t,{name:s,type:r}=n,o=i[s];if("datetime"===r)t=this.buildDateTimeParam(o);else switch(typeof o){default:t=o;break;case"object":let e=n._tuid;t=void 0===e?o.id:e.getIdFromObj(o)}e[s]=t}}buildDateTimeParam(e){let t;switch(typeof e){default:throw new Error("escape datetime field in pack data error: value="+e);case"undefined":return;case"object":t=e;break;case"string":case"number":t=new Date(e)}return Math.floor(t.getTime()/1e3)}buildDateParam(e){let t;switch(typeof e){default:throw new Error("escape datetime field in pack data error: value="+e);case"undefined":return;case"string":return e;case"object":t=e;break;case"number":t=new Date(e)}let i=t.toISOString(),n=i.indexOf("T");return n>0?i.substr(0,n):i}pack(e){let t=[],i=this.fields;void 0!==i&&this.packRow(t,i,e);let n=this.arrFields;if(void 0!==n)for(let s of n)this.packArr(t,s.fields,e[s.name]);return t.join("")}escape(e,t){let i=e[t.name];switch(t.type){case"datetime":return this.buildDateTimeParam(i);default:switch(typeof i){default:return i;case"object":let e=t._tuid;return void 0===e?i.id:e.getIdFromObj(i);case"string":let n=i.length,s="",r=0;for(let t=0;t<n;t++){switch(i.charCodeAt(t)){case 9:s+=i.substring(r,t)+"\\t",r=t+1;break;case 10:s+=i.substring(r,t)+"\\n",r=t+1}}return s+i.substring(r);case"undefined":return""}}}packRow(e,t,i){let n=t.length;if(0===n)return;let o="";o+=this.escape(i,t[0]);for(let r=1;r<n;r++){let e=t[r];o+=s+this.escape(i,e)}e.push(o+r)}packArr(e,t,i){if(void 0!==i)for(let n of i)this.packRow(e,t,n);e.push(r)}cacheFieldsInValue(e,t){for(let i of t){let{name:t,_tuid:n}=i;if(void 0===n)continue;let s=e[t];e[t]=n.boxId(s)}}unpackTuidIdsOfFields(e,t){if(void 0===t)return e;let i=[];for(let n of e){if(!n)continue;let e=n.length,s=0;for(;s<e;){if(10===n.charCodeAt(s)){++s;break}let e={};s=this.unpackRow(e,t,n,s),i.push(e)}}return i}unpackSheet(e){let t={},i=this.fields,n=0;void 0!==i&&(n=this.unpackRow(t,i,e,n));let s=this.arrFields;if(void 0!==s)for(let r of s)n=this.unpackArr(t,r,e,n);return t}unpackReturns(e){let t={},i=0,n=this.returns;if(void 0!==n)for(let s of n)i=this.unpackArr(t,s,e,i);return t}unpackRow(e,t,i,n){let s=0,r=0,o=n,a=0,l=i.length,c=t.length;for(;n<l;n++)if(s=r,9===(r=i.charCodeAt(n))){let r=t[a],{name:u}=r;if(8!==s){if(n>o){let t=i.substring(o,n);e[u]=this.to(e,t,r)}}else e[u]=null;if(o=n+1,++a>=c)return(n=i.indexOf("\n",o))>=0?++n:n=l,n}else if(10===r){let r=t[a],{name:l}=r;if(8!==s){if(n>o){let t=i.substring(o,n);e[l]=this.to(e,t,r)}}else e[l]=null;return++a,++n}let u=t[a],{name:d}=u;if(8!==s){let t=i.substring(o);e[d]=this.to(e,t,u)}return l}to(e,t,i){switch(i.type){default:return t;case"datetime":case"time":let e=Number(t);return!0===isNaN(e)?new Date(t):new Date(1e3*e);case"date":let n=t.split("-");return new Date(Number(n[0]),Number(n[1])-1,Number(n[2]));case"tinyint":case"smallint":case"int":case"bigint":case"dec":return Number(t);case"id":let s=Number(t),{_tuid:r}=i;return void 0===r?s:r.boxId(s)}}unpackArr(e,t,i,n){let s=[],r=i.length,{name:o,fields:a}=t;for(;n<r;){if(10===i.charCodeAt(n)){++n;break}let e={};s.push(e),n=this.unpackRow(e,a,i,n)}return e[o]=s,n}}},function(e,t,i){"use strict";i.d(t,"a",function(){return r});const n="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",s=8;function r(){let e=n.length,t="";for(let i=0;i<s;i++)t+=n.charAt(Math.floor(Math.random()*e));return t}},function(e,t,i){"use strict";i.d(t,"c",function(){return r}),i.d(t,"b",function(){return o}),i.d(t,"d",function(){return c}),i.d(t,"a",function(){return u});var n=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};let s;function r(e){s=e}function o(e){window.top.postMessage({type:"ws",msg:e},"*")}class a{constructor(){this.handlerSeed=1,this.anyHandlers={},this.msgHandlers={}}onWsReceiveAny(e){let t=this.handlerSeed++;return this.anyHandlers[t]=e,t}onWsReceive(e,t){let i=this.handlerSeed++;return this.msgHandlers[i]={type:e,handler:t},i}endWsReceive(e){delete this.anyHandlers[e],delete this.msgHandlers[e]}receive(e){return n(this,void 0,void 0,function*(){let{$type:t}=e;for(let i in this.anyHandlers)yield this.anyHandlers[i](e);for(let i in this.msgHandlers){let{type:n,handler:s}=this.msgHandlers[i];n===t&&(yield s(e))}})}}let l=1;const c=new class extends a{constructor(){super(...arguments),this.wsBaseId="WsBridge seed "+l++}};class u extends a{constructor(e,t){super(),this.wsBaseId="WSChannel seed "+l++,this.wsHost=e,this.token=t}static setCenterToken(e){u.centerToken=e}connect(){if(void 0!==this.ws)return;let e=this;return new Promise((t,i)=>{let s=new WebSocket(this.wsHost,this.token||u.centerToken);console.log("connect webSocket %s",this.wsHost),s.onopen=(i=>{console.log("webSocket connected %s",this.wsHost),e.ws=s,t()}),s.onerror=(e=>{i("webSocket can't open!")}),s.onmessage=(t=>n(this,void 0,void 0,function*(){return yield e.wsMessage(t)})),s.onclose=(t=>{e.ws=void 0,console.log("webSocket closed!")})})}close(){void 0!==this.ws&&(this.ws.close(),this.ws=void 0)}wsMessage(e){return n(this,void 0,void 0,function*(){try{console.log("websocket message: %s",e.data);let i=JSON.parse(e.data);!function(e){void 0!==s&&s.postMessage({type:"ws",msg:e},"*")}(i),yield this.receive(i)}catch(t){console.log("ws msg error: ",t)}})}sendWs(e){let t=this;this.connect().then(()=>{t.ws.send(e)})}}},function(e,t,i){"use strict";var n=i(51);i.d(t,"UqMan",function(){return n.a}),i.d(t,"fieldDefaultValue",function(){return n.b});i(20),i(32),i(24),i(52);var s=i(38);i.o(s,"Badge")&&i.d(t,"Badge",function(){return s.Badge}),i.o(s,"Controller")&&i.d(t,"Controller",function(){return s.Controller}),i.o(s,"EasyDate")&&i.d(t,"EasyDate",function(){return s.EasyDate}),i.o(s,"FA")&&i.d(t,"FA",function(){return s.FA}),i.o(s,"Form")&&i.d(t,"Form",function(){return s.Form}),i.o(s,"IconText")&&i.d(t,"IconText",function(){return s.IconText}),i.o(s,"Image")&&i.d(t,"Image",function(){return s.Image}),i.o(s,"LMR")&&i.d(t,"LMR",function(){return s.LMR}),i.o(s,"List")&&i.d(t,"List",function(){return s.List}),i.o(s,"NavView")&&i.d(t,"NavView",function(){return s.NavView}),i.o(s,"Page")&&i.d(t,"Page",function(){return s.Page}),i.o(s,"PropGrid")&&i.d(t,"PropGrid",function(){return s.PropGrid}),i.o(s,"UQsMan")&&i.d(t,"UQsMan",function(){return s.UQsMan}),i.o(s,"VPage")&&i.d(t,"VPage",function(){return s.VPage}),i.o(s,"View")&&i.d(t,"View",function(){return s.View}),i.o(s,"nav")&&i.d(t,"nav",function(){return s.nav});i(53),i(55),i(54),i(56);var r=i(93);i.d(t,"UQsMan",function(){return r.a})},function(e,t,i){"use strict";i.d(t,"a",function(){return a});var n=i(2),s=(i(10),i(20)),r=i(15),o=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class a extends s.a{get typeName(){return"query"}setSchema(e){super.setSchema(e);let{returns:t}=e;this.isPaged=t&&void 0!==t.find(e=>"$page"===e.name)}resetPage(e,t){this.pageStart=void 0,this.pageSize=e,this.params=t,this.more=!1,this.list=void 0}get hasMore(){return this.more}loadPage(){return o(this,void 0,void 0,function*(){if(void 0===this.pageSize)throw new Error("call resetPage(size:number, params:any) first");let e;if(void 0!==this.pageStart)switch(this.startField.type){default:e=this.pageStart;break;case"date":case"time":case"datetime":e=this.pageStart.getTime()}let t=yield this.page(this.params,e,this.pageSize+1);if(this.list=n.l.array([],{deep:!1}),void 0!==t){if(t.length>this.pageSize){this.more=!0,t.pop();let e=this.returns.find(e=>"$page"===e.name);this.startField=e.fields[0],this.pageStart=t[t.length-1][this.startField.name]}else this.more=!1;this.list.push(...t)}})}pageCaller(e){return new r.c(this,e)}page(e,t,i){return o(this,void 0,void 0,function*(){let n={pageStart:t,pageSize:i+1,params:e};return yield this.pageCaller(n).request()})}queryCaller(e){return new r.d(this,e)}query(e){return o(this,void 0,void 0,function*(){return yield this.queryCaller(e).request()})}table(e){return o(this,void 0,void 0,function*(){let t=yield this.query(e);for(let e in t)return t[e]})}obj(e){return o(this,void 0,void 0,function*(){let t=yield this.table(e);if(t.length>0)return t[0]})}scalar(e){return o(this,void 0,void 0,function*(){let t=yield this.obj(e);for(let e in t)return t[e]})}}(function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);r>3&&o&&Object.defineProperty(t,i,o)})([n.l],a.prototype,"list",void 0)},function(e,t,i){"use strict";i.d(t,"a",function(){return a});var n=i(9),s=i(2),r=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o},o=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class a{constructor(e,t,i,n){this.isChanged=!1,this.itemSchema=e,this.uiItem=t,this.value=n;let{name:s}=e;this.name=s,this.label=i}start(){return o(this,void 0,void 0,function*(){return yield this.internalStart()})}end(){return o(this,void 0,void 0,function*(){yield this.internalEnd()})}internalEnd(){return o(this,void 0,void 0,function*(){n.b.pop()})}verifyValue(){if(void 0===this.uiItem)return;let{rules:e}=this.uiItem;if(void 0===e)return;let t=this.newValue;function i(e,i){let n=e(t);if(void 0!==n)return"object"!==typeof n?n:JSON.stringify(n)}if(Array.isArray(e))for(let n of e){let e=i(n);if(void 0!==e){this.error=e;break}}else this.error=i(e)}}r([s.l],a.prototype,"error",void 0),r([s.l],a.prototype,"isChanged",void 0)},,function(e,t,i){"use strict";i.d(t,"a",function(){return a});var n=i(0),s=i(4),r=i.n(s),o=i(9);function a(e){let{className:t,style:i,src:s,altImage:a}=e;return s?(!0===s.startsWith(":")&&(s=o.b.resUrl+s.substr(1)),n.createElement("img",{src:s,className:t,alt:"img",style:i,onError:e=>{e.currentTarget.src=a||"https://tv.jkchemical.com/imgs/0001.png"}})):n.createElement("div",{className:r()(t,"image-none"),style:i},n.createElement("i",{className:"fa fa-file-o"}))}},function(e,t,i){"use strict";i.d(t,"b",function(){return r}),i.d(t,"a",function(){return o});var n=i(75),s=i.n(n);function r(e){let t=s()(e);return{id:t.id,name:t.name,guest:t.guest,token:e}}function o(e){return{id:0,guest:s()(e).guest,token:e}}},function(e,t,i){"use strict";i.d(t,"b",function(){return c}),i.d(t,"a",function(){return d});var n=i(10),s=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};const r="https://tv.jkchemical.com",o=Object({NODE_ENV:"production",PUBLIC_URL:"/app",REACT_APP_CENTER_HOST:"https://tv.jkchemical.com",REACT_APP_UNIT:"0"}).REACT_APP_RES_HOST||r,a={centerhost:{value:Object({NODE_ENV:"production",PUBLIC_URL:"/app",REACT_APP_CENTER_HOST:"https://tv.jkchemical.com",REACT_APP_UNIT:"0"}).REACT_APP_CENTER_DEBUG_HOST||"localhost:3000",local:!1},reshost:{value:Object({NODE_ENV:"production",PUBLIC_URL:"/app",REACT_APP_CENTER_HOST:"https://tv.jkchemical.com",REACT_APP_UNIT:"0"}).REACT_APP_RES_DEBUG_HOST||"localhost:3015",local:!1},uqhost:{value:Object({NODE_ENV:"production",PUBLIC_URL:"/app",REACT_APP_CENTER_HOST:"https://tv.jkchemical.com",REACT_APP_UNIT:"0"}).REACT_APP_UQ_DEBUG_HOST||"localhost:3015",local:!1},unitxhost:{value:Object({NODE_ENV:"production",PUBLIC_URL:"/app",REACT_APP_CENTER_HOST:"https://tv.jkchemical.com",REACT_APP_UNIT:"0"}).REACT_APP_UQ_DEBUG_HOST||"localhost:3015",local:!1},"uq-build":{value:Object({NODE_ENV:"production",PUBLIC_URL:"/app",REACT_APP_CENTER_HOST:"https://tv.jkchemical.com",REACT_APP_UNIT:"0"}).REACT_APP_UQ_DEBUG_BUILDER_HOST||"localhost:3009",local:!1}};function l(e){return!0===e.startsWith("https://")?e.endsWith("/")?e:e+"/":`http://${e}/`}function c(e){return l(e)+"res/"}const u={method:"GET",mode:"no-cors",headers:{"Content-Type":"text/plain"}};const d=new class{start(e){return s(this,void 0,void 0,function*(){this.testing=e,!0===n.d.isDevelopment&&(yield this.tryLocal());let t=this.getCenterHost();this.url=function(e){return l(e)}(t),this.ws=function(e){return!0===e.startsWith("https://")?(!0===(e=e.substr("https://".length)).endsWith("/")&&(e=e.substr(0,e.length-1)),"wss://"+e+"/tv/"):`ws://${e}/tv/`}(t),this.resHost=this.getResHost()})}debugHostUrl(e){return`http://${e}/hello`}tryLocal(){return s(this,void 0,void 0,function*(){let e=[],t=[];for(let s in a){let e=a[s],{value:i}=e;t.findIndex(e=>e===i)<0&&t.push(i)}for(let s of t){let t=this.debugHostUrl(s);e.push(m(t))}let i=yield Promise.all(e),n=t.length;for(let s=0;s<n;s++){let e=i[s],n=t[s];for(let t in a){let i=a[t];i.value===n&&(i.local=e)}}})}getCenterHost(){let{value:e,local:t}=a.centerhost;return!0===document.location.hash.includes("sheet_debug")?e:!0===n.d.isDevelopment&&!0===t?e:r}getResHost(){let{value:e,local:t}=a.reshost;return!0===document.location.hash.includes("sheet_debug")?e:!0===n.d.isDevelopment&&!0===t?e:o}getUrlOrDebug(e,t="uqhost"){if(!1===n.d.isDevelopment)return e;let i=a[t];if(void 0===i)return e;let{value:s,local:r}=i;return!1===r?e:`http://${s}/`}getUrlOrTest(e,t,i){let n;return!0===this.testing?("-"!==i&&(t=i),n="uq/test/"+e+"/"):n="uq/prod/"+e+"/",(t=this.getUrlOrDebug(t))+n}localCheck(e){return s(this,void 0,void 0,function*(){return yield m(e)})}},h=200;function m(e){return s(this,void 0,void 0,function*(){try{return yield function(e){return new Promise((t,i)=>{fetch(e,u).then(e=>{e.text().then(t).catch(i)}).catch(i);const n=new Error("Connection timed out");setTimeout(i,h,n)})}(e),!0}catch(t){return!1}})}},function(e,t,i){"use strict";i.d(t,"b",function(){return a}),i.d(t,"a",function(){return l}),i.d(t,"c",function(){return u});var n=i(0),s=i(5),r=i(12),o=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class a{constructor(e,t,i){this.tuid=e,this.ui=t,this.res=i}}class l{constructor(e,t){this.tuidUR=e,this.id=t,this.isUndefined=void 0===this.tuidUR.tuid}get obj(){return this.tuidUR.tuid.valueFromId(this.id)}render(e,t){if(void 0===this.id||null===this.id)return;let i=this.boxName,s=this.obj;if(!0===this.isUndefined)return void 0!==e?e(s,t):Object(r.a)(s,t);switch(typeof s){case"undefined":return n.createElement("del",{className:"text-black-50"},i," undefined");case"number":return n.createElement("del",{className:"text-black-50"},i," ",this.id)}if(void 0===e&&(e=this.tuidUR.ui),void 0!==e&&("function"!==typeof e&&(e=e.content),void 0!==e)){let t=e(s,this.tuidUR.res);return void 0!==t?t:n.createElement("del",{className:"text-danger"},i," ",this.id)}return Object(r.a)(s)}get boxName(){return this.tuidUR.tuid.name}assure(){return o(this,void 0,void 0,function*(){yield this.tuidUR.tuid.assureBox(this.id)})}}const c=Object(s.a)(({tuidValue:e,ui:t,x:i,nullUI:s})=>{if(void 0===e)return void 0===s?n.createElement(n.Fragment,null,"[undefined]"):s();if(null===e)return void 0===s?n.createElement(n.Fragment,null,"[null]"):s();let o=typeof e;switch(o){default:if(void 0===t)return n.createElement(n.Fragment,null,o,"-",e);{let s=t(e,i);return void 0!==s?s:n.createElement(n.Fragment,null,e)}case"object":let a=function(e,t,i){let s,o=e;switch(typeof e){case"undefined":s=n.createElement(n.Fragment,null,"boxId undefined");break;case"number":s=n.createElement(n.Fragment,null,"id:",e);break;default:if("function"!==typeof o.render){if(void 0!==t)return t(e,i);s=Object(r.a)(e,i)}}return void 0!==s?n.createElement("del",{className:"text-danger"},s):o.render(t,i)}(e,t,i);return void 0!==a?a:void 0===s?n.createElement(n.Fragment,null,"id null"):s();case"number":return n.createElement(n.Fragment,null,"id...",e)}}),u=(e,t,i,s)=>n.createElement(c,{tuidValue:e,ui:t,x:i,nullUI:s})},function(e,t,i){"use strict";var n=i(8),s=i.n(n),r=i(6),o=i(0),a=i.n(o),l=i(1),c=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class u extends r.b{constructor(){super(...arguments),this.onNew=(()=>this.event("new")),this.onList=(()=>this.event("list")),this.onSearch=(e=>c(this,void 0,void 0,function*(){return this.event("list",e)}))}open(e){return c(this,void 0,void 0,function*(){this.openPage(this.view)})}entityRender(e,t){return e.render()}entityClick(e){return c(this,void 0,void 0,function*(){yield e.onClick()})}get view(){let e,{label:t,isImport:i}=this.controller;!1===i&&(e=o.createElement("button",{className:"btn btn-outline-success ml-2",onClick:this.onNew},"\u65b0\u589e"));let n=o.createElement(o.Fragment,null,e,o.createElement("button",{className:"btn btn-outline-info ml-2",onClick:this.onList},"\u5168\u90e8")),s=o.createElement(l.LMR,{className:"m-3",right:n},o.createElement(l.SearchBox,{className:"w-100",size:"md",onSearch:this.onSearch,placeholder:"\u641c\u7d22"+t}));return()=>o.createElement(l.Page,{header:t},s)}}var d=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class h extends r.b{constructor(){super(...arguments),this.next=(()=>d(this,void 0,void 0,function*(){this.vForm.reset(),this.closePage()})),this.finish=(()=>{this.closePage(2),this.event("edit-end")}),this.onSubmit=(()=>d(this,void 0,void 0,function*(){let e=this.vForm.getValues(),t=yield this.controller.entity.save(this.id,e),{id:i}=t;if(i<0){let{unique:e}=this.controller.entity;if(void 0!==e)for(let t of e)this.vForm.setError(t,"\u4e0d\u80fd\u91cd\u590d")}else{if(this.controller.isCalling)return this.returnCall(i),void this.closePage();this.openPageElement(o.createElement(l.Page,{header:this.label+"\u63d0\u4ea4\u6210\u529f",back:"none"},o.createElement("div",{className:"m-3"},o.createElement("span",{className:"text-success"},o.createElement(l.FA,{name:"check-circle",size:"lg"})," \u6210\u529f\u63d0\u4ea4\uff01"),o.createElement("div",{className:"mt-5"},o.createElement("button",{className:"btn btn-primary mr-3",onClick:this.next},"\u7ee7\u7eed\u5f55\u5165"),o.createElement("button",{className:"btn btn-outline-primary",onClick:this.finish},"\u4e0d\u7ee7\u7eed"))))),this.event("item-changed",{id:this.id,values:e})}}))}open(e){return d(this,void 0,void 0,function*(){this.vForm=this.createForm(this.onSubmit,e),void 0!==e&&(this.id=e.id),this.openPage(this.editView)})}get editView(){return()=>o.createElement(l.Page,{header:(void 0===this.id?"\u65b0\u589e":"\u7f16\u8f91")+" - "+this.label},this.vForm.render("py-3"))}resetForm(){this.vForm.reset()}}var m=i(16),f=i(5),v=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class p extends r.b{constructor(){super(...arguments),this.mainView=Object(f.a)(()=>{let e=a.a.createElement(l.SearchBox,{className:"mx-1 w-100",initKey:"",onSearch:this.onSearchMain,placeholder:"\u641c\u7d22"+this.label});return a.a.createElement(l.Page,{header:e,back:"close"},a.a.createElement(l.List,{items:this.controller.PageItems.items,item:{render:this.renderMainRow,onClick:this.clickMainRow},before:"\u641c\u7d22"+this.label+"\u8d44\u6599"}))}),this.onSearchMain=(e=>v(this,void 0,void 0,function*(){yield this.controller.searchMain(e)})),this.renderMainRow=((e,t)=>a.a.createElement(this.mainRowContent,Object.assign({},e))),this.clickMainRow=(e=>v(this,void 0,void 0,function*(){this.ceasePage(),void 0!==this.controller.entity.hasDiv?yield this.showDiv(this.entity.getIdFromObj(e)):this.returnCall(e)})),this.divView=(e=>a.a.createElement(l.Page,{header:"\u9009\u62e9Div"},a.a.createElement(l.List,{items:e.items,item:{render:this.renderDivRow,onClick:this.clickDivRow}}))),this.renderDivRow=((e,t)=>a.a.createElement(this.divRowContent,Object.assign({},e))),this.clickDivRow=(e=>{this.ceasePage(),this.returnCall(e)})}open(e){return v(this,void 0,void 0,function*(){void 0===e?yield this.showMain(e):yield this.showDiv(e)})}showMain(e){return v(this,void 0,void 0,function*(){this.mainRowContent=this.ui.rowContent||m.b,yield this.controller.searchMain(e),this.openPage(this.mainView)})}showDiv(e){return v(this,void 0,void 0,function*(){let{divs:t}=this.ui;void 0!==t&&(this.divRowContent=t[this.entity.name].rowContent),void 0===this.divRowContent&&(this.divRowContent=m.b);let i=yield this.controller.getDivItems(e);this.openPage(this.divView,{items:i})})}}var g=i(12),y=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class b extends r.b{constructor(){super(...arguments),this.next=(()=>y(this,void 0,void 0,function*(){this.vForm.reset(),this.closePage()})),this.finish=(()=>{this.closePage(2)}),this.onSubmit=(()=>y(this,void 0,void 0,function*(){let e=this.vForm.getValues(),t=yield this.entity.save(this.id,e);t&&alert("\u8fd9\u91cc\u8fd8\u8981\u5224\u65ad\u8fd4\u56de\u503c\uff0c\u5148\u4e0d\u5904\u7406\u4e86 \n"+Object(g.b)(t)),this.openPage(()=>o.createElement(l.Page,{header:this.label+"\u63d0\u4ea4\u6210\u529f",back:"none"},o.createElement("div",{className:"m-3"},o.createElement("span",{className:"text-success"},o.createElement(l.FA,{name:"check-circle",size:"lg"})," \u6210\u529f\u63d0\u4ea4\uff01"),o.createElement("div",{className:"mt-5"},o.createElement("button",{className:"btn btn-primary mr-3",onClick:this.next},"\u7ee7\u7eed\u5f55\u5165"),o.createElement("button",{className:"btn btn-outline-primary",onClick:this.finish},"\u4e0d\u7ee7\u7eed")))))})),this.view=(()=>o.createElement(l.Page,{header:this.label},this.vForm.render("py-3")))}buildForm(e){this.vForm=this.createForm(void 0,e)}open(e){return y(this,void 0,void 0,function*(){this.buildForm(e),this.openPage(this.view)})}render(e){return this.buildForm(e),this.vForm.render()}loadId(e){return y(this,void 0,void 0,function*(){this.id=e})}resetForm(){this.vForm.reset()}}class w extends b{}var x=i(10),E=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class k extends x.c{constructor(e){super(!0),this.tuid=e}load(e,t,i){return E(this,void 0,void 0,function*(){return yield this.tuid.search(e,t,i)})}setPageStart(e){this.pageStart=void 0===e?0:e.id}}var C=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class P extends r.b{constructor(){super(...arguments),this.onSearch=(e=>C(this,void 0,void 0,function*(){yield this.controller.searchMain(e)})),this.renderRow=((e,t)=>o.createElement(this.rowContent,Object.assign({},e))),this.clickRow=(e=>{this.callOnSelected(e)}),this.rowKey=(e=>{let{id:t}=e;return t}),this.view=Object(f.a)(()=>{let e=o.createElement(l.SearchBox,{className:"mx-1 w-100",initKey:"",onSearch:this.onSearch,placeholder:"\u641c\u7d22"+this.label});return o.createElement(l.Page,{header:e},o.createElement(l.List,{items:this.controller.PageItems.items,item:{render:this.renderRow,onClick:this.clickRow,key:this.rowKey},before:"\u641c\u7d22"+this.label+"\u8d44\u6599"}))})}open(e){return C(this,void 0,void 0,function*(){this.rowContent=this.ui.rowContent||m.b,this.ownerId=Number(e),yield this.controller.searchMain(""),this.openPage(this.view)})}callOnSelected(e){void 0!==this.onSelected?this.onSelected(e):alert("onSelect is undefined")}}class N extends P{onSelected(e){return C(this,void 0,void 0,function*(){!1===this.controller.isImport?this.event("edit",e.id):this.event("info",e.id)})}}var I=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class S extends r.a{buildPageItems(){return new k(this.entity)}searchMain(e){return I(this,void 0,void 0,function*(){void 0===this.PageItems&&(this.PageItems=this.buildPageItems()),void 0!==e&&(yield this.PageItems.first(e))})}getDivItems(e){return I(this,void 0,void 0,function*(){return yield this.entity.searchArr(e,void 0,0,1e3)})}}class F extends S{from(){return this}cUqFrom(){return this.cUq}cEditFrom(){return this.cUq.cTuidEditFromName(this.entity.name)}cInfoFrom(){return this.cUq.cTuidInfoFromName(this.entity.name)}cSelectFrom(){return this.cUq.cTuidSelectFromName(this.entity.name)}getLable(e){if(e===this.entity)return this.label;let{name:t}=e,{arrs:i}=this.res;if(void 0!==i){let e=i[t];if(void 0!==e){let t=e.label;if(void 0!==t)return t}}return t}get VTuidMain(){return u}get VTuidEdit(){return h}get VTuidList(){return N}internalStart(e){return I(this,void 0,void 0,function*(){this.isImport=this.entity.isImport,yield this.openVPage(this.VTuidMain)})}onEvent(e,t){return I(this,void 0,void 0,function*(){switch(e){default:return;case"new":yield this.onNew();break;case"list":yield this.onList();break;case"edit":return void(yield this.onEdit(t));case"item-changed":return void this.itemChanged(t);case"info":let i=new V(this.cUq,this.entity,this.ui,this.res);return void(yield i.start(t))}})}edit(e){return I(this,void 0,void 0,function*(){let t=this.ui&&this.ui.CTuidEdit;void 0===t?yield this.openVPage(this.VTuidEdit,e):yield new t(this.cUq,this.entity,this.ui,this.res).start(e)})}onNew(){return I(this,void 0,void 0,function*(){yield this.edit(void 0)})}onList(){return I(this,void 0,void 0,function*(){let e=this.ui&&this.ui.CTuidList;void 0===e?yield this.openVPage(this.VTuidList,void 0):yield new e(this.cUq,this.entity,this.ui,this.res).start(void 0)})}onEdit(e){return I(this,void 0,void 0,function*(){let t=void 0;void 0!==e&&(t=yield this.entity.load(e)),this.edit(t)})}itemChanged({id:e,values:t}){if(void 0===this.PageItems)return;let i=this.PageItems.items.find(t=>t.id===e);void 0!==i&&s.a.merge(i,t)}}class T extends F{internalStart(e){return I(this,void 0,void 0,function*(){this.isImport=this.entity.isImport,yield this.openVPage(this.VTuidMain)})}}class O extends F{internalStart(e){return I(this,void 0,void 0,function*(){this.isImport=this.entity.isImport,"number"===typeof e?yield this.onEdit(e):yield this.edit(e)})}edit(e){return I(this,void 0,void 0,function*(){yield this.openVPage(this.VTuidEdit,e)})}}class R extends F{internalStart(e){return I(this,void 0,void 0,function*(){this.isImport=this.entity.isImport,yield this.openVPage(this.VTuidList)})}}class A extends S{internalStart(e){return I(this,void 0,void 0,function*(){yield this.openVPage(this.VTuidSelect,e)})}beforeStart(){return I(this,void 0,void 0,function*(){return yield this.entity.loadSchema(),void 0!==this.PageItems&&this.PageItems.reset(),!0})}get VTuidSelect(){return p}idFromItem(e){return e.id}}class V extends S{internalStart(e){return I(this,void 0,void 0,function*(){let t=yield this.entity.load(e);yield this.openVPage(this.VTuidInfo,t)})}get VTuidInfo(){return w}}i.d(t,"d",function(){return T}),i.d(t,"a",function(){return O}),i.d(t,"c",function(){return R}),i.d(t,"e",function(){return A}),i.d(t,"b",function(){return V})},function(e,t,i){"use strict";i.d(t,"a",function(){return o}),i.d(t,"b",function(){return a});var n=i(20),s=i(15),r=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class o extends n.a{get typeName(){return"action"}submit(e){return r(this,void 0,void 0,function*(){return yield new a(this,e).request()})}submitReturns(e){return r(this,void 0,void 0,function*(){return yield new l(this,e).request()})}}class a extends s.a{get path(){return"action/"+this.entity.name}buildParams(){return{data:this.entity.pack(this.params)}}}class l extends a{get path(){return"action/"+this.entity.name+"/returns"}xresult(e){let{returns:t}=this.entity,i=t.length,n={};for(let s=0;s<i;s++){n[t[s].name]=e[s]}return n}}},function(e,t,i){"use strict";var n=i(0),s=i.n(n),r=i(5);class o{constructor(e){this.view=(()=>n.createElement("div",null)),this.label=e}render(){return n.createElement("div",{key:this.key,className:"px-3"},n.createElement("div",{className:"form-group row"},n.createElement("label",{className:"col-sm-2 col-form-label"},this.label),n.createElement("div",{className:"col-sm-10"},this.renderContent())))}setAddRow(e){}get key(){return this.label}getVFields(){}getVArr(){}getVSubmit(){}renderContent(){return n.createElement("div",{className:"form-control form-control-plaintext bg-white border border-info rounded "},"content")}}class a extends o{constructor(e,t){super(e),this.vField=t}get key(){return this.vField.name}getVFields(){return[this.vField]}renderContent(){return this.vField.render()}}class l extends o{constructor(e,t){super(e),this.vArr=t}setAddRow(e){this.vArr.setAddRow(e)}get key(){return this.vArr.name}getVArr(){return this.vArr}render(){return n.createElement(n.Fragment,{key:this.key},this.vArr&&this.vArr.render())}}class c extends o{constructor(e){super(void 0),this.vSubmit=e}get key(){return"$submit"}getVSubmit(){return this.vSubmit}render(){return n.createElement("div",{key:"$submit",className:"px-3"},n.createElement("div",{className:"form-group row"},n.createElement("div",{className:"offset-sm-2 col-sm-10"},this.vSubmit.render())))}}var u=i(16),d=i(2),h=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o},m=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class f extends u.c{constructor(e){super(),this.onClickSubmit=(()=>m(this,void 0,void 0,function*(){this.vForm.submit()})),this.view=Object(r.a)(()=>{let{isOk:e}=this.vForm;return n.createElement("button",{type:"button",onClick:this.onClickSubmit,className:this.className,disabled:!1===e},this.caption)}),this.vForm=e,this.caption=this.vForm.submitCaption,this.className="btn btn-primary w-25"}}h([d.l],f.prototype,"caption",void 0),h([d.l],f.prototype,"className",void 0);var v=i(4),p=i.n(v),g=i(1);class y{}class b extends y{check(e,t){switch(typeof t){default:case"boolean":return;case"object":if(null!==t)return;break;case"string":if(t.trim().length>0)return;break;case"number":if(!0===isNaN(t))return;break;case"undefined":}e.push("\u4e0d\u80fd\u4e3a\u7a7a")}}class w extends y{check(e,t){if(void 0===t||null===t)return;let i=Number(t);!0===isNaN(i)&&e.push("\u5fc5\u987b\u662f\u6570\u5b57")}}class x extends y{check(e,t){if(void 0===t||null===t)return;let i=Number(t);!0!==Number.isNaN(i)&&!1!==Number.isInteger(i)||e.push("\u5fc5\u987b\u662f\u6574\u6570")}}class E extends w{constructor(e){super(),this.min=e}check(e,t){super.check(e,t),Number(t)<this.min&&e.push("\u4e0d\u80fd\u5c0f\u4e8e"+this.min)}}class k extends w{constructor(e){super(),this.max=e}check(e,t){super.check(e,t),Number(t)>this.max&&e.push("\u4e0d\u80fd\u5c0f\u4e8e"+this.max)}}var C=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};class P extends u.c{constructor(e,t,i,n){super(),this.form=e,this.field=t,this.name=t.name,this.fieldUI=i||{},this.fieldRes=n||{},this.init()}init(){this.buildRules()}buildRules(){this.rules=[];let{required:e}=this.fieldUI;(!0===e||void 0!==this.field&&!1===this.field.null)&&this.rules.push(new b)}get checkRules(){let e=[];for(let t of this.rules)t.check(e,this.value);return e}get isOk(){if(0===this.rules.length)return!0;return 0===this.checkRules.length}get value(){return this.form.values[this.name]}setValue(e){this.form.values[this.name]=e}get error(){return this.form.errors[this.name]}set error(e){this.form.errors[this.name]=e}parse(e){return e}get readonly(){let{mode:e}=this.form;return e===G.readonly||e===G.edit&&!1===this.fieldUI.editable}}C([d.e],P.prototype,"checkRules",null),C([d.e],P.prototype,"isOk",null),C([d.e],P.prototype,"value",null);class N extends P{constructor(){super(...arguments),this.renderError=(e=>{let{errors:t}=this.form,i=t[this.name];if(void 0!==i)return n.createElement("div",{className:e},n.createElement(g.FA,{name:"exclamation-circle"})," ",i)}),this.ref=(e=>{this.input=e,this.setInputValue()}),this.onFocus=(()=>{this.error=void 0}),this.onBlur=(()=>{let e=this.checkRules;e.length>0&&(this.error=e[0]),this.form.computeFields()}),this.onChange=(e=>{let t=this.parse(e.currentTarget.value);null!==t&&this.setValue(t)}),this.view=Object(r.a)(()=>{let e,t,i,{required:s}=this.fieldUI,{placeHolder:r,suffix:o}=this.fieldRes,a=["form-control","form-control-input"];return!0===this.readonly?t=n.createElement("input",{className:p()(a,"bg-light"),ref:this.ref,type:this.inputType,readOnly:!0}):(t=n.createElement("input",{className:p()(a),ref:this.ref,type:this.inputType,onFocus:this.onFocus,onBlur:this.onBlur,onChange:this.onChange,placeholder:r,readOnly:!1,maxLength:this.maxLength,onKeyPress:this.onKeyPress}),!0!==s&&!1!==this.field.null||(e=n.createElement(I,null))),i=void 0===o?t:n.createElement("div",{className:"input-group"},t,n.createElement("div",{className:"input-group-append"},n.createElement("span",{className:"input-group-text"},o))),n.createElement(n.Fragment,null,e,i,this.renderError("text-danger small mt-1 mx-2"))})}get maxLength(){}setValue(e){super.setValue(e),this.setInputValue()}setInputValue(){if(!this.input)return;let e=this.value;this.input.value=null===e||void 0===e?"":e}}const I=()=>n.createElement("b",{style:{color:"red",position:"absolute",left:"0.1em",top:"0.5em"}},"*");class S extends N{constructor(){super(...arguments),this.inputType="text"}get maxLength(){return this.field.size}}const F=45,T=46;class O extends N{constructor(){super(...arguments),this.inputType="number",this.onKeyPress=(e=>{let t=e.charCode;if(!(8===t||0===t||13===t||t>=48&&t<=57))if(void 0!==this.extraChars&&this.extraChars.indexOf(t)>=0)switch(t){case T:this.onKeyDot();break;case F:this.onKeyNeg(),e.preventDefault()}else e.preventDefault()})}init(){if(super.init(),this.extraChars=[],void 0!==this.fieldUI){let{min:e,max:t}=this.fieldUI;void 0!==e?e<0&&this.extraChars.push(F):this.extraChars.push(F)}switch(this.field.type){case"dec":case"bigint":case"int":case"smallint":case"tinyint":this.extraChars.push(T)}}buildRules(){super.buildRules(),this.rules.push(new w);let{min:e,max:t}=this.fieldUI;void 0!==e&&this.rules.push(new E(e)),void 0!==t&&this.rules.push(new k(t))}parse(e){try{if(0===e.trim().length)return;let i=Number(e);return!0===isNaN(i)?null:i}catch(t){return null}}setInputValue(){if(!this.input)return;let e=this.value;this.parse(this.input.value)!==e&&(this.input.value=null===e||void 0===e?"":e)}onKeyDot(){let e=this.input.value;e.indexOf(".")>=0&&(this.input.value=e.replace(".",""))}onKeyNeg(){let e=this.input.value,t=e.indexOf("-");e=t>=0?e.replace("-",""):"-"+e,this.input.value=e}}class R extends O{buildRules(){super.buildRules(),this.rules.push(new x)}}class A extends O{}class V extends S{}class q extends S{}class j extends S{}class U extends P{constructor(e,t,i){super(e,t,void 0,i),this.view=Object(r.a)(()=>{let e=this.form.values[this.field.name],{placeHolder:t,suffix:i}=this.fieldRes;null===e&&(e="");let n,r=s.a.createElement("input",{className:"form-control form-control-input bg-light",type:"text",placeholder:t,readOnly:!0,value:e});return n=void 0===i?r:s.a.createElement("div",{className:"input-group"},r,s.a.createElement("div",{className:"input-group-append"},s.a.createElement("span",{className:"input-group-text"},i)))})}}var L=i(8),M=i.n(L),D=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class B extends u.c{constructor(e,t,i){super(),this.rowPage=(()=>n.createElement(g.Page,{header:this.label,back:"close"},this.vForm.render("py-3"))),this.onSubmit=(()=>D(this,void 0,void 0,function*(){let{valueBoxs:e}=this.vForm;yield this.onRowChanged(e)})),this.onRowChanged=(e=>D(this,void 0,void 0,function*(){void 0===this.rowValues?(e.$owner=this.ownerForm.values,this.list.push(e),void 0===this.onEditRow?this.vForm.reset():yield this.onEditRow(void 0,this.onRowChanged)):(M.a.merge(this.rowValues,e),void 0===this.onEditRow&&g.nav.pop())})),this.renderItem=((e,t)=>void 0===this.rowContent?n.createElement("div",{className:"px-3 py-2"},n.createElement(u.a,Object.assign({},e))):n.createElement(this.rowContent,Object.assign({},e))),this.showRow=(e=>D(this,void 0,void 0,function*(){void 0===this.onEditRow?(this.vForm.reset(),void 0!==e&&this.vForm.setValues(e),g.nav.push(n.createElement(this.rowPage,null))):yield this.onEditRow(e,this.onRowChanged)})),this.editRow=(e=>D(this,void 0,void 0,function*(){this.rowValues=e;let{vSubmit:t}=this.vForm;void 0!==t&&(t.caption=this.editSubmitCaption,t.className="btn btn-outline-success"),this.vForm.mode=this.ownerForm.mode,yield this.showRow(e)})),this.internalAddRow=(()=>D(this,void 0,void 0,function*(){this.rowValues=void 0;let{vSubmit:e}=this.vForm;e.caption=this.newSubmitCaption,e.className="btn btn-outline-success",this.vForm.reset(),this.vForm.mode=G.new,yield this.showRow(void 0)})),this.view=(()=>{let e;void 0===this.addRow&&this.mode===G.readonly||(e=n.createElement("button",{onClick:this.addRow||this.internalAddRow,type:"button",className:"btn btn-link p-0"},this.ownerForm.arrTitleNewButton));let t=this.header||n.createElement("div",{className:"px-3 bg-light small",style:{paddingTop:"1px",paddingBottom:"1px"}},n.createElement("div",{className:"flex-fill align-self-center"},this.label),e);return n.createElement(g.List,{className:"pb-3",header:t,none:n.createElement(g.Muted,{className:"px-3 py-2"},this.none),items:this.list,item:{render:this.renderItem,onClick:this.editRow}})}),this.ownerForm=e;let{name:s,fields:r}=t;this.name=s;let{ui:o,res:a,mode:l,inputs:c,values:d}=e,h=a.arrs,m=void 0!==h?h[s]:{},{label:f,none:v,newSubmit:p,editSubmit:y}=m;this.none=v||e.none,this.newSubmitCaption=p||e.arrNewCaption,this.editSubmitCaption=y||e.arrEditCaption,this.label=f||s;let b=o&&o.items[s]||{};this.rowContent=b.rowContent,this.mode=l,void 0===this.onEditRow?this.vForm=new J({fields:r,arrs:void 0,ui:b,res:m,inputs:c[s],none:e.none,submitCaption:"submit",arrNewCaption:void 0,arrEditCaption:void 0,arrTitleNewButton:void 0,mode:l},l===G.readonly?void 0:this.onSubmit):this.onEditRow=i,this.list=d[s]}reset(){this.vForm.reset(),this.list.clear()}setAddRow(e){this.addRow=e}}var _=i(30),$=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};const H={textAlign:"left",paddingLeft:"0.75rem",paddingRight:"0.75rem",overflow:"hidden"};class W extends P{constructor(e,t,i,s){super(e,t,i,s),this.onClick=(()=>$(this,void 0,void 0,function*(){if(!0===this.readonly){if(!this.value)return;return void(yield this.tuid.showInfo())}let e;void 0!==this.input?e=yield this.input.select(this.vForm,this.field,this.vForm.getValues()):(alert("call undefined"),e=0),this.setValue(this.tuid.boxId(e))})),this.view=Object(r.a)(()=>{let e,{placeHolder:t}=this.fieldRes,i=!1,{_tuid:s}=this.field,{ownerField:r}=s;if(void 0!==r){let{name:e}=r;i=null===this.vForm.getValue(e)}if(null===this.value)e=n.createElement(n.Fragment,null,t||this.input.placeHolder);else if("object"===typeof this.value)e=Object(_.c)(this.value);else{let t=this.tuid.boxId(this.value);e=Object(_.c)(t)}if(!0===this.readonly)return n.createElement("div",{className:"form-control form-control-plaintext border border-info rounded bg-light cursor-pointer",onClick:this.onClick},e);let{required:o}=this.fieldUI,a=(!0===o||!1===this.field.null)&&n.createElement(I,null);return n.createElement(n.Fragment,null,a,n.createElement("button",{className:"form-control btn btn-outline-info",type:"button",disabled:i,style:H,onClick:this.onClick},e))}),this.tuid=t._tuid,this.vForm=e,this.input=e.inputs[t.name]}}class z{constructor(e,t,i){this.vForm=e,this.onSubmit=i;let{fields:n,arrs:s,ui:r,res:o}=t;if(this.fields=n,this.arrs=s,void 0!==r){let{items:e,layout:t}=r;this.formItems=e,this.layout=t}this.res=o}build(){return void 0===this.layout?this.bandsOnFly():this.bandsFromLayout()}resFromName(e,t){if(void 0===t)return;let{fields:i}=t;return void 0!==i?i[e]||e:void 0}bandsOnFly(){let e=[];if(this.bandsFromFields(e,this.fields,this.res),void 0!==this.arrs)for(let t of this.arrs)e.push(this.bandFromArr(t));return void 0!==this.onSubmit&&e.push(new c(new f(this.vForm))),e}bandsFromFields(e,t,i){if(void 0!==t)for(let n of t)e.push(this.bandFromField(n,i))}bandsFromLayout(){return[]}bandFromField(e,t){let i,n,s,r,{name:o}=e,l=this.resFromName(o,t);return"object"===typeof l?(n=l.label,i=l):(n=l,i=void 0),void 0!==this.formItems&&(r=this.formItems[o]),void 0===(s="function"===typeof r?new U(this.vForm,e,i):function(e,t,i,n){let s;switch(t.type){default:return;case"tinyint":case"smallint":case"int":case"bigint":s=R;break;case"id":let{_tuid:e}=t;if(void 0!==e)return;s=R;break;case"dec":s=A;break;case"char":s=S;break;case"text":s=V;break;case"datetime":s=q;break;case"date":s=j}return new s(e,t,i,n)}(this.vForm,e,r,i))&&(s=new W(this.vForm,e,r,i)),new a(n||o,s)}bandFromArr(e){let{name:t}=e,i=new B(this.vForm,e);return new l(t,i)}}var G,Q=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o},K=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};!function(e){e[e.new=0]="new",e[e.edit=1]="edit",e[e.readonly=2]="readonly"}(G||(G={}));class J{constructor(e,t){this.vFields={},this.vArrs={},this.onFormSubmit=(e=>(e.preventDefault(),!1)),this.view=Object(r.a)(({className:e})=>n.createElement("form",{className:e,onSubmit:this.onFormSubmit},this.bands.map(e=>e.render())));let{fields:i,arrs:s,ui:o,res:a,inputs:l,none:c,submitCaption:u,arrNewCaption:d,arrEditCaption:h,arrTitleNewButton:m,mode:f}=e;this.fields=i,this.arrs=s,this.ui=o,void 0!==this.ui&&(this.formItems=this.ui.items),this.res=a,this.inputs=l,this.none=c,this.submitCaption=u,this.arrNewCaption=d,this.arrEditCaption=h,this.arrTitleNewButton=m||n.createElement("small",null,n.createElement(g.FA,{name:"plus"})," \u65b0\u589e"),this.mode=void 0===t?G.readonly:f,this.buildFormValues(),this.buildBands(e,t),this.onSubmit=t}buildBands(e,t){this.bandColl={};let i=new z(this,e,t);this.bands=i.build();for(let n of this.bands){this.bandColl[n.key]=n;let e=n.getVFields();if(void 0!==e)for(let n of e)this.vFields[n.name]=n;let t=n.getVArr();void 0!==t&&(this.vArrs[t.name]=t);let i=n.getVSubmit();void 0!==i&&(this.vSubmit=i)}}getBand(e){return this.bandColl[e]}computeFields(){if(void 0===this.formItems)return;let e=this.values;for(let t in this.formItems){let i=this.formItems[t];"function"===typeof i&&(e[t]=i.call(this,e))}}submit(){return K(this,void 0,void 0,function*(){void 0!==this.onSubmit&&(yield this.onSubmit())})}getValues(){let e={},t=this.values;for(let i of this.fields){let{name:n}=i,s=t[n];e[n]=null!==s&&"object"===typeof s?s.id:s}if(void 0!==this.arrs)for(let i of this.arrs){let{name:t,fields:n,id:s,order:r}=i,o=e[t]=[],a=this.vArrs[t].list;for(let e of a){let t={};void 0!==s&&(t[s]=e[s]),void 0!==r&&(t[r]=e[r]);for(let i of n){let{name:n}=i,s=e[n];t[n]=null!==s&&"object"===typeof s?s.id:s}o.push(t)}}return e}get valueBoxs(){let e={},t=this.values;for(let i of this.fields){let{name:n,_tuid:s}=i,r=t[n];e[n]=void 0===s||"object"===typeof r?r:s.boxId(r)}if(void 0===this.arrs)return e;for(let i of this.arrs){let{name:t,fields:n}=i,s=e[t]=this.vArrs[t].list.slice();for(let e of s)for(let t of n){let{name:i,_tuid:n}=t,s=e[i];e[i]=void 0===n||"object"===typeof s?s:n.boxId(s)}}return e}setValues(e){if(void 0===e)return void this.reset();let t=this.values,i=this.errors;for(let n of this.fields){let s=n.name;i[s]=void 0;let r=e[s];t[s]=r}for(let n in this.vArrs){let i=e[n];if(void 0===i)continue;let s=t[n];s.clear(),s.push(...i)}}get isOk(){for(let e in this.vFields)if(!1===this.vFields[e].isOk)return!1;return!0}reset(){let e=this.values,t=this.errors;for(let i of this.fields){let n=i.name;e[n]=null,t[n]=void 0}for(let i in this.vFields){let e=this.vFields[i];void 0!==e.name&&e.setValue(null)}for(let i in this.vArrs){this.vArrs[i].reset()}}getValue(e){return this.values[e]}setValue(e,t){this.values[e]=t}setError(e,t){this.errors[e]=t}buildFieldValues(e){let t={valueFromFieldName:function(e){return this[e]}};for(let i of e){t[i.name]=null}return t}buildObservableValues(){let e=this.buildFieldValues(this.fields);if(void 0!==this.arrs)for(let t of this.arrs)e[t.name]=d.l.array([],{deep:!0});return Object(d.l)(e)}buildFormValues(){this.values=this.buildObservableValues(),this.errors=Object(d.l)(this.buildFieldValues(this.fields))}render(e="py-3"){return n.createElement(this.view,{className:e})}}Q([d.e],J.prototype,"isOk",null),i.d(t,"a",function(){return G}),i.d(t,"b",function(){return J})},,,function(e,t,i){"use strict";var n=i(8),s=i.n(n),r=i(20),o=i(15),a=i(2),l=i(114),c=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};const u=1e3;class d{constructor(e){this.queue=[],this.cache=a.l.map({},{deep:!1}),this.waitingIds=[],this.divName=void 0,this.tuidInner=e,this.initLocalArr()}initLocalArr(){this.localArr=this.tuidInner.cache.arr(this.tuidInner.name+".ids")}useId(e,t){if(void 0!==e&&0!==e&&!1!==Object(l.isNumber)(e))if(!0!==this.cache.has(e))if(this.tuidInner.cacheTuids(!0===t?70:20),this.cache.set(e,e),this.waitingIds.findIndex(t=>t===e)>=0)this.moveToHead(e);else{if(this.queue.length>=u){let t=this.queue.shift();if(t===e)return void this.queue.push(t);if(!0===this.cache.has(t))this.cache.delete(t);else{let e=this.waitingIds.findIndex(e=>e===t);this.waitingIds.splice(e,1)}}this.waitingIds.push(e),this.queue.push(e)}else this.moveToHead(e)}moveToHead(e){let t=this.queue.findIndex(t=>t===e);this.queue.splice(t,1),this.queue.push(e)}getValue(e){return this.cache.get(e)}remove(e){this.cache.delete(e);let t=this.queue.findIndex(t=>t===e);this.queue.splice(t,1)}valueFromId(e){let t;switch(typeof e){case"object":t=e.id;break;case"number":t=e;break;default:return}return this.getValue(t)}resetCache(e){this.remove(e),this.useId(e)}cacheValue(e){if(void 0===e)return!1;let t=this.getIdFromObj(e);if(void 0===t)return!1;let i=this.waitingIds.findIndex(e=>e===t);return i>=0&&this.waitingIds.splice(i,1),this.cache.set(t,e),!0}getIdFromObj(e){return this.tuidInner.getIdFromObj(e)}cacheIds(){return c(this,void 0,void 0,function*(){if(0===this.waitingIds.length)return;let e=yield this.loadIds();yield this.cacheIdValues(e)})}cacheIdValues(e){return c(this,void 0,void 0,function*(){if(void 0===e)return;let t=this.unpackTuidIds(e);for(let e of t)!1!==this.cacheValue(e)&&this.cacheTuidFieldValues(e)})}modifyIds(e){return c(this,void 0,void 0,function*(){let t=(yield this.loadTuidIdsOrLocal(e)).filter(e=>{let t=e.indexOf("\t");t<0&&(t=e.length);let i=Number(e.substr(0,t));return void 0!==this.localArr.getItem(i)});0!==t.length&&(yield this.cacheIdValues(t))})}loadIds(){return c(this,void 0,void 0,function*(){return yield this.loadTuidIdsOrLocal(this.waitingIds)})}unpackTuidIds(e){return this.tuidInner.unpackTuidIds(e)}cacheTuidFieldValues(e){this.tuidInner.cacheTuidFieldValues(e)}assureObj(e){return c(this,void 0,void 0,function*(){switch(typeof this.cache.get(e)){case"object":return;case"number":this.cache.set(e,e)}let t=yield this.loadTuidIdsOrLocal([e]);yield this.cacheIdValues(t)})}loadTuidIdsOrLocal(e){return c(this,void 0,void 0,function*(){let t=[],i=[];for(let s of e){let e=this.localArr.getItem(s);void 0===e?i.push(s):t.push(e)}let n=i.length;if(n>0){let e=yield this.tuidInner.loadTuidIds(this.divName,i);for(let r=0;r<n;r++){let n=e[r];if(!n)continue;let o=n.indexOf("\t");o<0&&(o=n.length);let a=Number(n.substr(0,o));s.a.remove(i,e=>e===a),t.push(n),this.localArr.setItem(a,n)}n=i.length;for(let t=0;t<n;t++)this.localArr.setItem(i[t],"")}return t})}}class h extends d{constructor(e,t){super(e),this.div=t,this.divName=t.name,this.localArr=e.cache.arr(e.name+".ids."+this.divName)}initLocalArr(){}getIdFromObj(e){return this.div.getIdFromObj(e)}unpackTuidIds(e){return this.div.unpackTuidIds(e)}cacheTuidFieldValues(e){this.div.cacheTuidFieldValues(e)}}i.d(t,"b",function(){return v}),i.d(t,"a",function(){return P});var m=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class f extends r.a{constructor(){super(...arguments),this.typeName="tuid",this.isImport=!1}setSchema(e){super.setSchema(e);let{id:t}=e;this.idName=t}buildTuidBox(){return new N(this)}getIdFromObj(e){return e[this.idName]}cacheIds(){}modifyIds(e){return m(this,void 0,void 0,function*(){})}}class v extends f{constructor(e,t,i){super(e,t,i),this.idCache=new d(this),this.localArr=this.cache.arr(this.name+".whole"),!0===e.newVersion&&this.localArr.removeAll()}setSchema(e){super.setSchema(e);let{arrs:t}=e;if(void 0!==t){this.divs={};for(let e of t){let{name:t}=e,i=new I(this.uq,this,t);this.divs[t]=i,i.setSchema(e),i.buildFieldsTuid()}}}useId(e,t){this.idCache.useId(e,t)}boxId(e){if("object"===typeof e)return e;this.useId(e);let{createBoxId:t}=this.uq;return t?t(this,e):{id:e}}valueFromId(e){return this.idCache.getValue(e)}assureBox(e){return m(this,void 0,void 0,function*(){yield this.idCache.assureObj(e)})}cacheIds(){if(this.idCache.cacheIds(),void 0!==this.divs)for(let e in this.divs)this.divs[e].cacheIds()}modifyIds(e){return m(this,void 0,void 0,function*(){yield this.idCache.modifyIds(e)})}cacheTuids(e){this.uq.cacheTuids(e)}get hasDiv(){return void 0!==this.divs}div(e){return this.divs&&this.divs[e]}loadTuidIds(e,t){return m(this,void 0,void 0,function*(){let i=yield new y(this,{divName:e,ids:t}).request();return i.length>0&&(this.cached=!0),i})}loadMain(e){return m(this,void 0,void 0,function*(){return"object"===typeof e&&(e=e.id),yield this.idCache.assureObj(e),this.idCache.valueFromId(e)})}load(e){return m(this,void 0,void 0,function*(){if(void 0===e||0===e)return;"object"===typeof e&&(e=e.id);let t,i=this.localArr.getItem(e);if(i?t=JSON.parse(i):void 0!==(t=yield new g(this,e).request())&&this.localArr.setItem(e,JSON.stringify(t)),void 0!==t){for(let e of this.schema.fields){let{tuid:i}=e;if(void 0===i)continue;let n=this.uq.getTuid(i);if(void 0===n)continue;let s=e.name;t[s]=n.boxId(t[s])}return this.idCache.cacheValue(t),this.cacheTuidFieldValues(t),t}})}cacheTuidFieldValues(e){let{fields:t,arrs:i}=this.schema;if(this.cacheFieldsInValue(e,t),void 0!==i)for(let n of i){let{name:t,fields:i}=n,s=e[t];if(void 0===s)continue;let r=this.div(t);for(let e of s)r.cacheValue(e),this.cacheFieldsInValue(e,i)}}buildFieldsTuid(){super.buildFieldsTuid();let{mainFields:e}=this.schema;this.uq.buildFieldTuid(this.cacheFields=e||this.fields)}unpackTuidIds(e){return this.unpackTuidIdsOfFields(e,this.cacheFields)}save(e,t){return m(this,void 0,void 0,function*(){let i=new b(this,{id:e,props:t}).request();return void 0!==e&&(this.idCache.remove(e),this.localArr.removeItem(e)),i})}all(){return m(this,void 0,void 0,function*(){return yield new x(this,{}).request()})}search(e,t,i){return m(this,void 0,void 0,function*(){return yield this.searchArr(void 0,e,t,i)})}searchArr(e,t,i,n){return m(this,void 0,void 0,function*(){let s={arr:void 0,owner:e,key:t,pageStart:i,pageSize:n},r=yield new w(this,s).request(),{fields:o}=this.schema;for(let e of r)this.cacheFieldsInValue(e,o);return r})}loadArr(e,t,i){return m(this,void 0,void 0,function*(){if(void 0!==i&&0!==i)return yield new E(this,{arr:e,owner:t,id:i}).request()})}saveArr(e,t,i,n){return m(this,void 0,void 0,function*(){return yield new k(this,{arr:e,owner:t,id:i,props:n}).request()})}posArr(e,t,i,n){return m(this,void 0,void 0,function*(){return yield new C(this,{arr:e,owner:t,id:i,order:n}).request()})}}class p extends o.b{get entity(){return this._entity}}class g extends p{constructor(){super(...arguments),this.method="GET"}get path(){return`tuid/${this.entity.name}/${this.params}`}}class y extends p{get path(){let{divName:e}=this.params;return`tuidids/${this.entity.name}/${void 0!==e?e:"$"}`}buildParams(){return this.params.ids}xresult(e){return e.split("\n")}}class b extends p{get path(){return`tuid/${this.entity.name}`}buildParams(){let{fields:e,arrs:t}=this.entity.schema,{id:i,props:n}=this.params,s={$id:i};if(this.transParams(s,n,e),void 0!==t)for(let r of t){let e=r.name,t=[],i=r.fields,o=n[e];if(void 0!==o)for(let n of o){let e={};this.transParams(e,n,i),t.push(e)}s[e]=t}return s}transParams(e,t,i){if(void 0!==t)for(let n of i){let{name:i,tuid:s,type:r}=n,o=t[i];if(void 0!==s)"object"===typeof o&&null!==o&&(o=o.id);else switch(r){case"date":o=this.entity.buildDateParam(o);break;case"datetime":o=this.entity.buildDateTimeParam(o)}e[i]=o}}}class w extends p{get path(){return`tuids/${this.entity.name}`}}class x extends p{constructor(){super(...arguments),this.method="GET"}get path(){return`tuid-all/${this.entity.name}`}}class E extends p{constructor(){super(...arguments),this.method="GET"}get path(){let{arr:e,owner:t,id:i}=this.params;return`tuid-arr/${this.entity.name}/${t}/${e}/${i}`}}class k extends p{get path(){let{arr:e,owner:t}=this.params;return`tuid-arr/${this.entity.name}/${t}/${e}/`}buildParams(){let{id:e,props:t}=this.params,i=s.a.clone(t);return i.$id=e,i}}class C extends p{get path(){let{arr:e,owner:t}=this.params;return`tuid-arr-pos/${this.entity.name}/${t}/${e}/`}buildParams(){let{id:e,order:t}=this.params;return{bid:e,$order:t}}}class P extends f{constructor(e,t,i,n){super(e,t,i),this.isImport=!0,this.from=n}setFrom(e){this.tuidLocal=e}useId(e){this.tuidLocal.useId(e)}boxId(e){return this.tuidLocal.boxId(e)}valueFromId(e){return this.tuidLocal.valueFromId(e)}assureBox(e){return m(this,void 0,void 0,function*(){yield this.tuidLocal.assureBox(e)})}get hasDiv(){return this.tuidLocal.hasDiv}div(e){return this.tuidLocal.div(e)}loadMain(e){return m(this,void 0,void 0,function*(){return yield this.tuidLocal.loadMain(e)})}load(e){return m(this,void 0,void 0,function*(){return yield this.tuidLocal.load(e)})}save(e,t){return m(this,void 0,void 0,function*(){return yield this.tuidLocal.save(e,t)})}all(){return m(this,void 0,void 0,function*(){return yield this.tuidLocal.all()})}search(e,t,i){return m(this,void 0,void 0,function*(){return yield this.tuidLocal.search(e,t,i)})}searchArr(e,t,i,n){return m(this,void 0,void 0,function*(){return yield this.tuidLocal.searchArr(e,t,i,n)})}loadArr(e,t,i){return m(this,void 0,void 0,function*(){return yield this.tuidLocal.loadArr(e,t,i)})}saveArr(e,t,i,n){return m(this,void 0,void 0,function*(){yield this.tuidLocal.saveArr(e,t,i,n)})}posArr(e,t,i,n){return m(this,void 0,void 0,function*(){yield this.tuidLocal.posArr(e,t,i,n)})}}class N{constructor(e){this.ownerField=void 0,this.tuid=e}boxId(e){return this.tuid.boxId(e)}getIdFromObj(e){return this.tuid.getIdFromObj(e)}useId(e){return this.tuid.useId(e)}showInfo(){return m(this,void 0,void 0,function*(){alert("showInfo not implemented")})}}class I extends v{constructor(e,t,i){super(e,i,0),this.typeName="div",this.tuid=t,this.idName="id",this.idCache=new h(t,this)}get owner(){return this.tuid}buildFieldsTuid(){super.buildFieldsTuid();let{mainFields:e}=this.schema;this.uq.buildFieldTuid(this.cacheFields=e)}buildTuidDivBox(e){return new S(this.tuid,this,e)}getIdFromObj(e){return e[this.idName]}cacheValue(e){this.idCache.cacheValue(e)}useId(e,t){this.idCache.useId(e,t)}valueFromId(e){return this.idCache.getValue(e)}assureBox(e){return m(this,void 0,void 0,function*(){yield this.idCache.assureObj(e)})}cacheIds(){return m(this,void 0,void 0,function*(){yield this.idCache.cacheIds()})}cacheTuidFieldValues(e){let t=this.schema.fields;this.cacheFieldsInValue(e,t)}unpackTuidIds(e){return this.unpackTuidIdsOfFields(e,this.cacheFields)}}class S extends N{constructor(e,t,i){super(e),this.div=t,this.ownerField=i}boxId(e){return this.div.boxId(e)}getIdFromObj(e){return this.div.getIdFromObj(e)}useId(e){return this.div.useId(e)}}},function(e,t,i){"use strict";i.d(t,"b",function(){return r}),i.d(t,"a",function(){return o});var n=i(8),s=i.n(n);const r={lang:void 0,district:void 0};function o(e){let{lang:t,district:i}=r,n={};if(void 0===e)return n;s.a.merge(n,e._);let o=e[t];if(void 0===o)return n;s.a.merge(n,o._);let a=o[i];if(void 0===a)return n;s.a.merge(n,a);let{entity:l}=n;if(void 0!==l)for(let s in l)l[s.toLowerCase()]=l[s];return n}!function(){let e,t,i=navigator.languages&&navigator.languages[0]||navigator.language;if(i){let n=i.split("-");e=n[0],n.length>1&&(t=n[1])}else e="zh",t="CN";!function(e,t){r.lang=e,r.district=t}(e,t)}()},function(e,t,i){"use strict";var n=i(90);i.o(n,"Badge")&&i.d(t,"Badge",function(){return n.Badge}),i.o(n,"Controller")&&i.d(t,"Controller",function(){return n.Controller}),i.o(n,"EasyDate")&&i.d(t,"EasyDate",function(){return n.EasyDate}),i.o(n,"FA")&&i.d(t,"FA",function(){return n.FA}),i.o(n,"Form")&&i.d(t,"Form",function(){return n.Form}),i.o(n,"IconText")&&i.d(t,"IconText",function(){return n.IconText}),i.o(n,"Image")&&i.d(t,"Image",function(){return n.Image}),i.o(n,"LMR")&&i.d(t,"LMR",function(){return n.LMR}),i.o(n,"List")&&i.d(t,"List",function(){return n.List}),i.o(n,"NavView")&&i.d(t,"NavView",function(){return n.NavView}),i.o(n,"Page")&&i.d(t,"Page",function(){return n.Page}),i.o(n,"PropGrid")&&i.d(t,"PropGrid",function(){return n.PropGrid}),i.o(n,"UQsMan")&&i.d(t,"UQsMan",function(){return n.UQsMan}),i.o(n,"VPage")&&i.d(t,"VPage",function(){return n.VPage}),i.o(n,"View")&&i.d(t,"View",function(){return n.View}),i.o(n,"nav")&&i.d(t,"nav",function(){return n.nav});var s=i(36);i.d(t,"TuidImport",function(){return s.a}),i.d(t,"TuidInner",function(){return s.b});var r=i(92);i.d(t,"TuidsCache",function(){return r.a});i(39)},function(e,t,i){"use strict";i.d(t,"a",function(){return a});var n=i(0),s=i(5),r=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};const o=(e,t,i)=>n.createElement(n.Fragment,null,e,": ",function(e){let t="{";if(void 0===e)return"undefined";for(let i in e){let n=e[i];if(t+=i+": ",void 0===n)t+="undefined";else if(null===n)t+="null";else switch(typeof n){default:t+=n;break;case"function":t+="function";break;case"object":t+="{obj}"}t+=", "}return t+"}"}(t));class a{constructor(e,t,i){this.id=e,this.tuid=t,this.ui=i,this.isUndefined=void 0===this.tuid}get obj(){return this.tuid.valueFromId(this.id)}render(e,t){if(void 0===this.id||null===this.id)return;let i=this.boxName,s=this.obj;if(!0===this.isUndefined)return void 0!==e?e(s,t):o(i,s,t);switch(typeof s){case"undefined":return n.createElement("del",{className:"text-black-50"},i," undefined");case"number":return n.createElement("del",{className:"text-black-50"},i," ",this.id)}if(void 0===e&&(e=this.ui),void 0!==e&&("function"!==typeof e&&(e=e.content),void 0!==e)){let t=e(s);return void 0!==t?t:n.createElement("del",{className:"text-danger"},i," ",this.id)}return o(i,s)}get boxName(){return this.tuid.name}assure(){return r(this,void 0,void 0,function*(){yield this.tuid.assureBox(this.id)})}}Object(s.a)(({tuidValue:e,ui:t,x:i,nullUI:s})=>{if(void 0===e)return void 0===s?n.createElement(n.Fragment,null,"[undefined]"):s();if(null===e)return void 0===s?n.createElement(n.Fragment,null,"[null]"):s();let r=typeof e;switch(r){default:if(void 0===t)return n.createElement(n.Fragment,null,r,"-",e);{let s=t(e,i);return void 0!==s?s:n.createElement(n.Fragment,null,e)}case"object":let a=function(e,t,i){let s,r=e;switch(typeof e){case"undefined":s=n.createElement(n.Fragment,null,"boxId undefined");break;case"number":s=n.createElement(n.Fragment,null,"id:",e);break;default:if("function"!==typeof r.render){if(void 0!==t)return t(e,i);s=o(r.boxName,e,i)}}return void 0!==s?n.createElement("del",{className:"text-danger"},s):r.render(t,i)}(e,t,i);return void 0!==a?a:void 0===s?n.createElement(n.Fragment,null,"id null"):s();case"number":return n.createElement(n.Fragment,null,"id...",e)}})},function(e,t,i){"use strict";i.d(t,"b",function(){return s}),i.d(t,"a",function(){return r});var n=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};function s(e,t,i,s,r){return n(this,void 0,void 0,function*(){yield e.fetch(t,i,s,r)})}class r{constructor(e,t){this.path=e||"",this.showWaiting=t}xcall(e){return n(this,void 0,void 0,function*(){let t=yield this.getHttpChannel();return yield t.xcall(this.path,e)})}call(e,t,i){return n(this,void 0,void 0,function*(){let n=yield this.getHttpChannel();return yield n.callFetch(e,t,i)})}get(e,t){return n(this,void 0,void 0,function*(){let i=yield this.getHttpChannel();return yield i.get(this.path+e,t)})}post(e,t){return n(this,void 0,void 0,function*(){let i=yield this.getHttpChannel();return yield i.post(this.path+e,t)})}put(e,t){return n(this,void 0,void 0,function*(){let i=yield this.getHttpChannel();return yield i.put(this.path+e,t)})}delete(e,t){return n(this,void 0,void 0,function*(){let i=yield this.getHttpChannel();return yield i.delete(this.path+e,t)})}}},function(e,t,i){"use strict";i.d(t,"a",function(){return o});var n=i(0),s=i(9),r=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class o extends n.Component{constructor(e){super(e),this.logoutClick=(()=>{s.b.showLogout(this.logout)}),this.logout=(()=>r(this,void 0,void 0,function*(){let{logout:e}=this.props;"function"===typeof e&&(yield e()),yield s.b.logout(void 0)})),this.state={hasBack:s.b.level>1}}componentWillUnmount(){}back(){return r(this,void 0,void 0,function*(){yield s.b.back()})}openWindow(){window.open(document.location.href)}render(){let e,t,i,r=this.state.hasBack||window.self!==window.top,{right:o,center:a,logout:l,className:c}=this.props;if(void 0!==l&&window.self===window.top&&("boolean"===typeof l&&!0===l||"function"===typeof l)){let{user:e}=s.b;if(void 0!==e){let{nick:t,name:s}=e;i=n.createElement("div",{className:"d-flex align-items-center"},n.createElement("small",{className:"text-light"},t||s),n.createElement("a",{className:"btn ml-2 cursor-pointer",href:"#",role:"button",onClick:this.logoutClick},n.createElement("i",{className:"fa fa-sign-out fa-lg"})))}}if(r)switch(this.props.back){case"none":e=void 0;break;default:case"back":e=n.createElement("nav",{onClick:this.back},n.createElement("i",{className:"fa fa-angle-left"}));break;case"close":e=n.createElement("nav",{onClick:this.back},n.createElement("i",{className:"fa fa-close"}))}window.self!==window.top&&(console.log(document.location.href),t=n.createElement("header",{onClick:this.openWindow}));let u=(o||i)&&n.createElement("aside",null,o," ",i);return n.createElement("header",{className:c},t,e,n.createElement("div",null,a),u)}}},function(e,t,i){"use strict";var n=i(6),s=i(0),r=i.n(s),o=i(5),a=i(1),l=i(12);const c=e=>r.a.createElement("div",{className:"px-3 py-2"},Object(l.b)(e));var u=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class d extends n.b{constructor(){super(...arguments),this.onSubmit=(()=>u(this,void 0,void 0,function*(){let e=this.vForm.getValues();if(!0===this.entity.isPaged)yield this.entity.resetPage(30,e),yield this.entity.loadPage(),this.replacePage(this.pageResult);else{let t=yield this.entity.query(e);this.replacePage(this.queryResult,t)}})),this.again=(()=>{this.vForm.reset(),this.replacePage(this.view)}),this.renderRow=((e,t)=>s.createElement(this.row,Object.assign({},e))),this.view=(()=>s.createElement(a.Page,{header:this.label},this.vForm.render("mx-3 my-2"),this.renderExtra())),this.pageResult=(()=>{let{list:e}=this.entity,t=s.createElement("button",{className:"btn btn-outline-success",onClick:this.again},s.createElement(a.FA,{name:"search"})," \u518d\u67e5\u8be2");return s.createElement(a.Page,{header:this.label,right:t},s.createElement(a.List,{items:e,item:{render:this.renderRow}}))}),this.queryResult=Object(o.a)(e=>{let t=s.createElement("button",{className:"btn btn-outline-success",onClick:this.again},s.createElement(a.FA,{name:"search"})," \u518d\u67e5\u8be2");return s.createElement(a.Page,{header:this.label,right:t},s.createElement("pre",null,JSON.stringify(e,void 0,"\t")))})}open(e){return u(this,void 0,void 0,function*(){this.vForm=this.createForm(this.onSubmit,e);let{row:t,queryRow:i}=this.ui;this.row=i||t||c,this.openPage(this.view)})}renderExtra(){}}var h=i(10),m=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class f extends n.b{constructor(){super(...arguments),this.onSearch=(e=>m(this,void 0,void 0,function*(){yield this.PageItems.first(e)})),this.renderRow=((e,t)=>s.createElement(this.row,Object.assign({},e))),this.clickRow=(e=>{this.callOnSelected(e)}),this.view=(()=>{let e=s.createElement(a.SearchBox,{className:"mx-1 w-100",initKey:"",onSearch:this.onSearch,placeholder:"\u641c\u7d22"+this.label});return s.createElement(a.Page,{header:e},s.createElement(a.List,{items:this.PageItems.items,item:{render:this.renderRow,onClick:this.clickRow},before:"\u641c\u7d22"+this.label+"\u8d44\u6599"}))})}open(e){return m(this,void 0,void 0,function*(){let{row:t,selectRow:i}=this.ui;this.row=i||t||c,this.PageItems=new v(this.entity),yield this.onSearch(e),this.openPage(this.view)})}callOnSelected(e){this.closePage(),this.returnCall(e)}}class v extends h.c{constructor(e){super(),this.query=e}load(){return m(this,void 0,void 0,function*(){let e;if(yield this.query.loadSchema(),!0===this.query.isPaged)e=yield this.query.page(this.param,this.pageStart,this.pageSize);else{e=(yield this.query.query(this.param))[this.query.returns[0].name]}return e})}setPageStart(e){void 0===e&&(this.pageStart=0)}}var p=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class g extends n.a{}class y extends g{internalStart(){return p(this,void 0,void 0,function*(){yield this.openVPage(this.VQueryMain)})}get VQueryMain(){return this.ui&&this.ui.main||d}}class b extends g{internalStart(e){return p(this,void 0,void 0,function*(){yield this.openVPage(this.VQuerySelect,e)})}get VQuerySelect(){return f}}i.d(t,"a",function(){return y}),i.d(t,"b",function(){return b})},function(e,t,i){"use strict";i.d(t,"a",function(){return m});var n=i(0),s=i(5),r=i(2),o=i(50),a=i(27),l=i(9),c=i(14),u=i(25),d=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o},h=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class m extends u.a{constructor(){super(...arguments),this.overSize=!1,this.upload=(()=>h(this,void 0,void 0,function*(){if(!this.resUploader)return;let e=yield this.resUploader.upload();if(null===e)return this.overSize=!0,void setTimeout(()=>this.overSize=!1,3e3);this.resId=e,this.isChanged=this.resId!==this.value})),this.page=Object(s.a)(e=>{let t,{resolve:i}=e,s=n.createElement("button",{className:"btn btn-sm btn-success",disabled:!this.isChanged,onClick:()=>i(this.resId)},"\u4fdd\u5b58");return!0===this.overSize&&(t=n.createElement("div",{className:"text-danger"},n.createElement("i",{className:"fa fa-times-circle"})," \u56fe\u7247\u6587\u4ef6\u5927\u5c0f\u8d85\u8fc72M\uff0c\u65e0\u6cd5\u4e0a\u4f20")),n.createElement(c.a,{header:"\u66f4\u6539"+this.label,right:s},n.createElement("div",{className:"my-3 px-3 py-3 bg-white"},n.createElement("div",null,n.createElement("div",null,"\u4e0a\u4f20\u56fe\u7247\uff1a"),n.createElement("div",{className:"my-3"},n.createElement(o.a,{ref:e=>this.resUploader=e,multiple:!1,maxSize:2048})),n.createElement("div",null,n.createElement("button",{className:"btn btn-primary",onClick:this.upload},"\u4e0a\u4f20"))),t,n.createElement("div",{className:"small muted my-4"},"\u652f\u6301JPG\u3001GIF\u3001PNG\u683c\u5f0f\u56fe\u7247\uff0c\u4e0d\u8d85\u8fc72M\u3002"),n.createElement("div",{className:"d-flex"},n.createElement("div",{className:"w-12c h-12c mr-4",style:{border:"1px dotted gray",padding:"8px"}},n.createElement(a.a,{className:"w-100 h-100",src:this.resId})),n.createElement("div",null,n.createElement("div",{className:"small"},"\u56fe\u7247\u9884\u89c8"),n.createElement(a.a,{className:"w-4c h-4c mt-3",src:this.resId})))))})}internalStart(){return h(this,void 0,void 0,function*(){return this.resId=this.value,new Promise((e,t)=>{l.b.push(n.createElement(this.page,{resolve:e,reject:t}),()=>t())})})}}d([r.l],m.prototype,"resId",void 0),d([r.l],m.prototype,"overSize",void 0)},function(e,t,i){"use strict";i.d(t,"a",function(){return o});var n=i(7),s=i(28),r=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};const o=new class extends n.b{login(e){return r(this,void 0,void 0,function*(){let t=yield this.get("login",e);switch(typeof t){default:return;case"string":return Object(s.b)(t);case"object":let e=t.token,i=Object(s.b)(e),{nick:n,icon:r}=t;return n&&(i.nick=n),r&&(i.icon=r),i}})}register(e){return r(this,void 0,void 0,function*(){return yield this.post("register",e)})}setVerify(e,t){return r(this,void 0,void 0,function*(){return yield this.post("set-verify",{account:e,type:t})})}checkVerify(e,t){return r(this,void 0,void 0,function*(){return yield this.post("check-verify",{account:e,verify:t})})}isExists(e){return r(this,void 0,void 0,function*(){return yield this.get("is-exists",{account:e})})}resetPassword(e,t,i,n){return r(this,void 0,void 0,function*(){return yield this.post("reset-password",{account:e,password:t,verify:i,type:n})})}userSetProp(e,t){return r(this,void 0,void 0,function*(){yield this.post("tie/user-set-prop",{prop:e,value:t})})}}("tv/user/",void 0)},,,,function(e,t,i){"use strict";i.d(t,"a",function(){return a});var n=i(2),s=i(21),r=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o},o=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class a{constructor(e=!1){this.isFirst=!0,this.loading=!1,this.beforeLoad=!0,this.loaded=!1,this.allLoaded=!1,this.firstSize=100,this.pageStart=void 0,this.pageSize=30,this.appendPosition="tail",this._items=n.l.array([],{deep:e})}get items(){return!0===this.beforeLoad?null:!1!==this.loaded?this._items:void 0}scrollToTop(){this.topDiv="$$"+Object(s.a)()}scrollToBottom(){this.bottomDiv="$$"+Object(s.a)()}reset(){this.isFirst=!0,this.beforeLoad=!0,this.loaded=!1,this.param=void 0,this.allLoaded=!1,this._items.clear()}append(e){"tail"===this.appendPosition?this._items.unshift(e):this._items.push(e)}first(e){return o(this,void 0,void 0,function*(){this.reset(),this.beforeLoad=!1,this.param=e,yield this.more()})}onLoad(){return o(this,void 0,void 0,function*(){})}more(){return o(this,void 0,void 0,function*(){if(!0===this.allLoaded)return;if(!0===this.loading)return;this.loading=!0,yield this.onLoad(),void 0===this.pageStart&&this.setPageStart(void 0);let e=this.pageSize+1;!0===this.isFirst&&this.firstSize>this.pageSize&&(e=this.firstSize+1);let t=yield this.load(this.param,this.pageStart,e);this.loading=!1,this.loaded=!0;let i=t.length;!0===this.isFirst&&i>this.firstSize||!1===this.isFirst&&i>this.pageSize?(this.allLoaded=!1,--i,t.splice(i,1)):this.allLoaded=!0,0!==i?(this.setPageStart(t[i-1]),"tail"===this.appendPosition?this._items.push(...t):this._items.unshift(...t.reverse()),this.isFirst=!1):this._items.clear()})}}r([n.l],a.prototype,"loading",void 0),r([n.l],a.prototype,"beforeLoad",void 0),r([n.l],a.prototype,"loaded",void 0),r([n.l],a.prototype,"allLoaded",void 0),r([n.e],a.prototype,"items",null),r([n.l],a.prototype,"topDiv",void 0),r([n.l],a.prototype,"bottomDiv",void 0)},function(e,t,i){"use strict";i.d(t,"a",function(){return s});var n=i(0);function s(){return n.createElement("div",{className:"d-flex h-100 align-items-center justify-content-center"},n.createElement("i",{className:"fa fa-spinner fa-spin fa-2x fa-fw text-info"}))}},function(e,t,i){"use strict";i.d(t,"a",function(){return o});var n=i(0),s=i(9),r=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class o extends n.Component{constructor(){super(...arguments),this.upload=(()=>r(this,void 0,void 0,function*(){let{maxSize:e}=this.props;void 0===e||e<=0?e=1e11:e*=1024;let t=s.b.resUrl+"upload";var i=this.fileInput.files,n=new FormData;let r=i.length;for(let s=0;s<r;s++){let t=i[s];if(t.size>e)return null;n.append("files[]",t,t.name)}try{let e=new AbortController,i=yield fetch(t,{method:"POST",body:n,signal:e.signal});return":"+(yield i.json()).res.id}catch(o){console.error("%s %s",t,o)}}))}render(){let{className:e,multiple:t,onFilesChange:i}=this.props;return n.createElement("input",{className:e,ref:e=>this.fileInput=e,onChange:i,type:"file",name:"file",multiple:t})}}},function(e,t,i){"use strict";i.d(t,"b",function(){return p}),i.d(t,"a",function(){return g});var n=i(8),s=i.n(n),r=i(7),o=i(38),a=i(32),l=i(52),c=i(24),u=i(53),d=i(54),h=i(55),m=i(56),f=i(39),v=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};function p(e){switch(e){case"tinyint":case"smallint":case"int":case"bigint":case"dec":return 0;case"char":case"text":return"";case"datetime":case"date":return"2000-1-1";case"time":return"0:00"}}class g{constructor(e,t,i,n){this.actions={},this.sheets={},this.queries={},this.books={},this.maps={},this.histories={},this.pendings={},this.tuids={},this.createBoxIdFromTVs=((e,t)=>{let{name:i}=e;return new f.a(t,e,this.tvs[i])}),this.tuidArr=[],this.actionArr=[],this.sheetArr=[],this.queryArr=[],this.bookArr=[],this.mapArr=[],this.historyArr=[],this.pendingArr=[],this.createBoxId=i,void 0===i&&(this.createBoxId=this.createBoxIdFromTVs,this.tvs=n||{});let{id:s,uqOwner:a,uqName:l,access:c,newVersion:u}=t;this.newVersion=u,this.uqOwner=a,this.uqName=l,this.id=s,this.name=a+"/"+l,this.uqVersion=0,this.localMap=e.localMap.map(this.name),this.localModifyMax=this.localMap.child("$modifyMax"),this.localAccess=this.localMap.child("$access");let d;d=null===c||void 0===c||"*"===c?[]:c.split(";").map(e=>e.trim()).filter(e=>e.length>0),"$$$/$unitx"===this.name?this.uqApi=new r.d(r.g.unit):this.uqApi=new r.e("tv/",a,l,d,!0),this.tuidsCache=new o.TuidsCache(this)}get entities(){return s.a.merge({},this.actions,this.sheets,this.queries,this.books,this.maps,this.histories,this.pendings,this.tuids)}tuid(e){return this.tuids[e.toLowerCase()]}tuidDiv(e,t){let i=this.tuids[e.toLowerCase()];return i&&i.div(t.toLowerCase())}action(e){return this.actions[e.toLowerCase()]}sheet(e){return this.sheets[e.toLowerCase()]}query(e){return this.queries[e.toLowerCase()]}book(e){return this.books[e.toLowerCase()]}map(e){return this.maps[e.toLowerCase()]}history(e){return this.histories[e.toLowerCase()]}pending(e){return this.pendings[e.toLowerCase()]}sheetFromTypeId(e){for(let t in this.sheets){let i=this.sheets[t];if(i.typeId===e)return i}}init(){return v(this,void 0,void 0,function*(){yield this.uqApi.init()})}loadEntities(){return v(this,void 0,void 0,function*(){try{let t=this.localAccess.get();if(t||(t=yield this.uqApi.loadAccess()),!t)return;this.buildEntities(t),"common"===this.uqName&&this.pullModify(12)}catch(e){return e}})}buildEntities(e){this.localAccess.set(e);let{access:t,tuids:i,version:n}=e;this.uqVersion=n,this.buildTuids(i),this.buildAccess(t)}loadEntitySchema(e){return v(this,void 0,void 0,function*(){return yield this.uqApi.schema(e)})}getTuid(e){return this.tuids[e]}buildTuids(e){for(let t in e){let i=e[t],{typeId:n,from:s}=i;this.newTuid(t,n,s).sys=!0}for(let t in e){let i=e[t];this.getTuid(t).setSchema(i)}for(let t in this.tuids){this.tuids[t].buildFieldsTuid()}}buildAccess(e){for(let t in e){let i=e[t];switch(typeof i){case"string":this.fromType(t,i);break;case"object":this.fromObj(t,i)}}}cacheTuids(e){this.tuidsCache.cacheTuids(e)}newAction(e,t){let i=this.actions[e];return void 0!==i?i:(i=this.actions[e]=new a.a(this,e,t),this.actionArr.push(i),i)}newTuid(e,t,i){let n=this.tuids[e];return void 0!==n?n:(n=void 0!==i?new o.TuidImport(this,e,t,i):new o.TuidInner(this,e,t),this.tuids[e]=n,this.tuidArr.push(n),n)}newQuery(e,t){let i=this.queries[e];return void 0!==i?i:(i=this.queries[e]=new c.a(this,e,t),this.queryArr.push(i),i)}newBook(e,t){let i=this.books[e];return void 0!==i?i:(i=this.books[e]=new u.a(this,e,t),this.bookArr.push(i),i)}newMap(e,t){let i=this.maps[e];return void 0!==i?i:(i=this.maps[e]=new h.a(this,e,t),this.mapArr.push(i),i)}newHistory(e,t){let i=this.histories[e];if(void 0===i)return i=this.histories[e]=new d.a(this,e,t),this.historyArr.push(i),i}newPending(e,t){let i=this.pendings[e];if(void 0===i)return i=this.pendings[e]=new m.a(this,e,t),this.pendingArr.push(i),i}newSheet(e,t){let i=this.sheets[e];return void 0!==i?i:(i=this.sheets[e]=new l.a(this,e,t),this.sheetArr.push(i),i)}fromType(e,t){let i=t.split("|");t=i[0];let n=Number(i[1]);switch(t){case"tuid":break;case"action":this.newAction(e,n);break;case"query":this.newQuery(e,n);break;case"book":this.newBook(e,n);break;case"map":this.newMap(e,n);break;case"history":this.newHistory(e,n);break;case"sheet":this.newSheet(e,n);break;case"pending":this.newPending(e,n)}}fromObj(e,t){switch(t.$){case"sheet":this.buildSheet(e,t)}}buildSheet(e,t){let i=this.sheets[e];void 0===i&&(i=this.newSheet(e,t.id)),i.build(t)}buildFieldTuid(e,t){if(void 0!==e){for(let t of e){let{tuid:e}=t;if(void 0===e)continue;let i=this.getTuid(e);void 0!==i&&(t._tuid=i.buildTuidBox())}for(let i of e){let{owner:n}=i;if(void 0===n)continue;let s=e.find(e=>e.name===n);if(void 0===s&&(void 0!==t&&(s=t.find(e=>e.name===n)),void 0===s))throw new Error(`owner field ${n} is undefined`);let{arr:r,tuid:o}=i,a=this.getTuid(s._tuid.tuid.name);if(void 0===a)continue;let l=a.div(r||o);if(i._tuid=l&&l.buildTuidDivBox(s),void 0===i._tuid)throw new Error(`owner field ${n} is not tuid`)}}}buildArrFieldsTuid(e,t){if(void 0!==e)for(let i of e){let{fields:e}=i;void 0!==e&&this.buildFieldTuid(e,t)}}pullModify(e){this.tuidsCache.pullModify(e)}}},function(e,t,i){"use strict";i.d(t,"a",function(){return a});var n=i(20),s=i(48),r=i(15),o=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class a extends n.a{get typeName(){return"sheet"}setSchema(e){super.setSchema(e),this.states=e.states}build(e){this.states=[];for(let t of e.ops)this.states.push({name:t,actions:void 0})}createSheetState(e,t){let i={name:e,actions:[]},n=i.actions;for(let s in t){let e={name:s};n.push(e)}return i}save(e,t){return o(this,void 0,void 0,function*(){let{id:i}=this.uq,n={app:i,discription:e,data:t};return yield new c(this,n).request()})}action(e,t,i,n){return o(this,void 0,void 0,function*(){return yield new u(this,{id:e,flow:t,state:i,action:n}).request()})}unpack(e){let t=e[0][0];return{brief:t,data:this.unpackSheet(t.data),flows:e[1]}}getSheet(e){return o(this,void 0,void 0,function*(){let t=yield new d(this,e).request();return 0===t[0].length?yield this.getArchive(e):this.unpack(t)})}getArchive(e){return o(this,void 0,void 0,function*(){let t=yield new h(this,e).request();return this.unpack(t)})}getArchives(e,t){return o(this,void 0,void 0,function*(){let i={pageStart:e,pageSize:t};return yield new m(this,i).request()})}getStateSheets(e,t,i){return o(this,void 0,void 0,function*(){let n={state:e,pageStart:t,pageSize:i};return yield new f(this,n).request()})}createPageStateItems(){return new g(this)}stateSheetCount(){return o(this,void 0,void 0,function*(){return yield new v(this,void 0).request()})}mySheets(e,t,i){return o(this,void 0,void 0,function*(){let n={state:e,pageStart:t,pageSize:i};return yield new p(this,n).request()})}}class l extends r.b{get entity(){return this._entity}get path(){return`sheet/${this.entity.name}/${this.suffix}`}}class c extends l{get path(){return`sheet/${this.entity.name}`}buildParams(){let{app:e,discription:t,data:i}=this.params;return{app:e,discription:t,data:this.entity.pack(i)}}}class u extends l{constructor(){super(...arguments),this.method="PUT"}get path(){return`sheet/${this.entity.name}`}}class d extends l{constructor(){super(...arguments),this.method="GET"}buildParams(){}get path(){return`sheet/${this.entity.name}/get/${this.params}`}}class h extends l{constructor(){super(...arguments),this.method="GET"}buildParams(){}get path(){return`sheet/${this.entity.name}/archive/${this.params}`}}class m extends l{constructor(){super(...arguments),this.suffix="archives"}}class f extends l{constructor(){super(...arguments),this.suffix="states"}}class v extends l{constructor(){super(...arguments),this.method="GET",this.suffix="statecount"}xresult(e){let{states:t}=this.entity;return t.map(t=>{let i=t.name,n=0,s=e.find(e=>e.state===i);return void 0!==s&&(n=s.count),{state:i,count:n}})}}class p extends l{constructor(){super(...arguments),this.suffix="my-sheets"}xresult(e){return e}}class g extends s.a{constructor(e){super(!0),this.sheet=e,this.pageSize=10}load(e,t,i){return o(this,void 0,void 0,function*(){return yield this.sheet.getStateSheets(e,t,i)})}setPageStart(e){this.pageStart=void 0===e?0:e.id}}},function(e,t,i){"use strict";i.d(t,"a",function(){return r});var n=i(24),s=i(15);class r extends n.a{constructor(){super(...arguments),this.queryApiName="book"}get typeName(){return"book"}queryCaller(e){return new o(this,e)}}class o extends s.d{get path(){return`book/${this.entity.name}`}}},function(e,t,i){"use strict";i.d(t,"a",function(){return s});var n=i(24);class s extends n.a{constructor(){super(...arguments),this.queryApiName="history"}get typeName(){return"history"}}},function(e,t,i){"use strict";i.d(t,"a",function(){return a});var n=i(20),s=i(32),r=i(15),o=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class a extends n.a{constructor(){super(...arguments),this.actions={},this.queries={}}get typeName(){return"map"}setSchema(e){super.setSchema(e),this.schemaFrom=this.schema.from;let{actions:t,queries:i,keys:n}=e;this.uq.buildFieldTuid(this.keys=n);for(let s in t){let e=t[s],{name:i}=e,n=this.uq.newAction(i,void 0);n.setSchema(e),n.buildFieldsTuid(),this.actions[s]=n}for(let s in i){let e=i[s],{name:t}=e,n=this.uq.newQuery(t,void 0);n.setSchema(e),n.buildFieldsTuid(),this.queries[s]=n}}add(e){return o(this,void 0,void 0,function*(){return yield new c(this,e).request()})}del(e){return o(this,void 0,void 0,function*(){return yield new u(this,e).request()})}all(){return o(this,void 0,void 0,function*(){return yield new d(this,void 0).request()})}page(e,t,i){return o(this,void 0,void 0,function*(){return yield new h(this,{pageStart:t,pageSize:i,param:e}).request()})}query(e){return o(this,void 0,void 0,function*(){let t=new m(this,e);return yield t.request()})}table(e){return o(this,void 0,void 0,function*(){let t=yield this.query(e);for(let e in t)return t[e]})}obj(e){return o(this,void 0,void 0,function*(){let t=yield this.table(e);if(t.length>0)return t[0]})}scalar(e){return o(this,void 0,void 0,function*(){let t=yield this.obj(e);for(let e in t)return t[e]})}}class l extends r.b{get entity(){return this._entity}get path(){}innerCall(){return o(this,void 0,void 0,function*(){let e=this.getCaller(this.params),t=yield this.entity.uqApi.xcall(e);return{res:e.xresult(t.res)}})}buildParams(){return super.buildParams()}}class c extends l{getCaller(e){return new f(this.entity,this.entity.actions.add,e)}}class u extends l{getCaller(e){return new v(this.entity,this.entity.actions.add,e)}}class d extends l{getCaller(e){return new p(this.entity,this.entity.queries.all,e)}}class h extends l{getCaller(e){return new g(this.entity,this.entity.queries.page,e)}}class m extends l{getCaller(e){return new y(this.entity,this.entity.queries.query,e)}}class f extends s.b{constructor(e,t,i){super(t,i),this.map=e}get path(){return`map/${this.map.name}/add`}get headers(){}}class v extends s.b{constructor(e,t,i){super(t,i),this.map=e}get path(){return`map/${this.map.name}/del`}get headers(){}}class p extends r.c{constructor(e,t,i){super(t,i),this.map=e}get path(){return`map/${this.map.name}/all`}get headers(){}}class g extends r.c{constructor(e,t,i){super(t,i),this.map=e}get path(){return`map/${this.map.name}/page`}get headers(){}}class y extends r.d{constructor(e,t,i){super(t,i),this.map=e}get path(){return`map/${this.map.name}/query`}get headers(){}}},function(e,t,i){"use strict";i.d(t,"a",function(){return s});var n=i(24);class s extends n.a{constructor(){super(...arguments),this.queryApiName="pending"}get typeName(){return"pending"}}},function(e,t,i){"use strict";i.d(t,"a",function(){return a});var n=i(0),s=i.n(n),r=i(1);function o(e,t){return s.a.createElement(r.FA,{className:e,name:t,fixWidth:!0})}const a={tuid:o("text-info","list-alt"),action:o("text-info","hand-o-right"),map:o("text-muted","list-ul"),book:o("text-muted","book"),query:o("text-warning","search"),history:o("text-info","hand-o-right"),pending:o("text-info","forward"),sheet:o("text-primary","wpforms")}},function(e,t,i){"use strict";i.d(t,"a",function(){return s});var n=i(1);class s extends n.Controller{constructor(e,t){super(t),this.cUq=e}}},function(e,t,i){"use strict";var n=i(2),s=i(7),r=i(6),o=i(0),a=i.n(o),l=i(5),c=i(1),u=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class d extends r.b{constructor(){super(...arguments),this.newClick=(()=>this.event("new")),this.schemaClick=(()=>this.event("schema")),this.archivesClick=(()=>this.event("archives")),this.sheetStateClick=(e=>this.event("state",e)),this.renderState=((e,t)=>{let{state:i,count:n}=e;if(0===n)return null;let s=o.createElement("span",{className:"badge badge-success ml-5 align-self-end"},n);return o.createElement(c.LMR,{className:"px-3 py-2",left:this.controller.getStateLabel(i),right:s})}),this.view=Object(l.a)(()=>{let e,t=this.controller.statesCount.filter(e=>e.count),i=o.createElement("button",{className:"btn btn-outline-primary",onClick:this.archivesClick},"\u5df2\u5f52\u6863");return!0===this.isDev&&(e=o.createElement("button",{className:"btn btn-primary mr-2",color:"primary",onClick:this.schemaClick},"\u6a21\u677f")),o.createElement(c.Page,{header:this.label},o.createElement(c.LMR,{className:"mx-3 my-2",right:i},o.createElement("button",{className:"btn btn-primary mr-2",color:"primary",onClick:this.newClick},"\u65b0\u5efa"),e),o.createElement(c.List,{className:"my-2",header:o.createElement(c.Muted,{className:"mx-3 my-1"},"\u5f85\u5904\u7406",this.label),none:"[ \u65e0 ]",items:t,item:{render:this.renderState,onClick:this.sheetStateClick}}))})}open(){return u(this,void 0,void 0,function*(){this.openPage(this.view)})}}var h=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class m extends r.b{constructor(){super(...arguments),this.onSubmit=(()=>h(this,void 0,void 0,function*(){let e=this.vForm.getValues(),t=this.vForm.values;yield this.controller.onSave(e,t)})),this.view=(()=>o.createElement(c.Page,{header:this.label},this.vForm.render()))}open(e){return h(this,void 0,void 0,function*(){this.vForm=this.createForm(this.onSubmit,e),this.openPage(this.view)})}}var f=i(33);const v={width:"8rem"};class p extends r.b{constructor(){super(...arguments),this.flowRow=((e,t)=>{let i,{date:n,state:s,action:r}=e;switch(void 0===r&&(r=o.createElement(o.Fragment,null,o.createElement(c.FA,{className:"text-primary",name:"pencil-square-o"})," \u5236\u5355")),s){case"$":break;case"#":i=o.createElement(o.Fragment,null,o.createElement(c.FA,{className:"text-success",name:"file-archive-o"}));break;default:i=o.createElement(o.Fragment,null,o.createElement(c.FA,{className:"text-muted",name:"arrow-right"})," \xa0 ",s)}return o.createElement(c.LMR,{left:o.createElement("div",{className:"pl-3 py-2",style:v},r),right:o.createElement("div",{className:"p-2"},o.createElement(c.Muted,null,o.createElement(c.EasyDate,{date:n})))},o.createElement("div",{className:"p-2"},i))}),this.sheetView=(()=>{let e,{brief:t,flows:i}=this.sheetData;return"-"===t.state&&(e=o.createElement("div",{className:"mx-3 my-2",style:{color:"red"}},"\u672c\u5355\u636e\u4f5c\u5e9f")),o.createElement("div",null,e,this.vForm.render(),o.createElement(c.List,{header:o.createElement(c.Muted,{className:"mx-3 my-1"},"\u6d41\u7a0b"),items:i,item:{render:this.flowRow}}))})}}var g=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class y extends p{constructor(){super(...arguments),this.onSubmit=(()=>g(this,void 0,void 0,function*(){let e=this.vForm.getValues();yield this.controller.saveSheet(e,this.vForm.values),this.closePage(),this.returnCall(this.vForm.values)})),this.view=(()=>o.createElement(c.Page,{header:this.label},this.vForm.render()))}open(e){return g(this,void 0,void 0,function*(){this.sheetData=e,this.vForm=this.createForm(this.onSubmit,e.data,f.a.edit),this.openPage(this.view)})}}var b=i(4),w=i.n(b),x=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class E extends p{constructor(){super(...arguments),this.actionClick=(e=>x(this,void 0,void 0,function*(){let{id:t,flow:i,state:n}=this.sheetData.brief;yield this.controller.action(t,i,n,e.name),this.ceasePage(),this.openPage(this.acted)})),this.deleteClick=(()=>x(this,void 0,void 0,function*(){alert("\u5355\u636e\u4f5c\u5e9f\uff1a\u7a0b\u5e8f\u6b63\u5728\u8bbe\u8ba1\u4e2d")})),this.editClick=(()=>x(this,void 0,void 0,function*(){let e=yield this.controller.editSheet(this.sheetData);this.vForm.setValues(e)})),this.page=(()=>{let e,t,{brief:i}=this.sheetData,{state:n,no:s}=i,r=this.controller.getStateLabel(n),{states:o}=this.entity,l=o.find(e=>e.name===n);if(void 0===l){let t,i;switch(n){default:t="\u4e0d\u8ba4\u8bc6\u7684\u5355\u636e\u72b6\u6001'"+n+"'",i="text-info";break;case"-":t="\u5df2\u4f5c\u5e9f",i="text-danger";break;case"#":t="\u5df2\u5f52\u6863",i="text-success"}e=a.a.createElement("div",{className:w()(i)},"[",t,"]")}else e=a.a.createElement("div",{className:"flex-grow-1"},l.actions.map((e,t)=>a.a.createElement("button",{key:t,className:"btn btn-primary mr-2",onClick:()=>this.actionClick(e)},this.controller.getActionLabel(n,e.name)))),"$"===n&&(t=a.a.createElement("div",null,a.a.createElement("button",{className:"btn btn-outline-info ml-2",onClick:this.editClick},"\u4fee\u6539"),a.a.createElement("button",{className:"btn btn-outline-danger ml-2",onClick:this.deleteClick},"\u4f5c\u5e9f")));return a.a.createElement(c.Page,{header:this.label+":"+r+"-"+s},a.a.createElement("div",{className:"mb-2"},a.a.createElement("div",{className:"d-flex px-3 py-2 border-bottom bg-light"},e,t),a.a.createElement(this.sheetView,null)))}),this.acted=(()=>{let{discription:e}=this.sheetData.brief;return a.a.createElement(c.Page,{header:"\u5df2\u5904\u7406",back:"close"},a.a.createElement("div",{className:"p-3 d-flex flex-column align-items-center"},a.a.createElement("div",{className:"p-3"},e),a.a.createElement("div",{className:"text-success"},a.a.createElement(c.FA,{name:"check-circle-o"})," \u5355\u636e\u5df2\u5904\u7406\uff01"),a.a.createElement("div",{className:"p-3"},a.a.createElement("button",{className:"btn btn-outline-info",onClick:()=>this.backPage()},"\u8fd4\u56de"))))})}open(e){return x(this,void 0,void 0,function*(){this.sheetData=e,this.vForm=this.createForm(void 0,e.data),this.openPage(this.page)})}}var k=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class C extends r.b{constructor(){super(...arguments),this.view=(()=>o.createElement(c.Page,{header:this.label+"\u6a21\u677f"},o.createElement("pre",{className:"mx-3 my-2"},this.entity.schemaStringify())))}open(e){return k(this,void 0,void 0,function*(){this.openPage(this.view)})}}var P=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class N extends r.b{constructor(){super(...arguments),this.archiveClick=(e=>P(this,void 0,void 0,function*(){1!==e.processing&&this.event("archived",e)})),this.archiveRow=((e,t)=>{let{date:i}=e,n=o.createElement(o.Fragment,null,1===e.processing?"... ":"",e.no," \xa0 ",e.discription),s=o.createElement(c.Muted,null,o.createElement(c.EasyDate,{date:i}));return o.createElement(c.LMR,{className:"px-3 py-2",left:n,right:s})}),this.view=(()=>o.createElement(c.Page,{header:"\u5df2\u5f52\u6863"+this.label},o.createElement(c.List,{items:this.list,item:{render:this.archiveRow,onClick:this.archiveClick}})))}open(){return P(this,void 0,void 0,function*(){this.list=yield this.entity.getArchives(void 0,10),this.openPage(this.view)})}}var I=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class S extends r.b{constructor(){super(...arguments),this.rowClick=(e=>I(this,void 0,void 0,function*(){1!==e.processing?this.event("action",e.id):this.event("processing",e.id)})),this.onScrollBottom=(()=>{console.log("onScrollBottom"),this.controller.pageStateItems.more()}),this.rowContent=(e=>{let{no:t,discription:i,date:n,processing:s}=e,r=o.createElement(o.Fragment,null,t," \xa0 ",o.createElement(c.Muted,null,i)," ",1===s?"...":""),a=o.createElement(c.Muted,null,o.createElement(c.EasyDate,{date:n}));return o.createElement(c.LMR,{className:"px-3 py-2",left:r,right:a})}),this.renderRow=((e,t)=>o.createElement(this.row,Object.assign({},e))),this.view=(()=>{let{pageStateItems:e}=this.controller;return o.createElement(c.Page,{header:this.label+" - "+this.stateLabel,onScrollBottom:this.onScrollBottom},o.createElement(c.List,{items:e,item:{render:this.renderRow,onClick:this.rowClick}}))})}open(e){return I(this,void 0,void 0,function*(){this.row=this.ui.listRow||this.rowContent,this.stateName=e.state,this.stateLabel=this.controller.getStateLabel(this.stateName),yield this.controller.pageStateItems.first(this.stateName),this.openPage(this.view)})}}var F=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class T extends p{constructor(){super(...arguments),this.view=(()=>{let{brief:e}=this.sheetData;return o.createElement(c.Page,{header:this.label+"-"+e.no},o.createElement(this.sheetView,null))})}open(e){return F(this,void 0,void 0,function*(){this.sheetData=e,this.vForm=this.createForm(void 0,this.sheetData.data),this.openPage(this.view)})}}class O extends r.b{}var R=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class A extends O{constructor(){super(...arguments),this.restart=(()=>R(this,void 0,void 0,function*(){this.ceasePage(),yield this.event("new")})),this.actionClick=(e=>R(this,void 0,void 0,function*(){this.ceasePage();let{id:t,flow:i,state:n}=this.brief;yield this.controller.action(t,i,n,e.name),this.openPage(this.acted)})),this.buttons=o.createElement(o.Fragment,null,o.createElement("button",{className:"btn btn-outline-primary mr-3",onClick:this.restart},"\u7ee7\u7eed\u5f00\u5355"),o.createElement("button",{className:"btn btn-outline-info",onClick:()=>this.backPage()},"\u8fd4\u56de")),this.view=(()=>{let{states:e}=this.entity;let t=e.find(e=>"$"===e.name),i=o.createElement(o.Fragment,null,t.actions.map((e,t)=>o.createElement("button",{key:t,className:"btn btn-primary mr-3",onClick:()=>this.actionClick(e)},this.controller.getActionLabel("$",e.name))));return o.createElement(c.Page,{header:"\u5df2\u4fdd\u5b58",back:"close"},o.createElement("div",{className:"p-3 d-flex flex-column align-items-center"},o.createElement("div",{className:"text-success"},o.createElement(c.FA,{name:"check-circle-o"})," \u5355\u636e\u5df2\u4fdd\u5b58\uff01\u7cfb\u7edf\u5c1a\u672a\u5904\u7406"),o.createElement("div",{className:"p-3"},i,this.buttons)))}),this.acted=(()=>o.createElement(c.Page,null,o.createElement("div",{className:"p-3 d-flex flex-column align-items-center"},o.createElement("div",{className:"text-success"},o.createElement(c.FA,{name:"check-circle-o"})," \u5355\u636e\u5df2\u5904\u7406\uff01"),o.createElement("div",{className:"p-3"},this.buttons))))}open(e){return R(this,void 0,void 0,function*(){this.brief=e,this.openPage(this.view)})}}var V=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class q extends p{constructor(){super(...arguments),this.page=(()=>{let{brief:e}=this.sheetData,{state:t,no:i}=e,n=this.controller.getStateLabel(t);return a.a.createElement(c.Page,{header:this.label+":"+n+"-"+i},a.a.createElement("div",{className:"mb-2"},a.a.createElement("div",{className:"d-flex px-3 py-2 border-bottom bg-light"},"\u6b63\u5728\u5904\u7406\u4e2d..."),a.a.createElement(this.sheetView,null)))})}open(e){return V(this,void 0,void 0,function*(){this.sheetData=e,this.vForm=this.createForm(void 0,e.data),this.openPage(this.page)})}}var j=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class U extends r.a{constructor(){super(...arguments),this.statesCount=n.l.array([],{deep:!0}),this.onSave=((e,t)=>j(this,void 0,void 0,function*(){let i=yield this.saveSheet(e,t);this.ceasePage(),yield this.showSaved(i)}))}internalStart(){return j(this,void 0,void 0,function*(){yield this.loadStateSheetCount(),this.pageStateItems=this.entity.createPageStateItems(),yield this.openVPage(this.VSheetMain)})}onMessage(e){return j(this,void 0,void 0,function*(){let{type:t,body:i,from:n,to:s}=e;"sheet"===t&&this.onSheet(n,s,i)})}onSheet(e,t,i){let n=this.user.id,{id:s,preState:r,state:o}=i;console.log({$:"onMessage sheet",from:e,to:t.join(","),id:s,preState:r,state:o,me:n,sheetData:i}),e===n&&this.sheetActPreState(s,r),void 0!==t.find(e=>e===n)&&this.sheetActState(s,o,i)}sheetActPreState(e,t){if(this.changeStateCount(t,-1),void 0===this.curState||this.curState!==t)return;let i=this.pageStateItems.items.findIndex(t=>t.id===e);i>=0&&this.pageStateItems.items.splice(i,1)}sheetActState(e,t,i){this.changeStateCount(t,1),void 0!==this.curState&&this.curState===t&&this.pageStateItems.items.findIndex(t=>t.id===e)<0&&this.pageStateItems.items.push(i)}changeStateCount(e,t){if(void 0===e)return;let i=this.statesCount.findIndex(t=>t.state===e);if(console.log({$:"changeState",state:e,delta:t,index:i}),i<0)return;let n=this.statesCount[i];n.count+=t,n.count<0&&(n.count=0)}get VSheetMain(){return this.ui&&this.ui.main||d}get VSheetNew(){return this.ui.sheetNew||m}get VSheetSaved(){return this.ui.sheetSaved||A}get VSheetEdit(){return this.ui.sheetEdit||y}get VSheetSchema(){return C}get VArchives(){return N}get VArchived(){return T}get VSheetList(){return S}get VSheetAction(){return this.ui.sheetAction||E}get VSheetProcessing(){return q}onEvent(e,t){return j(this,void 0,void 0,function*(){let i;switch(e){default:return;case"new":i=this.VSheetNew;break;case"schema":i=this.VSheetSchema;break;case"archives":i=this.VArchives;break;case"state":this.curState=t.state,i=this.VSheetList;break;case"archived":return void(yield this.showArchived(t));case"action":return void(yield this.showAction(t));case"processing":return void(yield this.showProcessing(t))}yield this.openVPage(i,t)})}startSheet(e){return j(this,void 0,void 0,function*(){!1!==(yield this.beforeStart())&&(yield this.onEvent("action",e))})}showAction(e){return j(this,void 0,void 0,function*(){let t=yield this.getSheetData(e);Object(s.m)({body:{$type:"msg",action:"$sheet",msg:{id:e,uq:this.cUq.uq.id,state:t.brief.state}}}),yield this.openVPage(this.VSheetAction,t)})}showProcessing(e){return j(this,void 0,void 0,function*(){let t=yield this.getSheetData(e);yield this.openVPage(this.VSheetProcessing,t)})}editSheet(e){return j(this,void 0,void 0,function*(){return yield this.vCall(this.VSheetEdit,e)})}showArchived(e){return j(this,void 0,void 0,function*(){let t=yield this.getArchived(e.id);yield this.openVPage(this.VArchived,t)})}showSaved(e){return j(this,void 0,void 0,function*(){yield this.openVPage(this.VSheetSaved,e)})}getStateUI(e){let{states:t}=this.res;if(void 0!==t)return t[e]}getStateLabel(e){let t=this.getStateUI(e),i=t&&t.label||e;switch(i){default:return i;case"$":return"\u65b0\u5355"}}getActionLabel(e,t){let i=this.getStateUI(e);if(void 0===i)return t;let n=i.actions;if(void 0===n)return t;let s=n[t];return s&&s.label||t}loadStateSheetCount(){return j(this,void 0,void 0,function*(){this.statesCount.clear();let e=yield this.entity.stateSheetCount();this.statesCount.splice(0,0,...e)})}getSheetData(e){return j(this,void 0,void 0,function*(){return yield this.entity.getSheet(e)})}getArchived(e){return j(this,void 0,void 0,function*(){return yield this.entity.getArchive(e)})}saveSheet(e,t){return j(this,void 0,void 0,function*(){let{sheetTitle:i}=this.ui,n=void 0===i?this.label:i(t,this.x);return yield this.entity.save(n,e)})}action(e,t,i,n){return j(this,void 0,void 0,function*(){return yield this.entity.action(e,t,i,n)})}}i.d(t,"a",function(){return U})},function(e,t,i){"use strict";var n=i(0),s=i(5),r=i(4),o=i.n(r);i(131);let a=class extends n.Component{render(){let e,{className:t,badge:i,size:s,color:r,badgeAlign:a,badgeVertical:l,children:c}=this.props,u=o()(t,"va-badge",s&&"va-badge-"+s,"va-badge-"+(r||"secondary"),a&&"va-badg-"+a,l&&"va-badg-"+l);return i&&(e=n.createElement("b",null,i)),n.createElement("div",{className:u},c,e)}};a=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o}([s.a],a);i(133);let l=class extends n.Component{render(){let e,t,i,{className:s,left:r,children:a,right:l,onClick:c}=this.props;return void 0!==r&&(e=n.createElement("header",null,r)),void 0!==l&&(t=n.createElement("footer",null,l)),void 0!==c&&(i="cursor-pointer"),n.createElement("div",{className:o()("va-lmr",s,i),onClick:c},e,n.createElement("div",null,a),t)}};l=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o}([s.a],l);class c extends n.Component{render(){let{name:e,className:t,size:i,spin:s,fixWidth:r,border:a,pull:l,pulse:c,rotate:u,flip:d,inverse:h}=this.props,m=o()(t,"fa",e&&"fa-"+e,i&&"fa-"+i,r&&"fa-fw",a&&"fa-border",l&&"fa-pull-"+l,s&&"fa-spin",c&&"fa-pulse",u&&"fa-rotate-"+u,d&&"fa-flip-"+d,h&&"fa-inverse");return n.createElement("i",{className:m})}}class u extends n.Component{render(){let{icon:e,iconClass:t,text:i,textClass:s}=this.props;return n.createElement("div",{className:"py-2"},n.createElement(c,{className:t,name:e,fixWidth:!0}),n.createElement("span",{className:s},i))}}const d=e=>n.createElement("small",{className:o()("text-muted",e.className),style:e.style},e.children);i.d(t,"a",function(){return a}),i.d(t,"d",function(){return l}),i.d(t,"b",function(){return c}),i.d(t,"c",function(){return u}),i.d(t,"e",function(){return d})},function(e,t,i){"use strict";var n=i(1),s=i(12),r=i(23),o=i(18),a=i(6),l=i(0),c=i.n(l),u=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class d extends a.b{constructor(){super(...arguments),this.view=(()=>l.createElement(n.Page,{header:this.label},"Book"))}open(e){return u(this,void 0,void 0,function*(){this.openPage(this.view)})}}var h=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class m extends a.a{internalStart(){return h(this,void 0,void 0,function*(){yield this.openVPage(this.VBookMain)})}get VBookMain(){return d}}var f=i(59),v=i(66),p=i(42),g=i(31),y=i(63);class b extends n.View{constructor(e){super(e),this.isSysVisible=!1,this.view=(()=>{let e,{res:t,uq:i,error:s}=this.controller,r={render:(e,t)=>e.render(),onClick:void 0},o=[{header:t.tuid||"TUID",items:this.tuidLinks},{cn:"my-2",header:t.map||"MAP",items:this.mapLinks},{cn:"my-2",header:t.sheet||"SHEET",items:this.sheetLinks},{cn:"my-2",header:t.action||"ACTION",items:this.actionLinks},{cn:"my-2",header:t.query||"QUERY",items:this.queryLinks},{cn:"mt-2 mb-4",header:t.book||"BOOK",items:this.bookLinks},{cn:"mt-2 mb-4",header:t.history||"HISTORY",items:this.historyLinks},{cn:"mt-2 mb-4",header:t.pending||"PENDING",items:this.pendingLinks}];return e=void 0!==s?c.a.createElement("div",{className:"p-3 text-danger"},"\u8fde\u63a5\u9519\u8bef: ",s):o.map(({cn:e,header:t,items:i},s)=>i.length>0&&c.a.createElement(n.List,{key:s,className:e,header:c.a.createElement("div",{className:"px-3 py-1 bg-light"},c.a.createElement(n.Muted,null,t)),items:i,item:r})),c.a.createElement(c.a.Fragment,null,c.a.createElement("div",{className:"px-3 py-1 small"},t.uq||i),e)});let{tuidArr:t,mapArr:i,sheetArr:s,actionArr:r,queryArr:a,bookArr:l,historyArr:u,pendingArr:d}=e.uq;this.tuidLinks=t.filter(e=>this.isVisible(e)).map(e=>new o.a(this.controller.cTuidMain(e))),this.mapLinks=i.filter(e=>this.isVisible(e)).map(e=>new o.a(this.controller.cMap(e))),this.sheetLinks=s.filter(e=>this.isVisible(e)).map(e=>new o.a(this.controller.cSheet(e))),this.actionLinks=r.filter(e=>this.isVisible(e)).map(e=>new o.a(this.controller.cAction(e))),this.queryLinks=a.filter(e=>this.isVisible(e)).map(e=>new o.a(this.controller.cQuery(e))),this.bookLinks=l.filter(e=>this.isVisible(e)).map(e=>new o.a(this.controller.cBook(e))),this.historyLinks=u.filter(e=>this.isVisible(e)).map(e=>new o.a(this.controller.cHistory(e))),this.pendingLinks=d.filter(e=>this.isVisible(e)).map(e=>new o.a(this.controller.cPending(e)))}isVisible(e){return!0!==e.sys||this.isSysVisible}render(e){return void 0===this.view?c.a.createElement("div",null,"??? viewModel \u5fc5\u987b\u5b9a\u4e49 view ???"):c.a.createElement(this.view)}}var w=i(64),x=i(65),E=i(30),k=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};function C(e){if(void 0!==e)for(let t in e)e[t.toLowerCase()]=e[t]}class P extends n.Controller{constructor(e,t,i){super(Object(n.resLang)(i.res)),this.tuidURs={},this.createBoxId=((e,t)=>{let{name:i}=e,n=this.tuidURs[i];if(void 0===n){let{ui:t,res:s}=this.getUI(e);this.tuidURs[i]=n=new E.b(e,t,s)}return new E.a(n,t)}),this.isSysVisible=!1,this.cApp=e,C(i.tuid),C(i.sheet),C(i.map),C(i.query),C(i.action),C(i.book),C(i.history),C(i.pending),this.ui=i,this.CTuidMain=i.CTuidMain||g.d,this.CTuidEdit=i.CTuidEdit||g.a,this.CTuidList=i.CTuidList||g.c,this.CTuidSelect=i.CTuidSelect||g.e,this.CTuidInfo=i.CTuidInfo||g.b,this.CQuery=i.CQuery||p.a,this.CQuerySelect=i.CQuerySelect||p.b,this.CMap=i.CMap||y.a,this.CAction=i.CAction||v.a,this.CSheet=i.CSheet||f.a,this.CBook=i.CBook||m,this.CHistory=i.CHistory||w.a,this.CPending=i.CPending||x.a,this.uq=new r.UqMan(e.uqs,t,this.createBoxId,void 0)}internalStart(){return k(this,void 0,void 0,function*(){})}init(){return k(this,void 0,void 0,function*(){return yield this.uq.init()})}loadEntities(){return k(this,void 0,void 0,function*(){try{yield this.uq.loadEntities()}catch(e){return e}})}getQuerySearch(e){return k(this,void 0,void 0,function*(){let t=this.uq.query(e);if(void 0===t)alert(`QUERY ${e} \u6ca1\u6709\u5b9a\u4e49!`);else{yield t.loadSchema();let{returns:i}=t;i.length>1&&alert(`QUERY ${e} \u8fd4\u56de\u591a\u5f20\u8868, \u65e0\u6cd5\u505aQuerySearch`)}return t})}getTuidPlaceHolder(e){let{tuidPlaceHolder:t,entity:i}=this.res,{name:n}=e;if(void 0!==i){i[n]}return t||"Select"}getNone(){let{none:e}=this.res;return e||"none"}isVisible(e){return!0!==e.sys||this.isSysVisible}navSheet(e,t){return k(this,void 0,void 0,function*(){let i=this.uq.sheetFromTypeId(e);if(void 0===i)return void alert("sheetTypeId "+e+" is not exists!");let n=this.cSheet(i);yield n.startSheet(t)})}sheet(e){return this.uq.sheet(e)}action(e){return this.uq.action(e)}query(e){return this.uq.query(e)}book(e){return this.uq.book(e)}map(e){return this.uq.map(e)}history(e){return this.uq.history(e)}pending(e){return this.uq.pending(e)}tuid(e){return this.uq.tuid(e)}tuidDiv(e,t){return this.uq.tuidDiv(e,t)}cSheetFromName(e){let t=this.uq.sheet(e);if(void 0!==t)return this.cSheet(t)}cActionFromName(e){let t=this.uq.action(e);if(void 0!==t)return this.cAction(t)}cQueryFromName(e){let t=this.uq.query(e);if(void 0!==t)return this.cQuery(t)}cBookFromName(e){let t=this.uq.book(e);if(void 0!==t)return this.cBook(t)}cMapFromName(e){let t=this.uq.map(e);if(void 0!==t)return this.cMap(t)}cHistoryFromName(e){let t=this.uq.history(e);if(void 0!==t)return this.cHistory(t)}cPendingFromName(e){let t=this.uq.pending(e);if(void 0!==t)return this.cPending(t)}cTuidMainFromName(e){let t=this.uq.tuid(e);if(void 0!==t)return this.cTuidMain(t)}cTuidEditFromName(e){let t=this.uq.tuid(e);if(void 0!==t)return this.cTuidEdit(t)}cTuidInfoFromName(e){let t=this.uq.tuid(e);if(void 0!==t)return this.cTuidInfo(t)}cTuidSelectFromName(e){let t=this.uq.tuid(e);if(void 0!==t)return this.cTuidSelect(t)}cFromName(e,t){switch(e){case"sheet":let i=this.uq.sheet(t);if(void 0===i)return;return this.cSheet(i);case"action":let n=this.uq.action(t);if(void 0===n)return;return this.cAction(n);case"tuid":let s=this.uq.tuid(t);if(void 0===s)return;return this.cTuidMain(s);case"query":let r=this.uq.query(t);if(void 0===r)return;return this.cQuery(r);case"book":let o=this.uq.book(t);if(void 0===o)return;return this.cBook(o);case"map":let a=this.uq.map(t);if(void 0===a)return;return this.cMap(a);case"history":let l=this.uq.history(t);if(void 0===l)return;return this.cHistory(l);case"pending":let c=this.uq.pending(t);if(void 0===c)return;return this.cPending(c)}}linkFromName(e,t){return this.link(this.cFromName(e,t))}getUI(e){let t,i,{name:n,typeName:s}=e;if(void 0!==this.ui)if("div"===s){let i=e.owner,s=this.ui[i.typeName];if(s){let e=s[i.name];if(e){let i=e.divs;i&&(t=i[n])}}}else{let e=this.ui[s];void 0!==e&&(t=e[n])}let{entity:r}=this.res;return void 0!==r&&(i=r[n]),{ui:t||{},res:i||{}}}link(e){return new o.a(e)}get tuidLinks(){return this.uq.tuidArr.filter(e=>this.isVisible(e)).map(e=>this.link(this.cTuidMain(e)))}cTuidMain(e){let{ui:t,res:i}=this.getUI(e);return new(t&&t.CTuidMain||this.CTuidMain)(this,e,t,i)}cTuidEdit(e){let{ui:t,res:i}=this.getUI(e);return new(t&&t.CTuidEdit||this.CTuidEdit)(this,e,t,i)}cTuidList(e){let{ui:t,res:i}=this.getUI(e);return new(t&&t.CTuidList||this.CTuidList)(this,e,t,i)}cTuidSelect(e){let{ui:t,res:i}=this.getUI(e);return new(t&&t.CTuidSelect||this.CTuidSelect)(this,e,t,i)}cTuidInfo(e){let{ui:t,res:i}=this.getUI(e);return new(t&&t.CTuidInfo||this.CTuidInfo)(this,e,t,i)}cSheet(e){let{ui:t,res:i}=this.getUI(e);return new(t&&t.CSheet||this.CSheet)(this,e,t,i)}get sheetLinks(){return this.uq.sheetArr.filter(e=>this.isVisible(e)).map(e=>this.link(this.cSheet(e)))}cAction(e){let{ui:t,res:i}=this.getUI(e);return new(t&&t.CAction||this.CAction)(this,e,t,i)}get actionLinks(){return this.uq.actionArr.filter(e=>this.isVisible(e)).map(e=>this.link(this.cAction(e)))}cQuery(e){let{ui:t,res:i}=this.getUI(e);return new(t&&t.CQuery||this.CQuery)(this,e,t,i)}cQuerySelect(e){let t=this.uq.query(e);if(void 0===t)return;let{ui:i,res:n}=this.getUI(t);return new(i&&i.CQuerySelect||this.CQuerySelect)(this,t,i,n)}get queryLinks(){return this.uq.queryArr.filter(e=>this.isVisible(e)).map(e=>this.link(this.cQuery(e)))}cBook(e){let{ui:t,res:i}=this.getUI(e);return new(t&&t.CBook||this.CBook)(this,e,t,i)}get bookLinks(){return this.uq.bookArr.filter(e=>this.isVisible(e)).map(e=>this.link(this.cBook(e)))}cHistory(e){let{ui:t,res:i}=this.getUI(e);return new(t&&t.CHistory||this.CHistory)(this,e,t,i)}get historyLinks(){return this.uq.historyArr.filter(e=>this.isVisible(e)).map(e=>this.link(this.cHistory(e)))}cPending(e){let{ui:t,res:i}=this.getUI(e);return new(t&&t.CPending||this.CPending)(this,e,t,i)}get pendingLinks(){return this.uq.pendingArr.filter(e=>this.isVisible(e)).map(e=>this.link(this.cPending(e)))}cMap(e){let{ui:t,res:i}=this.getUI(e);return new(t&&t.CMap||this.CMap)(this,e,t,i)}get mapLinks(){return this.uq.mapArr.filter(e=>this.isVisible(e)).map(e=>this.link(this.cMap(e)))}getTuidContent(e){let{ui:t}=this.getUI(e);return t&&t.content||s.a}getTuidDivContent(e){let{owner:t}=e,{ui:i}=this.getUI(t);return i&&i.divs&&i.divs[e.name].content||s.a}showTuid(e,t){return k(this,void 0,void 0,function*(){let i=this.cTuidInfo(e);yield i.start(t)})}showTuidDiv(e,t){return k(this,void 0,void 0,function*(){let{owner:i}=e,n=this.cTuidInfo(i);yield n.start(t)})}get VUq(){return b}render(){return new this.VUq(this).render()}}i.d(t,"a",function(){return P})},function(e,t,i){"use strict";var n=i(1),s=i(7),r=i(61),o=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};const a=new class extends s.b{userAppUnits(e){return o(this,void 0,void 0,function*(){return yield this.get("tie/user-app-units",{app:e})})}}("tv/",void 0);var l=i(23),c=i(0),u=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class d extends n.VPage{constructor(){super(...arguments),this.appPage=(()=>{let{caption:e}=this.controller;return c.createElement(n.Page,{header:e,logout:()=>u(this,void 0,void 0,function*(){s.g.unit=void 0})},this.appContent())}),this.appContent=(()=>{let e,{cUqArr:t}=this.controller;return e=0===t.length?c.createElement("div",{className:"text-danger"},c.createElement(n.FA,{name:""})," \u6b64APP\u6ca1\u6709\u7ed1\u5b9a\u4efb\u4f55\u7684UQ"):t.map((e,t)=>c.createElement("div",{key:t},e.render())),c.createElement(c.Fragment,null,e)})}open(e){return u(this,void 0,void 0,function*(){this.openPage(this.appPage)})}render(e){return this.appContent()}}class h extends n.VPage{constructor(){super(...arguments),this.page=(e=>{let{user:t}=n.nav,i=t?t.name:"[\u672a\u767b\u5f55]",{appOwner:s,appName:r}=this.controller.uqs;return c.createElement(n.Page,{header:"APP\u65e0\u6cd5\u8fd0\u884c",logout:!0},c.createElement("div",{className:"m-3 text-danger container"},c.createElement("div",{className:"form-group row"},c.createElement("div",{className:"col-sm-3 font-weight-bold"},"\u767b\u5f55\u7528\u6237"),c.createElement("div",{className:"col-sm text-body"},i)),c.createElement("div",{className:"form-group row"},c.createElement("div",{className:"col-sm-3 font-weight-bold"},"App"),c.createElement("div",{className:"col-sm text-body"},`${s}/${r}`)),c.createElement("div",{className:"form-group row"},c.createElement("div",{className:"col-sm-3 font-weight-bold"},"\u9884\u8bbe\u5c0f\u53f7"),c.createElement("div",{className:"col-sm text-body"},e||c.createElement("small",{className:""},"[\u65e0\u9884\u8bbe\u5c0f\u53f7]"))),c.createElement("div",{className:"form-group row"},c.createElement("div",{className:"col-sm-3 font-weight-bold"},"\u53ef\u80fd\u539f\u56e0",c.createElement(n.FA,{name:"exclamation-triangle"})),c.createElement("div",{className:"col-sm text-body"},c.createElement("ul",{className:"p-0"},c.createElement("li",null,"\u6ca1\u6709\u5c0f\u53f7\u8fd0\u884c ",r),c.createElement("li",null,"\u7528\u6237 ",c.createElement("b",null,i)," \u6ca1\u6709\u52a0\u5165\u4efb\u4f55\u4e00\u4e2a\u8fd0\u884c",r,"\u7684\u5c0f\u53f7"),e&&c.createElement("li",null,"\u9884\u8bbe\u5c0f\u53f7 ",c.createElement("b",null,e)," \u6ca1\u6709\u8fd0\u884cApp ",r)))),c.createElement("div",{className:"form-group row"},c.createElement("div",{className:"col-sm-3 font-weight-bold"},"\u5c0f\u53f7",e),c.createElement("div",{className:"col-sm text-body"},"\u9884\u8bbe\u5c0f\u53f7\u5b9a\u4e49\u5728 public/unit.json \u6587\u4ef6\u4e2d\u3002 \u5b9a\u4e49\u4e86\u8fd9\u4e2a\u6587\u4ef6\u7684\u7a0b\u5e8f\uff0c\u53ea\u80fd\u7531url\u76f4\u63a5\u542f\u52a8\u3002 \u7528\u6237\u7b2c\u4e00\u6b21\u8bbf\u95eeapp\u4e4b\u540e\uff0c\u4f1a\u7f13\u5b58\u5728localStorage\u91cc\u3002",c.createElement("br",null),"\u5982\u679c\u8981\u5220\u53bb\u7f13\u5b58\u7684\u9884\u5b9a\u4e49Unit\uff0clogout\u7136\u540e\u518dlogin\u3002"))))})}open(e){return u(this,void 0,void 0,function*(){this.openPage(this.page,e)})}}class m extends n.VPage{constructor(){super(...arguments),this.renderRow=((e,t)=>{let{id:i,nick:s,name:r}=e;return c.createElement(n.LMR,{className:"px-3 py-2",right:"id: "+i},c.createElement("div",null,s||r))}),this.onRowClick=(e=>u(this,void 0,void 0,function*(){s.g.unit=e.id,yield this.controller.start()})),this.page=(()=>c.createElement(n.Page,{header:"\u9009\u62e9\u5c0f\u53f7",logout:!0},c.createElement(n.List,{items:this.controller.appUnits,item:{render:this.renderRow,onClick:this.onRowClick}})))}open(){return u(this,void 0,void 0,function*(){this.openPage(this.page)})}}class f extends n.VPage{constructor(){super(...arguments),this.page=(e=>c.createElement(n.Page,{header:"ERROR"},c.createElement("div",{className:"m-3"},c.createElement("div",null,"Load Uqs \u53d1\u751f\u9519\u8bef\uff1a"),e.map((e,t)=>c.createElement("div",{key:t},e)))))}open(e){return u(this,void 0,void 0,function*(){this.openPage(this.page,e)})}}class v extends n.VPage{constructor(){super(...arguments),this.page=(e=>c.createElement(n.Page,{header:"App start error!"},c.createElement("pre",null,"string"===typeof e?e:e.message)))}open(e){return u(this,void 0,void 0,function*(){this.openPage(this.page,e)})}}var p=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class g extends n.Controller{constructor(e){if(super(Object(n.resLang)(e&&e.res)),this.cUqCollection={},this.cImportUqs={},n.nav.setSettings(e),this.name=e.appName,this.version=e.version,void 0===this.name)throw new Error('appName like "owner/app" must be defined in UI');this.uqs=new l.UQsMan(this.name,void 0),void 0===e.uqs&&(e.uqs={}),this.ui=e,this.caption=this.res.caption||"Tonva"}getImportUq(e,t){let i=e+"/"+t,n=this.cImportUqs[i];return void 0!==n?n:(this.cImportUqs[i]=n=this.getCUq(i),n)}newCUq(e,t){let i=new(this.ui.CUq||r.a)(this,e,t);return Object.setPrototypeOf(i.x,this.x),i}get cUqArr(){let e=[];for(let t in this.cUqCollection)e.push(this.cUqCollection[t]);return e}getCUq(e){return this.cUqCollection[e]}get VAppMain(){return this.ui&&this.ui.main||d}beforeStart(){return p(this,void 0,void 0,function*(){try{let t=yield this.load(),{predefinedUnit:i}=s.g,{user:r}=n.nav;if(void 0!==r&&r.id>0)switch(this.appUnits=yield a.userAppUnits(this.uqs.id),this.appUnits.length){case 0:return this.showUnsupport(i),!1;case 1:let e=this.appUnits[0].id;if(void 0===e||e<0||void 0!==i&&e!==i)return this.showUnsupport(i),!1;s.g.unit=e;break;default:if(i>0&&void 0!==this.appUnits.find(e=>e.id===i)){s.g.unit=i;break}return this.openVPage(m),!1}return void 0===t||(this.openVPage(f),!1)}catch(e){return this.openVPage(v),!1}})}load(){return p(this,void 0,void 0,function*(){let{appOwner:e,appName:t}=this.uqs,{localData:i}=this.uqs,n=i.get();if(!n||n.version!==this.version){(n=yield Object(s.k)(e,t)).version=this.version,i.set(n);for(let e of n.uqs)e.newVersion=!0}let{id:r,uqs:o}=n;this.uqs.id=r;let a=[],l=[],c=[];for(let s of o){let{uqOwner:e,uqName:t}=s,i=e+"/"+t,n=this.ui.uqs[i]||{},r=this.newCUq(s,n);this.cUqCollection[i]=r,this.uqs.addUq(r.uq),l.push(r.init())}yield Promise.all(l);for(let s in this.cUqCollection){let e=this.cUqCollection[s];c.push(e.loadEntities())}let u=yield Promise.all(c);for(let s of u){let e=s;void 0===e||a.push(e)}if(0!==a.length||(a.push(...this.uqs.setTuidImportsLocal()),0!==a.length))return a})}internalStart(e){return p(this,void 0,void 0,function*(){!0!==e&&this.clearPrevPages(),yield this.showMainPage()})}clearPrevPages(){n.nav.clear()}showUnsupport(e){this.clearPrevPages(),this.openVPage(h,e)}showMainPage(){return p(this,void 0,void 0,function*(){let e=Object(s.h)();if(void 0!==e){let t=e.split("-");if(t.length>3){let e=t[3];if("sheet"===e||"sheet_debug"===e){let e=Number(t[4]),i=Number(t[5]),n=Number(t[6]),s=this.getCUqFromId(e);return void 0===s?void alert("unknown uqId: "+e):(this.clearPrevPages(),void(yield s.navSheet(i,n)))}}}this.openVPage(this.VAppMain)})}getCUqFromId(e){for(let t in this.cUqCollection){let i=this.cUqCollection[t];if(i.uq.id===e)return i}}}i.d(t,"a",function(){return g})},function(e,t,i){"use strict";var n=i(8),s=i.n(n),r=i(2),o=i(23),a=i(12),l=i(6),c=i(0),u=i(5),d=i(4),h=i.n(d),m=i(1),f=i(30),v=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class p extends l.b{constructor(){super(...arguments),this.itemRender=((e,t)=>c.createElement(this.ItemRow,{item:e})),this.ItemRow=Object(u.a)(({item:e})=>{let t,i,n,s,r,o,{box:l,children:u,isLeaf:d,keyIndex:v,values:p}=e,g=this.controller.keyUIs[v],{content:y,valuesContent:b,none:w}=g;if(!1===this.isFrom&&(t=c.createElement("button",{className:"btn btn-link btn-sm",onClick:()=>this.controller.addClick(e)},c.createElement(m.FA,{name:"plus"})),i=c.createElement("button",{className:"btn btn-link btn-sm",onClick:()=>this.controller.removeClick(e)},c.createElement(m.FA,{className:"text-info",name:"trash"}))),!1===d?n=0===v?t:c.createElement(c.Fragment,null,i," \xa0 ",t):v>0&&(n=i),!0===d)s=void 0,p&&(o=(b||a.a)(p,this.x));else{r="border-bottom";let e=w&&w(this.x);s=c.createElement(m.List,{className:"ml-4",items:u,item:{onClick:void 0,render:this.itemRender},none:e})}let x=c.createElement("div",{className:"py-1 pr-3"},Object(f.c)(l,y,this.x));return c.createElement("div",{className:"d-flex flex-column"},c.createElement(m.LMR,{className:h()("px-3","py-2",r),left:x,right:n},c.createElement("div",{className:"py-1"},o)),s)})}open(e){return v(this,void 0,void 0,function*(){this.isFrom=this.controller.isFrom,this.openPage(this.view)})}get view(){return()=>c.createElement(m.Page,{header:this.label},c.createElement(m.List,{items:this.controller.items,item:{className:"my-2",onClick:void 0,render:this.itemRender}}))}}var g=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class y extends l.b{constructor(){super(...arguments),this.onValuesSubmit=(()=>g(this,void 0,void 0,function*(){this.ceasePage();let e=this.vForm.getValues();this.returnCall(e)})),this.view=(()=>c.createElement(m.Page,null,this.vForm.render()))}open(e){return g(this,void 0,void 0,function*(){this.vForm=this.createForm(this.onValuesSubmit),this.openPageElement(c.createElement(this.view,null))})}}var b=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class w{constructor(e,t,i,n){this.children=r.l.array([],{deep:!0}),this.parent=e,this.tuid=t,this.box=i,this.keyIndex=n,this.isLeaf=!1}}class x extends l.a{constructor(){super(...arguments),this.addClick=(e=>b(this,void 0,void 0,function*(){let{keyIndex:t,children:i}=e,n=this.keyFields.length,s=n-1,r=t+1;if(r>=n)return;let a=this.keyFields[r],l=a.name,c=a._tuid,u={},d={};for(let o=e;void 0!==o;o=o.parent){let{keyIndex:e,box:t}=o,i=this.keyFields[e].name;u[i]=d[i]=t.id}let h=yield this.searchOnKey(a,u);if(void 0===h||h<=0)return;c.useId(h);let m=c.boxId(h),f={},v={};if(t+1===s){if(c.useId(h),v[l]=f[l]=m,this.entity.fields.length>0){let e=yield this.vCall(y,d);for(let t in e)v[t]=f[t]=e[t]}}else{v[l]=d[l]=m;for(let t=r+1;t<s;t++)d[this.keyFields[t].name]=0;f[this.keyFields[s].name]=0;let{fields:e}=this.entity;for(let t of e){let{type:e,null:i}=t;!0!==i&&(f[t.name]=Object(o.fieldDefaultValue)(e))}}d.arr1=[f],yield this.entity.actions.add.submit(d);let p=i.findIndex(e=>e.box.id===h);if(p<0)i.push(this.createItem(e,c.tuid,m,r,v));else{let{fields:e}=this.entity;if(void 0!==e&&e.length>0){let e=i[p];i.splice(p,1),e.values=v,i.splice(p,0,e)}}this.removeCeased()})),this.removeClick=(e=>b(this,void 0,void 0,function*(){let t=this.keyFields[e.keyIndex]._tuid,i=this.cUq.cTuidMain(t.tuid).getLable(t.tuid),n=this.res.confirmDelete||s.a.template("do you really want to remove ${label}?");if(!1===window.confirm(n({label:i})))return;let r=this.entity,o={},a={};(o.arr1=[]).push(a);for(let s=e;void 0!==s;s=s.parent){let e=s.keyIndex;a[this.keyFields[e].name]=s.box.id}let l=this.keyFields.length;for(let s=e.keyIndex+1;s<l;s++){a[this.keyFields[s].name]=-1}yield r.actions.del.submit(o);let c=e.parent.children,u=c.findIndex(t=>t===e);u>=0&&c.splice(u,1)}))}internalStart(){return b(this,void 0,void 0,function*(){let{keys:e,schemaFrom:t}=this.entity;this.isFrom=void 0!==t;let i=this.entity.queries.all,n=(yield i.query({})).ret,o=e.length;this.keyUIs=s.a.clone(this.ui.keys||[]),this.keyFields=[];let l=i.returns[0].fields;for(let s=0;s<o;s++)this.keyFields.push(l[s]),s>=this.keyUIs.length&&this.keyUIs.push({content:a.a});this.items=Object(r.l)([]);let c=void 0;for(let s of n){let e=this.addItem(c,s);void 0!==e&&(this.items.push(e),c=e)}yield this.openVPage(this.VMapMain)})}createItem(e,t,i,n,s){let r=new w(e,t,i,n);return n===this.keyFields.length-1&&(r.isLeaf=!0,r.values=s),r}addItem(e,t){let i=void 0,n=this.keyFields.length,s=e;for(let r=0;r<n;r++){let e=this.keyFields[r],{name:n}=e,o=e._tuid,a=t[n];if(void 0===a)break;let{id:l}=a;if(0===r){if(0===l)continue;void 0!==s&&s.box.id===l||(i=s=this.createItem(void 0,o.tuid,a,r,t));continue}let{children:c}=s,u=c.length;if(u>0){let e=c[u-1];if(e.box.id===l){s=e;continue}}l>0&&c.push(s=this.createItem(s,o.tuid,a,r,t))}return i}searchOnKey(e,t){return b(this,void 0,void 0,function*(){let{_tuid:i}=e,{tuid:n,ownerField:s}=i,r=this.cUq.cTuidSelect(n),o=t;void 0!==s&&"object"===typeof(o=t[s.name])&&(o=o.id);let a=yield r.call(o);return i.getIdFromObj(a)})}get VMapMain(){return p}}i.d(t,"a",function(){return x})},function(e,t,i){"use strict";var n=i(6),s=i(0),r=i(1),o=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class a extends n.b{constructor(){super(...arguments),this.view=(()=>s.createElement(r.Page,{header:this.label},"History"))}open(e){return o(this,void 0,void 0,function*(){this.openPage(this.view)})}}var l=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class c extends n.a{internalStart(){return l(this,void 0,void 0,function*(){yield this.openVPage(this.VHistoryMain)})}get VHistoryMain(){return a}}i.d(t,"a",function(){return c})},function(e,t,i){"use strict";var n=i(6),s=i(0),r=i(1),o=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class a extends n.b{constructor(){super(...arguments),this.view=(()=>s.createElement(r.Page,{header:this.label},"pending"))}open(e){return o(this,void 0,void 0,function*(){this.openPage(this.view)})}}var l=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class c extends n.a{internalStart(){return l(this,void 0,void 0,function*(){yield this.openVPage(this.VPendingMain)})}get VPendingMain(){return a}}i.d(t,"a",function(){return c})},function(e,t,i){"use strict";var n=i(6),s=i(0),r=i(1),o=i(12),a=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class l extends n.b{constructor(){super(...arguments),this.onSubmit=(()=>a(this,void 0,void 0,function*(){let e=this.vForm.getValues();this.returns=yield this.controller.submit(e),this.closePage(),this.openPage(this.resultPage)})),this.mainPage=(()=>{let{label:e}=this.controller;return s.createElement(r.Page,{header:e},this.vForm.render("mx-3 my-2"))}),this.resultPage=(()=>{let{label:e}=this.controller;return s.createElement(r.Page,{header:e,back:"close"},"\u5b8c\u6210\uff01",s.createElement("pre",null,Object(o.b)(this.returns)))})}open(e){return a(this,void 0,void 0,function*(){this.vForm=this.createForm(this.onSubmit,e),this.openPage(this.mainPage)})}}var c=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class u extends n.a{internalStart(){return c(this,void 0,void 0,function*(){yield this.openVPage(this.VActionMain)})}get VActionMain(){return l}submit(e){return c(this,void 0,void 0,function*(){return this.entity.submit(e)})}submitReturns(e){return c(this,void 0,void 0,function*(){return this.entity.submitReturns(e)})}}i.d(t,"a",function(){return u})},,function(e,t,i){"use strict";i.d(t,"store",function(){return p});var n=i(2),s=i(8),r=i.n(s),o=i(3),a=i(11),l=i(115),c=i(77),u=(i(104),i(105),function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o}),d=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};const h={id:0,name:"\u540c\u82b1\u7cfb\u7edf",nick:void 0,discription:"\u540c\u82b1\u5e73\u53f0",icon:void 0,date:void 0};class m extends o.PageItems{constructor(e,t){super(!0),this.unit=e,this.query=t,this.appendPosition="head"}load(){return d(this,void 0,void 0,function*(){return yield this.query.loadSchema(),(yield this.query.page(this.param,this.pageStart,this.pageSize)).$page})}setPageStart(e){this.pageStart=void 0===e?void 0:e.id}end(e){this.items.find(t=>t.id===e)}remove(e){let t=this.items.find(t=>t.id===e);void 0!==t&&this.items.remove(t)}addMessage(e){this.remove(e.id),this.append(e),void 0===this.unread&&(this.unread=0),++this.unread}}u([n.l],m.prototype,"unread",void 0);class f{constructor(e){this.id=e,this.messages=new m(this,void 0)}get isOwner(){return this._isOwner}set isOwner(e){this._isOwner=e}get isAdmin(){return this._isAdmin}set isAdmin(e){this._isAdmin=e}loadProps(){return d(this,void 0,void 0,function*(){let e=yield a.a.unitBase(this.id);if(void 0===e)return;let{name:t,discription:i,icon:n,nick:s,isOwner:r,isAdmin:o,owner:l,ownerName:c,ownerNick:u,ownerIcon:d}=e;this.name=t,this.discription=i,this.nick=s,this.icon=n,this.isOwner=r,this.isAdmin=o,this.owner=l,this.ownerName=c,this.ownerNick=u,this.ownerIcon=d})}loadApps(){return d(this,void 0,void 0,function*(){let e,t=yield a.a.apps(this.id);e=void 0===t?[]:t.apps,void 0===t?(t={},r.a.assign(t,h)):0===t.id&&r.a.assign(t,h),r.a.assign(this,t),this.apps=e})}loadMessages(){return d(this,void 0,void 0,function*(){yield a.a.messagesRead(this.id),void 0===this.messages.items&&(yield this.messages.first(void 0))})}messageReadClear(){return d(this,void 0,void 0,function*(){this.unread=0,this.messages.unread=0;let e=p.stickies.find(e=>e.objId===this.id);if(void 0!==e){e.date=void 0;let t=e.obj;void 0!==t&&(t.subject=void 0,t.unread=0)}yield a.a.messagesRead(this.id)})}messageAct(e,t){return d(this,void 0,void 0,function*(){yield a.a.actMessage({unit:this.id,id:e,action:t})})}}u([n.l],f.prototype,"apps",void 0),u([n.l],f.prototype,"unread",void 0),u([n.l],f.prototype,"date",void 0);class v{constructor(){this.unitArray=[],this.units=new Map,this.unit=void 0,this.cacheUsers=new c.b,this.cacheUnits=new c.a,this.follow=new l.a(this)}onWs(e){return d(this,void 0,void 0,function*(){let{from:t,to:i,body:n,push:s}=e;if(void 0===n)return;let{$type:r,$user:o,$unit:a,$io:l,action:c,data:u,msg:d}=n;if("msg"!==r)return;if(!u)return;let h=new Date,m=p.dataToMsg(u);for(let e of this.units){let t=e[1];if(a===t.id){this.onStickyMessage(t,l,h,m.message&&m.message.subject);break}}void 0!==e.id?this.processMessage(e):this.processCommand(e)})}dataToMsg(e){let t=e.split("\t");function i(e){if(e)return Number(e)}let n,s=i(t[0]),r=function(e){if(e)return new Date(1e3*Number(e))}(t[4]),o=i(t[8]),a=i(t[9]),l=t[10],c=t[11];return void 0!==r&&(n={id:s,fromUser:i(t[1]),fromUnit:i(t[2]),type:t[3],date:r,subject:t[5],discription:t[6],content:t[7]}),{id:s,message:n,branch:o,done:a,prevState:l,state:c}}onStickyMessage(e,t,i,n){if(e.unread+=t,e.date=i,void 0!==this.stickies)for(let s of this.stickies)if(s.objId===e.id){void 0!==s.obj&&(s.obj.subject=n);break}}processCommand(e){let{type:t,content:i}=e;switch(t){case"message-end":this.messageEnd(i);break;case"message-removed":this.messageRemoved(i)}}messageEnd(e){let{id:t,unit:i,state:n}=e,s=this.units.get(i);void 0!==s&&s.messages.end(t)}messageRemoved(e){let{id:t,unit:i}=e;this.removeMessage(i,t)}removeMessage(e,t){let i=this.units.get(e);void 0!==i&&i.messages.remove(t)}processMessage(e){}logout(){this.stickies.splice(0,this.stickies.length),this.units.clear(),this.unit=void 0,this.cacheUsers.dict.clear(),this.cacheUnits.dict.clear(),this.follow.logout()}getAdminApp(){return d(this,void 0,void 0,function*(){return void 0!==this.adminApp?this.adminApp:this.adminApp=yield a.a.adminUrl()})}getAppFromId(e){return d(this,void 0,void 0,function*(){return yield a.a.appFromId(e)})}loadStickies(){return d(this,void 0,void 0,function*(){let e=[],t=yield a.a.stickies(),i=t[0],n=t[4];for(let r of i)switch(r.type){case 3:let e=r.obj=n.find(e=>e.id===r.objId),{id:t,type:i,name:s,discription:o,icon:a,unread:l,date:c,owner:u}=e,d=new f(t);d.type=i,d.name=s,d.discription=o,d.icon=a,d.unread=l,d.date=c,d.owner=u,this.units.set(t,d)}e.push(...i);let s=t[5][0];if(void 0!==s){let{unread:t,date:i}=s;this.addSysUnitStick(e,t,i)}this.stickies=e})}newUnit(e){return d(this,void 0,void 0,function*(){let t=new f(e);if(yield t.loadProps(),this.units.set(e,t),this.unitArray.unshift(t),this.unitArray.length>v.maxUnitCount){let e=this.unitArray.pop();this.units.delete(e.id)}return t})}setUnit(e){return d(this,void 0,void 0,function*(){let t=this.units.get(e);if(void 0===t)t=yield this.newUnit(e);else{let e=this.unitArray.findIndex(e=>e===t);e>0&&(this.unitArray.splice(e,1),this.unitArray.unshift(t))}o.appInFrame.unit=e,this.unit=t})}setUnitRead(){return d(this,void 0,void 0,function*(){let{unread:e,id:t}=this.unit;e>0&&(yield a.b.messageRead(t),this.unit.unread=0)})}acceptFellowInvite(e){return d(this,void 0,void 0,function*(){let t=yield a.a.unitAddFellow(e.id);this.follow.removeInvite(e),void 0!==t&&this.stickies.unshift(t)})}addSysUnitStick(e,t,i){if(void 0===t||t<=0)return;let n=e.findIndex(e=>(0===e.type||3===e.type)&&0===e.objId);if(n<0){let i=r.a.clone(h);return i.unread=t,void e.unshift({id:0,date:new Date,type:0,objId:0,obj:i})}if(n>0){let t=e.splice(n,1)[0];e.unshift(t)}}followUnit(e){return d(this,void 0,void 0,function*(){let t=yield a.a.searchUnitsFollow(e),i=this.units.get(e);void 0===i?i=yield this.newUnit(e):i.apps=void 0,this.stickies.unshift({id:t,date:new Date,type:3,objId:e,obj:i})})}unfollowUnit(){return d(this,void 0,void 0,function*(){if(void 0===this.unit)return;this.unit.apps=void 0;let e=this.unit.id;yield a.a.unitNotFollow(e);let t=this.stickies.findIndex(t=>t.objId===e);t<0||this.stickies.splice(t,1)})}}v.maxUnitCount=2,u([n.l],v.prototype,"stickies",void 0),u([n.l],v.prototype,"units",void 0),u([n.l],v.prototype,"unit",void 0);const p=new v},,,,,,,,function(e,t,i){"use strict";i.d(t,"a",function(){return r});var n=i(17),s=i(22);const r={set(e,t){Object(n.i)(e,t),s.a.setCenterToken(t)},clear(){Object(n.i)(0,void 0),s.a.setCenterToken(void 0)}}},function(e,t,i){"use strict";i.d(t,"b",function(){return o}),i.d(t,"a",function(){return a});var n=i(3),s=i(11),r=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class o extends n.CacheIds{_loadIds(e){return r(this,void 0,void 0,function*(){})}_loadId(e){return r(this,void 0,void 0,function*(){return yield s.a.userBase(e)})}}class a extends n.CacheIds{_loadIds(e){return r(this,void 0,void 0,function*(){})}_loadId(e){return r(this,void 0,void 0,function*(){return yield s.a.unitBase(e)})}}},,,function(e,t,i){"use strict";i.d(t,"a",function(){return l}),i.d(t,"c",function(){return c}),i.d(t,"b",function(){return u});var n=i(0),s=i(9),r=i(14),o=i(10),a=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class l{constructor(e){this.isDev=o.d.isDevelopment,this.onMessageReceive=(e=>a(this,void 0,void 0,function*(){yield this.onMessage(e)})),this.res=e||{},this.x=this.res.x||{}}get user(){return s.b.user}get isLogined(){let{user:e}=s.b;return void 0!==e&&e.id>0}dispose(){s.b.unregisterReceiveHandler(this.receiveHandlerId),this.onDispose()}onDispose(){}openVPage(e,t){return a(this,void 0,void 0,function*(){yield new e(this).open(t)})}renderView(e,t){return new e(this).render(t)}event(e,t){return a(this,void 0,void 0,function*(){yield this.onEvent(e,t)})}onEvent(e,t){return a(this,void 0,void 0,function*(){})}msg(e){alert(e)}errorPage(e,t){this.openPage(n.createElement(r.a,{header:"App error!"},n.createElement("pre",null,"string"===typeof t?t:t.message)))}onMessage(e){}beforeStart(){return a(this,void 0,void 0,function*(){return!0})}registerReceiveHandler(){this.receiveHandlerId=s.b.registerReceiveHandler(this.onMessageReceive)}start(e,...t){return a(this,void 0,void 0,function*(){this.disposer=this.dispose.bind(this),this.registerReceiveHandler(),!1!==(yield this.beforeStart())&&(yield this.internalStart(e,...t))})}get isCalling(){return void 0!==this._resolve_$}call(e,...t){return a(this,void 0,void 0,function*(){return void 0===this._resolve_$&&(this._resolve_$=[]),new Promise((i,n)=>a(this,void 0,void 0,function*(){this._resolve_$.push(i),yield this.start(e,...t)}))})}vCall(e,t){return a(this,void 0,void 0,function*(){return void 0===this._resolve_$&&(this._resolve_$=[]),new Promise((i,n)=>a(this,void 0,void 0,function*(){this._resolve_$.push(i),yield new e(this).open(t)}))})}returnCall(e){if(void 0===this._resolve_$)return;let t=this._resolve_$.pop();void 0!==t?t(e):alert("the Controller call already returned, or not called")}openPage(e){s.b.push(e,this.disposer),this.disposer=void 0}replacePage(e){s.b.replace(e,this.disposer),this.disposer=void 0}backPage(){s.b.back()}closePage(e){s.b.pop(e)}ceasePage(e){s.b.ceaseTop(e)}removeCeased(){s.b.removeCeased()}regConfirmClose(e){s.b.regConfirmClose(e)}}class c{constructor(e){this.controller=e,this.res=e.res,this.x=e.x}get isDev(){return o.d.isDevelopment}renderVm(e,t){return new e(this.controller).render(t)}openVPage(e,t){return a(this,void 0,void 0,function*(){yield new e(this.controller).open(t)})}event(e,t){return a(this,void 0,void 0,function*(){yield this.controller.event(e,t)})}vCall(e,t){return a(this,void 0,void 0,function*(){return yield this.controller.vCall(e,t)})}returnCall(e){this.controller.returnCall(e)}openPage(e,t){this.controller.openPage(n.createElement(e,t))}replacePage(e,t){this.controller.replacePage(n.createElement(e,t))}openPageElement(e){this.controller.openPage(e)}replacePageElement(e){this.controller.replacePage(e)}backPage(){this.controller.backPage()}closePage(e){this.controller.closePage(e)}ceasePage(e){this.controller.ceasePage(e)}removeCeased(){this.controller.removeCeased()}regConfirmClose(e){this.controller.regConfirmClose(e)}}class u extends c{render(e){return null}}},function(e,t,i){"use strict";var n=i(82);i.o(n,"Badge")&&i.d(t,"Badge",function(){return n.Badge}),i.o(n,"EasyDate")&&i.d(t,"EasyDate",function(){return n.EasyDate}),i.o(n,"Edit")&&i.d(t,"Edit",function(){return n.Edit}),i.o(n,"EditMeInfo")&&i.d(t,"EditMeInfo",function(){return n.EditMeInfo}),i.o(n,"FA")&&i.d(t,"FA",function(){return n.FA}),i.o(n,"Form")&&i.d(t,"Form",function(){return n.Form}),i.o(n,"IconText")&&i.d(t,"IconText",function(){return n.IconText}),i.o(n,"Image")&&i.d(t,"Image",function(){return n.Image}),i.o(n,"LMR")&&i.d(t,"LMR",function(){return n.LMR}),i.o(n,"List")&&i.d(t,"List",function(){return n.List}),i.o(n,"Muted")&&i.d(t,"Muted",function(){return n.Muted}),i.o(n,"PropGrid")&&i.d(t,"PropGrid",function(){return n.PropGrid}),i.o(n,"SearchBox")&&i.d(t,"SearchBox",function(){return n.SearchBox}),i.o(n,"emailRegex")&&i.d(t,"emailRegex",function(){return n.emailRegex}),i.o(n,"mobileRegex")&&i.d(t,"mobileRegex",function(){return n.mobileRegex}),i.o(n,"resLang")&&i.d(t,"resLang",function(){return n.resLang});var s=i(83);i.o(s,"Badge")&&i.d(t,"Badge",function(){return s.Badge}),i.o(s,"EasyDate")&&i.d(t,"EasyDate",function(){return s.EasyDate}),i.o(s,"Edit")&&i.d(t,"Edit",function(){return s.Edit}),i.o(s,"EditMeInfo")&&i.d(t,"EditMeInfo",function(){return s.EditMeInfo}),i.o(s,"FA")&&i.d(t,"FA",function(){return s.FA}),i.o(s,"Form")&&i.d(t,"Form",function(){return s.Form}),i.o(s,"IconText")&&i.d(t,"IconText",function(){return s.IconText}),i.o(s,"Image")&&i.d(t,"Image",function(){return s.Image}),i.o(s,"LMR")&&i.d(t,"LMR",function(){return s.LMR}),i.o(s,"List")&&i.d(t,"List",function(){return s.List}),i.o(s,"Muted")&&i.d(t,"Muted",function(){return s.Muted}),i.o(s,"PropGrid")&&i.d(t,"PropGrid",function(){return s.PropGrid}),i.o(s,"SearchBox")&&i.d(t,"SearchBox",function(){return s.SearchBox}),i.o(s,"emailRegex")&&i.d(t,"emailRegex",function(){return s.emailRegex}),i.o(s,"mobileRegex")&&i.d(t,"mobileRegex",function(){return s.mobileRegex}),i.o(s,"resLang")&&i.d(t,"resLang",function(){return s.resLang});i(84)},function(e,t){},function(e,t){},function(e,t,i){"use strict"},function(e,t,i){"use strict";i.d(t,"b",function(){return n}),i.d(t,"a",function(){return s});const n=/^[0-9]*$/,s=/\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*/},function(e,t,i){"use strict";i(0),i(4)},function(e,t,i){"use strict";i.d(t,"a",function(){return r});var n=i(0);function s(e,t){if(!e)return null;let i;switch(typeof e){default:i=e;break;case"string":i=new Date(e);break;case"number":i=new Date(1e3*e)}let n,s,r,o,a,l,c,u=new Date,d=i;n=u.getTime()-d.getTime();let h=d.getHours(),m=d.getMinutes();return s=u.getDate(),r=d.getDate(),o=d.getMonth()+1,a=d.getFullYear(),c=u.getFullYear(),l=!0===t?" "+h+(m<10?":0":":")+m:"",n<-864e5?a===c?o+"\u6708"+r+"\u65e5"+l:a+"\u5e74"+o+"\u6708"+r+"\u65e5"+l:n<864e5?r!==s?(n<0?"\u660e\u5929 ":"\u6628\u5929 ")+l:!0===t?l:"\u4eca\u5929":a===c?o+"\u6708"+r+"\u65e5":a+"\u5e74"+o+"\u6708"+r+"\u65e5"}class r extends n.Component{render(){return s(this.props.date,!1)}}},function(e,t,i){"use strict";i(0),i(4),i(1)},function(e,t,i){"use strict";i.d(t,"a",function(){return l});var n=i(0),s=i(4),r=i.n(s),o=i(2),a=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class l extends n.Component{constructor(){super(...arguments),this.key=null,this.onChange=(e=>{this.key=e.target.value,void 0!==this.key&&(this.key=this.key.trim(),""===this.key&&(this.key=void 0)),!0!==this.props.allowEmptySearch&&(this.disabled=!this.key)}),this.onSubmit=(e=>a(this,void 0,void 0,function*(){if(e.preventDefault(),null===this.key&&(this.key=this.props.initKey||""),!0!==this.props.allowEmptySearch){if(!this.key)return;this.input&&(this.input.disabled=!0)}yield this.props.onSearch(this.key),this.input&&(this.input.disabled=!1)}))}clear(){this.input&&(this.input.value="")}render(){let e,t,{className:i,inputClassName:s,onFocus:o,label:a,placeholder:l,buttonText:c,maxLength:u,size:d}=this.props;switch(d){default:case"sm":e="input-group-sm";break;case"md":e="input-group-md";break;case"lg":e="input-group-lg"}return void 0!==a&&(t=n.createElement("label",{className:"input-group-addon"},a)),n.createElement("form",{className:i,onSubmit:this.onSubmit},n.createElement("div",{className:r()("input-group",e)},t,n.createElement("input",{ref:e=>this.input=e,onChange:this.onChange,type:"text",name:"key",onFocus:o,className:r()("form-control",s||"border-primary"),placeholder:l,defaultValue:this.props.initKey,maxLength:u}),n.createElement("div",{className:"input-group-append"},n.createElement("button",{className:"btn btn-primary",type:"submit",disabled:this.disabled},n.createElement("i",{className:"fa fa-search"}),n.createElement("i",{className:"fa"}),c))))}}(function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);r>3&&o&&Object.defineProperty(t,i,o)})([o.l],l.prototype,"disabled",void 0)},function(e,t){},,function(e,t,i){"use strict";i.d(t,"a",function(){return s});var n=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class s{constructor(e){this.loadIds=(()=>{this.clearCacheTimer();let{tuids:e}=this.uq;for(let t in e){e[t].cacheIds()}}),this.uq=e}cacheTuids(e){this.clearCacheTimer(),this.cacheTimer=setTimeout(this.loadIds,e)}clearCacheTimer(){void 0!==this.cacheTimer&&(clearTimeout(this.cacheTimer),this.cacheTimer=void 0)}pullModify(e){if(void 0===e)return;let t=Math.floor(Date.now()/1e3);void 0===this.modifyMax&&(this.modifyMax=this.uq.localModifyMax.get(),void 0===this.modifyMax&&(this.modifyMax={max:e,seconds:t},this.uq.localModifyMax.set(this.modifyMax)));let{max:i,seconds:n}=this.modifyMax;if(t-n<3600)return;if(e<=i)return;let s=[],{tuids:r}=this.uq;for(let o in r)s.push(o);0!==s.length&&(this.modifyMax.seconds=t,this.innerPullModify(s.join("\t")))}innerPullModify(e){return n(this,void 0,void 0,function*(){let{uqApi:t,tuids:i}=this.uq,{max:n}=this.modifyMax,s=yield t.queueModify(n,30,e),r={},o=0;for(let e of s.queue){let{id:t,entity:n,key:s}=e,a=i[n];if(void 0===a)continue;let l=r[n];void 0===l&&(l=r[n]={tuid:a,ids:[]}),l.ids.push(s),t>o&&(o=t)}for(let e in r){let{tuid:t,ids:i}=r[e];yield t.modifyIds(i)}let a=Math.floor(Date.now()/1e3);this.modifyMax={max:o,seconds:a},this.uq.localModifyMax.set(this.modifyMax)})}}},function(e,t,i){"use strict";i.d(t,"a",function(){return o});var n=i(10),s=i(51),r=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class o{constructor(e,t){this.tvs=t||{},this.buildTVs(),this.collection={};let i=e.split("/");if(2!==i.length)throw new Error("tonvaApp name must be / separated, owner/app");this.appOwner=i[0],this.appName=i[1],this.localMap=n.d.localDb.map(e),this.localData=this.localMap.child("uqData")}addUq(e){this.collection[e.name]=e}buildTVs(){for(let e in this.tvs){let t=this.tvs[e];if(void 0===t)continue;let i=e.toLowerCase();if(i!==e){this.tvs[i]=t;for(let e in t){let i=t[e];if(void 0===i)continue;let n=e.toLowerCase();n!==e&&(t[n]=i)}}}}init(e){return r(this,void 0,void 0,function*(){let t=[];for(let i of e){let{uqOwner:e,uqName:n}=i,r=e+"/"+n,o=new s.a(this,i,void 0,this.tvs[r]||this.tvs[n]);this.collection[r]=o;let a=r.toLowerCase();a!==r&&(this.collection[a]=o),t.push(o.init())}yield Promise.all(t)})}load(){return r(this,void 0,void 0,function*(){let e=[],t=[];for(let n in this.collection){let e=this.collection[n];t.push(e.loadEntities())}let i=yield Promise.all(t);for(let n of i){let t=n;void 0===t||e.push(t)}return e})}buildUQs(){let e={};for(let t in this.collection){let i=this.collection[t],n=i.uqName,s=n.toLowerCase(),r=i.entities,o=Object.keys(r);for(let e of o){let t=r[e],{name:i,sName:n}=t;i!==n&&(r[n]=t)}e[t]=r,e[n]=r,s!==n&&(e[s]=r)}return e}setTuidImportsLocal(){let e=[];for(let t in this.collection){let i=this.collection[t];for(let t of i.tuidArr)if(!0===t.isImport){let i=this.setInner(t);i&&e.push(i)}}return e}setInner(e){let{from:t}=e,i=t.owner+"/"+t.uq,n=this.collection[i];if(void 0===n)return`setInner(tuidImport: TuidImport): uq ${i} is not loaded`;let s=e.name,r=n.tuid(s);return void 0===r?`setInner(tuidImport: TuidImport): uq ${i} has no Tuid ${s}`:!0===r.isImport?`setInner(tuidImport: TuidImport): uq ${i} Tuid ${s} is import`:void e.setFrom(r)}}},function(e,t,i){"use strict";i(62),i(95),i(61),i(66),i(31),i(59),i(42),i(63),i(64),i(65),i(16),i(33);var n=i(96);i.o(n,"Badge")&&i.d(t,"Badge",function(){return n.Badge}),i.o(n,"Controller")&&i.d(t,"Controller",function(){return n.Controller}),i.o(n,"EasyDate")&&i.d(t,"EasyDate",function(){return n.EasyDate}),i.o(n,"FA")&&i.d(t,"FA",function(){return n.FA}),i.o(n,"Form")&&i.d(t,"Form",function(){return n.Form}),i.o(n,"IconText")&&i.d(t,"IconText",function(){return n.IconText}),i.o(n,"Image")&&i.d(t,"Image",function(){return n.Image}),i.o(n,"LMR")&&i.d(t,"LMR",function(){return n.LMR}),i.o(n,"List")&&i.d(t,"List",function(){return n.List}),i.o(n,"NavView")&&i.d(t,"NavView",function(){return n.NavView}),i.o(n,"Page")&&i.d(t,"Page",function(){return n.Page}),i.o(n,"PropGrid")&&i.d(t,"PropGrid",function(){return n.PropGrid}),i.o(n,"VPage")&&i.d(t,"VPage",function(){return n.VPage}),i.o(n,"View")&&i.d(t,"View",function(){return n.View}),i.o(n,"nav")&&i.d(t,"nav",function(){return n.nav});i(58),i(6),i(18),i(57)},function(e,t,i){"use strict";i(0),i(62)},function(e,t){},,,,,,,,function(e,t){},function(e,t,i){"use strict";const n=[{id:-99,name:"$self",icon:"tasks",caption:"\u81ea\u5df1\u5f85\u529e",discription:void 0,content:{needTo:!1}},{id:-98,name:"$dispatch",icon:"share-square",caption:"\u7ed9\u540c\u4e8b\u53d1\u4efb\u52a1",discription:void 0,content:{needTo:!0}}],s={};for(let r of n)s[r.name]=r},function(e,t,i){"use strict";var n=i(0),s=i(2),r=i(4),o=i.n(r),a=i(8),l=i.n(a);class c{}class u extends c{constructor(e){super(),this.func=e}check(e,t){let i=this.func(t);if(void 0!==i)switch(typeof i){case"undefined":return;case"string":return void e.push(i);default:return void e.push(...i)}}}class d extends c{constructor(e){super(),this.res=e}}class h extends d{check(e,t){switch(typeof t){default:case"boolean":return;case"object":if(null!==t)return;break;case"string":if(t.trim().length>0)return;break;case"number":if(!1===isNaN(t))return;break;case"undefined":}e.push(this.res.required)}}class m extends d{constructor(e,t,i){super(e),this.minMsg=l.a.template(e.min),this.maxMsg=l.a.template(e.max),this.min=t,this.max=i}check(e,t){if(void 0===t||null===t)return;let i=Number(t);!0===isNaN(i)?e.push(this.res.number):this.checkMore(e,i)}checkMore(e,t){void 0!==this.min&&Number(t)<this.min&&e.push(this.minMsg({min:this.min})),void 0!==this.max&&Number(t)>this.max&&e.push(this.maxMsg({max:this.max}))}}class f extends m{checkMore(e,t){super.checkMore(e,t),!1===Number.isInteger(t)&&e.push(this.res.integer)}}var v=i(5),p=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};class g{constructor(e,t,i,s){this.errors=[],this.contextErrors=[],this.onInputChange=(e=>{this.changeValue(e.target.value,!0)}),this.container=Object(v.a)(()=>{if(!1===this.visible)return null;let{form:e,inNode:t}=this.context;if(!0===t)return this.render();let i=this.label;return!0===this.itemSchema.required&&!1!==e.props.requiredFlag&&null!==i&&(i=n.createElement(n.Fragment,null,i,"\xa0",n.createElement("span",{className:"text-danger"},"*"))),e.FieldContainer(i,this.renderBody())}),this.context=e;let{name:r}=t;if(this.name=r,this._itemSchema=t,this.fieldProps=i,this.children=s,this._ui=e.getUiItem(r),void 0===this.ui)this.readOnly=!1,this.disabled=!1,this.visible=!0;else{let{readOnly:e,disabled:t,visible:i}=this.ui;this.readOnly=!0===e,this.disabled=!0===t,this.visible=!(!1===i)}this.value=this.defaultValue=e.getValue(r),this.init()}get hasError(){return this.errors.length+this.contextErrors.length>0}get itemSchema(){return this._itemSchema}get ui(){return this._ui}init(){if(this.rules=[],!0===this.itemSchema.required&&this.rules.push(new h(this.context.form.res)),this.buildRules(),void 0===this.ui)return;let{rules:e}=this.ui;if(void 0!==e)if(!1!==Array.isArray(e))for(let t of e)this.rules.push(new u(t));else this.rules.push(new u(e))}buildRules(){}checkRules(){let e=[];for(let t of this.rules)t.check(e,this.value);0===e.length?this.context.removeErrorWidget(this):(this.context.addErrorWidget(this),this.errors.push(...e))}get isOk(){return 0===this.errors.length}setError(e){void 0!==e&&("string"===typeof e?this.errors.push(e):this.errors.push(...e))}setContextError(e){void 0!==e&&("string"===typeof e?this.contextErrors.push(e):this.contextErrors.push(...e))}clearError(){this.errors.splice(0)}clearContextError(){this.contextErrors.splice(0)}parse(e){return e}setElementValue(e){}setDataValue(e){!0!==this.isChanging&&(this.context.initData[this.name]=this.value=this.parse(e))}setValue(e){!0!==this.isChanging&&this.changeValue(e,!1)}getValue(){return this.context.getValue(this.name)}getReadOnly(){return this.readOnly}getDisabled(){return this.disabled}getVisible(){return this.visible}setReadOnly(e){this.readOnly=e}setDisabled(e){this.disabled=e}setVisible(e){this.visible=e}changeValue(e,t){let i,n,s=this.value;void 0!==this.ui&&(i=this.ui.onChanging,n=this.ui.onChanged);let r=!0;void 0!==i&&(this.isChanging=!0,r=i(this.context,this.value,s),this.isChanging=!1),!0===r&&(this.setDataValue(e),!0!==t&&this.setElementValue(e),void 0!==n&&(this.isChanging=!0,n(this.context,this.value,s),this.isChanging=!1))}get className(){let e;return!1===this.context.inNode&&(e="form-control"),o()(e,this.context.form.FieldClass,this.ui&&this.ui.className)}renderBody(){let e;if(!1===this.hasError&&this.ui){let{discription:t,discriptionClassName:i}=this.ui;void 0===i&&(i="small text-muted"),e=n.createElement("span",{className:i},t)}return n.createElement(n.Fragment,null,this.render(),e)}get label(){let e;if(void 0===this.ui)e=this.name;else{let t=this.ui.label;e=null===t?null:t||this.name}return e}renderTemplet(){if(void 0!==this.children)return n.createElement(n.Fragment,null,this.children);if(void 0===this.ui)return;let{Templet:e}=this.ui;return"function"===typeof e?e(this.value):e}renderErrors(){let e=[...this.errors,...this.contextErrors];if(0===e.length)return null;let{inNode:t}=this.context,i=!0===t?"span":"div";return e.map(e=>n.createElement(i,{key:e,className:"text-danger d-inline-block my-2 ml-3"},n.createElement(n.Fragment,null,n.createElement("i",{className:"fa fa-exclamation-circle"})," \xa0",e)))}}p([s.l],g.prototype,"errors",void 0),p([s.l],g.prototype,"contextErrors",void 0),p([s.e],g.prototype,"hasError",null),p([s.l],g.prototype,"visible",void 0),p([s.e],g.prototype,"isOk",null);var y=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class b extends g{constructor(){super(...arguments),this.inputType="text",this.onKeyDown=(e=>y(this,void 0,void 0,function*(){if(this.internalOnKeyDown(e),13!==e.keyCode)return;let{onEnter:t}=this.context.form.props;if(void 0===t)return;this.changeValue(e.currentTarget.value,!0),this.input.blur();let i=yield t(this.name,this.context);void 0!==i&&this.context.setError(this.name,i)}))}get ui(){return this._ui}setElementValue(e){null!==this.input&&(this.input.value=e)}get placeholder(){return this.ui&&this.ui.placeholder||this.name}internalOnKeyDown(e){}onBlur(e){this.onInputChange(e),this.checkRules(),this.context.checkContextRules()}onFocus(e){this.clearError(),this.context.removeErrorWidget(this),this.context.clearErrors()}onChange(e){}setReadOnly(e){null!==this.input&&(this.input.readOnly=this.readOnly=e)}setDisabled(e){null!==this.input&&(this.input.disabled=this.disabled=e)}render(){let e=this.renderTemplet();if(void 0!==e)return e;let t={};return!0===this.hasError?t["is-invalid"]=!0:t["required-item"]=!0===this.itemSchema.required,n.createElement(n.Fragment,null,n.createElement("input",{ref:e=>this.input=e,className:o()(this.className,t),type:this.inputType,defaultValue:this.value,onChange:e=>this.onChange(e),placeholder:this.placeholder,readOnly:this.readOnly,disabled:this.disabled,onKeyDown:this.onKeyDown,onFocus:e=>this.onFocus(e),onBlur:e=>this.onBlur(e),maxLength:this.itemSchema.maxLength}),this.renderErrors())}}class w extends b{constructor(){super(...arguments),this.inputType="number"}get itemSchema(){return this._itemSchema}buildRules(){super.buildRules();let e=this.context.form.res,{min:t,max:i}=this.itemSchema;this.rules.push("integer"===this.itemSchema.type?new m(e,t,i):new f(e,t,i))}parse(e){if(void 0!==e&&null!==e)return Number(e)}}class x extends w{constructor(){super(...arguments),this.inputType="number"}isValidKey(e){return 46===e||8===e||37===e||39===e||e>=48&&e<=57||e>=96&&e<=105||109===e||189===e}internalOnKeyDown(e){let t=e.keyCode;window.event.returnValue=this.isValidKey(t)}}class E extends b{constructor(){super(...arguments),this.inputType="date"}}class k extends g{constructor(){super(...arguments),this.onInputChange=(e=>{this.setDataValue(!0===e.target.checked?this.trueValue:this.falseValue)}),this.onClick=(()=>{this.context.clearErrors()})}get ui(){return this._ui}init(){if(super.init(),void 0!==this.ui){let{trueValue:e,falseValue:t}=this.ui;this.trueValue=void 0===e||e,this.falseValue=void 0!==t&&t}else this.trueValue=!0,this.falseValue=!1}setElementValue(e){this.input.checked=e===this.trueValue}setReadOnly(e){this.input.readOnly=this.readOnly=e}setDisabled(e){this.input.disabled=this.disabled=e}render(){let e=o()(this.className,"form-check-inline p-0"),t=n.createElement("input",{ref:e=>this.input=e,className:"align-self-center",type:"checkbox",defaultChecked:this.defaultValue,onChange:this.onInputChange,onClick:this.onClick});return!0===this.context.inNode?n.createElement("label",{className:e},t," ",this.ui&&this.ui.label||this.name):n.createElement("div",{className:e},n.createElement("label",{className:"w-100 h-100 mb-0 d-flex justify-content-center"},t))}}class C extends g{constructor(){super(...arguments),this.onInputChange=(e=>{this.setDataValue(e.target.value)})}get ui(){return this._ui}setElementValue(e){this.select.value=e}setReadOnly(e){this.select.disabled=this.readOnly=!e}setDisabled(e){this.select.disabled=this.disabled=e}render(){if(!0===this.readOnly){let e=this.ui.list.find(e=>e.value===this.value),t=void 0===e?"(???)":e.title;return n.createElement("span",{className:"form-control w-min-6c"},t)}return n.createElement("select",{ref:e=>this.select=e,className:o()(this.className,"form-control"),defaultValue:this.defaultValue,onChange:this.onInputChange},this.ui.list.map((e,t)=>{let{title:i,value:s}=e;return n.createElement("option",{className:void 0,key:t,value:s},i||s)}))}}(function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);r>3&&o&&Object.defineProperty(t,i,o)})([s.l],C.prototype,"readOnly",void 0);const P={height:"auto"};var N=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class I extends g{constructor(){super(...arguments),this.onClick=(()=>N(this,void 0,void 0,function*(){let e=this.ui&&this.ui.pickId;if(void 0===e)return void alert("no pickId defined!");let t=yield e(this.context,this.name,this.value);this.setDataValue(t),this.clearError(),this.clearContextError(),this.checkRules()}))}get ui(){return this._ui}setReadOnly(e){this.readOnly=e}setDisabled(e){this.disabled=e}render(){let e,t;void 0!==this.ui&&(e=this.ui.placeholder,t=this.ui.Templet);let i,s={"form-control":!0,"required-item":!0===this.itemSchema.required,"cursor-pointer":!0,"is-invalid":this.hasError};return void 0===this.value||null===this.value?(i=e||"placeholder",s["text-muted"]=!0):i=void 0===t?n.createElement(n.Fragment,null,this.value):"function"===typeof t?t(this.value):t,n.createElement(n.Fragment,null,n.createElement("div",{className:o()(s),onClick:this.onClick},i),this.renderErrors())}}(function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);r>3&&o&&Object.defineProperty(t,i,o)})([s.l],I.prototype,"value",void 0);const S=(e,t,i)=>n.createElement("span",{className:"text-danger"},"!!data type ",e," only support ",(i||[]).join(", "),", can't use ui ",t,"!!");var F=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class T extends g{constructor(){super(...arguments),this.onClick=(()=>F(this,void 0,void 0,function*(){this.clearError(),this.clearContextError();let{name:e,type:t}=this.itemSchema;"submit"===t&&(yield this.context.submit(e))})),this.observerRender=Object(v.a)(()=>{let e,t,i,{name:s,type:r}=this.itemSchema;if(void 0!==this.ui){let{widget:n}=this.ui;if("button"!==n)return S(r,n,["button"]);e=this.ui.Templet,t=this.ui.className,i=this.ui.label}let o,{form:a,hasError:l}=this.context,c=this.context,u="submit"===r&&l;o=void 0!==this.children?this.children:"function"===typeof e?e():void 0!==e?e:i;let d=n.createElement("button",{className:t,type:"button",disabled:u,onClick:this.onClick},o||s);return!0===c.inNode?n.createElement(n.Fragment,null,d,this.renderErrors()):n.createElement("div",{className:a.ButtonClass},n.createElement("div",null,this.renderErrors()),d)})}get ui(){return this._ui}get label(){return null}render(){return n.createElement(this.observerRender,null)}}var O=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o},R=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class A{constructor(e,t,i,s,r){if(this.widgets={},this.errors=[],this.errorWidgets=[],this.renderErrors=Object(v.a)(()=>{let{errors:e}=this;return 0===e.length?null:n.createElement(n.Fragment,null,e.map(e=>n.createElement("span",{key:e,className:"text-danger inline-block my-1 ml-3"},n.createElement("i",{className:"fa fa-exclamation-circle"})," \xa0",e)))}),this.form=e,this.uiSchema=t,this.initData=i,this.inNode=s,this.isRow=r,void 0!==t){let{rules:e}=t;void 0!==e&&(this.rules=[],!1===Array.isArray(e)?this.rules.push(e):this.rules.push(...e))}}getArrRowContexts(e){void 0===this.subContexts&&(this.subContexts={});let t=this.subContexts[e];return void 0===t&&(this.subContexts[e]=t={}),t}get arrName(){}getValue(e){return this.initData[e]}setValue(e,t){this.initData[e]=t;let i=this.widgets[e];void 0!==i&&i.setValue(t)}getDisabled(e){let t=this.widgets[e];if(void 0!==t)return t.getDisabled()}setDisabled(e,t){let i=this.widgets[e];void 0!==i&&i.setDisabled(t)}getReadOnly(e){let t=this.widgets[e];void 0!==t&&t.getReadOnly()}setReadOnly(e,t){let i=this.widgets[e];void 0!==i&&i.setReadOnly(t)}getVisible(e){let t=this.widgets[e];void 0!==t&&t.getVisible()}setVisible(e,t){let i=this.widgets[e];void 0!==i&&i.setVisible(t)}submit(e){return R(this,void 0,void 0,function*(){if(this.checkRules(),!0===this.hasError){let e="";for(let t of this.errorWidgets)e+=t.name+":\n"+t.errors.join("\n");return void console.error(e)}let{onButtonClick:t}=this.form.props;if(void 0===t)return void alert(`button ${e} clicked. you should define form onButtonClick`);let i=yield t(e,this);void 0!==i&&this.setError(e,i)})}checkFieldRules(){for(let e in this.widgets)this.widgets[e].checkRules();if(void 0!==this.subContexts)for(let e in this.subContexts){let t=this.subContexts[e];for(let e in t)t[e].checkFieldRules()}}checkContextRules(){if(this.clearErrors(),void 0!==this.rules){for(let e of this.rules){let t=e(this);if(void 0!==t)if(!0===Array.isArray(t))this.errors.push(...t);else if("string"===typeof t)this.errors.push(t);else for(let e in t)this.setError(e,t[e])}if(void 0!==this.subContexts)for(let e in this.subContexts){let t=this.subContexts[e];for(let e in t){let i=t[e];i.clearErrors(),i.checkContextRules()}}}}setError(e,t){let i=this.widgets[e];void 0!==i&&(i.setContextError(t),this.addErrorWidget(i))}clearContextErrors(){for(let e in this.widgets){let t=this.widgets[e];void 0!==t&&t.clearContextError()}}clearWidgetsErrors(){for(let e in this.widgets){let t=this.widgets[e];void 0!==t&&t.clearError()}}checkRules(){this.clearErrors(),this.clearWidgetsErrors(),this.checkFieldRules(),!0!==this.hasError&&this.checkContextRules()}addErrorWidget(e){this.errorWidgets.findIndex(t=>t===e)<0&&this.errorWidgets.push(e)}removeErrorWidget(e){let t=this.errorWidgets.findIndex(t=>t===e);t>=0&&this.errorWidgets.splice(t,1)}checkHasError(){if(!0===this.errorWidgets.length+this.errors.length>0)return!0;if(void 0===this.subContexts)return!1;for(let e in this.subContexts){let t=this.subContexts[e];for(let e in t)if(!0===t[e].hasError)return!0}return!1}get hasError(){return this.checkHasError()}clearErrors(){this.errors.splice(0),this.errorWidgets.splice(0),this.clearContextErrors()}}O([s.l],A.prototype,"errors",void 0),O([s.l],A.prototype,"errorWidgets",void 0),O([s.e],A.prototype,"hasError",null);let V=1;class q extends A{constructor(e,t,i,n){let s,{uiSchema:r}=e;if(void 0!==r){let{items:e}=r;void 0!==e&&(s=e[t.name])}super(e.form,s,i,n,!0),this.parentContext=e,this.arrSchema=t,this.rowKey=V++,this.data=i}getItemSchema(e){return this.arrSchema.itemSchemas[e]}getUiItem(e){if(void 0===this.uiSchema)return;let{items:t}=this.uiSchema;return void 0!==t?t[e]:void 0}get arrName(){return this.arrSchema.name}clearErrors(){super.clearErrors(),this.parentContext.clearErrors()}get parentData(){return this.parentContext.data}}class j extends A{constructor(e,t){super(e,e.uiSchema,e.data,t,!1)}get data(){return this.form.data}getItemSchema(e){return this.form.itemSchemas[e]}getUiItem(e){let{uiSchema:t}=this.form;if(void 0===t)return;let{items:i}=t;return void 0!==i?i[e]:void 0}}const U=n.createContext({}),L=Object(v.a)(({parentContext:e,arrSchema:t,children:i})=>{let s,r,a,l,{name:c,arr:u}=t,d=e.initData[c],{form:h}=e,m=e.getArrRowContexts(c),f=e.getUiItem(c),p=c,{ArrContainer:g,RowContainer:y,RowSeperator:b,uiSchema:w}=h;if(void 0!==w){let{selectable:e,deletable:t,restorable:i}=w;!0!==r&&(r=e),!0!==a&&(a=t),!0!==l&&(l=i)}if(void 0!==f){let{widget:e,label:i,selectable:n,deletable:o,restorable:c,ArrContainer:u,RowContainer:d,RowSeperator:h}=f;if(void 0!==n&&(r=n),void 0!==o&&(a=o),void 0!==c&&(l=c),void 0!==u&&(g=u),void 0!==d&&(y=d),void 0!==h&&(b=h),s=f.Templet,"arr"!==e)return S(t.type,e,["arr"]);p=i||p}let x=!0;return g(p,n.createElement(n.Fragment,null,d.map((c,h)=>{let f,p,g=void 0;if(!1===x?g=b:x=!1,void 0!==i)f=new q(e,t,c,!0),p=n.createElement(n.Fragment,null,i);else{let i=typeof s;"function"===i?(f=new q(e,t,c,!0),p=n.createElement(Object(v.a)(s),c)):"object"===i?(f=new q(e,t,c,!0),p=s):(f=new q(e,t,c,!1),p=n.createElement(n.Fragment,null,u.map((e,t)=>n.createElement(n.Fragment,{key:e.name},H(f,e,void 0)))))}let w,E,{rowKey:k}=f;if(m[k]=f,!0===r){let e=e=>{let{checked:t}=e.target;c.$isSelected=t;let{$source:i}=c;void 0!==i&&(i.$isSelected=t),f.clearErrors()};w=n.createElement("div",{className:"form-row-checkbox"},n.createElement("input",{type:"checkbox",onClick:e,defaultChecked:c.$isSelected}))}let C=!(void 0===c.$isDeleted||!1===c.$isDeleted);if(!0===a){let e=C?"fa-undo":"fa-trash",t=()=>{if(!0===l){c.$isDeleted=!C;let{$source:e}=c;void 0!==e&&(e.$isDeleted=!C)}else{let e=d.indexOf(c);e>=0&&d.splice(e,1)}f.clearErrors()};E=n.createElement("div",{className:"form-row-edit text-info",onClick:t},n.createElement("i",{className:o()("fa",e,"fa-fw")}))}let P=!0===r||!0===a?e=>n.createElement("fieldset",{disabled:C},n.createElement("div",{className:o()("d-flex",{deleted:C,"row-selected":c.$isSelected})},w,n.createElement("div",{className:!0===r&&!0===a?"form-row-content":"form-row-content-1"},e),E)):e=>e;return n.createElement(U.Provider,{key:k,value:f},g,y(P(n.createElement(n.Fragment,null,n.createElement(f.renderErrors,null),p))))})))});var M=i(27),D=i(43),B=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class _ extends g{constructor(){super(...arguments),this.onClick=(()=>B(this,void 0,void 0,function*(){let e=new D.a(this.itemSchema,this.ui,this.ui.label,this.value),t=yield e.start();null!==t&&(this.setValue(t),this.imageSrc=t),yield e.end()})),this.observerRender=Object(v.a)(()=>{let e,t=["bg-white p-1 d-flex justify-content-center"];return this.readOnly||this.disabled||(t.push("cursor-pointer"),e=this.onClick),n.createElement("div",{className:o()(t),onClick:e},n.createElement(M.a,{src:this.imageSrc,className:"w-4c h-4c"}))})}get ui(){return this._ui}init(){super.init(),this.imageSrc=this.value}render(){return n.createElement(this.observerRender,null)}}(function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);r>3&&o&&Object.defineProperty(t,i,o)})([s.l],_.prototype,"imageSrc",void 0);const $={id:{dataTypes:["id"],widget:I},text:{dataTypes:["integer","number","string"],widget:b},textarea:{dataTypes:["string"],widget:class extends g{constructor(){super(...arguments),this.onInputChange=(e=>{this.setValue(e.currentTarget.value)})}get itemSchema(){return this._itemSchema}get ui(){return this._ui}setElementValue(e){this.input.value=e}setReadOnly(e){this.input.readOnly=this.readOnly=e}setDisabled(e){this.input.disabled=this.disabled=e}render(){let e=this.renderTemplet();if(void 0!==e)return e;let t={};return!0===this.hasError?t["is-invalid"]=!0:t["required-item"]=!0===this.itemSchema.required,n.createElement("textarea",{ref:e=>this.input=e,className:o()(this.className,t),rows:this.ui&&this.ui.rows,maxLength:this.itemSchema.maxLength,defaultValue:this.defaultValue,onChange:this.onInputChange})}}},password:{dataTypes:["string"],widget:class extends b{constructor(){super(...arguments),this.inputType="password"}}},date:{dataTypes:["date"],widget:E},datetime:{dataTypes:["date"],widget:class extends b{constructor(){super(...arguments),this.inputType="datetime"}}},time:{dataTypes:["date"],widget:class extends b{constructor(){super(...arguments),this.inputType="time"}}},month:{dataTypes:["date"],widget:class extends b{constructor(){super(...arguments),this.inputType="month"}}},select:{dataTypes:["integer","number","string","date","boolean"],widget:C},url:{dataTypes:["string"],widget:class extends b{constructor(){super(...arguments),this.inputType="url"}}},email:{dataTypes:["string"],widget:class extends b{constructor(){super(...arguments),this.inputType="email"}}},number:{dataTypes:["integer","number"],widget:w},updown:{dataTypes:["integer","number"],widget:x},color:{},checkbox:{dataTypes:["boolean","integer","number"],widget:k},image:{dataTypes:["string"],widget:_},checkboxes:{},radio:{dataTypes:["integer","number","string","date","boolean"],widget:class extends g{constructor(){super(...arguments),this.inputs={}}get ui(){return this._ui}setElementValue(e){for(let t in this.inputs){let i=this.inputs[t];i.checked=e===i.value}}setReadOnly(e){this.readOnly=e;for(let t in this.inputs)this.inputs[t].readOnly=e}setDisabled(e){this.disabled=e;for(let t in this.inputs)this.inputs[t].disabled=e}render(){let e,{defaultValue:t,list:i}=this.ui,{isRow:s}=this.context;!0===s&&(e=this.context.rowKey);let r=o()(this.className,"py-0");return n.createElement("span",{className:r,style:P},i.map((i,s)=>{let{value:r,title:o}=i,a=this.name;return void 0!==e&&(a+="-"+e),n.createElement("label",{key:s,className:"form-radio-inline"},n.createElement("input",{ref:e=>this.inputs[s]=e,type:"radio",name:a,value:r,defaultChecked:(this.defaultValue||t)===r,onChange:this.onInputChange}),o||r)}))}}},range:{dataTypes:["integer"],widget:class extends g{constructor(){super(...arguments),this.inputType="range"}get ui(){return this._ui}setReadOnly(e){this.input.readOnly=this.readOnly=e}setDisabled(e){this.input.disabled=this.disabled=e}render(){let{min:e,max:t,step:i}=this.ui;return n.createElement(n.Fragment,null,n.createElement("input",{ref:e=>this.input=e,className:o()(this.className,"form-control","w-min-6c"),type:this.inputType,defaultValue:this.defaultValue,onChange:this.onInputChange,max:t,min:e,step:i}))}}},button:{dataTypes:["button","submit"],widget:T}};function H(e,t,i,s){if(void 0===e)return null;if(void 0===t)return;let r,{name:o,type:a}=t;switch(a){case"arr":let t=e.getItemSchema(o);return n.createElement(L,{parentContext:e,arrSchema:t,children:i})}let l=e.getUiItem(o);function c(e){switch(e){default:return b;case"id":return I;case"integer":return x;case"number":return w;case"string":return b;case"date":return E;case"boolean":return k;case"button":case"submit":return T}}if(void 0===l)r=c(a);else{let{widget:e}=l;switch(e){default:if(void 0!==e){r=$[e].widget}void 0===r&&(r=c(a));break;case"custom":r=l.WidgetClass;break;case"group":return n.createElement("span",null,"impletment group")}}let{widgets:u}=e,d=new r(e,t,s,i);return u[o]=d,n.createElement(d.container,null)}i(79);const W={_:{required:"required",number:"not valid number",integer:"not valid integer",min:"min value is ${min}",max:"max value is ${max}"},zh:{_:{required:"\u5fc5\u987b\u586b",number:"\u9700\u8981\u6570\u5b57",integer:"\u9700\u8981\u6574\u6570",min:"\u4e0d\u80fd\u5c0f\u4e8e${min}",max:"\u4e0d\u80fd\u5927\u4e8e${max}"}}};var z=i(37),G=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class Q extends n.Component{constructor(e){super(e),this.watch=(()=>{let{formData:e}=this.props;void 0!==e&&this.calcSelectOrDelete()}),this.DefaultContainer=(e=>n.createElement("form",{className:o()(this.props.className),onSubmit:e=>e.preventDefault()},e)),this.DefaultFieldContainer=((e,t)=>{let{fieldLabelSize:i}=this.props;if(i>0){let s;null===e?i=0:s=n.createElement("label",{className:o()("col-sm-"+i,"col-form-label")},e);let r="col-sm-"+(12-i);return n.createElement("div",{className:"form-group row"},s,n.createElement("div",{className:r},t))}return n.createElement("div",{className:"form-group"},null===e?null:n.createElement("label",{className:"col-form-label"},e),t)}),this.DefaultFieldClass=void 0,this.DefaultButtonClass="text-center py-2",this.DefaultRes=Object(z.a)(W),this.ArrContainer=((e,t)=>n.createElement("div",null,n.createElement("div",{className:o()("small text-muted text-center bg-light py-1 px-3 mt-4 mb-1")},e),t)),this.RowContainer=(e=>{let t=o()({"py-3":!0});return n.createElement("div",{className:t},e)}),this.RowSeperator=n.createElement("div",{className:"border border-gray border-top"});let{schema:t,uiSchema:i,Container:r,FieldContainer:a,FieldClass:l,ButtonClass:c,res:u}=e;this.Container=r||this.DefaultContainer,this.FieldContainer=a||this.DefaultFieldContainer,this.FieldClass=void 0!==l&&""!==l&&null!==l?l:this.DefaultFieldClass,this.res=u||this.DefaultRes,this.ButtonClass=c||this.DefaultButtonClass,this.schema=t,this.itemSchemas={};for(let n of this.schema)this.itemSchemas[n.name]=n;this.uiSchema=i,this.disposer=Object(s.d)(this.watch),this.data={}}renderContent(){this.initData(this.props.formData);let e,{children:t}=this.props;return void 0!==t?(this.formContext=new j(this,!0),n.createElement(n.Fragment,null,t)):(void 0!==this.uiSchema&&(e=this.uiSchema.Templet),void 0!==e?(this.formContext=new j(this,!0),"function"===typeof e?e(this.data):e):(this.formContext=new j(this,!1),n.createElement(n.Fragment,null,this.schema.map((e,i)=>n.createElement(n.Fragment,{key:i},H(this.formContext,e,t))))))}initData(e){void 0===e&&(e={});for(let t of this.schema)this.initDataItem(t,this.data,e)}initDataItem(e,t,i){let{name:n,type:r}=e;if("button"===r)return;if("arr"!==r)return void(t[n]=i[n]);let o=e,{arr:a}=o;if(void 0===a)return;let l=o.itemSchemas={};for(let s of a)l[s.name]=s;let c=i[n];void 0===c?c=[]:!1===Array.isArray(c)&&(c=[c]);let u=[];for(let s of c){let{$isSelected:e,$isDeleted:t}=s,i={$source:s,$isSelected:e,$isDeleted:t};for(let n of a)this.initDataItem(n,i,s);u.push(i)}t[n]=Object(s.l)(u)}calcSelectOrDelete(){for(let e of this.schema)this.arrItemOperated(e)}arrItemOperated(e){let{name:t,type:i}=e;if("arr"!==i)return;if(void 0===this.data)return;let n=this.data[t];if(void 0===n)return;let{arr:s}=e;for(let r of n){let{$source:e}=r;if(void 0===e)continue;let{$isSelected:t,$isDeleted:i}=e;r.$isSelected=t,r.$isDeleted=i;for(let n of s)this.arrItemOperated(n)}}componentDidMount(){let{beforeShow:e}=this.props;void 0!==e&&e(this.formContext)}componentWillUnmount(){void 0!==this.disposer&&this.disposer()}render(){let e=this.renderContent();return n.createElement(U.Provider,{value:this.formContext},n.createElement(this.formContext.renderErrors,null),this.Container(e))}buttonClick(e){return G(this,void 0,void 0,function*(){if(this.formContext.checkRules(),!0===this.formContext.hasError)return;let{onButtonClick:t}=this.formContext.form.props;if(void 0===t)return void alert("you should define form onButtonClick");let i=yield t(e,this.formContext);void 0!==i&&this.formContext.setError(e,i)})}}(class extends n.Component{render(){let{name:e,children:t}=this.props,i=this.context;if(void 0===i)return n.createElement("span",{className:"text-danger"},"!only in Form!");let s=i.getItemSchema(e),r=H(i,s,t,this.props);return void 0===r?n.createElement("span",{className:"text-danger"},"!!",e," is not defined!!"):r}}).contextType=U,i.d(t,"a",function(){return Q})},function(e,t,i){"use strict";i(1),i(23);var n=i(7),s=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};new class extends n.b{userAppUnits(e){return s(this,void 0,void 0,function*(){return yield this.get("tie/user-app-units",{app:e})})}}("tv/",void 0);i(0)},function(e,t,i){"use strict";var n=i(0),s=i(5),r=i(9),o=i(14),a=i(25),l=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class c extends a.a{constructor(){super(...arguments),this.onChange=(e=>{this.newValue=e.target.value;let t=this.value;this.isChanged=this.newValue!==t}),this.onBlur=(e=>{this.verifyValue()}),this.onFocus=(()=>{this.error=void 0}),this.page=Object(s.a)(e=>{let{resolve:t}=e,i=n.createElement("button",{className:"btn btn-sm btn-success",disabled:!this.isChanged,onClick:()=>{this.verifyValue(),void 0===this.error&&t(this.newValue)}},"\u4fdd\u5b58");return n.createElement(o.a,{header:"\u66f4\u6539"+this.label,right:i},n.createElement("div",{className:"m-3"},n.createElement("input",{type:"text",onChange:this.onChange,onBlur:this.onBlur,onFocus:this.onFocus,className:"form-control",defaultValue:this.value}),this.uiItem&&n.createElement("div",{className:"small muted m-2"},this.uiItem.placeholder),this.error&&n.createElement("div",{className:"text-danger"},this.error)))})}internalStart(){return l(this,void 0,void 0,function*(){return new Promise((e,t)=>{let i=n.createElement(this.page,{resolve:e,reject:t});r.b.push(i,t)})})}}var u=i(43),d=i(27),h=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class m extends a.a{constructor(e,t,i,r){super(e,t,i,r),this.onChange=(e=>{this.newValue=e;let t=this.value;this.isChanged=this.newValue!==t}),this.page=Object(s.a)(e=>{let{resolve:t}=e,{name:i}=this.itemSchema,{list:s}=this.uiItem,r=n.createElement("button",{className:"btn btn-sm btn-success",disabled:!this.isChanged,onClick:()=>{this.verifyValue(),void 0===this.error&&t(this.newValue)}},"\u4fdd\u5b58"),a=s?s.map((e,t)=>{let{title:s,value:r}=e;return n.createElement("label",{key:t,className:"px-3 py-2 cursor-pointer"},n.createElement("input",{name:i,type:"radio",value:r,onClick:()=>this.onChange(r),defaultChecked:r===this.value})," ",s||r," \xa0")}):n.createElement(n.Fragment,null,"no list defined");return n.createElement(o.a,{header:"\u66f4\u6539"+this.label,right:r},n.createElement("div",{className:"m-3"},a))}),void 0===this.value&&(this.value=t.defaultValue)}internalStart(){return h(this,void 0,void 0,function*(){return new Promise((e,t)=>{let i=n.createElement(this.page,{resolve:e,reject:t});r.b.push(i,t)})})}}var f=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class v extends a.a{constructor(){super(...arguments),this.onChange=(e=>{this.newValue=e;let t=this.value;this.isChanged=this.newValue!==t}),this.page=Object(s.a)(e=>{let{resolve:t}=e,{list:i}=this.uiItem,s=i?i.map((e,i)=>{let{title:s,value:r}=e;return n.createElement("div",{key:i,className:"px-3 py-2 cursor-pointer bg-white mb-1",onClick:()=>{this.onChange(r),t(this.newValue)}},s||r)}):n.createElement(n.Fragment,null,"no list defined");return n.createElement(o.a,{header:"\u66f4\u6539"+this.label},n.createElement("div",{className:"my-3"},s))})}internalStart(){return f(this,void 0,void 0,function*(){return new Promise((e,t)=>{let i=n.createElement(this.page,{resolve:e,reject:t});r.b.push(i,t)})})}}var p=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class g extends a.a{constructor(){super(...arguments),this.onChange=(e=>{this.newValue=e;let t=this.value;this.isChanged=this.newValue!==t}),this.page=Object(s.a)(e=>n.createElement(o.a,{header:"\u66f4\u6539"+this.label},"ddd"))}internalStart(){return p(this,void 0,void 0,function*(){return new Promise((e,t)=>p(this,void 0,void 0,function*(){let{pickId:t}=this.uiItem;if(void 0===t)return void alert("IdItemEdit.pickId = undefined");let i=yield t(void 0,void 0,this.value);this.onChange(i.id),e(i)}))})}internalEnd(){return p(this,void 0,void 0,function*(){})}}var y=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};let b=class extends n.Component{constructor(e){super(e),this.defaultSepClassName="border-top edit-sep-light-gray",this.defaultRowContainerClassName="d-flex px-3 py-2 bg-white align-items-center",this.renderRow=((e,t)=>{let i,s,{name:r,type:o,required:a}=e,l=this.uiSchema[r];if(void 0===l)s=r;else{s=l.label;let e=l.Templet;if(void 0!==e)i="function"===typeof e?n.createElement("b",null,e(t)):n.createElement("b",null,e);else if(void 0!==t)switch(l.widget){case"radio":case"select":let{list:e}=l;i=n.createElement("b",null,e.find(e=>e.value===t).title);break;case"id":i=n.createElement("b",null,"no templet for ",r,"=",t)}}if(void 0===i)switch(o){default:i=t?n.createElement("b",null,t):n.createElement("small",{className:"text-muted"},"(\u65e0)");break;case"image":i=n.createElement(d.a,{className:"w-4c h-4c",src:t})}let c=!0===a&&n.createElement("span",{className:"text-danger"},"*");return n.createElement("div",{className:this.rowContainerClassName,onClick:()=>y(this,void 0,void 0,function*(){return yield this.rowClick(e,l,s,t)})},n.createElement("div",{className:"w-6c"},s," ",c),n.createElement("div",{className:"flex-fill d-flex justify-content-end"},i),!0!==this.props.stopEdit&&n.createElement("div",{className:"w-2c text-right"},n.createElement("i",{className:"fa fa-angle-right"})))}),this.rowClick=((e,t,i,n)=>y(this,void 0,void 0,function*(){let s,{onItemChanged:r,onItemClick:o,stopEdit:a}=this.props;if(!0===a)return;if(void 0!==o)return void(yield o(e,t,n));let l=function(e,t,i,n){let s;if(void 0!==t)switch(t.widget){default:break;case"id":s=g;break;case"text":s=c;break;case"image":s=u.a;break;case"select":s=v;break;case"radio":return new m(e,t,i,n)}if(void 0===s)switch(e.type){case"string":s=c;break;case"image":s=u.a}if(void 0===s)return;return new s(e,t,i,n)}(e,t,i,n);if(void 0!==l)try{(s=yield l.start())!==n&&(void 0===r?(alert(`${e.name} value changed, new: ${s}, pre: ${n}`),this.props.data[e.name]=s):yield r(e,s,n)),yield l.end()}catch(d){console.log("no value changed")}else alert("undefined: let itemEdit:ItemEdit = createItemEdit(itemSchema, uiItem, label, value);")}));let{topBorderClassName:t,bottomBorderClassName:i,sepClassName:s,rowContainerClassName:r,uiSchema:o,stopEdit:a}=e;this.topBorder=n.createElement("div",{className:t||this.defaultSepClassName}),this.bottomBorder=n.createElement("div",{className:i||this.defaultSepClassName}),this.rowContainerClassName=r||this.defaultRowContainerClassName,!0!==a&&(this.rowContainerClassName+=" cursor-pointer"),this.sep=n.createElement("div",{className:s||this.defaultSepClassName}),this.uiSchema=o&&o.items||{}}render(){let e=[],{schema:t}=this.props,i=t.length;e.push(this.topBorder);for(let n=0;n<i;n++){let i=t[n];n>0&&e.push(this.sep);let s=this.props.data[i.name];e.push(this.renderRow(i,s))}return e.push(this.bottomBorder),n.createElement("div",null,e.map((e,t)=>n.createElement(n.Fragment,{key:t},e)))}};b=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o}([s.a],b),i.d(t,"a",function(){return b})},function(e,t,i){"use strict";var n=i(0),s=i(4),r=i.n(s),o=i(5),a=i(2);class l{constructor(e){this.list=e}get isPaged(){let e=this.list.props.items;return null!==e&&void 0!==e&&!1===Array.isArray(e)}get items(){let e=this.list.props.items;return null===e?null:void 0!==e?!0===Array.isArray(e)?e:e.items:void 0}get loading(){let e=this.list.props.items;if(null===e)return!1;if(void 0===e)return!0;let t=e;return void 0!==t.items&&t.loading}get selectedItems(){}dispose(){}renderContent(e,t){let{render:i}=this.list.props.item;return void 0===i?n.createElement("div",{className:"px-3 py-2"},JSON.stringify(e)):i(e,t)}}(function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);r>3&&o&&Object.defineProperty(t,i,o)})([a.e],l.prototype,"loading",null);class c extends l{constructor(){super(...arguments),this.render=((e,t)=>{let{className:i,key:s,onClick:o}=this.list.props.item;return n.createElement("li",{key:void 0===s?t:s(e),className:r()("va-row-clickable",i),onClick:()=>o&&o(e)},this.renderContent(e,t))})}}var u=i(21);class d extends l{constructor(){super(...arguments),this.render=((e,t)=>{let{className:i,key:s}=this.list.props.item;if("string"===typeof e){let t=r()("va-list-gap","px-3","pt-1");return n.createElement("li",{key:Object(u.a)(),className:t},e)}return n.createElement("li",{key:void 0===s?t:s(e),className:r()(i)},this.renderContent(e,t))})}}class h extends l{constructor(e){super(e),this.buildItems=(()=>{console.log("buildItems in selectable.tsx");let e,t,{items:i,selectedItems:n,compare:s}=this.list.props;if(void 0===i)return void(this._items=void 0);if(null===i)return void(this._items=null);e=!0===Array.isArray(i)?i:i.items,t=void 0===s?(e,t)=>e===t:s;let r=e.map(e=>{return{selected:void 0!==n&&void 0!==n.find(i=>t(e,i)),item:e,labelId:Object(u.a)()}});this._items=r}),this.render=((e,t)=>{let{className:i,key:s}=this.list.props.item,{labelId:o,selected:a,item:l}=e;return n.createElement("li",{key:void 0===s?t:s(e),className:r()(i)},n.createElement("div",{className:"d-flex align-items-center px-3"},n.createElement("input",{ref:e=>{e&&(this.input=e,e.checked=a)},className:"",type:"checkbox",value:"",id:o,defaultChecked:a,onChange:t=>{this.onSelect(e,t.target.checked)}}),n.createElement("label",{className:"",style:{flex:1,marginBottom:0},htmlFor:o},this.renderContent(l,t))))}),this.disposer=Object(a.d)(this.buildItems)}dispose(){this.disposer()}get items(){return this._items}selectAll(){this._items&&this._items.forEach(e=>e.selected=!0)}unselectAll(){this._items&&this._items.forEach(e=>e.selected=!1)}onSelect(e,t){e.selected=t;let i=this._items.some(e=>e.selected);this.list.props.item.onSelect(e.item,t,i)}get selectedItems(){return this._items.filter(e=>!0===e.selected).map(e=>e.item)}}(function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);r>3&&o&&Object.defineProperty(t,i,o)})([a.l],h.prototype,"_items",void 0);i(137);i.d(t,"a",function(){return m});let m=class extends n.Component{constructor(e){super(e),this._$scroll=(e=>{console.log("############### items scroll to "+e)}),this.buildBase()}buildBase(){let{item:e}=this.props,{onClick:t,onSelect:i}=e;void 0!==i?this.selectable=this.listBase=new h(this):this.listBase=void 0!==t?new c(this):new d(this)}componentWillUnmount(){this.listBase.dispose()}selectAll(){this.selectable&&this.selectable.selectAll()}unselectAll(){this.selectable&&this.selectable.unselectAll()}get selectedItems(){return this.listBase.selectedItems}render(){let{className:e,header:t,footer:i,before:s,loading:o,none:a}=this.props;void 0===s&&(s="-"),void 0===o&&(o=(()=>n.createElement("i",{className:"fa fa-spinner fa-spin fa-2x fa-fw text-info"}))),void 0===a&&(a="none");let l,c,{items:u,loading:d}=this.listBase;function h(e,t){if(e)switch(typeof e){default:case"string":return n.createElement("li",{className:"va-list-"+t},e);case"function":return n.createElement("li",{className:"va-list-"+t},e());case"object":return n.createElement("li",null,e)}}return l=null===u?h(s,"before"):void 0===u?h(o,"loading"):0===u.length?h(a,"none"):u.map((e,t)=>this.listBase.render(e,t)),!0===d&&u&&(c=h(o,"loading")),n.createElement("ul",{className:r()("va-list",e)},h(t,"header"),l,c,h(i,"footer"))}};m=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o}([o.a],m)},function(e,t,i){"use strict";var n=i(0),s=i(4),r=i.n(s);class o{setValues(e){}}class a extends o{render(e){return n.createElement("div",{key:"_b_"+e,className:""},n.createElement("div",{className:"w-100"},n.createElement("div",{style:{borderTop:"1px solid #f0f0f0"}})))}}class l extends o{constructor(e){super(),this.param=e}render(e){let t;switch(this.param){default:t="py-2";break;case"=":t="py-1";break;case"-":t="pb-1"}let i=r()(t);return n.createElement("div",{key:"_g_"+e,className:i,style:{backgroundColor:"#f0f0f0"}})}}const c="justify-content-start",u="justify-content-center",d="justify-content-end";class h extends o{constructor(e,t){super(),this.gridProps=e,this.prop=t,this.col=!0===e.labelFixLeft?"col":"col-sm"}render(e){let{onClick:t,bk:i}=this.prop,s=r()({"cursor-pointer":void 0!==t,"bg-white":void 0===i,row:!0});return n.createElement("div",{key:e,className:s,onClick:t},this.renderLabel(),this.renderProp())}renderLabel(){let{label:e}=this.prop;return void 0===e?null:n.createElement("label",{className:this.col+"-3 col-form-label"},e)}renderProp(){let e,t,{label:i}=this.prop;switch(this.gridProps.alignValue){case"left":e=c;break;case"center":e=u;break;case"right":e=d}switch(this.prop.vAlign){case"top":t="align-items-start";break;default:case"center":t="align-items-center";break;case"bottom":t="align-items-end";break;case"stretch":t="align-items-stretch"}let s=this.col+(void 0===i?"-12":"-9"),o=r()(e,t,s,"d-flex");return n.createElement("div",{className:o},this.renderPropBody())}renderPropBody(){return n.createElement("div",{className:"form-control-plaintext"},this.renderPropContent())}renderPropContent(){return this.content}}class m extends h{setValues(e){this.content=void 0===e?void 0:e[this.prop.name]}}class f extends h{setValues(e){this.content=void 0===e?void 0:e[this.prop.name]}}class v extends h{setValues(e){if(void 0===e)this.content=void 0;else{let t=this.prop.list;this.content="string"===typeof t?e[t]:void 0}}renderPropBody(){let{list:e,row:t}=this.prop,i="string"===typeof e?this.content:e;return void 0===i?n.createElement("div",null):n.createElement("div",{className:"w-100"},i.map((e,i)=>n.createElement(n.Fragment,{key:i},0===i?null:n.createElement("div",{style:{width:"100%",borderBottom:"1px solid #f0f0f0"}}),n.createElement(t,e))))}}class p extends h{renderPropBody(){let{component:e}=this.prop;return e}renderProp(){let e,t,i,{label:s,full:o}=this.prop;switch(this.gridProps.alignValue){case"left":e=c;break;case"center":e=u;break;case"right":e=d}switch(this.prop.vAlign){case"top":t="align-items-start";break;default:case"center":t="align-items-center";break;case"bottom":t="align-items-end";break;case"stretch":t="align-items-stretch"}i=!0!==o?this.col+(void 0===s?"-12":"-9"):"w-100";let a=r()(e,t,i,"d-flex");return n.createElement("div",{className:a},this.renderPropBody())}}class g{constructor(e,t){this.gridProps=e,this.props=t,this.buildRows()}buildRows(){this.rows=[];let e=!0;for(let t of this.props)if("string"===typeof t)this.rows.push(new l(t)),e=!0;else{let i;switch(e||this.rows.push(new a),t.type){default:continue;case"string":i=new m(this.gridProps,t);break;case"number":i=new f(this.gridProps,t);break;case"list":i=new v(this.gridProps,t);break;case"component":i=new p(this.gridProps,t)}this.rows.push(i),e=!1}}setValues(e){for(let t of this.rows)t.setValues(e)}render(){return this.rows.map((e,t)=>e.render(String(t)))}}var y=i(5);let b=class extends n.Component{render(){let{className:e,rows:t,values:i}=this.props,s=new g(this.props,t);s.setValues(i);let o=r()("container-fluid",e);return n.createElement("div",{className:o},s.render())}};b=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o}([y.a],b),i.d(t,"a",function(){return b})},function(e,t,i){"use strict";var n=i(0),s=i(2),r=i(5),o=i(4),a=i.n(o),l=(i(135),function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o}),c=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class u{get content(){return!0!==this.selected?this._content:void 0!==this._content?this._content:this._content=this.contentBuilder()}start(){return c(this,void 0,void 0,function*(){void 0===this._content&&void 0!==this.load&&(yield this.load())})}}l([s.l],u.prototype,"selected",void 0);let d=class extends n.Component{constructor(e){super(e),this.tabClick=(e=>c(this,void 0,void 0,function*(){yield e.start(),this.selectedTab.selected=!1,e.selected=!0,this.selectedTab=e}));let{size:t,tabs:i,tabBack:n,contentBack:s,sep:r,selected:o}=this.props;this.size=t||"md",this.tabs=i.map(e=>{let t=new u;return t.name=e.name,t.selected=!1,t.caption=e.caption,t.contentBuilder=e.content,t.notify=e.notify,t.load=e.load,t}),this.tabBack=n||"bg-light",this.contentBack=s,this.sep=r||"border-top border-gray",void 0!==o&&(this.selectedTab=this.tabs.find(e=>e.name===o)),void 0===this.selectedTab&&(this.selectedTab=this.tabs[0]),this.selectedTab.selected=!0}componentDidMount(){return c(this,void 0,void 0,function*(){if(void 0===this.tabs)return;if(0===this.tabs.length)return;let e=this.tabs[0];yield e.start()})}showTab(e){let t=this.tabs.find(t=>t.name===e);void 0!==t&&(void 0!==this.selectedTab&&(this.selectedTab.selected=!1),t.selected=!0,this.selectedTab=t)}render(){let e=a()("tab","tab-"+this.size),t=n.createElement("div",{className:a()(this.contentBack,"tab-content")},this.tabs.map((e,t)=>{let i={display:!0===e.selected?void 0:"none"};return n.createElement("div",{key:t,style:i},e.content)})),i=n.createElement("div",{className:a()(this.tabBack,this.sep,"tab-tabs")},this.tabs.map((e,t)=>{let i,{selected:s,caption:r,notify:o}=e;if(void 0!==o){let e=o.get();void 0!==e&&(e>0?i=n.createElement("u",null,e>99?"99+":e):e<0&&(i=n.createElement("u",{className:"dot"})))}return n.createElement("div",{key:t,className:"",onClick:()=>this.tabClick(e)},n.createElement("div",{className:"align-self-center"},i,r(s)))}));return n.createElement("div",{className:e},"top"===this.props.tabPosition?n.createElement(n.Fragment,null,i,t):n.createElement(n.Fragment,null,t,i))}};l([s.l],d.prototype,"selectedTab",void 0),l([s.l],d.prototype,"tabs",void 0),d=l([r.a],d)},function(e,t,i){"use strict";var n=i(0),s=i(2),r=i(1),o=i(44),a=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class l extends n.Component{constructor(e){super(e),this.schema=[{name:"nick",type:"string"},{name:"icon",type:"image"}],this.uiSchema={items:{nick:{widget:"text",label:"\u522b\u540d",placeholder:"\u597d\u7684\u522b\u540d\u66f4\u65b9\u4fbf\u8bb0\u5fc6"},icon:{widget:"image",label:"\u5934\u50cf"}}},this.onItemChanged=((e,t,i)=>a(this,void 0,void 0,function*(){let{name:i}=e;yield o.a.userSetProp(i,t),this.data[i]=t,r.nav.user[i]=t,r.nav.saveLocalUser()}));let{nick:t,icon:i}=r.nav.user;this.data={nick:t,icon:i}}render(){return n.createElement(r.Page,{header:"\u4e2a\u4eba\u4fe1\u606f"},n.createElement(r.Edit,{schema:this.schema,uiSchema:this.uiSchema,data:this.data,onItemChanged:this.onItemChanged}))}}(function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);r>3&&o&&Object.defineProperty(t,i,o)})([s.l],l.prototype,"data",void 0),i.d(t,"a",function(){return l})},function(e,t,i){"use strict";i.d(t,"a",function(){return o});var n=i(0),s=i(7),r=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class o extends n.Component{constructor(){super(...arguments),this.reApi=(()=>r(this,void 0,void 0,function*(){this.props.clearError();const{channel:e,url:t,options:i,resolve:n,reject:r}=this.props;yield Object(s.n)(e,t,i,n,r)})),this.close=(()=>r(this,void 0,void 0,function*(){this.props.clearError()}))}render(){let e,{error:t,url:i}=this.props;if("object"===typeof t){let i=[];for(let e in t)i.push(n.createElement("li",{key:e},n.createElement("label",null,e),n.createElement("div",null,t[e])));e=n.createElement("ul",null,i)}else e=n.createElement("div",null,t);return n.createElement("li",null,n.createElement("article",{className:"page-container"},n.createElement("section",null,n.createElement("div",{className:"va-error"},n.createElement("div",null,"\u7f51\u7edc\u51fa\u73b0\u95ee\u9898"),n.createElement("div",null,"\u70b9\u51fb\u91cd\u65b0\u8bbf\u95ee"),n.createElement("div",null,"url: ",i),e,n.createElement("div",{className:"p-3"},n.createElement("button",{type:"button",onClick:this.reApi},"\u91cd\u65b0API"),n.createElement("button",{type:"button",onClick:this.close},"\u5173\u95ed"))))))}}},,function(e,t,i){"use strict";i.d(t,"a",function(){return a});var n=i(2),s=i(11),r=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o},o=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class a{constructor(e){this.invites=void 0,this.newInvitesCount=0,this.store=e}logout(){this.invites=void 0,this.newInvitesCount=0}msgUnitInvited(e){void 0===this.invites?this.newInvitesCount++:void 0===this.invites.find(t=>t.id===e.id)&&this.invites.push(e)}loadInvites(){return o(this,void 0,void 0,function*(){if(void 0===this.invites){let e;if(this.invites=[],void 0===e)return}})}refuseInvite(e){return o(this,void 0,void 0,function*(){yield s.a.removeMessage(e.id),this.removeInvite(e)})}removeInvite(e){let t=this.invites.findIndex(t=>t.id===e.id);this.invites.splice(t,1)}}r([n.l],a.prototype,"invites",void 0),r([n.l],a.prototype,"newInvitesCount",void 0)},function(e,t,i){},function(e,t,i){e.exports=i(227)},,,,,,,,,,function(e,t,i){},,function(e,t,i){},,function(e,t,i){},,function(e,t,i){},,function(e,t,i){},,function(e,t,i){},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,i){},,,,function(e,t,i){},,function(e,t,i){"use strict";i.r(t);var n=i(0),s=i(34),r=i(3),o=i(8),a=i.n(o),l=i(2),c=i(11);const u={id:0,name:"\u540c\u82b1\u7cfb\u7edf",nick:void 0,discription:"\u540c\u82b1\u5e73\u53f0",icon:void 0,date:void 0};var d=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o},h=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class m{constructor(e){this.id=e}get isOwner(){return this._isOwner}set isOwner(e){null===e&&(e=0),this._isOwner=e}get isAdmin(){return this._isAdmin}set isAdmin(e){null===e&&(e=0),this._isAdmin=e}get isDev(){return 0!==(1&this.type)}get isHao(){return 0!==(2&this.type)}loadProps(){return h(this,void 0,void 0,function*(){let e=yield c.a.unitBase(this.id);if(void 0===e)return;let{name:t,discription:i,icon:n,nick:s,type:r,isOwner:o,isAdmin:a,owner:l,ownerName:u,ownerNick:d,ownerIcon:h}=e;this.name=t,this.discription=i,this.nick=s,this.icon=n,this.type=r,this.isOwner=o,this.isAdmin=a,this.owner=l,this.ownerName=u,this.ownerNick=d,this.ownerIcon=h})}loadApps(){return h(this,void 0,void 0,function*(){let e,t=yield c.a.apps(this.id);void 0!==t&&(e=t.apps,0===t.id&&a.a.assign(t,u),a.a.assign(this,t),this.apps=e)})}loadMessages(){return h(this,void 0,void 0,function*(){})}messageReadClear(){return h(this,void 0,void 0,function*(){})}messageAct(e,t){return h(this,void 0,void 0,function*(){})}}d([l.l],m.prototype,"apps",void 0),d([l.l],m.prototype,"unread",void 0),d([l.l],m.prototype,"date",void 0);var f=i(5),v=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class p extends r.VPage{constructor(){super(...arguments),this.page=(()=>{let e=n.createElement("button",{className:"btn btn-success btn-sm",onClick:this.showLogs},"log");return n.createElement(r.Page,{header:"\u5173\u4e8e\u540c\u82b1",right:e},n.createElement("div",{className:"p-3 bg-white h-100"},n.createElement("p",null,n.createElement("b",null,n.createElement("span",{className:"text-primary"},"\u540c"),n.createElement("span",{className:"text-danger"},"\u82b1"),"\uff0c \u5c31\u8981",n.createElement("span",{className:"text-success"},"\u987a")," \uff01")),n.createElement("p",null,"\u6570\u636e\u5982\u82b1\uff0c\u8ba9\u534f\u4f5c\u66f4\u987a\u7545")))}),this.showLogs=(()=>{this.openPage(this.logs)}),this.logs=(()=>n.createElement(r.Page,{header:"Logs"},r.nav.logs.map((e,t)=>n.createElement("div",{key:t,className:"px-3 py-1"},e))))}open(){return v(this,void 0,void 0,function*(){this.openPage(this.page)})}}function g(e,t){return t?n.createElement(n.Fragment,null,n.createElement("b",null,t)," \xa0 ",n.createElement("small",{className:"muted"},e)):n.createElement("b",null,e)}var y=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class b extends r.VPage{constructor(){super(...arguments),this.exit=(()=>{r.nav.showLogout(()=>y(this,void 0,void 0,function*(){this.controller.logout()}))}),this.about=(()=>{this.openVPage(p)}),this.onEditMe=(()=>{this.openPageElement(n.createElement(r.EditMeInfo,null))}),this.changePassword=(()=>y(this,void 0,void 0,function*(){yield r.nav.changePassword()})),this.page=Object(f.a)(()=>{const{user:e}=r.nav;if(void 0===e)return n.createElement(r.Page,{header:"loged out"},"loged out");let{name:t,nick:i,id:s,icon:o}=e,a=["",{type:"component",component:n.createElement(r.LMR,{className:"py-2 cursor-pointer w-100",left:n.createElement(r.Image,{className:"w-3c h-3c mr-3",src:o}),right:n.createElement(r.FA,{className:"align-self-end",name:"chevron-right"})},n.createElement("div",null,n.createElement("div",null,g(t,i)),n.createElement("div",{className:"small"},n.createElement("span",{className:"text-muted"},"ID:")," ",s>1e4?s:String(s+1e4).substr(1)))),onClick:this.onEditMe},"",{type:"component",component:n.createElement(r.IconText,{iconClass:"text-info mr-2",icon:"laptop",text:"\u6211\u7684\u5c0f\u53f7"}),onClick:()=>this.controller.showMyUnits()}];return a.push("",{type:"component",component:n.createElement(r.IconText,{iconClass:"text-info mr-2",icon:"key",text:"\u4fee\u6539\u5bc6\u7801"}),onClick:this.changePassword},{type:"component",component:n.createElement(r.IconText,{iconClass:"text-info mr-2",icon:"smile-o",text:"\u5173\u4e8e\u540c\u82b1"}),onClick:this.about},"","",{type:"component",bk:"",component:n.createElement("button",{className:"btn btn-danger w-100",onClick:this.exit},n.createElement(r.FA,{name:"sign-out",size:"lg"})," \u9000\u51fa\u767b\u5f55")}),n.createElement(r.Page,{header:"\u6211"},n.createElement(r.PropGrid,{rows:a,values:{}}))})}open(){return y(this,void 0,void 0,function*(){this.openPage(this.page)})}}var w=i(4),x=i.n(w),E=i(67),k=i.n(E),C=(i(68),function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})});function P(e,t,i,n,s){return C(this,void 0,void 0,function*(){let{url:o,urlDebug:a}=e;if(!o)return void alert("APP: "+e.name+"\n"+e.discription+"\n\u5c1a\u672a\u7ed1\u5b9a\u670d\u52a1");let l=o;if(a){!0===(yield r.host.localCheck(a))&&(l=a)}yield r.nav.navToApp(l,t,i,n,s)})}const N="------\n### \u9879\u76ee\u63cf\u8ff0\uff0c\u6682\u65e0\u3002\u7528markdown\u65b9\u5f0f\u63cf\u8ff0\n";var I=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class S extends r.View{constructor(){super(...arguments),this.appClick=(e=>I(this,void 0,void 0,function*(){let t=this.controller.unit.id;0===e.id||(yield P(e,t))})),this.renderRow=((e,t)=>{let{id:i,name:s,caption:o,icon:a,discription:l}=e;return n.createElement(r.LMR,{className:"px-3 py-2",left:n.createElement(r.Badge,null,n.createElement(r.Image,{src:a}))},n.createElement("div",{className:"px-3"},n.createElement("div",null,n.createElement("b",null,o||s)),n.createElement("small",{className:"text-muted"},l)))}),this.clickToAdmin=(()=>I(this,void 0,void 0,function*(){let e=this.controller.unit.id;yield P(void 0,e)}))}render(){let{unit:e}=this.controller;if(!e)return null;let{apps:t}=e;return void 0===t||0===t.length?n.createElement(k.a,{className:"bg-white p-3",source:e.discription||N}):n.createElement(r.List,{items:t,item:{render:this.renderRow,onClick:this.appClick}})}}var F=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class T extends r.VPage{constructor(){super(...arguments),this.sideBarOpened=!1,this.confirmClose=(()=>F(this,void 0,void 0,function*(){return document.removeEventListener("click",this.handleDocumentClick),!0})),this.handleDocumentClick=(e=>F(this,void 0,void 0,function*(){if(this.elToggleButton&&this.elToggleButton.contains(e.target))return!1===this.sideBarOpened&&(yield Promise.all([this.controller.loadStickies()])),void this.toggleOpen();this.elSideBar&&(this.elSideBar.contains(e.target)||this.closeSideBar())})),this.page=Object(f.a)(()=>{let e,{unit:t}=this.controller,i=n.createElement("div",{ref:e=>this.elToggleButton=e,className:"p-2 cursor-pointer"},n.createElement(r.FA,{name:"navicon",size:"lg"})),s=t?t.nick||t.name:"\u540c\u82b1";if(void 0===t){let{user:t}=r.nav;if(void 0!==t){let{nick:i,name:s}=t;e=n.createElement("div",{className:"p-3"},"\u6b22\u8fce\u4f60\uff0c",i||s)}else e=n.createElement("div",{className:"p-3"},"no unit, no user")}else e=n.createElement("div",{className:"flex-fill"},this.renderVm(S));let o=this.sideBar();return n.createElement(r.Page,{header:s,right:i,sideBar:o},n.createElement("div",{className:"d-flex h-100"},e))}),this.toggleOpen=(()=>{this.sideBarOpened=!this.sideBarOpened}),this.onMeClick=(()=>F(this,void 0,void 0,function*(){this.closeSideBar(),yield this.controller.showMe()})),this.onAboutUnit=(()=>F(this,void 0,void 0,function*(){this.closeSideBar(),yield this.controller.showUnitAbout()})),this.cnItems="py-2 cursor-pointer border-bottom border-info align-items-center",this.stickyClick=(e=>F(this,void 0,void 0,function*(){this.closeSideBar(),yield this.controller.showUnit(e.objId)})),this.stickyRender=((e,t)=>{let i,{type:n,date:s,objId:r,obj:o}=e,a=this.controller.units.get(r);void 0!==a&&(i=a.unread,s=a.date);let{unit:l}=this.controller,c=l&&l.id;switch(n){case 3:return void 0===o?null:o.id===c?null:this.stickyUnit(s,o,i);case 0:if(void 0===o)return;return this.stickyUnit(s,o,i)}})}open(){return F(this,void 0,void 0,function*(){document.addEventListener("click",this.handleDocumentClick),this.regConfirmClose(this.confirmClose),this.openPage(this.page)})}closeSideBar(){this.sideBarOpened=!1}aboutUnit(){let{unit:e}=this.controller;if(void 0===e)return null;let{icon:t,name:i,nick:s}=e,o=n.createElement(r.Image,{className:"w-2c h-2c mr-3",src:t}),a=n.createElement(r.FA,{name:"ellipsis-h"}),l=s?n.createElement("div",null,n.createElement("div",null,s),n.createElement("div",{className:"small text-muted"},i)):i;return n.createElement(r.LMR,{className:x()("px-3",this.cnItems),left:o,right:a,onClick:this.onAboutUnit},l)}meItem(){let{user:e}=r.nav;if(void 0===e)return null;let{nick:t,icon:i,name:s}=e,o=n.createElement(r.Image,{className:"w-2c h-2c mr-3",src:i});return n.createElement(r.LMR,{className:x()("px-3",this.cnItems),left:o,onClick:this.onMeClick},n.createElement("div",{className:"my-3"},g(s,t)))}sideBar(){if(!1===this.sideBarOpened)return null;let{stickies:e}=this.controller,t={render:this.stickyRender,onClick:this.stickyClick,key:e=>String(e.objId)};return n.createElement("div",{className:"w-30c position-absolute bg-white h-100 shadow-lg border-right border-light",style:{zIndex:1001,right:0,overflowX:"hidden",overflowY:"auto"},ref:e=>this.elSideBar=e},this.meItem(),this.aboutUnit(),n.createElement(r.List,{items:e,item:t,none:null}))}stickyUnit(e,t,i){let s,{name:o,nick:a,discription:l,icon:c,date:u,subject:d}=t;return s=void 0!==d?n.createElement("div",{className:"small text-success"},d):n.createElement("div",{className:"small text-muted"},l),n.createElement(r.LMR,{className:"px-3 py-2",left:n.createElement(r.Badge,{size:"xs",badge:i||t.unread},n.createElement(r.Image,{src:c})),right:n.createElement("small",{className:"text-muted"},n.createElement(r.EasyDate,{date:e}))},n.createElement("div",{className:"px-3"},n.createElement("div",null,a||o),s))}}(function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);r>3&&o&&Object.defineProperty(t,i,o)})([l.l],T.prototype,"sideBarOpened",void 0);var O=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class R extends r.VPage{constructor(){super(...arguments),this.clickToAdmin=(()=>O(this,void 0,void 0,function*(){yield this.controller.navToAdmin()})),this.page=(()=>{let e,{unit:t}=this.controller,{id:i,name:s,nick:o,discription:a,apps:l,icon:c,ownerName:u,ownerNick:d,isOwner:h,isAdmin:m}=t;d&&(d="- "+d),1!==h&&1!==m||(e=n.createElement("button",{className:"btn btn-success btn-sm align-self-start",onClick:()=>this.clickToAdmin()},"\u8fdb\u5165\u7ba1\u7406"));let f=n.createElement("div",{className:"mr-3 w-4c h-4c"},n.createElement(r.Image,{src:c}));return n.createElement(r.Page,{header:"\u5173\u4e8e "+(o||s)},n.createElement(r.LMR,{className:"my-3 container-fluid",left:f,right:e},n.createElement("div",{className:"mb-3"},o?n.createElement(n.Fragment,null,n.createElement("div",null,n.createElement("b",null,o)),n.createElement("div",{className:"small text-muted"},s)):s),n.createElement("div",{className:"row"},n.createElement("label",{className:"small text-dark col-3"},"\u53d1\u5e03\u8005\uff1a"),n.createElement("div",{className:"col-9"},u," ",d))),n.createElement("div",{className:"bg-white p-3"},n.createElement(k.a,{source:a||N})))})}open(){return O(this,void 0,void 0,function*(){this.openPage(this.page)})}}var A=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};const V={dev:"\u5f00\u53d1\u53f7",unit:"\u5c0f\u53f7"};class q extends r.VPage{constructor(){super(...arguments),this.page=(()=>{let{type:e,caption:t}=this.param,i=V[e],s=[{name:"name",type:"string",maxLength:50,required:!0}];"unit"===e&&s.push({name:"isPublic",type:"boolean"}),s.push({name:"submit",type:"submit"});let o={items:{name:{widget:"text",label:i,placeholder:"\u533a\u522b\u4e8e\u5176\u5b83\u7684\u552f\u4e00\u540d\u79f0"},isPublic:{widget:"checkbox",label:"\u516c\u5f00"},submit:{widget:"button",label:"\u63d0\u4ea4",className:"btn btn-primary"}}};return n.createElement(r.Page,{header:t,back:"close"},n.createElement(r.Form,{onButtonClick:this.onSubmit,className:"m-3",schema:s,uiSchema:o,formData:{isPublic:!0},fieldLabelSize:2}))}),this.onSubmit=((e,t)=>A(this,void 0,void 0,function*(){let e=a.a.clone(t.data),i=e.isPublic;void 0!==i&&(e.isPulic=!0===i?1:0),e.type=this.param.type;let s,o=(yield this.controller.unitCreate(e)).unit;switch(o){default:return yield this.controller.reloadStickies(),this.closePage(),void this.openPageElement(n.createElement(r.Page,null,n.createElement("div",{className:"p-3 text-success"},n.createElement(r.FA,{name:"check"})," \u521b\u5efa\u5b8c\u6210",n.createElement("br",null),n.createElement("br",null),"\u968f\u540e\u53ef\u4ee5\u8fdb\u5165\u7ba1\u7406\uff0c\u5f00\u542f\u5e94\u7528\uff0c\u7ba1\u7406\u7528\u6237\u3002")));case 0:s="\u540d\u5b57\u5df2\u7ecf\u88ab\u4f7f\u7528\u4e86";break;case-1:this.closePage(),this.openPageElement(n.createElement(r.Page,null,n.createElement("div",{className:"p-3 text-success"},n.createElement(r.FA,{name:"check"})," \u65e0\u6cd5\u521b\u5efa",n.createElement("br",null),n.createElement("br",null),"\u5df2\u5230\u521b\u5efa\u4e0a\u9650")));break;case-2:s="\u9519\u8bef\u7f16\u53f7: "+o}t.setError("name",s)}))}open(e){return A(this,void 0,void 0,function*(){this.param=e,this.openPage(this.page)})}}var j=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};const U="\u521b\u5efa\u5c0f\u53f7",L="\u521b\u5efa\u5f00\u53d1\u53f7",M="py-2 cursor-pointer border-bottom border-info align-items-center";class D extends r.VPage{constructor(){super(...arguments),this.page=Object(f.a)(()=>{let e,{adminUnits:t}=this.controller;if(t&&t.length>0){let i=[];i.push(""),i.push({type:"component",component:n.createElement(r.List,{className:"w-100",items:t,item:{render:this.renderAdminUnit,onClick:this.clickAdminUnit}})}),e=n.createElement(r.PropGrid,{rows:i,values:{}})}return n.createElement(r.Page,{header:"\u6211\u7684\u5c0f\u53f7"},this.itemCreate(),e)}),this.renderAdminUnit=((e,t)=>{let i,s,{name:o,icon:a,isAdmin:l,isOwner:c,isDev:u,isHao:d}=e,h=[];c&&h.push("\u6240\u6709\u8005"),l&&h.push("\u7ba1\u7406\u5458"),h.length>0&&(i=n.createElement("small",{className:"text-muted"},h.join(", ")));let m=[];!0===d&&m.push("\u5c0f\u53f7"),!0===u&&m.push("\u5f00\u53d1\u53f7"),m.length>0&&(s=n.createElement(n.Fragment,null," \xa0 ",n.createElement("small",{className:"text-muted"},m.join(", "))));let f=n.createElement(r.Image,{className:"w-1-5c h-1-5c mr-2",src:a});return n.createElement(r.LMR,{className:"py-2",left:f,right:i},o,s)}),this.clickAdminUnit=(e=>{this.controller.navToAdmin(e)}),this.apply=(()=>{let{allowDev:e,sumDev:t,allowUnit:i,sumUnit:s}=this.controller.grant,o=[];e>t&&o.push("",{type:"component",component:n.createElement(r.IconText,{iconClass:"text-info mr-2",icon:"laptop",text:U}),onClick:this.applyUnit}),i>s&&o.push("=",{type:"component",component:n.createElement(r.IconText,{iconClass:"text-info mr-2",icon:"desktop",text:L}),onClick:this.applyDev}),r.nav.push(n.createElement(r.Page,{header:"\u521b\u5efa"},n.createElement(r.PropGrid,{rows:o,values:{}})))}),this.applyUnit=(()=>{this.showApplyPage("unit")}),this.applyDev=(()=>{this.showApplyPage("dev")})}open(){return j(this,void 0,void 0,function*(){this.openPage(this.page)})}itemCreate(){let{allowDev:e,sumDev:t,allowUnit:i,sumUnit:s}=this.controller.grant,o=[];if(e>t&&o.push({icon:"laptop",type:"dev",caption:"\u521b\u5efa\u5f00\u53d1\u53f7"}),i>s&&o.push({icon:"desktop",type:"unit",caption:"\u521b\u5efa\u5c0f\u53f7"}),0===o.length)return;let a=!0;return n.createElement(n.Fragment,null,o.map((e,t)=>{let i=["px-3 bg-white",M];!0===a&&(i.push("border-top"),a=!1);let{icon:s,type:o,caption:l}=e,c=n.createElement(r.FA,{name:s,size:"lg",className:"text-info mr-3"});return n.createElement(r.LMR,{key:t,className:x()(i),left:c,onClick:()=>this.openVPage(q,e)},l)}))}showApplyPage(e){}}var B=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o},_=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class $ extends r.Controller{constructor(){super(...arguments),this.units=new Map,this.unit=void 0}internalStart(){return _(this,void 0,void 0,function*(){yield this.showUnit(void 0),this.openVPage(T)})}showUnit(e){return _(this,void 0,void 0,function*(){if(void 0===this.unit){let e=new m(void 0);if(yield e.loadApps(),void 0===e.id)return;return this.unit=e,void(this.units[e.id]=this.unit)}this.unit.id!==e&&(this.unit=this.units.get(e),this.unit?yield this.unit.loadApps():alert(e+"not exists"))})}showUnitAbout(){return _(this,void 0,void 0,function*(){this.openVPage(R)})}showMyUnits(){return _(this,void 0,void 0,function*(){yield this.loadAdminUnits(),this.openVPage(D)})}reloadStickies(){return _(this,void 0,void 0,function*(){this.stickies=void 0,this.adminUnits=void 0,yield Promise.all([this.loadStickies(),this.loadAdminUnits()])})}loadStickies(){return _(this,void 0,void 0,function*(){if(void 0!==this.stickies)return;let e=[],t=yield c.a.stickies(),i=t[0],n=t[4];for(let s of i)switch(s.type){case 3:let e=s.obj=n.find(e=>e.id===s.objId),{id:t,type:i,name:r,nick:o,discription:a,icon:l,unread:c,date:u,owner:d}=e,h=new m(t);h.type=i,h.name=r,h.nick=o,h.discription=a,h.icon=l,h.unread=c,h.date=u,h.owner=d,this.units.set(t,h)}e.push(...i),this.stickies=e})}addSysUnitStick(e,t,i){if(void 0===t||t<=0)return;let n=a.a.clone(u);n.unread=t,e.unshift({id:0,date:new Date,type:0,objId:0,obj:n})}loadAdminUnits(){return _(this,void 0,void 0,function*(){if(void 0!==this.adminUnits)return;let e=yield c.a.adminUnits();this.adminUnits=[];for(let i of e[0]){let{id:e,name:t,nick:n,discription:s,icon:r,type:o,isAdmin:a,isOwner:l}=i,c=new m(e);c.name=t,c.nick=n,c.discription=s,c.icon=r,c.type=o,c.isAdmin=a,c.isOwner=l,this.adminUnits.push(c)}let t=e[1];0===t.length?this.grant={allowDev:0,sumDev:0,allowUnit:0,sumUnit:0}:this.grant=t[0]})}showMe(){return _(this,void 0,void 0,function*(){this.openVPage(b)})}navToAdmin(e){return _(this,void 0,void 0,function*(){void 0===this.adminApp&&(this.adminApp=yield c.a.adminUrl()),e||(e=this.unit),e&&(yield P(this.adminApp,e.id),yield this.unit.loadApps())})}logout(){return _(this,void 0,void 0,function*(){this.stickies.splice(0,this.stickies.length),this.units.clear(),this.unit=void 0,r.nav.logout()})}unitCreate(e){return _(this,void 0,void 0,function*(){return yield c.a.unitCreateDirect(e)})}}B([l.l],$.prototype,"stickies",void 0),B([l.l],$.prototype,"units",void 0),B([l.l],$.prototype,"unit",void 0),B([l.l],$.prototype,"adminUnits",void 0);i(221),i(223);var H=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};var W=class extends n.Component{onLogined(){return H(this,void 0,void 0,function*(){r.nav.clear();let e=new $(void 0);yield e.start()})}render(){return n.createElement(r.NavView,{onLogined:this.onLogined})}};const z=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function G(e){navigator.serviceWorker.register(e).then(e=>{e.onupdatefound=(()=>{const t=e.installing;t&&(t.onstatechange=(()=>{"installed"===t.state&&(navigator.serviceWorker.controller?console.log("New content is available; please refresh."):console.log("Content is cached for offline use."))}))})}).catch(e=>{console.error("Error during service worker registration:",e)})}i(225);s.render(n.createElement(W,null),document.getElementById("root")),function(){if("serviceWorker"in navigator){if(new URL("/app",window.location.toString()).origin!==window.location.origin)return;window.addEventListener("load",()=>{const e="/app/service-worker.js";z?function(e){fetch(e).then(t=>{404===t.status||-1===t.headers.get("content-type").indexOf("javascript")?navigator.serviceWorker.ready.then(e=>{e.unregister().then(()=>{window.location.reload()})}):G(e)}).catch(()=>{console.log("No internet connection found. App is running in offline mode.")})}(e):G(e)})}}()}],[[117,4,3]]]);
//# sourceMappingURL=main.71297f90.chunk.js.map